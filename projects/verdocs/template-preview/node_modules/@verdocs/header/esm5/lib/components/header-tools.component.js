/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Injector, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { Router } from '@angular/router';
import { MatSnackBar } from '@angular/material/snack-bar';
import { NotificationService } from '@verdocs/notifications';
import { OrganizationDialogService } from '@verdocs/profiles';
import { VerdocsStateService, VerdocsAuthGuardService, VerdocsTokenObjectService } from '@verdocs/tokens';
import { Subscription } from 'rxjs';
import { findIndex, includes } from 'lodash';
import { connectionConfigToken } from '../header.module';
import { VerdocsHeaderService } from '../services/header.service';
var HeaderToolsComponent = /** @class */ (function () {
    function HeaderToolsComponent(verdocsStateService, verdocsObjectService, verdocsAuthGuardService, organizationDialogService, notificationsService, verdocsHeaderService, snackbar, injector, router, platform) {
        this.verdocsStateService = verdocsStateService;
        this.verdocsObjectService = verdocsObjectService;
        this.verdocsAuthGuardService = verdocsAuthGuardService;
        this.organizationDialogService = organizationDialogService;
        this.notificationsService = notificationsService;
        this.verdocsHeaderService = verdocsHeaderService;
        this.snackbar = snackbar;
        this.injector = injector;
        this.router = router;
        this.platform = platform;
        this.apps = [];
        this.notifications = [];
        this.profileLoading = false;
        this.hasProfile = false;
        this.profileOverride = {
            top: 56,
            right: 20
        };
        this.sidenav = false;
        this.type = 'default';
        this.notificationsSubscription = new Subscription();
        this.profileLoadingSubscription = new Subscription();
        this.tokenConfig = this.injector.get(connectionConfigToken);
        this.myAccountUrl = this.tokenConfig.rAccount_frontend_url;
        this.rSecureUrl = this.tokenConfig.rSecure_frontend_url;
        this.rFormUrl = this.tokenConfig.rForm_frontend_url;
        this.termsUrl = this.tokenConfig.rSecure_frontend_url + '/terms';
        this.privacyUrl = this.tokenConfig.rSecure_frontend_url + '/privacy';
        this.loginUrl = this.tokenConfig.rSecure_frontend_url + '/login';
        this.signupUrl = this.tokenConfig.rSecure_frontend_url + '/signup';
        this.organizationImgSrc = this.tokenConfig.rAccount_frontend_url + "/assets/organization/select-profile.png";
        this.verdocs_logo_url = this.rFormUrl + "/assets/blue-logo.svg";
        this.origin = this.tokenConfig.origin;
        this.isAtOriginalOrigin = this.verdocsHeaderService.getAtOrigin(this.origin);
    }
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.checkEmailVerification();
        this.hasProfile = this.verdocsObjectService.getProfile();
        this.verdocsHeaderService.userProfileSubject.subscribe((/**
         * @param {?} profiles
         * @return {?}
         */
        function (profiles) {
            _this.profiles = _this.verdocsHeaderService.getProfileCollection(profiles);
            _this.verdocsHeaderService.profilesSubject.next(profiles);
            /** @type {?} */
            var index = findIndex(profiles, { organization_id: _this.organization_id });
            if (index >= 0) {
                _this.newProfile = profiles[index];
                _this.organizationDialogService.setNewProfile(_this.newProfile);
            }
        }));
        this.notificationsSubscription = this.notificationsService.Notificatations().subscribe((/**
         * @param {?} notifications
         * @return {?}
         */
        function (notifications) {
            _this.notifications = notifications;
        }));
        this.profileLoadingSubscription = this.verdocsHeaderService.profileLoadingSubject.subscribe((/**
         * @param {?} status
         * @return {?}
         */
        function (status) {
            _this.profileLoading = status;
        }));
        if (!this.profiles && this.hasProfile) {
            this.verdocsHeaderService.getProfiles();
        }
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.ngAfterContentChecked = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            if (typeof window !== 'undefined') {
                if (window.innerWidth > 600) {
                    this.profileOverride.top = 60;
                }
                else {
                    this.profileOverride.top = 56;
                }
            }
        }
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.notificationsSubscription.unsubscribe();
        this.profileLoadingSubscription.unsubscribe();
    };
    /**
     * @private
     * @return {?}
     */
    HeaderToolsComponent.prototype.checkEmailVerification = /**
     * @private
     * @return {?}
     */
    function () {
        this.emailVerified = this.verdocsStateService.getEmailVerification();
        this.organizationDialogService.setEmailVerified(this.emailVerified);
    };
    Object.defineProperty(HeaderToolsComponent.prototype, "admin_url", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.hasAccessToAdmin()) {
                return this.tokenConfig.rAccount_frontend_url + "/admin";
            }
            return undefined;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} notification
     * @return {?}
     */
    HeaderToolsComponent.prototype.removeNotification = /**
     * @param {?} notification
     * @return {?}
     */
    function (notification) {
        this.notificationsService.dismissNotification(notification);
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.signOut = /**
     * @return {?}
     */
    function () {
        this.verdocsAuthGuardService.signOut();
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.signIn = /**
     * @return {?}
     */
    function () {
        if (window) {
            window.location.href = this.rSecureUrl + "/login?redirect_url=" + (this.rFormUrl + this.router.url);
        }
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.signUp = /**
     * @return {?}
     */
    function () {
        if (window) {
            window.location.href = this.rSecureUrl + "/signup?redirect_url=" + (this.rFormUrl + this.router.url);
        }
    };
    /**
     * @param {?} profile_id
     * @return {?}
     */
    HeaderToolsComponent.prototype.switch = /**
     * @param {?} profile_id
     * @return {?}
     */
    function (profile_id) {
        var _this = this;
        this.verdocsHeaderService.switchProfile(profile_id).then((/**
         * @return {?}
         */
        function () {
            window.location.href = "" + _this.tokenConfig.rForm_frontend_url;
        }));
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.switchAndGoToAdmin = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.newProfile) {
            this.verdocsHeaderService.switchProfile(this.newProfile.id).then((/**
             * @param {?} profile
             * @return {?}
             */
            function (profile) {
                window.location.href = _this.myAccountUrl + "/admin/profile/" + _this.newProfile.id;
            }));
        }
    };
    /**
     * @param {?=} sendMessage
     * @return {?}
     */
    HeaderToolsComponent.prototype.updateTokenStatus = /**
     * @param {?=} sendMessage
     * @return {?}
     */
    function (sendMessage) {
        var _this = this;
        this.createSnackbar('Checking email verification', 'OK');
        this.verdocsHeaderService.updateTokens(sendMessage).then((/**
         * @return {?}
         */
        function () {
            _this.emailVerified = _this.verdocsStateService.getEmailVerification();
            _this.organizationDialogService.setEmailVerified(_this.emailVerified);
        }));
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.resendEmailVerification = /**
     * @return {?}
     */
    function () {
        this.verdocsHeaderService.resendEmailVerification();
    };
    /**
     * @param {?} name
     * @return {?}
     */
    HeaderToolsComponent.prototype.checkNameValidity = /**
     * @param {?} name
     * @return {?}
     */
    function (name) {
        var _this = this;
        return this.verdocsHeaderService.getNameValidity(name)
            .then((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            _this.organizationDialogService.setNameValidation(result);
        }));
    };
    /**
     * @param {?} organizationGroup
     * @return {?}
     */
    HeaderToolsComponent.prototype.createOrganization = /**
     * @param {?} organizationGroup
     * @return {?}
     */
    function (organizationGroup) {
        var _this = this;
        this.verdocsHeaderService.createOrganization(organizationGroup)
            .then((/**
         * @param {?} organization
         * @return {?}
         */
        function (organization) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.organization_id = organization['id'];
                        return [4 /*yield*/, this.verdocsHeaderService.getAccountData()];
                    case 1:
                        _a.sent();
                        this.createSnackbar('Organization created', null);
                        return [2 /*return*/];
                }
            });
        }); }));
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.switchProfile = /**
     * @return {?}
     */
    function () {
        this.switch(this.newProfile.id);
    };
    /**
     * @param {?} clientName
     * @return {?}
     */
    HeaderToolsComponent.prototype.checkAccess = /**
     * @param {?} clientName
     * @return {?}
     */
    function (clientName) {
        return this.verdocsStateService.hasAccessTo(clientName + '_Realster');
    };
    /**
     * @param {?} clientName
     * @return {?}
     */
    HeaderToolsComponent.prototype.jumpTo = /**
     * @param {?} clientName
     * @return {?}
     */
    function (clientName) {
        window.location.href = this.tokenConfig[clientName + '_frontend_url'];
    };
    /**
     * @private
     * @return {?}
     */
    HeaderToolsComponent.prototype.hasAccessToAdmin = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var roles = this.verdocsStateService.getRAccountRoles();
        return includes(roles, 'owner') || includes(roles, 'admin');
    };
    /**
     * @param {?} message
     * @param {?=} buttonTitle
     * @return {?}
     */
    HeaderToolsComponent.prototype.createSnackbar = /**
     * @param {?} message
     * @param {?=} buttonTitle
     * @return {?}
     */
    function (message, buttonTitle) {
        if (!buttonTitle) {
            buttonTitle = null;
        }
        /** @type {?} */
        var snackbarConfig;
        if (window.innerWidth >= 920) {
            snackbarConfig = {
                verticalPosition: 'bottom',
                horizontalPosition: 'left',
                duration: 5000
            };
        }
        else {
            snackbarConfig = {
                verticalPosition: 'top',
                duration: 5000
            };
        }
        this.snackbar.open(message, buttonTitle, snackbarConfig);
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.lunchElevio = /**
     * @return {?}
     */
    function () {
        window['lunchElevio']();
    };
    /**
     * @return {?}
     */
    HeaderToolsComponent.prototype.lunchIntercom = /**
     * @return {?}
     */
    function () {
        window['lunchIntercom']();
    };
    HeaderToolsComponent.decorators = [
        { type: Component, args: [{
                    selector: 'verdocs-header-tools',
                    template: "<div class=\"verdocs__wrapper\" *ngIf=\"hasProfile\" [ngClass]=\"{sidenav: sidenav}\">\n  <div class=\"verdocs__chat\">\n    <button mat-icon-button *ngIf=\"!sidenav\" (click)=\"lunchIntercom()\" matTooltip=\"Live Chat\">\n      <mat-icon>forum</mat-icon>\n    </button>\n  </div>\n  <div class=\"verdocs__help\">\n    <button mat-icon-button *ngIf=\"!sidenav\" (click)=\"lunchElevio()\" matTooltip=\"Help Center\">\n      <mat-icon>help</mat-icon>\n    </button>\n  </div>\n  <div class=\"verdocs__notification\" *ngIf=\"!sidenav\" matTooltip=\"Notifications\">\n    <verdocs-notifications [notifications]=\"notifications\" (removeNotification)=\"removeNotification($event)\"\n      [verdocs_logo_url]=\"verdocs_logo_url\"></verdocs-notifications>\n  </div>\n  <div class=\"verdocs__account\" *ngIf=\"profiles\"\n    [ngClass]=\"{header: !sidenav, sidenav: sidenav, default: type === 'default'}\" matTooltip=\"My Account\">\n    <verdocs-profiles [currentProfile]=\"profiles.currentProfile()\" [override]=\"profileOverride\" [admin_url]=\"admin_url\">\n      <verdocs-account-dialog [profiles]=\"profiles\" [termsUrl]=\"termsUrl\" [privacyUrl]=\"privacyUrl\"\n        [accountUrl]=\"myAccountUrl\" (signOutEvent)=\"signOut()\" [admin_url]=\"admin_url\">\n        <verdocs-account-profile [profiles]=\"profiles\" [loading]=\"profileLoading\"\n          [organizationImgSrc]=\"organizationImgSrc\" (switchEvent)=\"switch($event)\"\n          (switchAndRedirectEvent)=\"switchAndGoToAdmin()\" (getEmailVerificationEvent)=\"updateTokenStatus()\"\n          (resendEmailVerificationEvent)=\"resendEmailVerification()\" (getNameValidityEvent)=\"checkNameValidity($event)\"\n          (createOrganizationEvent)=\"createOrganization($event)\" (switchProfileEvent)=\"switchProfile()\">\n        </verdocs-account-profile>\n      </verdocs-account-dialog>\n    </verdocs-profiles>\n  </div>\n</div>\n<div class=\"verdocs__wrapper\" *ngIf=\"!hasProfile\">\n  <a class=\"verdocs__signin-button\" mat-button [routerLink]=\"'/login'\"\n    *ngIf=\"origin === 'rSecure' && isAtOriginalOrigin\" [ngClass]=\"{preview: mode === 'preview'}\">Sign in</a>\n  <a class=\"verdocs__signup-button\" mat-button [routerLink]=\"'/signup'\"\n    *ngIf=\"origin === 'rSecure' && isAtOriginalOrigin\" [ngClass]=\"{preview: mode === 'preview'}\">Sign up</a>\n  <button class=\"verdocs__signin-button\" mat-button *ngIf=\"origin !== 'rSecure'\"\n    [ngClass]=\"{preview: mode === 'preview'}\" (click)=\"signIn()\">Sign in</button>\n  <button class=\"verdocs__signup-button\" mat-button *ngIf=\"origin !== 'rSecure'\"\n    [ngClass]=\"{preview: mode === 'preview'}\" (click)=\"signUp()\">Sign up</button>\n</div>",
                    styles: [".verdocs__wrapper{height:64px;flex-direction:row;box-sizing:border-box;display:flex;justify-content:flex-end;align-items:center}.verdocs__notification{margin-top:0;line-height:64px}@media only screen and (max-width:600px){.verdocs__wrapper{height:56px}.verdocs__notification{line-height:56px}}.verdocs__chat{line-height:64px;margin-right:7px}.verdocs__chat button{height:40px;min-width:40px}.verdocs__help{line-height:64px;margin-right:7px}.verdocs__help button{height:40px;min-width:40px}.verdocs__app{line-height:64px}.verdocs__app-button{padding:0;height:48px;min-width:48px;border-radius:24px}.verdocs__app.sidenav{margin-right:4px}@media only screen and (max-width:600px){.verdocs__app{line-height:56px}}.verdocs__account{line-height:64px}.verdocs__account-button{background-color:#9b9b9b;color:#fff}@media only screen and (max-width:854px){.verdocs__wrapper{display:none}.verdocs__wrapper.sidenav{display:flex}.verdocs__account.header.default,.verdocs__app.header.default,.verdocs__chat,.verdocs__help,.verdocs__notification{display:none}}@media only screen and (min-width:855px){.verdocs__account.sidenav,.verdocs__app.sidenav{display:none}}@media only screen and (max-width:600px){.verdocs__account{line-height:56px}}.verdocs__account,.verdocs__app,.verdocs__chat,.verdocs__notification{float:left}.verdocs__signin-button,.verdocs__signup-button{padding-left:8px;padding-right:8px;border-radius:2px;height:36px;background-color:#33354c;color:#fff;min-width:60px}.verdocs__signin-button.preview,.verdocs__signup-button.preview{background-color:transparent;color:rgba(0,0,0,.87)}.verdocs__signup-button{margin-left:8px;border:.5px solid #fff}.verdocs__signup-button.preview{border:.5px solid rgba(0,0,0,.87)}.menu__container{width:320px;height:248px}.menu__container .mat-menu-content{padding:0}.menu__container.mat-menu-panel{padding:8px}.menu__item{padding:0!important;margin-bottom:8px!important;border:none;min-width:64px!important;border-radius:50%!important}.menu__item-wrapper{padding:12px;float:left;text-align:center}.menu__item-wrapper.my-account{padding-left:6.5px;padding-right:6.5px}.menu__item img{vertical-align:middle}.menu__icon{width:40px}.menu__icon.rForm{width:30px}.menu__background{background-color:#495057;width:64px;height:64px;line-height:64px;border-radius:50%}.menu__title{font-size:14px;text-align:center;line-height:20px}.menu__account-container{width:270px;height:228px}"]
                }] }
    ];
    /** @nocollapse */
    HeaderToolsComponent.ctorParameters = function () { return [
        { type: VerdocsStateService },
        { type: VerdocsTokenObjectService },
        { type: VerdocsAuthGuardService },
        { type: OrganizationDialogService },
        { type: NotificationService },
        { type: VerdocsHeaderService },
        { type: MatSnackBar },
        { type: Injector },
        { type: Router },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    HeaderToolsComponent.propDecorators = {
        profileOverride: [{ type: Input }],
        sidenav: [{ type: Input }],
        type: [{ type: Input }],
        mode: [{ type: Input }]
    };
    return HeaderToolsComponent;
}());
export { HeaderToolsComponent };
if (false) {
    /** @type {?} */
    HeaderToolsComponent.prototype.tokenConfig;
    /** @type {?} */
    HeaderToolsComponent.prototype.apps;
    /** @type {?} */
    HeaderToolsComponent.prototype.emailVerified;
    /** @type {?} */
    HeaderToolsComponent.prototype.notifications;
    /** @type {?} */
    HeaderToolsComponent.prototype.profiles;
    /** @type {?} */
    HeaderToolsComponent.prototype.newProfile;
    /** @type {?} */
    HeaderToolsComponent.prototype.organization_id;
    /** @type {?} */
    HeaderToolsComponent.prototype.myAccountUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.rSecureUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.rFormUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.termsUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.privacyUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.loginUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.signupUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.organizationImgSrc;
    /** @type {?} */
    HeaderToolsComponent.prototype.profileLoading;
    /** @type {?} */
    HeaderToolsComponent.prototype.hasProfile;
    /** @type {?} */
    HeaderToolsComponent.prototype.origin;
    /** @type {?} */
    HeaderToolsComponent.prototype.isAtOriginalOrigin;
    /** @type {?} */
    HeaderToolsComponent.prototype.verdocs_logo_url;
    /** @type {?} */
    HeaderToolsComponent.prototype.profileOverride;
    /** @type {?} */
    HeaderToolsComponent.prototype.sidenav;
    /** @type {?} */
    HeaderToolsComponent.prototype.type;
    /** @type {?} */
    HeaderToolsComponent.prototype.mode;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.notificationsSubscription;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.profileLoadingSubscription;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsStateService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsObjectService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsAuthGuardService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.organizationDialogService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.notificationsService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsHeaderService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.snackbar;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLXRvb2xzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL2hlYWRlci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlYWRlci10b29scy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFxQixLQUFLLEVBQUUsUUFBUSxFQUF1QixNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsV0FBVyxFQUFxQixNQUFNLDZCQUE2QixDQUFDO0FBQzdFLE9BQU8sRUFBRSxtQkFBbUIsRUFBZ0IsTUFBTSx3QkFBd0IsQ0FBQztBQUMzRSxPQUFPLEVBQXFCLHlCQUF5QixFQUErQixNQUFNLG1CQUFtQixDQUFDO0FBQzlHLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSx1QkFBdUIsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzFHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFFN0MsT0FBTyxFQUFvQixxQkFBcUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRWxFO0lBb0NFLDhCQUNVLG1CQUF3QyxFQUN4QyxvQkFBK0MsRUFDL0MsdUJBQWdELEVBQ2hELHlCQUFvRCxFQUNwRCxvQkFBeUMsRUFDekMsb0JBQTBDLEVBQzFDLFFBQXFCLEVBQ3JCLFFBQWtCLEVBQ2xCLE1BQWMsRUFDTyxRQUFRO1FBVDdCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFDeEMs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O3VCQUNMLEtBQUs7dUJBQ0wsS0FBSzs7SUE2TFIsMkJBQUM7Q0FBQSxBQTdORCxJQTZOQztTQXhOWSxvQkFBb0I7OztJQUMvQiwyQ0FBcUM7O0lBQ3JDLG9DQUFpQjs7SUFDakIsNkNBQThCOztJQUM5Qiw2Q0FBMEM7O0lBQzFDLHdDQUFtQzs7SUFDbkMsMENBQXVCOztJQUN2QiwrQ0FBK0I7O0lBQy9CLDRDQUE0Qjs7SUFDNUIsMENBQTBCOztJQUMxQix3Q0FBd0I7O0lBQ3hCLHdDQUF3Qjs7SUFDeEIsMENBQTBCOztJQUMxQix3Q0FBd0I7O0lBQ3hCLHlDQUF5Qjs7SUFDekIsa0RBQWtDOztJQUNsQyw4Q0FBOEI7O0lBQzlCLDBDQUEwQjs7SUFDMUIsc0NBQXVEOztJQUN2RCxrREFBbUM7O0lBQ25DLGdEQUFnQzs7SUFDaEMsK0NBR0U7O0lBQ0YsdUNBQWdDOztJQUNoQyxvQ0FBaUM7O0lBQ2pDLG9DQUE2Qjs7Ozs7SUFDN0IseURBQXVEOzs7OztJQUN2RCwwREFBd0Q7Ozs7O0lBR3RELG1EQUFnRDs7Ozs7SUFDaEQsb0RBQXVEOzs7OztJQUN2RCx1REFBd0Q7Ozs7O0lBQ3hELHlEQUE0RDs7Ozs7SUFDNUQsb0RBQWlEOzs7OztJQUNqRCxvREFBa0Q7Ozs7O0lBQ2xELHdDQUE2Qjs7Ozs7SUFDN0Isd0NBQTBCOzs7OztJQUMxQixzQ0FBc0I7Ozs7O0lBQ3RCLHdDQUFxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPbkRlc3Ryb3ksIElucHV0LCBJbmplY3RvciwgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgSW5qZWN0LCBQTEFURk9STV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IE1hdFNuYWNrQmFyLCBNYXRTbmFja0JhckNvbmZpZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3NuYWNrLWJhcic7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25TZXJ2aWNlLCBOb3RpZmljYXRpb24gfSBmcm9tICdAdmVyZG9jcy9ub3RpZmljYXRpb25zJztcbmltcG9ydCB7IFByb2ZpbGVDb2xsZWN0aW9uLCBPcmdhbml6YXRpb25EaWFsb2dTZXJ2aWNlLCBPdmVycmlkZSBhcyBQcm9maWxlT3ZlcnJpZGUgfSBmcm9tICdAdmVyZG9jcy9wcm9maWxlcyc7XG5pbXBvcnQgeyBWZXJkb2NzU3RhdGVTZXJ2aWNlLCBWZXJkb2NzQXV0aEd1YXJkU2VydmljZSwgVmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZSB9IGZyb20gJ0B2ZXJkb2NzL3Rva2Vucyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbmRJbmRleCwgaW5jbHVkZXMgfSBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgeyBjb25uZWN0aW9uQ29uZmlnLCBjb25uZWN0aW9uQ29uZmlnVG9rZW4gfSBmcm9tICcuLi9oZWFkZXIubW9kdWxlJztcbmltcG9ydCB7IFZlcmRvY3NIZWFkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaGVhZGVyLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd2ZXJkb2NzLWhlYWRlci10b29scycsXG4gIHRlbXBsYXRlVXJsOiAnLi9oZWFkZXItdG9vbHMuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9oZWFkZXItdG9vbHMuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBIZWFkZXJUb29sc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgT25EZXN0cm95IHtcbiAgcHVibGljIHRva2VuQ29uZmlnOiBjb25uZWN0aW9uQ29uZmlnO1xuICBwdWJsaWMgYXBwcyA9IFtdO1xuICBwdWJsaWMgZW1haWxWZXJpZmllZDogYm9vbGVhbjtcbiAgcHVibGljIG5vdGlmaWNhdGlvbnM6IE5vdGlmaWNhdGlvbltdID0gW107XG4gIHB1YmxpYyBwcm9maWxlczogUHJvZmlsZUNvbGxlY3Rpb247XG4gIHB1YmxpYyBuZXdQcm9maWxlOiBhbnk7XG4gIHB1YmxpYyBvcmdhbml6YXRpb25faWQ6IHN0cmluZztcbiAgcHVibGljIG15QWNjb3VudFVybDogc3RyaW5nO1xuICBwdWJsaWMgclNlY3VyZVVybDogc3RyaW5nO1xuICBwdWJsaWMgckZvcm1Vcmw6IHN0cmluZztcbiAgcHVibGljIHRlcm1zVXJsOiBzdHJpbmc7XG4gIHB1YmxpYyBwcml2YWN5VXJsOiBzdHJpbmc7XG4gIHB1YmxpYyBsb2dpblVybDogc3RyaW5nO1xuICBwdWJsaWMgc2lnbnVwVXJsOiBzdHJpbmc7XG4gIHB1YmxpYyBvcmdhbml6YXRpb25JbWdTcmM6IHN0cmluZztcbiAgcHVibGljIHByb2ZpbGVMb2FkaW5nID0gZmFsc2U7XG4gIHB1YmxpYyBoYXNQcm9maWxlID0gZmFsc2U7XG4gIHB1YmxpYyBvcmlnaW46ICdyRm9ybScgfCAnclNlY3VyZScgfCAnckFjY291bnQnIHwgbnVsbDtcbiAgcHVibGljIGlzQXRPcmlnaW5hbE9yaWdpbjogYm9vbGVhbjtcbiAgcHVibGljIHZlcmRvY3NfbG9nb191cmw6IHN0cmluZztcbiAgQElucHV0KCkgcHVibGljIHByb2ZpbGVPdmVycmlkZTogUHJvZmlsZU92ZXJyaWRlID0ge1xuICAgIHRvcDo1NixcbiAgICByaWdodDogMjBcbiAgfTtcbiAgQElucHV0KCkgcHVibGljIHNpZGVuYXYgPSBmYWxzZTtcbiAgQElucHV0KCkgcHVibGljIHR5cGUgPSAnZGVmYXVsdCc7XG4gIEBJbnB1dCgpIHB1YmxpYyBtb2RlOiBzdHJpbmc7XG4gIHByaXZhdGUgbm90aWZpY2F0aW9uc1N1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcbiAgcHJpdmF0ZSBwcm9maWxlTG9hZGluZ1N1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHZlcmRvY3NTdGF0ZVNlcnZpY2U6IFZlcmRvY3NTdGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSB2ZXJkb2NzT2JqZWN0U2VydmljZTogVmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZSxcbiAgICBwcml2YXRlIHZlcmRvY3NBdXRoR3VhcmRTZXJ2aWNlOiBWZXJkb2NzQXV0aEd1YXJkU2VydmljZSxcbiAgICBwcml2YXRlIG9yZ2FuaXphdGlvbkRpYWxvZ1NlcnZpY2U6IE9yZ2FuaXphdGlvbkRpYWxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb25zU2VydmljZTogTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIHZlcmRvY3NIZWFkZXJTZXJ2aWNlOiBWZXJkb2NzSGVhZGVyU2VydmljZSxcbiAgICBwcml2YXRlIHNuYWNrYmFyOiBNYXRTbmFja0JhcixcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1cbiAgKSB7IFxuICAgIHRoaXMudG9rZW5Db25maWcgPSB0aGlzLmluamVjdG9yLmdldChjb25uZWN0aW9uQ29uZmlnVG9rZW4pO1xuICAgIHRoaXMubXlBY2NvdW50VXJsID0gdGhpcy50b2tlbkNvbmZpZy5yQWNjb3VudF9mcm9udGVuZF91cmw7XG4gICAgdGhpcy5yU2VjdXJlVXJsID0gdGhpcy50b2tlbkNvbmZpZy5yU2VjdXJlX2Zyb250ZW5kX3VybDtcbiAgICB0aGlzLnJGb3JtVXJsID0gdGhpcy50b2tlbkNvbmZpZy5yRm9ybV9mcm9udGVuZF91cmw7XG4gICAgdGhpcy50ZXJtc1VybCA9IHRoaXMudG9rZW5Db25maWcuclNlY3VyZV9mcm9udGVuZF91cmwgKyAnL3Rlcm1zJztcbiAgICB0aGlzLnByaXZhY3lVcmwgPSB0aGlzLnRva2VuQ29uZmlnLnJTZWN1cmVfZnJvbnRlbmRfdXJsICsgJy9wcml2YWN5JztcbiAgICB0aGlzLmxvZ2luVXJsID0gdGhpcy50b2tlbkNvbmZpZy5yU2VjdXJlX2Zyb250ZW5kX3VybCArICcvbG9naW4nO1xuICAgIHRoaXMuc2lnbnVwVXJsID0gdGhpcy50b2tlbkNvbmZpZy5yU2VjdXJlX2Zyb250ZW5kX3VybCArICcvc2lnbnVwJztcbiAgICB0aGlzLm9yZ2FuaXphdGlvbkltZ1NyYyA9IGAke3RoaXMudG9rZW5Db25maWcuckFjY291bnRfZnJvbnRlbmRfdXJsfS9hc3NldHMvb3JnYW5pemF0aW9uL3NlbGVjdC1wcm9maWxlLnBuZ2A7XG4gICAgdGhpcy52ZXJkb2NzX2xvZ29fdXJsID0gYCR7dGhpcy5yRm9ybVVybH0vYXNzZXRzL2JsdWUtbG9nby5zdmdgO1xuICAgIHRoaXMub3JpZ2luID0gdGhpcy50b2tlbkNvbmZpZy5vcmlnaW47XG4gICAgdGhpcy5pc0F0T3JpZ2luYWxPcmlnaW4gPSB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLmdldEF0T3JpZ2luKHRoaXMub3JpZ2luKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2hlY2tFbWFpbFZlcmlmaWNhdGlvbigpO1xuICAgIHRoaXMuaGFzUHJvZmlsZSA9IHRoaXMudmVyZG9jc09iamVjdFNlcnZpY2UuZ2V0UHJvZmlsZSgpO1xuICAgIHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2UudXNlclByb2ZpbGVTdWJqZWN0LnN1YnNjcmliZShwcm9maWxlcyA9PiB7XG4gICAgICB0aGlzLnByb2ZpbGVzID0gdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS5nZXRQcm9maWxlQ29sbGVjdGlvbihwcm9maWxlcyk7XG4gICAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnByb2ZpbGVzU3ViamVjdC5uZXh0KHByb2ZpbGVzKTtcbiAgICAgIGNvbnN0IGluZGV4ID0gZmluZEluZGV4KHByb2ZpbGVzLCB7IG9yZ2FuaXphdGlvbl9pZDogdGhpcy5vcmdhbml6YXRpb25faWQgfSk7XG4gICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICB0aGlzLm5ld1Byb2ZpbGUgPSBwcm9maWxlc1tpbmRleF07XG4gICAgICAgIHRoaXMub3JnYW5pemF0aW9uRGlhbG9nU2VydmljZS5zZXROZXdQcm9maWxlKHRoaXMubmV3UHJvZmlsZSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zU3Vic2NyaXB0aW9uID0gdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5Ob3RpZmljYXRhdGlvbnMoKS5zdWJzY3JpYmUobm90aWZpY2F0aW9ucyA9PiB7XG4gICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zO1xuICAgIH0pO1xuICAgIHRoaXMucHJvZmlsZUxvYWRpbmdTdWJzY3JpcHRpb24gPSB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnByb2ZpbGVMb2FkaW5nU3ViamVjdC5zdWJzY3JpYmUoc3RhdHVzID0+IHtcbiAgICAgIHRoaXMucHJvZmlsZUxvYWRpbmcgPSBzdGF0dXM7XG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMucHJvZmlsZXMgJiYgdGhpcy5oYXNQcm9maWxlKSB7XG4gICAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLmdldFByb2ZpbGVzKCk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRDaGVja2VkKCkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA+IDYwMCkge1xuICAgICAgICAgIHRoaXMucHJvZmlsZU92ZXJyaWRlLnRvcCA9IDYwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMucHJvZmlsZU92ZXJyaWRlLnRvcCA9IDU2O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgdGhpcy5wcm9maWxlTG9hZGluZ1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0VtYWlsVmVyaWZpY2F0aW9uKCk6IHZvaWQge1xuICAgIHRoaXMuZW1haWxWZXJpZmllZCA9IHRoaXMudmVyZG9jc1N0YXRlU2VydmljZS5nZXRFbWFpbFZlcmlmaWNhdGlvbigpO1xuICAgIHRoaXMub3JnYW5pemF0aW9uRGlhbG9nU2VydmljZS5zZXRFbWFpbFZlcmlmaWVkKHRoaXMuZW1haWxWZXJpZmllZCk7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGFkbWluX3VybCgpIHtcbiAgICBpZiAodGhpcy5oYXNBY2Nlc3NUb0FkbWluKCkpIHtcbiAgICAgIHJldHVybiBgJHt0aGlzLnRva2VuQ29uZmlnLnJBY2NvdW50X2Zyb250ZW5kX3VybH0vYWRtaW5gO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgcmVtb3ZlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uKSB7XG4gICAgdGhpcy5ub3RpZmljYXRpb25zU2VydmljZS5kaXNtaXNzTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbik7XG4gIH1cblxuICBzaWduT3V0KCkge1xuICAgIHRoaXMudmVyZG9jc0F1dGhHdWFyZFNlcnZpY2Uuc2lnbk91dCgpO1xuICB9XG5cbiAgc2lnbkluKCkge1xuICAgIGlmICh3aW5kb3cpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYCR7dGhpcy5yU2VjdXJlVXJsfS9sb2dpbj9yZWRpcmVjdF91cmw9JHt0aGlzLnJGb3JtVXJsICsgdGhpcy5yb3V0ZXIudXJsfWA7XG4gICAgfVxuICB9XG5cbiAgc2lnblVwKCkge1xuICAgIGlmICh3aW5kb3cpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYCR7dGhpcy5yU2VjdXJlVXJsfS9zaWdudXA/cmVkaXJlY3RfdXJsPSR7dGhpcy5yRm9ybVVybCArIHRoaXMucm91dGVyLnVybH1gO1xuICAgIH1cbiAgfVxuXG4gIHN3aXRjaChwcm9maWxlX2lkOiBzdHJpbmcpIHtcbiAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnN3aXRjaFByb2ZpbGUocHJvZmlsZV9pZCkudGhlbigoKSA9PiB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGAke3RoaXMudG9rZW5Db25maWcuckZvcm1fZnJvbnRlbmRfdXJsfWA7XG4gICAgfSk7XG4gIH1cblxuICBzd2l0Y2hBbmRHb1RvQWRtaW4oKSB7XG4gICAgaWYgKHRoaXMubmV3UHJvZmlsZSkge1xuICAgICAgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS5zd2l0Y2hQcm9maWxlKHRoaXMubmV3UHJvZmlsZS5pZCkudGhlbihwcm9maWxlID0+IHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgJHt0aGlzLm15QWNjb3VudFVybH0vYWRtaW4vcHJvZmlsZS8ke3RoaXMubmV3UHJvZmlsZS5pZH1gO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlVG9rZW5TdGF0dXMoc2VuZE1lc3NhZ2U/OiBib29sZWFuKSB7XG4gICAgdGhpcy5jcmVhdGVTbmFja2JhcignQ2hlY2tpbmcgZW1haWwgdmVyaWZpY2F0aW9uJywgJ09LJyk7XG4gICAgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS51cGRhdGVUb2tlbnMoc2VuZE1lc3NhZ2UpLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5lbWFpbFZlcmlmaWVkID0gdGhpcy52ZXJkb2NzU3RhdGVTZXJ2aWNlLmdldEVtYWlsVmVyaWZpY2F0aW9uKCk7XG4gICAgICB0aGlzLm9yZ2FuaXphdGlvbkRpYWxvZ1NlcnZpY2Uuc2V0RW1haWxWZXJpZmllZCh0aGlzLmVtYWlsVmVyaWZpZWQpO1xuICAgIH0pO1xuICB9XG5cbiAgcmVzZW5kRW1haWxWZXJpZmljYXRpb24oKSB7XG4gICAgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS5yZXNlbmRFbWFpbFZlcmlmaWNhdGlvbigpO1xuICB9XG5cbiAgY2hlY2tOYW1lVmFsaWRpdHkobmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2UuZ2V0TmFtZVZhbGlkaXR5KG5hbWUpXG4gICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICB0aGlzLm9yZ2FuaXphdGlvbkRpYWxvZ1NlcnZpY2Uuc2V0TmFtZVZhbGlkYXRpb24ocmVzdWx0KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlT3JnYW5pemF0aW9uKG9yZ2FuaXphdGlvbkdyb3VwKSB7XG4gICAgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS5jcmVhdGVPcmdhbml6YXRpb24ob3JnYW5pemF0aW9uR3JvdXApXG4gICAgICAudGhlbihhc3luYyBvcmdhbml6YXRpb24gPT4ge1xuICAgICAgICB0aGlzLm9yZ2FuaXphdGlvbl9pZCA9IG9yZ2FuaXphdGlvblsnaWQnXTtcbiAgICAgICAgYXdhaXQgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS5nZXRBY2NvdW50RGF0YSgpO1xuICAgICAgICB0aGlzLmNyZWF0ZVNuYWNrYmFyKCdPcmdhbml6YXRpb24gY3JlYXRlZCcsIG51bGwpO1xuICAgICAgfSk7XG4gIH1cblxuICBzd2l0Y2hQcm9maWxlKCkge1xuICAgIHRoaXMuc3dpdGNoKHRoaXMubmV3UHJvZmlsZS5pZCk7XG4gIH1cblxuICBjaGVja0FjY2VzcyhjbGllbnROYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMudmVyZG9jc1N0YXRlU2VydmljZS5oYXNBY2Nlc3NUbyhjbGllbnROYW1lICsgJ19SZWFsc3RlcicpO1xuICB9XG5cbiAganVtcFRvKGNsaWVudE5hbWUpIHtcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHRoaXMudG9rZW5Db25maWdbY2xpZW50TmFtZSArICdfZnJvbnRlbmRfdXJsJ107XG4gIH1cblxuICBwcml2YXRlIGhhc0FjY2Vzc1RvQWRtaW4oKSB7XG4gICAgY29uc3Qgcm9sZXMgPSB0aGlzLnZlcmRvY3NTdGF0ZVNlcnZpY2UuZ2V0UkFjY291bnRSb2xlcygpO1xuICAgIHJldHVybiBpbmNsdWRlcyhyb2xlcywgJ293bmVyJykgfHwgaW5jbHVkZXMocm9sZXMsICdhZG1pbicpO1xuICB9XG5cbiAgY3JlYXRlU25hY2tiYXIobWVzc2FnZTogc3RyaW5nLCBidXR0b25UaXRsZT86IHN0cmluZykge1xuICAgIGlmICghYnV0dG9uVGl0bGUpIHtcbiAgICAgIGJ1dHRvblRpdGxlID0gbnVsbDtcbiAgICB9XG4gICAgbGV0IHNuYWNrYmFyQ29uZmlnOiBNYXRTbmFja0JhckNvbmZpZ1xuICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA+PSA5MjApIHtcbiAgICAgIHNuYWNrYmFyQ29uZmlnID0ge1xuICAgICAgICB2ZXJ0aWNhbFBvc2l0aW9uOiAnYm90dG9tJyxcbiAgICAgICAgaG9yaXpvbnRhbFBvc2l0aW9uOiAnbGVmdCcsXG4gICAgICAgIGR1cmF0aW9uOiA1MDAwXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNuYWNrYmFyQ29uZmlnID0ge1xuICAgICAgICB2ZXJ0aWNhbFBvc2l0aW9uOiAndG9wJyxcbiAgICAgICAgZHVyYXRpb246IDUwMDBcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zbmFja2Jhci5vcGVuKG1lc3NhZ2UsIGJ1dHRvblRpdGxlLCBzbmFja2JhckNvbmZpZyk7XG4gIH1cblxuICBsdW5jaEVsZXZpbygpIHtcbiAgICB3aW5kb3dbJ2x1bmNoRWxldmlvJ10oKTtcbiAgfVxuXG4gIGx1bmNoSW50ZXJjb20oKSB7XG4gICAgd2luZG93WydsdW5jaEludGVyY29tJ10oKVxuICB9XG59XG4iXX0=