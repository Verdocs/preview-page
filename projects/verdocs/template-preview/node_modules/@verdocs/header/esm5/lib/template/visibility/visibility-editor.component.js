/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { VerdocsHeaderService } from '../../services/header.service';
import { TemplatesGuardService } from '../../services/templates.guard';
import { TemplateActions } from '../../models/verdocs.model';
var VisibilityEditorComponent = /** @class */ (function () {
    function VisibilityEditorComponent(templateGuard, verdocsHeaderService) {
        this.templateGuard = templateGuard;
        this.verdocsHeaderService = verdocsHeaderService;
        this.updateVisibility = false;
        this.isSaving = false;
        this.isEditMode = false;
        this._canShareWithOrg = null;
        this._canMakeItPrivate = null;
        this._canShareWithPublic = null;
    }
    /**
     * @return {?}
     */
    VisibilityEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.template_visibility = this.getTemplateVisibility();
    };
    /**
     * @return {?}
     */
    VisibilityEditorComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.template_visibility = this.getTemplateVisibility();
    };
    /**
     * @return {?}
     */
    VisibilityEditorComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.template_visibility = undefined;
    };
    /**
     * @return {?}
     */
    VisibilityEditorComponent.prototype.getTemplateVisibility = /**
     * @return {?}
     */
    function () {
        if (this.visibility) {
            if (this.visibility.is_personal) {
                if (this.visibility.is_public) {
                    return 'personal & public';
                }
                else {
                    return 'personal';
                }
            }
            else {
                if (this.visibility.is_public) {
                    return 'public & org';
                }
                else {
                    return 'org';
                }
            }
        }
        return undefined;
    };
    /**
     * @return {?}
     */
    VisibilityEditorComponent.prototype.setUpdateVisibility = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var original_visibility = this.getTemplateVisibility();
        this.updateVisibility = original_visibility !== this.template_visibility;
    };
    /**
     * @return {?}
     */
    VisibilityEditorComponent.prototype.saveChanges = /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var body, template;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.isSaving = true;
                        body = {};
                        if (this.updateVisibility && this.template) {
                            switch (this.template_visibility) {
                                case 'personal':
                                    body['is_personal'] = true;
                                    body['is_public'] = false;
                                    break;
                                case 'org':
                                    body['is_personal'] = false;
                                    body['is_public'] = false;
                                    break;
                                case 'public & org':
                                    body['is_personal'] = false;
                                    body['is_public'] = true;
                                    break;
                                case 'personal & public':
                                    body['is_personal'] = true;
                                    body['is_public'] = true;
                                default:
                                    break;
                            }
                        }
                        return [4 /*yield*/, this.verdocsHeaderService.updateTemplate(this.template.id, body)];
                    case 1:
                        template = _a.sent();
                        this.updateVisibility = false;
                        this.isSaving = false;
                        return [2 /*return*/];
                }
            });
        });
    };
    Object.defineProperty(VisibilityEditorComponent.prototype, "canShareWithPublic", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.template && typeof (this._canShareWithPublic) !== 'boolean') {
                this._canShareWithPublic = (this.templateGuard.canPerformAction(TemplateActions.CHANGE_VISIBILITY_PUBLIC, this.template))['canPerform'];
            }
            return this._canShareWithPublic;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(VisibilityEditorComponent.prototype, "canChangeVisibility", {
        get: /**
         * @return {?}
         */
        function () {
            return this.canMakeItPrivate || this.canShareWithOrg || this.canShareWithPublic;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(VisibilityEditorComponent.prototype, "canShareWithOrg", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.template && typeof (this._canShareWithOrg) !== 'boolean') {
                this._canShareWithOrg = (this.templateGuard.canPerformAction(TemplateActions.CHANGE_VISIBILITY_ORG, this.template))['canPerform'];
            }
            return this._canShareWithOrg;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(VisibilityEditorComponent.prototype, "canMakeItPrivate", {
        get: /**
         * @return {?}
         */
        function () {
            if (this.template && typeof (this._canMakeItPrivate) !== 'boolean') {
                this._canMakeItPrivate =
                    (this.templateGuard.canPerformAction(TemplateActions.CHANGE_VISIBILITY_PERSONAL, this.template))['canPerform'];
            }
            return this._canMakeItPrivate;
        },
        enumerable: true,
        configurable: true
    });
    VisibilityEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'app-preview-visibility',
                    template: "<div class=\"template-visiblity__container\" *ngIf=\"visibility\">\n  <ng-template #readView>\n    <div class=\"template-visibility__read\">\n      <div class=\"template-visibility__type\" *ngIf=\"visibility.is_personal && !visibility.is_public\">\n        <mat-icon class=\"template-visibility__type-icon\">lock</mat-icon>\n        <div class=\"template-visibility__type-text\">Personal</div>\n      </div>\n      <div class=\"template-visibility__type\" *ngIf=\"visibility.is_public\">\n        <mat-icon class=\"template-visibility__type-icon\">public</mat-icon>\n        <div class=\"template-visibility__type-text\">Public</div>\n      </div>\n      <div class=\"template-visibility__type\" *ngIf=\"!visibility.is_personal\">\n        <mat-icon class=\"template-visibility__type-icon\">group</mat-icon>\n        <div class=\"template-visibility__type-text\">Shared</div>\n      </div>\n    </div>\n  </ng-template>\n  <ng-template #editView>\n    <div class=\"template-visibility__edit\">\n      <mat-radio-group [(ngModel)]=\"template_visibility\" [disabled]=\"!canChangeVisibility\"\n        matTooltip=\"{{ !canChangeVisibility? 'You don\\'t have the permission to change the visibility of this document':''}}\">\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'personal'\" (click)=\"setUpdateVisibility()\"\n          [disabled]=\"!canMakeItPrivate\"\n          matTooltip=\"{{ !canMakeItPrivate? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Private\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Only you can see this document.\n          </div>\n        </mat-radio-button>\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'org'\" (click)=\"setUpdateVisibility()\"\n          [disabled]=\"!canShareWithOrg\"\n          matTooltip=\"{{ !canShareWithOrg? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Shared to your organization\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Give access to your organization to share this document.\n          </div>\n        </mat-radio-button>\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'public & org'\" (click)=\"setUpdateVisibility()\"\n          [disabled]=\"!canShareWithOrg || !canShareWithPublic\"\n          matTooltip=\"{{ !canShareWithOrg || !canShareWithPublic ? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Shared to your organization, and public on the web\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Give access to your organization to share, and anyone on the web can find and access this document.\n          </div>\n        </mat-radio-button>\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'personal & public'\"\n          [disabled]=\"!canShareWithPublic\" (click)=\"setUpdateVisibility()\"\n          matTooltip=\"{{ !canShareWithPublic? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Public on the web\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Anyone on the web can find and access this document.\n          </div>\n        </mat-radio-button>\n      </mat-radio-group>\n    </div>\n  </ng-template>\n  <ng-container *ngTemplateOutlet=\"isEditMode ? editView : readView\"></ng-container>\n</div>",
                    styles: [".template-visibility__read,.template-visibility__type{display:flex;align-items:center}.template-visibility__type-icon{margin-right:4px;color:rgba(0,0,0,.54)}.template-visibility__type-text{color:rgba(0,0,0,.87);margin-right:8px}"]
                }] }
    ];
    /** @nocollapse */
    VisibilityEditorComponent.ctorParameters = function () { return [
        { type: TemplatesGuardService },
        { type: VerdocsHeaderService }
    ]; };
    VisibilityEditorComponent.propDecorators = {
        visibility: [{ type: Input }],
        isEditMode: [{ type: Input }],
        template: [{ type: Input }]
    };
    return VisibilityEditorComponent;
}());
export { VisibilityEditorComponent };
if (false) {
    /** @type {?} */
    VisibilityEditorComponent.prototype.template_visibility;
    /** @type {?} */
    VisibilityEditorComponent.prototype.updateVisibility;
    /** @type {?} */
    VisibilityEditorComponent.prototype.isSaving;
    /** @type {?} */
    VisibilityEditorComponent.prototype.visibility;
    /** @type {?} */
    VisibilityEditorComponent.prototype.isEditMode;
    /** @type {?} */
    VisibilityEditorComponent.prototype.template;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype._canShareWithOrg;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype._canMakeItPrivate;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype._canShareWithPublic;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype.templateGuard;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype.verdocsHeaderService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlzaWJpbGl0eS1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZlcmRvY3MvaGVhZGVyLyIsInNvdXJjZXMiOlsibGliL3RlbXBsYXRlL3Zpc2liaWxpdHkvdmlzaWJpbGl0eS1lZGl0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWdDLE1BQU0sZUFBZSxDQUFDO0FBRS9FLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBYSxlQUFlLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUV4RTtJQWtCRSxtQ0FDVSxhQUFvQyxFQUNwQyxvQkFBMEM7UUFEMUMsa0JBQWEsR0FBYixhQUFhLENBQXVCO1FBQ3BDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFiN0MscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFHZixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBR3BCLHFCQUFnQixHQUFHLElBQUksQ0FBQztRQUN4QixzQkFBaUIsR0FBRyxJQUFJLENBQUM7UUFDekIsd0JBQW1CLEdBQUcsSUFBSSxDQUFDO0lBSy9CLENBQUM7Ozs7SUFFTCw0Q0FBUTs7O0lBQVI7UUFDRSxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDMUQsQ0FBQzs7OztJQUNELCtDQUFXOzs7SUFBWDtRQUNFLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztJQUMxRCxDQUFDOzs7O0lBQ0QsK0NBQVc7OztJQUFYO1FBQ0UsSUFBSSxDQUFDLG1CQUFtQixHQUFHLFNBQVMsQ0FBQztJQUN2QyxDQUFDOzs7O0lBRUQseURBQXFCOzs7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LCBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFZlcmRvY3NIZWFkZXJTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvaGVhZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGVtcGxhdGVzR3VhcmRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvdGVtcGxhdGVzLmd1YXJkJztcbmltcG9ydCB7IElUZW1wbGF0ZSwgVGVtcGxhdGVBY3Rpb25zIH0gZnJvbSAnLi4vLi4vbW9kZWxzL3ZlcmRvY3MubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhcHAtcHJldmlldy12aXNpYmlsaXR5JyxcbiAgdGVtcGxhdGVVcmw6ICd2aXNpYmlsaXR5LWVkaXRvci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3Zpc2liaWxpdHktZWRpdG9yLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgVmlzaWJpbGl0eUVkaXRvckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBwdWJsaWMgdGVtcGxhdGVfdmlzaWJpbGl0eTtcbiAgcHVibGljIHVwZGF0ZVZpc2liaWxpdHkgPSBmYWxzZTtcbiAgcHVibGljIGlzU2F2aW5nID0gZmFsc2U7XG5cbiAgQElucHV0KCkgdmlzaWJpbGl0eTtcbiAgQElucHV0KCkgaXNFZGl0TW9kZSA9IGZhbHNlO1xuICBASW5wdXQoKSB0ZW1wbGF0ZTtcblxuICBwcml2YXRlIF9jYW5TaGFyZVdpdGhPcmcgPSBudWxsO1xuICBwcml2YXRlIF9jYW5NYWtlSXRQcml2YXRlID0gbnVsbDtcbiAgcHJpdmF0ZSBfY2FuU2hhcmVXaXRoUHVibGljID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRlbXBsYXRlR3VhcmQ6IFRlbXBsYXRlc0d1YXJkU2VydmljZSxcbiAgICBwcml2YXRlIHZlcmRvY3NIZWFkZXJTZXJ2aWNlOiBWZXJkb2NzSGVhZGVyU2VydmljZVxuICApIHsgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudGVtcGxhdGVfdmlzaWJpbGl0eSA9IHRoaXMuZ2V0VGVtcGxhdGVWaXNpYmlsaXR5KCk7XG4gIH1cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy50ZW1wbGF0ZV92aXNpYmlsaXR5ID0gdGhpcy5nZXRUZW1wbGF0ZVZpc2liaWxpdHkoKTtcbiAgfVxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnRlbXBsYXRlX3Zpc2liaWxpdHkgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXRUZW1wbGF0ZVZpc2liaWxpdHkoKSB7XG4gICAgaWYgKHRoaXMudmlzaWJpbGl0eSkge1xuICAgICAgaWYgKHRoaXMudmlzaWJpbGl0eS5pc19wZXJzb25hbCkge1xuICAgICAgICBpZiAodGhpcy52aXNpYmlsaXR5LmlzX3B1YmxpYykge1xuICAgICAgICAgIHJldHVybiAncGVyc29uYWwgJiBwdWJsaWMnXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuICdwZXJzb25hbCc7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLnZpc2liaWxpdHkuaXNfcHVibGljKSB7XG4gICAgICAgICAgcmV0dXJuICdwdWJsaWMgJiBvcmcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAnb3JnJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgc2V0VXBkYXRlVmlzaWJpbGl0eSgpIHtcbiAgICBjb25zdCBvcmlnaW5hbF92aXNpYmlsaXR5ID0gdGhpcy5nZXRUZW1wbGF0ZVZpc2liaWxpdHkoKTtcbiAgICB0aGlzLnVwZGF0ZVZpc2liaWxpdHkgPSBvcmlnaW5hbF92aXNpYmlsaXR5ICE9PSB0aGlzLnRlbXBsYXRlX3Zpc2liaWxpdHk7XG4gIH1cblxuICBhc3luYyBzYXZlQ2hhbmdlcygpIHtcbiAgICB0aGlzLmlzU2F2aW5nID0gdHJ1ZTtcbiAgICBjb25zdCBib2R5ID0ge307XG4gICAgICBpZiAodGhpcy51cGRhdGVWaXNpYmlsaXR5ICYmIHRoaXMudGVtcGxhdGUpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnRlbXBsYXRlX3Zpc2liaWxpdHkpIHtcbiAgICAgICAgICBjYXNlICdwZXJzb25hbCc6XG4gICAgICAgICAgICBib2R5Wydpc19wZXJzb25hbCddID0gdHJ1ZTtcbiAgICAgICAgICAgIGJvZHlbJ2lzX3B1YmxpYyddID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdvcmcnOlxuICAgICAgICAgICAgYm9keVsnaXNfcGVyc29uYWwnXSA9IGZhbHNlO1xuICAgICAgICAgICAgYm9keVsnaXNfcHVibGljJ10gPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3B1YmxpYyAmIG9yZyc6XG4gICAgICAgICAgICBib2R5Wydpc19wZXJzb25hbCddID0gZmFsc2U7XG4gICAgICAgICAgICBib2R5Wydpc19wdWJsaWMnXSA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdwZXJzb25hbCAmIHB1YmxpYyc6XG4gICAgICAgICAgICBib2R5Wydpc19wZXJzb25hbCddID0gdHJ1ZTtcbiAgICAgICAgICAgIGJvZHlbJ2lzX3B1YmxpYyddID0gdHJ1ZTtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IHRlbXBsYXRlOiBJVGVtcGxhdGUgPSBhd2FpdCB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnVwZGF0ZVRlbXBsYXRlKHRoaXMudGVtcGxhdGUuaWQsIGJvZHkpO1xuICAgICAgdGhpcy51cGRhdGVWaXNpYmlsaXR5ID0gZmFsc2U7XG4gICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XG4gIH1cblxuICBnZXQgY2FuU2hhcmVXaXRoUHVibGljKCkge1xuICAgIGlmICh0aGlzLnRlbXBsYXRlICYmIHR5cGVvZiAodGhpcy5fY2FuU2hhcmVXaXRoUHVibGljKSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICB0aGlzLl9jYW5TaGFyZVdpdGhQdWJsaWMgPSAodGhpcy50ZW1wbGF0ZUd1YXJkLmNhblBlcmZvcm1BY3Rpb24oVGVtcGxhdGVBY3Rpb25zLkNIQU5HRV9WSVNJQklMSVRZX1BVQkxJQywgdGhpcy50ZW1wbGF0ZSkpWydjYW5QZXJmb3JtJ107XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYW5TaGFyZVdpdGhQdWJsaWNcbiAgfVxuXG4gIGdldCBjYW5DaGFuZ2VWaXNpYmlsaXR5KCkge1xuICAgIHJldHVybiB0aGlzLmNhbk1ha2VJdFByaXZhdGUgfHwgdGhpcy5jYW5TaGFyZVdpdGhPcmcgfHwgdGhpcy5jYW5TaGFyZVdpdGhQdWJsaWNcbiAgfVxuXG4gIGdldCBjYW5TaGFyZVdpdGhPcmcoKSB7XG4gICAgaWYgKHRoaXMudGVtcGxhdGUgJiYgdHlwZW9mICh0aGlzLl9jYW5TaGFyZVdpdGhPcmcpICE9PSAnYm9vbGVhbicpIHtcbiAgICAgIHRoaXMuX2NhblNoYXJlV2l0aE9yZyA9ICh0aGlzLnRlbXBsYXRlR3VhcmQuY2FuUGVyZm9ybUFjdGlvbihUZW1wbGF0ZUFjdGlvbnMuQ0hBTkdFX1ZJU0lCSUxJVFlfT1JHLCB0aGlzLnRlbXBsYXRlKSlbJ2NhblBlcmZvcm0nXTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NhblNoYXJlV2l0aE9yZ1xuICB9XG5cbiAgZ2V0IGNhbk1ha2VJdFByaXZhdGUoKSB7XG4gICAgaWYgKHRoaXMudGVtcGxhdGUgJiYgdHlwZW9mICh0aGlzLl9jYW5NYWtlSXRQcml2YXRlKSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICB0aGlzLl9jYW5NYWtlSXRQcml2YXRlID1cbiAgICAgICAgKHRoaXMudGVtcGxhdGVHdWFyZC5jYW5QZXJmb3JtQWN0aW9uKFRlbXBsYXRlQWN0aW9ucy5DSEFOR0VfVklTSUJJTElUWV9QRVJTT05BTCwgdGhpcy50ZW1wbGF0ZSkpWydjYW5QZXJmb3JtJ107XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYW5NYWtlSXRQcml2YXRlXG4gIH1cblxufVxuIl19