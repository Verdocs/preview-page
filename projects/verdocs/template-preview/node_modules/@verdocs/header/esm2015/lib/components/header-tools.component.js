/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Injector, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { Router } from '@angular/router';
import { MatSnackBar } from '@angular/material/snack-bar';
import { NotificationService } from '@verdocs/notifications';
import { OrganizationDialogService } from '@verdocs/profiles';
import { VerdocsStateService, VerdocsAuthGuardService, VerdocsTokenObjectService } from '@verdocs/tokens';
import { Subscription } from 'rxjs';
import { findIndex, includes } from 'lodash';
import { connectionConfigToken } from '../header.module';
import { VerdocsHeaderService } from '../services/header.service';
export class HeaderToolsComponent {
    /**
     * @param {?} verdocsStateService
     * @param {?} verdocsObjectService
     * @param {?} verdocsAuthGuardService
     * @param {?} organizationDialogService
     * @param {?} notificationsService
     * @param {?} verdocsHeaderService
     * @param {?} snackbar
     * @param {?} injector
     * @param {?} router
     * @param {?} platform
     */
    constructor(verdocsStateService, verdocsObjectService, verdocsAuthGuardService, organizationDialogService, notificationsService, verdocsHeaderService, snackbar, injector, router, platform) {
        this.verdocsStateService = verdocsStateService;
        this.verdocsObjectService = verdocsObjectService;
        this.verdocsAuthGuardService = verdocsAuthGuardService;
        this.organizationDialogService = organizationDialogService;
        this.notificationsService = notificationsService;
        this.verdocsHeaderService = verdocsHeaderService;
        this.snackbar = snackbar;
        this.injector = injector;
        this.router = router;
        this.platform = platform;
        this.apps = [];
        this.notifications = [];
        this.profileLoading = false;
        this.hasProfile = false;
        this.profileOverride = {
            top: 56,
            right: 20
        };
        this.sidenav = false;
        this.type = 'default';
        this.notificationsSubscription = new Subscription();
        this.profileLoadingSubscription = new Subscription();
        this.tokenConfig = this.injector.get(connectionConfigToken);
        this.myAccountUrl = this.tokenConfig.rAccount_frontend_url;
        this.rSecureUrl = this.tokenConfig.rSecure_frontend_url;
        this.rFormUrl = this.tokenConfig.rForm_frontend_url;
        this.termsUrl = this.tokenConfig.rSecure_frontend_url + '/terms';
        this.privacyUrl = this.tokenConfig.rSecure_frontend_url + '/privacy';
        this.loginUrl = this.tokenConfig.rSecure_frontend_url + '/login';
        this.signupUrl = this.tokenConfig.rSecure_frontend_url + '/signup';
        this.organizationImgSrc = `${this.tokenConfig.rAccount_frontend_url}/assets/organization/select-profile.png`;
        this.verdocs_logo_url = `${this.rFormUrl}/assets/blue-logo.svg`;
        this.origin = this.tokenConfig.origin;
        this.isAtOriginalOrigin = this.verdocsHeaderService.getAtOrigin(this.origin);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.checkEmailVerification();
        this.hasProfile = this.verdocsObjectService.getProfile();
        this.verdocsHeaderService.userProfileSubject.subscribe((/**
         * @param {?} profiles
         * @return {?}
         */
        profiles => {
            this.profiles = this.verdocsHeaderService.getProfileCollection(profiles);
            this.verdocsHeaderService.profilesSubject.next(profiles);
            /** @type {?} */
            const index = findIndex(profiles, { organization_id: this.organization_id });
            if (index >= 0) {
                this.newProfile = profiles[index];
                this.organizationDialogService.setNewProfile(this.newProfile);
            }
        }));
        this.notificationsSubscription = this.notificationsService.Notificatations().subscribe((/**
         * @param {?} notifications
         * @return {?}
         */
        notifications => {
            this.notifications = notifications;
        }));
        this.profileLoadingSubscription = this.verdocsHeaderService.profileLoadingSubject.subscribe((/**
         * @param {?} status
         * @return {?}
         */
        status => {
            this.profileLoading = status;
        }));
        if (!this.profiles && this.hasProfile) {
            this.verdocsHeaderService.getProfiles();
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        if (isPlatformBrowser(this.platform)) {
            if (typeof window !== 'undefined') {
                if (window.innerWidth > 600) {
                    this.profileOverride.top = 60;
                }
                else {
                    this.profileOverride.top = 56;
                }
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.notificationsSubscription.unsubscribe();
        this.profileLoadingSubscription.unsubscribe();
    }
    /**
     * @private
     * @return {?}
     */
    checkEmailVerification() {
        this.emailVerified = this.verdocsStateService.getEmailVerification();
        this.organizationDialogService.setEmailVerified(this.emailVerified);
    }
    /**
     * @return {?}
     */
    get admin_url() {
        if (this.hasAccessToAdmin()) {
            return `${this.tokenConfig.rAccount_frontend_url}/admin`;
        }
        return undefined;
    }
    /**
     * @param {?} notification
     * @return {?}
     */
    removeNotification(notification) {
        this.notificationsService.dismissNotification(notification);
    }
    /**
     * @return {?}
     */
    signOut() {
        this.verdocsAuthGuardService.signOut();
    }
    /**
     * @return {?}
     */
    signIn() {
        if (window) {
            window.location.href = `${this.rSecureUrl}/login?redirect_url=${this.rFormUrl + this.router.url}`;
        }
    }
    /**
     * @return {?}
     */
    signUp() {
        if (window) {
            window.location.href = `${this.rSecureUrl}/signup?redirect_url=${this.rFormUrl + this.router.url}`;
        }
    }
    /**
     * @param {?} profile_id
     * @return {?}
     */
    switch(profile_id) {
        this.verdocsHeaderService.switchProfile(profile_id).then((/**
         * @return {?}
         */
        () => {
            window.location.href = `${this.tokenConfig.rForm_frontend_url}`;
        }));
    }
    /**
     * @return {?}
     */
    switchAndGoToAdmin() {
        if (this.newProfile) {
            this.verdocsHeaderService.switchProfile(this.newProfile.id).then((/**
             * @param {?} profile
             * @return {?}
             */
            profile => {
                window.location.href = `${this.myAccountUrl}/admin/profile/${this.newProfile.id}`;
            }));
        }
    }
    /**
     * @param {?=} sendMessage
     * @return {?}
     */
    updateTokenStatus(sendMessage) {
        this.createSnackbar('Checking email verification', 'OK');
        this.verdocsHeaderService.updateTokens(sendMessage).then((/**
         * @return {?}
         */
        () => {
            this.emailVerified = this.verdocsStateService.getEmailVerification();
            this.organizationDialogService.setEmailVerified(this.emailVerified);
        }));
    }
    /**
     * @return {?}
     */
    resendEmailVerification() {
        this.verdocsHeaderService.resendEmailVerification();
    }
    /**
     * @param {?} name
     * @return {?}
     */
    checkNameValidity(name) {
        return this.verdocsHeaderService.getNameValidity(name)
            .then((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            this.organizationDialogService.setNameValidation(result);
        }));
    }
    /**
     * @param {?} organizationGroup
     * @return {?}
     */
    createOrganization(organizationGroup) {
        this.verdocsHeaderService.createOrganization(organizationGroup)
            .then((/**
         * @param {?} organization
         * @return {?}
         */
        (organization) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            this.organization_id = organization['id'];
            yield this.verdocsHeaderService.getAccountData();
            this.createSnackbar('Organization created', null);
        })));
    }
    /**
     * @return {?}
     */
    switchProfile() {
        this.switch(this.newProfile.id);
    }
    /**
     * @param {?} clientName
     * @return {?}
     */
    checkAccess(clientName) {
        return this.verdocsStateService.hasAccessTo(clientName + '_Realster');
    }
    /**
     * @param {?} clientName
     * @return {?}
     */
    jumpTo(clientName) {
        window.location.href = this.tokenConfig[clientName + '_frontend_url'];
    }
    /**
     * @private
     * @return {?}
     */
    hasAccessToAdmin() {
        /** @type {?} */
        const roles = this.verdocsStateService.getRAccountRoles();
        return includes(roles, 'owner') || includes(roles, 'admin');
    }
    /**
     * @param {?} message
     * @param {?=} buttonTitle
     * @return {?}
     */
    createSnackbar(message, buttonTitle) {
        if (!buttonTitle) {
            buttonTitle = null;
        }
        /** @type {?} */
        let snackbarConfig;
        if (window.innerWidth >= 920) {
            snackbarConfig = {
                verticalPosition: 'bottom',
                horizontalPosition: 'left',
                duration: 5000
            };
        }
        else {
            snackbarConfig = {
                verticalPosition: 'top',
                duration: 5000
            };
        }
        this.snackbar.open(message, buttonTitle, snackbarConfig);
    }
    /**
     * @return {?}
     */
    lunchElevio() {
        window['lunchElevio']();
    }
    /**
     * @return {?}
     */
    lunchIntercom() {
        window['lunchIntercom']();
    }
}
HeaderToolsComponent.decorators = [
    { type: Component, args: [{
                selector: 'verdocs-header-tools',
                template: "<div class=\"verdocs__wrapper\" *ngIf=\"hasProfile\" [ngClass]=\"{sidenav: sidenav}\">\n  <div class=\"verdocs__chat\">\n    <button mat-icon-button *ngIf=\"!sidenav\" (click)=\"lunchIntercom()\" matTooltip=\"Live Chat\">\n      <mat-icon>forum</mat-icon>\n    </button>\n  </div>\n  <div class=\"verdocs__help\">\n    <button mat-icon-button *ngIf=\"!sidenav\" (click)=\"lunchElevio()\" matTooltip=\"Help Center\">\n      <mat-icon>help</mat-icon>\n    </button>\n  </div>\n  <div class=\"verdocs__notification\" *ngIf=\"!sidenav\" matTooltip=\"Notifications\">\n    <verdocs-notifications [notifications]=\"notifications\" (removeNotification)=\"removeNotification($event)\"\n      [verdocs_logo_url]=\"verdocs_logo_url\"></verdocs-notifications>\n  </div>\n  <div class=\"verdocs__account\" *ngIf=\"profiles\"\n    [ngClass]=\"{header: !sidenav, sidenav: sidenav, default: type === 'default'}\" matTooltip=\"My Account\">\n    <verdocs-profiles [currentProfile]=\"profiles.currentProfile()\" [override]=\"profileOverride\" [admin_url]=\"admin_url\">\n      <verdocs-account-dialog [profiles]=\"profiles\" [termsUrl]=\"termsUrl\" [privacyUrl]=\"privacyUrl\"\n        [accountUrl]=\"myAccountUrl\" (signOutEvent)=\"signOut()\" [admin_url]=\"admin_url\">\n        <verdocs-account-profile [profiles]=\"profiles\" [loading]=\"profileLoading\"\n          [organizationImgSrc]=\"organizationImgSrc\" (switchEvent)=\"switch($event)\"\n          (switchAndRedirectEvent)=\"switchAndGoToAdmin()\" (getEmailVerificationEvent)=\"updateTokenStatus()\"\n          (resendEmailVerificationEvent)=\"resendEmailVerification()\" (getNameValidityEvent)=\"checkNameValidity($event)\"\n          (createOrganizationEvent)=\"createOrganization($event)\" (switchProfileEvent)=\"switchProfile()\">\n        </verdocs-account-profile>\n      </verdocs-account-dialog>\n    </verdocs-profiles>\n  </div>\n</div>\n<div class=\"verdocs__wrapper\" *ngIf=\"!hasProfile\">\n  <a class=\"verdocs__signin-button\" mat-button [routerLink]=\"'/login'\"\n    *ngIf=\"origin === 'rSecure' && isAtOriginalOrigin\" [ngClass]=\"{preview: mode === 'preview'}\">Sign in</a>\n  <a class=\"verdocs__signup-button\" mat-button [routerLink]=\"'/signup'\"\n    *ngIf=\"origin === 'rSecure' && isAtOriginalOrigin\" [ngClass]=\"{preview: mode === 'preview'}\">Sign up</a>\n  <button class=\"verdocs__signin-button\" mat-button *ngIf=\"origin !== 'rSecure'\"\n    [ngClass]=\"{preview: mode === 'preview'}\" (click)=\"signIn()\">Sign in</button>\n  <button class=\"verdocs__signup-button\" mat-button *ngIf=\"origin !== 'rSecure'\"\n    [ngClass]=\"{preview: mode === 'preview'}\" (click)=\"signUp()\">Sign up</button>\n</div>",
                styles: [".verdocs__wrapper{height:64px;flex-direction:row;box-sizing:border-box;display:flex;justify-content:flex-end;align-items:center}.verdocs__notification{margin-top:0;line-height:64px}@media only screen and (max-width:600px){.verdocs__wrapper{height:56px}.verdocs__notification{line-height:56px}}.verdocs__chat{line-height:64px;margin-right:7px}.verdocs__chat button{height:40px;min-width:40px}.verdocs__help{line-height:64px;margin-right:7px}.verdocs__help button{height:40px;min-width:40px}.verdocs__app{line-height:64px}.verdocs__app-button{padding:0;height:48px;min-width:48px;border-radius:24px}.verdocs__app.sidenav{margin-right:4px}@media only screen and (max-width:600px){.verdocs__app{line-height:56px}}.verdocs__account{line-height:64px}.verdocs__account-button{background-color:#9b9b9b;color:#fff}@media only screen and (max-width:854px){.verdocs__wrapper{display:none}.verdocs__wrapper.sidenav{display:flex}.verdocs__account.header.default,.verdocs__app.header.default,.verdocs__chat,.verdocs__help,.verdocs__notification{display:none}}@media only screen and (min-width:855px){.verdocs__account.sidenav,.verdocs__app.sidenav{display:none}}@media only screen and (max-width:600px){.verdocs__account{line-height:56px}}.verdocs__account,.verdocs__app,.verdocs__chat,.verdocs__notification{float:left}.verdocs__signin-button,.verdocs__signup-button{padding-left:8px;padding-right:8px;border-radius:2px;height:36px;background-color:#33354c;color:#fff;min-width:60px}.verdocs__signin-button.preview,.verdocs__signup-button.preview{background-color:transparent;color:rgba(0,0,0,.87)}.verdocs__signup-button{margin-left:8px;border:.5px solid #fff}.verdocs__signup-button.preview{border:.5px solid rgba(0,0,0,.87)}.menu__container{width:320px;height:248px}.menu__container .mat-menu-content{padding:0}.menu__container.mat-menu-panel{padding:8px}.menu__item{padding:0!important;margin-bottom:8px!important;border:none;min-width:64px!important;border-radius:50%!important}.menu__item-wrapper{padding:12px;float:left;text-align:center}.menu__item-wrapper.my-account{padding-left:6.5px;padding-right:6.5px}.menu__item img{vertical-align:middle}.menu__icon{width:40px}.menu__icon.rForm{width:30px}.menu__background{background-color:#495057;width:64px;height:64px;line-height:64px;border-radius:50%}.menu__title{font-size:14px;text-align:center;line-height:20px}.menu__account-container{width:270px;height:228px}"]
            }] }
];
/** @nocollapse */
HeaderToolsComponent.ctorParameters = () => [
    { type: VerdocsStateService },
    { type: VerdocsTokenObjectService },
    { type: VerdocsAuthGuardService },
    { type: OrganizationDialogService },
    { type: NotificationService },
    { type: VerdocsHeaderService },
    { type: MatSnackBar },
    { type: Injector },
    { type: Router },
    { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
HeaderToolsComponent.propDecorators = {
    profileOverride: [{ type: Input }],
    sidenav: [{ type: Input }],
    type: [{ type: Input }],
    mode: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    HeaderToolsComponent.prototype.tokenConfig;
    /** @type {?} */
    HeaderToolsComponent.prototype.apps;
    /** @type {?} */
    HeaderToolsComponent.prototype.emailVerified;
    /** @type {?} */
    HeaderToolsComponent.prototype.notifications;
    /** @type {?} */
    HeaderToolsComponent.prototype.profiles;
    /** @type {?} */
    HeaderToolsComponent.prototype.newProfile;
    /** @type {?} */
    HeaderToolsComponent.prototype.organization_id;
    /** @type {?} */
    HeaderToolsComponent.prototype.myAccountUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.rSecureUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.rFormUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.termsUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.privacyUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.loginUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.signupUrl;
    /** @type {?} */
    HeaderToolsComponent.prototype.organizationImgSrc;
    /** @type {?} */
    HeaderToolsComponent.prototype.profileLoading;
    /** @type {?} */
    HeaderToolsComponent.prototype.hasProfile;
    /** @type {?} */
    HeaderToolsComponent.prototype.origin;
    /** @type {?} */
    HeaderToolsComponent.prototype.isAtOriginalOrigin;
    /** @type {?} */
    HeaderToolsComponent.prototype.verdocs_logo_url;
    /** @type {?} */
    HeaderToolsComponent.prototype.profileOverride;
    /** @type {?} */
    HeaderToolsComponent.prototype.sidenav;
    /** @type {?} */
    HeaderToolsComponent.prototype.type;
    /** @type {?} */
    HeaderToolsComponent.prototype.mode;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.notificationsSubscription;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.profileLoadingSubscription;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsStateService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsObjectService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsAuthGuardService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.organizationDialogService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.notificationsService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.verdocsHeaderService;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.snackbar;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.router;
    /**
     * @type {?}
     * @private
     */
    HeaderToolsComponent.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLXRvb2xzLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL2hlYWRlci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2hlYWRlci10b29scy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFxQixLQUFLLEVBQUUsUUFBUSxFQUF1QixNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsV0FBVyxFQUFxQixNQUFNLDZCQUE2QixDQUFDO0FBQzdFLE9BQU8sRUFBRSxtQkFBbUIsRUFBZ0IsTUFBTSx3QkFBd0IsQ0FBQztBQUMzRSxPQUFPLEVBQXFCLHlCQUF5QixFQUErQixNQUFNLG1CQUFtQixDQUFDO0FBQzlHLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSx1QkFBdUIsRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzFHLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFFN0MsT0FBTyxFQUFvQixxQkFBcUIsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBT2xFLE1BQU0sT0FBTyxvQkFBb0I7Ozs7Ozs7Ozs7Ozs7SUErQi9CLFlBQ1UsbUJBQXdDLEVBQ3hDLG9CQUErQyxFQUMvQyx1QkFBZ0QsRUFDaEQseUJBQW9ELEVBQ3BELG9CQUF5QyxFQUN6QyxvQkFBMEMsRUFDMUMsUUFBcUIsRUFDckIsUUFBa0IsRUFDbEIsTUFBYyxFQUNPLFFBQVE7UUFUN0Isd0JB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SUFDeEIsd0NBQXdCOztJQUN4QiwwQ0FBMEI7O0lBQzFCLHdDQUF3Qjs7SUFDeEIseUNBQXlCOztJQUN6QixrREFBa0M7O0lBQ2xDLDhDQUE4Qjs7SUFDOUIsMENBQTBCOztJQUMxQixzQ0FBdUQ7O0lBQ3ZELGtEQUFtQzs7SUFDbkMsZ0RBQWdDOztJQUNoQywrQ0FHRTs7SUFDRix1Q0FBZ0M7O0lBQ2hDLG9DQUFpQzs7SUFDakMsb0NBQTZCOzs7OztJQUM3Qix5REFBdUQ7Ozs7O0lBQ3ZELDBEQUF3RDs7Ozs7SUFHdEQsbURBQWdEOzs7OztJQUNoRCxvREFBdUQ7Ozs7O0lBQ3ZELHVEQUF3RDs7Ozs7SUFDeEQseURBQTREOzs7OztJQUM1RCxvREFBaUQ7Ozs7O0lBQ2pELG9EQUFrRDs7Ozs7SUFDbEQsd0NBQTZCOzs7OztJQUM3Qix3Q0FBMEI7Ozs7O0lBQzFCLHNDQUFzQjs7Ozs7SUFDdEIsd0NBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9uRGVzdHJveSwgSW5wdXQsIEluamVjdG9yLCBBZnRlckNvbnRlbnRDaGVja2VkLCBJbmplY3QsIFBMQVRGT1JNX0lEIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgTWF0U25hY2tCYXIsIE1hdFNuYWNrQmFyQ29uZmlnIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc25hY2stYmFyJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UsIE5vdGlmaWNhdGlvbiB9IGZyb20gJ0B2ZXJkb2NzL25vdGlmaWNhdGlvbnMnO1xuaW1wb3J0IHsgUHJvZmlsZUNvbGxlY3Rpb24sIE9yZ2FuaXphdGlvbkRpYWxvZ1NlcnZpY2UsIE92ZXJyaWRlIGFzIFByb2ZpbGVPdmVycmlkZSB9IGZyb20gJ0B2ZXJkb2NzL3Byb2ZpbGVzJztcbmltcG9ydCB7IFZlcmRvY3NTdGF0ZVNlcnZpY2UsIFZlcmRvY3NBdXRoR3VhcmRTZXJ2aWNlLCBWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlIH0gZnJvbSAnQHZlcmRvY3MvdG9rZW5zJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmluZEluZGV4LCBpbmNsdWRlcyB9IGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IGNvbm5lY3Rpb25Db25maWcsIGNvbm5lY3Rpb25Db25maWdUb2tlbiB9IGZyb20gJy4uL2hlYWRlci5tb2R1bGUnO1xuaW1wb3J0IHsgVmVyZG9jc0hlYWRlclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9oZWFkZXIuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3ZlcmRvY3MtaGVhZGVyLXRvb2xzJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2hlYWRlci10b29scy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2hlYWRlci10b29scy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIEhlYWRlclRvb2xzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRDaGVja2VkLCBPbkRlc3Ryb3kge1xuICBwdWJsaWMgdG9rZW5Db25maWc6IGNvbm5lY3Rpb25Db25maWc7XG4gIHB1YmxpYyBhcHBzID0gW107XG4gIHB1YmxpYyBlbWFpbFZlcmlmaWVkOiBib29sZWFuO1xuICBwdWJsaWMgbm90aWZpY2F0aW9uczogTm90aWZpY2F0aW9uW10gPSBbXTtcbiAgcHVibGljIHByb2ZpbGVzOiBQcm9maWxlQ29sbGVjdGlvbjtcbiAgcHVibGljIG5ld1Byb2ZpbGU6IGFueTtcbiAgcHVibGljIG9yZ2FuaXphdGlvbl9pZDogc3RyaW5nO1xuICBwdWJsaWMgbXlBY2NvdW50VXJsOiBzdHJpbmc7XG4gIHB1YmxpYyByU2VjdXJlVXJsOiBzdHJpbmc7XG4gIHB1YmxpYyByRm9ybVVybDogc3RyaW5nO1xuICBwdWJsaWMgdGVybXNVcmw6IHN0cmluZztcbiAgcHVibGljIHByaXZhY3lVcmw6IHN0cmluZztcbiAgcHVibGljIGxvZ2luVXJsOiBzdHJpbmc7XG4gIHB1YmxpYyBzaWdudXBVcmw6IHN0cmluZztcbiAgcHVibGljIG9yZ2FuaXphdGlvbkltZ1NyYzogc3RyaW5nO1xuICBwdWJsaWMgcHJvZmlsZUxvYWRpbmcgPSBmYWxzZTtcbiAgcHVibGljIGhhc1Byb2ZpbGUgPSBmYWxzZTtcbiAgcHVibGljIG9yaWdpbjogJ3JGb3JtJyB8ICdyU2VjdXJlJyB8ICdyQWNjb3VudCcgfCBudWxsO1xuICBwdWJsaWMgaXNBdE9yaWdpbmFsT3JpZ2luOiBib29sZWFuO1xuICBwdWJsaWMgdmVyZG9jc19sb2dvX3VybDogc3RyaW5nO1xuICBASW5wdXQoKSBwdWJsaWMgcHJvZmlsZU92ZXJyaWRlOiBQcm9maWxlT3ZlcnJpZGUgPSB7XG4gICAgdG9wOjU2LFxuICAgIHJpZ2h0OiAyMFxuICB9O1xuICBASW5wdXQoKSBwdWJsaWMgc2lkZW5hdiA9IGZhbHNlO1xuICBASW5wdXQoKSBwdWJsaWMgdHlwZSA9ICdkZWZhdWx0JztcbiAgQElucHV0KCkgcHVibGljIG1vZGU6IHN0cmluZztcbiAgcHJpdmF0ZSBub3RpZmljYXRpb25zU3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICBwcml2YXRlIHByb2ZpbGVMb2FkaW5nU3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdmVyZG9jc1N0YXRlU2VydmljZTogVmVyZG9jc1N0YXRlU2VydmljZSxcbiAgICBwcml2YXRlIHZlcmRvY3NPYmplY3RTZXJ2aWNlOiBWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLFxuICAgIHByaXZhdGUgdmVyZG9jc0F1dGhHdWFyZFNlcnZpY2U6IFZlcmRvY3NBdXRoR3VhcmRTZXJ2aWNlLFxuICAgIHByaXZhdGUgb3JnYW5pemF0aW9uRGlhbG9nU2VydmljZTogT3JnYW5pemF0aW9uRGlhbG9nU2VydmljZSxcbiAgICBwcml2YXRlIG5vdGlmaWNhdGlvbnNTZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgdmVyZG9jc0hlYWRlclNlcnZpY2U6IFZlcmRvY3NIZWFkZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgc25hY2tiYXI6IE1hdFNuYWNrQmFyLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybVxuICApIHsgXG4gICAgdGhpcy50b2tlbkNvbmZpZyA9IHRoaXMuaW5qZWN0b3IuZ2V0KGNvbm5lY3Rpb25Db25maWdUb2tlbik7XG4gICAgdGhpcy5teUFjY291bnRVcmwgPSB0aGlzLnRva2VuQ29uZmlnLnJBY2NvdW50X2Zyb250ZW5kX3VybDtcbiAgICB0aGlzLnJTZWN1cmVVcmwgPSB0aGlzLnRva2VuQ29uZmlnLnJTZWN1cmVfZnJvbnRlbmRfdXJsO1xuICAgIHRoaXMuckZvcm1VcmwgPSB0aGlzLnRva2VuQ29uZmlnLnJGb3JtX2Zyb250ZW5kX3VybDtcbiAgICB0aGlzLnRlcm1zVXJsID0gdGhpcy50b2tlbkNvbmZpZy5yU2VjdXJlX2Zyb250ZW5kX3VybCArICcvdGVybXMnO1xuICAgIHRoaXMucHJpdmFjeVVybCA9IHRoaXMudG9rZW5Db25maWcuclNlY3VyZV9mcm9udGVuZF91cmwgKyAnL3ByaXZhY3knO1xuICAgIHRoaXMubG9naW5VcmwgPSB0aGlzLnRva2VuQ29uZmlnLnJTZWN1cmVfZnJvbnRlbmRfdXJsICsgJy9sb2dpbic7XG4gICAgdGhpcy5zaWdudXBVcmwgPSB0aGlzLnRva2VuQ29uZmlnLnJTZWN1cmVfZnJvbnRlbmRfdXJsICsgJy9zaWdudXAnO1xuICAgIHRoaXMub3JnYW5pemF0aW9uSW1nU3JjID0gYCR7dGhpcy50b2tlbkNvbmZpZy5yQWNjb3VudF9mcm9udGVuZF91cmx9L2Fzc2V0cy9vcmdhbml6YXRpb24vc2VsZWN0LXByb2ZpbGUucG5nYDtcbiAgICB0aGlzLnZlcmRvY3NfbG9nb191cmwgPSBgJHt0aGlzLnJGb3JtVXJsfS9hc3NldHMvYmx1ZS1sb2dvLnN2Z2A7XG4gICAgdGhpcy5vcmlnaW4gPSB0aGlzLnRva2VuQ29uZmlnLm9yaWdpbjtcbiAgICB0aGlzLmlzQXRPcmlnaW5hbE9yaWdpbiA9IHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2UuZ2V0QXRPcmlnaW4odGhpcy5vcmlnaW4pO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jaGVja0VtYWlsVmVyaWZpY2F0aW9uKCk7XG4gICAgdGhpcy5oYXNQcm9maWxlID0gdGhpcy52ZXJkb2NzT2JqZWN0U2VydmljZS5nZXRQcm9maWxlKCk7XG4gICAgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS51c2VyUHJvZmlsZVN1YmplY3Quc3Vic2NyaWJlKHByb2ZpbGVzID0+IHtcbiAgICAgIHRoaXMucHJvZmlsZXMgPSB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLmdldFByb2ZpbGVDb2xsZWN0aW9uKHByb2ZpbGVzKTtcbiAgICAgIHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2UucHJvZmlsZXNTdWJqZWN0Lm5leHQocHJvZmlsZXMpO1xuICAgICAgY29uc3QgaW5kZXggPSBmaW5kSW5kZXgocHJvZmlsZXMsIHsgb3JnYW5pemF0aW9uX2lkOiB0aGlzLm9yZ2FuaXphdGlvbl9pZCB9KTtcbiAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgIHRoaXMubmV3UHJvZmlsZSA9IHByb2ZpbGVzW2luZGV4XTtcbiAgICAgICAgdGhpcy5vcmdhbml6YXRpb25EaWFsb2dTZXJ2aWNlLnNldE5ld1Byb2ZpbGUodGhpcy5uZXdQcm9maWxlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnNTdWJzY3JpcHRpb24gPSB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLk5vdGlmaWNhdGF0aW9ucygpLnN1YnNjcmliZShub3RpZmljYXRpb25zID0+IHtcbiAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IG5vdGlmaWNhdGlvbnM7XG4gICAgfSk7XG4gICAgdGhpcy5wcm9maWxlTG9hZGluZ1N1YnNjcmlwdGlvbiA9IHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2UucHJvZmlsZUxvYWRpbmdTdWJqZWN0LnN1YnNjcmliZShzdGF0dXMgPT4ge1xuICAgICAgdGhpcy5wcm9maWxlTG9hZGluZyA9IHN0YXR1cztcbiAgICB9KTtcblxuICAgIGlmICghdGhpcy5wcm9maWxlcyAmJiB0aGlzLmhhc1Byb2ZpbGUpIHtcbiAgICAgIHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2UuZ2V0UHJvZmlsZXMoKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID4gNjAwKSB7XG4gICAgICAgICAgdGhpcy5wcm9maWxlT3ZlcnJpZGUudG9wID0gNjA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5wcm9maWxlT3ZlcnJpZGUudG9wID0gNTY7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLnByb2ZpbGVMb2FkaW5nU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRW1haWxWZXJpZmljYXRpb24oKTogdm9pZCB7XG4gICAgdGhpcy5lbWFpbFZlcmlmaWVkID0gdGhpcy52ZXJkb2NzU3RhdGVTZXJ2aWNlLmdldEVtYWlsVmVyaWZpY2F0aW9uKCk7XG4gICAgdGhpcy5vcmdhbml6YXRpb25EaWFsb2dTZXJ2aWNlLnNldEVtYWlsVmVyaWZpZWQodGhpcy5lbWFpbFZlcmlmaWVkKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgYWRtaW5fdXJsKCkge1xuICAgIGlmICh0aGlzLmhhc0FjY2Vzc1RvQWRtaW4oKSkge1xuICAgICAgcmV0dXJuIGAke3RoaXMudG9rZW5Db25maWcuckFjY291bnRfZnJvbnRlbmRfdXJsfS9hZG1pbmA7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZW1vdmVOb3RpZmljYXRpb24obm90aWZpY2F0aW9uOiBOb3RpZmljYXRpb24pIHtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnNTZXJ2aWNlLmRpc21pc3NOb3RpZmljYXRpb24obm90aWZpY2F0aW9uKTtcbiAgfVxuXG4gIHNpZ25PdXQoKSB7XG4gICAgdGhpcy52ZXJkb2NzQXV0aEd1YXJkU2VydmljZS5zaWduT3V0KCk7XG4gIH1cblxuICBzaWduSW4oKSB7XG4gICAgaWYgKHdpbmRvdykge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgJHt0aGlzLnJTZWN1cmVVcmx9L2xvZ2luP3JlZGlyZWN0X3VybD0ke3RoaXMuckZvcm1VcmwgKyB0aGlzLnJvdXRlci51cmx9YDtcbiAgICB9XG4gIH1cblxuICBzaWduVXAoKSB7XG4gICAgaWYgKHdpbmRvdykge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgJHt0aGlzLnJTZWN1cmVVcmx9L3NpZ251cD9yZWRpcmVjdF91cmw9JHt0aGlzLnJGb3JtVXJsICsgdGhpcy5yb3V0ZXIudXJsfWA7XG4gICAgfVxuICB9XG5cbiAgc3dpdGNoKHByb2ZpbGVfaWQ6IHN0cmluZykge1xuICAgIHRoaXMudmVyZG9jc0hlYWRlclNlcnZpY2Uuc3dpdGNoUHJvZmlsZShwcm9maWxlX2lkKS50aGVuKCgpID0+IHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYCR7dGhpcy50b2tlbkNvbmZpZy5yRm9ybV9mcm9udGVuZF91cmx9YDtcbiAgICB9KTtcbiAgfVxuXG4gIHN3aXRjaEFuZEdvVG9BZG1pbigpIHtcbiAgICBpZiAodGhpcy5uZXdQcm9maWxlKSB7XG4gICAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnN3aXRjaFByb2ZpbGUodGhpcy5uZXdQcm9maWxlLmlkKS50aGVuKHByb2ZpbGUgPT4ge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGAke3RoaXMubXlBY2NvdW50VXJsfS9hZG1pbi9wcm9maWxlLyR7dGhpcy5uZXdQcm9maWxlLmlkfWA7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVUb2tlblN0YXR1cyhzZW5kTWVzc2FnZT86IGJvb2xlYW4pIHtcbiAgICB0aGlzLmNyZWF0ZVNuYWNrYmFyKCdDaGVja2luZyBlbWFpbCB2ZXJpZmljYXRpb24nLCAnT0snKTtcbiAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnVwZGF0ZVRva2VucyhzZW5kTWVzc2FnZSkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmVtYWlsVmVyaWZpZWQgPSB0aGlzLnZlcmRvY3NTdGF0ZVNlcnZpY2UuZ2V0RW1haWxWZXJpZmljYXRpb24oKTtcbiAgICAgIHRoaXMub3JnYW5pemF0aW9uRGlhbG9nU2VydmljZS5zZXRFbWFpbFZlcmlmaWVkKHRoaXMuZW1haWxWZXJpZmllZCk7XG4gICAgfSk7XG4gIH1cblxuICByZXNlbmRFbWFpbFZlcmlmaWNhdGlvbigpIHtcbiAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLnJlc2VuZEVtYWlsVmVyaWZpY2F0aW9uKCk7XG4gIH1cblxuICBjaGVja05hbWVWYWxpZGl0eShuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS5nZXROYW1lVmFsaWRpdHkobmFtZSlcbiAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIHRoaXMub3JnYW5pemF0aW9uRGlhbG9nU2VydmljZS5zZXROYW1lVmFsaWRhdGlvbihyZXN1bHQpO1xuICAgICAgfSk7XG4gIH1cblxuICBjcmVhdGVPcmdhbml6YXRpb24ob3JnYW5pemF0aW9uR3JvdXApIHtcbiAgICB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLmNyZWF0ZU9yZ2FuaXphdGlvbihvcmdhbml6YXRpb25Hcm91cClcbiAgICAgIC50aGVuKGFzeW5jIG9yZ2FuaXphdGlvbiA9PiB7XG4gICAgICAgIHRoaXMub3JnYW5pemF0aW9uX2lkID0gb3JnYW5pemF0aW9uWydpZCddO1xuICAgICAgICBhd2FpdCB0aGlzLnZlcmRvY3NIZWFkZXJTZXJ2aWNlLmdldEFjY291bnREYXRhKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlU25hY2tiYXIoJ09yZ2FuaXphdGlvbiBjcmVhdGVkJywgbnVsbCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHN3aXRjaFByb2ZpbGUoKSB7XG4gICAgdGhpcy5zd2l0Y2godGhpcy5uZXdQcm9maWxlLmlkKTtcbiAgfVxuXG4gIGNoZWNrQWNjZXNzKGNsaWVudE5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy52ZXJkb2NzU3RhdGVTZXJ2aWNlLmhhc0FjY2Vzc1RvKGNsaWVudE5hbWUgKyAnX1JlYWxzdGVyJyk7XG4gIH1cblxuICBqdW1wVG8oY2xpZW50TmFtZSkge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdGhpcy50b2tlbkNvbmZpZ1tjbGllbnROYW1lICsgJ19mcm9udGVuZF91cmwnXTtcbiAgfVxuXG4gIHByaXZhdGUgaGFzQWNjZXNzVG9BZG1pbigpIHtcbiAgICBjb25zdCByb2xlcyA9IHRoaXMudmVyZG9jc1N0YXRlU2VydmljZS5nZXRSQWNjb3VudFJvbGVzKCk7XG4gICAgcmV0dXJuIGluY2x1ZGVzKHJvbGVzLCAnb3duZXInKSB8fCBpbmNsdWRlcyhyb2xlcywgJ2FkbWluJyk7XG4gIH1cblxuICBjcmVhdGVTbmFja2JhcihtZXNzYWdlOiBzdHJpbmcsIGJ1dHRvblRpdGxlPzogc3RyaW5nKSB7XG4gICAgaWYgKCFidXR0b25UaXRsZSkge1xuICAgICAgYnV0dG9uVGl0bGUgPSBudWxsO1xuICAgIH1cbiAgICBsZXQgc25hY2tiYXJDb25maWc6IE1hdFNuYWNrQmFyQ29uZmlnXG4gICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoID49IDkyMCkge1xuICAgICAgc25hY2tiYXJDb25maWcgPSB7XG4gICAgICAgIHZlcnRpY2FsUG9zaXRpb246ICdib3R0b20nLFxuICAgICAgICBob3Jpem9udGFsUG9zaXRpb246ICdsZWZ0JyxcbiAgICAgICAgZHVyYXRpb246IDUwMDBcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc25hY2tiYXJDb25maWcgPSB7XG4gICAgICAgIHZlcnRpY2FsUG9zaXRpb246ICd0b3AnLFxuICAgICAgICBkdXJhdGlvbjogNTAwMFxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnNuYWNrYmFyLm9wZW4obWVzc2FnZSwgYnV0dG9uVGl0bGUsIHNuYWNrYmFyQ29uZmlnKTtcbiAgfVxuXG4gIGx1bmNoRWxldmlvKCkge1xuICAgIHdpbmRvd1snbHVuY2hFbGV2aW8nXSgpO1xuICB9XG5cbiAgbHVuY2hJbnRlcmNvbSgpIHtcbiAgICB3aW5kb3dbJ2x1bmNoSW50ZXJjb20nXSgpXG4gIH1cbn1cbiJdfQ==