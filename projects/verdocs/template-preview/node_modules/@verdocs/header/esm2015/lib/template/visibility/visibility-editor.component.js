/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { VerdocsHeaderService } from '../../services/header.service';
import { TemplatesGuardService } from '../../services/templates.guard';
import { TemplateActions } from '../../models/verdocs.model';
export class VisibilityEditorComponent {
    /**
     * @param {?} templateGuard
     * @param {?} verdocsHeaderService
     */
    constructor(templateGuard, verdocsHeaderService) {
        this.templateGuard = templateGuard;
        this.verdocsHeaderService = verdocsHeaderService;
        this.updateVisibility = false;
        this.isSaving = false;
        this.isEditMode = false;
        this._canShareWithOrg = null;
        this._canMakeItPrivate = null;
        this._canShareWithPublic = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.template_visibility = this.getTemplateVisibility();
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        this.template_visibility = this.getTemplateVisibility();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.template_visibility = undefined;
    }
    /**
     * @return {?}
     */
    getTemplateVisibility() {
        if (this.visibility) {
            if (this.visibility.is_personal) {
                if (this.visibility.is_public) {
                    return 'personal & public';
                }
                else {
                    return 'personal';
                }
            }
            else {
                if (this.visibility.is_public) {
                    return 'public & org';
                }
                else {
                    return 'org';
                }
            }
        }
        return undefined;
    }
    /**
     * @return {?}
     */
    setUpdateVisibility() {
        /** @type {?} */
        const original_visibility = this.getTemplateVisibility();
        this.updateVisibility = original_visibility !== this.template_visibility;
    }
    /**
     * @return {?}
     */
    saveChanges() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            this.isSaving = true;
            /** @type {?} */
            const body = {};
            if (this.updateVisibility && this.template) {
                switch (this.template_visibility) {
                    case 'personal':
                        body['is_personal'] = true;
                        body['is_public'] = false;
                        break;
                    case 'org':
                        body['is_personal'] = false;
                        body['is_public'] = false;
                        break;
                    case 'public & org':
                        body['is_personal'] = false;
                        body['is_public'] = true;
                        break;
                    case 'personal & public':
                        body['is_personal'] = true;
                        body['is_public'] = true;
                    default:
                        break;
                }
            }
            /** @type {?} */
            const template = yield this.verdocsHeaderService.updateTemplate(this.template.id, body);
            this.updateVisibility = false;
            this.isSaving = false;
        });
    }
    /**
     * @return {?}
     */
    get canShareWithPublic() {
        if (this.template && typeof (this._canShareWithPublic) !== 'boolean') {
            this._canShareWithPublic = (this.templateGuard.canPerformAction(TemplateActions.CHANGE_VISIBILITY_PUBLIC, this.template))['canPerform'];
        }
        return this._canShareWithPublic;
    }
    /**
     * @return {?}
     */
    get canChangeVisibility() {
        return this.canMakeItPrivate || this.canShareWithOrg || this.canShareWithPublic;
    }
    /**
     * @return {?}
     */
    get canShareWithOrg() {
        if (this.template && typeof (this._canShareWithOrg) !== 'boolean') {
            this._canShareWithOrg = (this.templateGuard.canPerformAction(TemplateActions.CHANGE_VISIBILITY_ORG, this.template))['canPerform'];
        }
        return this._canShareWithOrg;
    }
    /**
     * @return {?}
     */
    get canMakeItPrivate() {
        if (this.template && typeof (this._canMakeItPrivate) !== 'boolean') {
            this._canMakeItPrivate =
                (this.templateGuard.canPerformAction(TemplateActions.CHANGE_VISIBILITY_PERSONAL, this.template))['canPerform'];
        }
        return this._canMakeItPrivate;
    }
}
VisibilityEditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-preview-visibility',
                template: "<div class=\"template-visiblity__container\" *ngIf=\"visibility\">\n  <ng-template #readView>\n    <div class=\"template-visibility__read\">\n      <div class=\"template-visibility__type\" *ngIf=\"visibility.is_personal && !visibility.is_public\">\n        <mat-icon class=\"template-visibility__type-icon\">lock</mat-icon>\n        <div class=\"template-visibility__type-text\">Personal</div>\n      </div>\n      <div class=\"template-visibility__type\" *ngIf=\"visibility.is_public\">\n        <mat-icon class=\"template-visibility__type-icon\">public</mat-icon>\n        <div class=\"template-visibility__type-text\">Public</div>\n      </div>\n      <div class=\"template-visibility__type\" *ngIf=\"!visibility.is_personal\">\n        <mat-icon class=\"template-visibility__type-icon\">group</mat-icon>\n        <div class=\"template-visibility__type-text\">Shared</div>\n      </div>\n    </div>\n  </ng-template>\n  <ng-template #editView>\n    <div class=\"template-visibility__edit\">\n      <mat-radio-group [(ngModel)]=\"template_visibility\" [disabled]=\"!canChangeVisibility\"\n        matTooltip=\"{{ !canChangeVisibility? 'You don\\'t have the permission to change the visibility of this document':''}}\">\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'personal'\" (click)=\"setUpdateVisibility()\"\n          [disabled]=\"!canMakeItPrivate\"\n          matTooltip=\"{{ !canMakeItPrivate? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Private\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Only you can see this document.\n          </div>\n        </mat-radio-button>\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'org'\" (click)=\"setUpdateVisibility()\"\n          [disabled]=\"!canShareWithOrg\"\n          matTooltip=\"{{ !canShareWithOrg? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Shared to your organization\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Give access to your organization to share this document.\n          </div>\n        </mat-radio-button>\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'public & org'\" (click)=\"setUpdateVisibility()\"\n          [disabled]=\"!canShareWithOrg || !canShareWithPublic\"\n          matTooltip=\"{{ !canShareWithOrg || !canShareWithPublic ? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Shared to your organization, and public on the web\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Give access to your organization to share, and anyone on the web can find and access this document.\n          </div>\n        </mat-radio-button>\n        <mat-radio-button class=\"template-visibility__radio-button\" [value]=\"'personal & public'\"\n          [disabled]=\"!canShareWithPublic\" (click)=\"setUpdateVisibility()\"\n          matTooltip=\"{{ !canShareWithPublic? 'You don\\'t have the permission to select this option':''}}\">\n          <div class=\"template-visibility__radio-text\">\n            Public on the web\n          </div>\n          <div class=\"template-visibility__radio-description\">\n            Anyone on the web can find and access this document.\n          </div>\n        </mat-radio-button>\n      </mat-radio-group>\n    </div>\n  </ng-template>\n  <ng-container *ngTemplateOutlet=\"isEditMode ? editView : readView\"></ng-container>\n</div>",
                styles: [".template-visibility__read,.template-visibility__type{display:flex;align-items:center}.template-visibility__type-icon{margin-right:4px;color:rgba(0,0,0,.54)}.template-visibility__type-text{color:rgba(0,0,0,.87);margin-right:8px}"]
            }] }
];
/** @nocollapse */
VisibilityEditorComponent.ctorParameters = () => [
    { type: TemplatesGuardService },
    { type: VerdocsHeaderService }
];
VisibilityEditorComponent.propDecorators = {
    visibility: [{ type: Input }],
    isEditMode: [{ type: Input }],
    template: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    VisibilityEditorComponent.prototype.template_visibility;
    /** @type {?} */
    VisibilityEditorComponent.prototype.updateVisibility;
    /** @type {?} */
    VisibilityEditorComponent.prototype.isSaving;
    /** @type {?} */
    VisibilityEditorComponent.prototype.visibility;
    /** @type {?} */
    VisibilityEditorComponent.prototype.isEditMode;
    /** @type {?} */
    VisibilityEditorComponent.prototype.template;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype._canShareWithOrg;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype._canMakeItPrivate;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype._canShareWithPublic;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype.templateGuard;
    /**
     * @type {?}
     * @private
     */
    VisibilityEditorComponent.prototype.verdocsHeaderService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlzaWJpbGl0eS1lZGl0b3IuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZlcmRvY3MvaGVhZGVyLyIsInNvdXJjZXMiOlsibGliL3RlbXBsYXRlL3Zpc2liaWxpdHkvdmlzaWJpbGl0eS1lZGl0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWdDLE1BQU0sZUFBZSxDQUFDO0FBRS9FLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBYSxlQUFlLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQU94RSxNQUFNLE9BQU8seUJBQXlCOzs7OztJQWFwQyxZQUNVLGFBQW9DLEVBQ3BDLG9CQUEwQztRQUQxQyxrQkFBYSxHQUFiLGFBQWEsQ0FBdUI7UUFDcEMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQWI3QyxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUdmLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFHcEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLHNCQUFpQixHQUFHLElBQUksQ0FBQztRQUN6Qix3QkFBbUIsR0FBRyxJQUFJLENBQUM7SUFLL0IsQ0FBQzs7OztJQUVMLFFBQVE7UUFDTixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDMUQsQ0FBQzs7OztJQUNELFdBQVc7UUFDVCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7SUFDMUQsQ0FBQzs7OztJQUNELFdBQVc7UUFDVCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsU0FBUyxDQUFDO0lBQ3ZDLENBQUM7Ozs7SUFFRCxxQkFBcUI7UUFDbkIs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QWdCLENBQUMsZUFBZSxDQUFDLHFCQUFxQixFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ25JO1FBQ0QsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUE7SUFDOUIsQ0FBQzs7OztJQUVELElBQUksZ0JBQWdCO1FBQ2xCLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssU0FBUyxFQUFFO1lBQ2xFLElBQUksQ0FBQyxpQkFBaUI7Z0JBQ3BCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUMsMEJBQTBCLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDbEg7UUFDRCxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQTtJQUMvQixDQUFDOzs7WUE5R0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSx3QkFBd0I7Z0JBQ2xDLGtzSEFBK0M7O2FBRWhEOzs7O1lBUFEscUJBQXFCO1lBRHJCLG9CQUFvQjs7O3lCQWMxQixLQUFLO3lCQUNMLEtBQUs7dUJBQ0wsS0FBSzs7OztJQU5OLHdEQUEyQjs7SUFDM0IscURBQWdDOztJQUNoQyw2Q0FBd0I7O0lBRXhCLCtDQUFvQjs7SUFDcEIsK0NBQTRCOztJQUM1Qiw2Q0FBa0I7Ozs7O0lBRWxCLHFEQUFnQzs7Ozs7SUFDaEMsc0RBQWlDOzs7OztJQUNqQyx3REFBbUM7Ozs7O0lBR2pDLGtEQUE0Qzs7Ozs7SUFDNUMseURBQWtEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBWZXJkb2NzSGVhZGVyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2hlYWRlci5zZXJ2aWNlJztcbmltcG9ydCB7IFRlbXBsYXRlc0d1YXJkU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3RlbXBsYXRlcy5ndWFyZCc7XG5pbXBvcnQgeyBJVGVtcGxhdGUsIFRlbXBsYXRlQWN0aW9ucyB9IGZyb20gJy4uLy4uL21vZGVscy92ZXJkb2NzLm1vZGVsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYXBwLXByZXZpZXctdmlzaWJpbGl0eScsXG4gIHRlbXBsYXRlVXJsOiAndmlzaWJpbGl0eS1lZGl0b3IuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi92aXNpYmlsaXR5LWVkaXRvci5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFZpc2liaWxpdHlFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgcHVibGljIHRlbXBsYXRlX3Zpc2liaWxpdHk7XG4gIHB1YmxpYyB1cGRhdGVWaXNpYmlsaXR5ID0gZmFsc2U7XG4gIHB1YmxpYyBpc1NhdmluZyA9IGZhbHNlO1xuXG4gIEBJbnB1dCgpIHZpc2liaWxpdHk7XG4gIEBJbnB1dCgpIGlzRWRpdE1vZGUgPSBmYWxzZTtcbiAgQElucHV0KCkgdGVtcGxhdGU7XG5cbiAgcHJpdmF0ZSBfY2FuU2hhcmVXaXRoT3JnID0gbnVsbDtcbiAgcHJpdmF0ZSBfY2FuTWFrZUl0UHJpdmF0ZSA9IG51bGw7XG4gIHByaXZhdGUgX2NhblNoYXJlV2l0aFB1YmxpYyA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZUd1YXJkOiBUZW1wbGF0ZXNHdWFyZFNlcnZpY2UsXG4gICAgcHJpdmF0ZSB2ZXJkb2NzSGVhZGVyU2VydmljZTogVmVyZG9jc0hlYWRlclNlcnZpY2VcbiAgKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnRlbXBsYXRlX3Zpc2liaWxpdHkgPSB0aGlzLmdldFRlbXBsYXRlVmlzaWJpbGl0eSgpO1xuICB9XG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIHRoaXMudGVtcGxhdGVfdmlzaWJpbGl0eSA9IHRoaXMuZ2V0VGVtcGxhdGVWaXNpYmlsaXR5KCk7XG4gIH1cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy50ZW1wbGF0ZV92aXNpYmlsaXR5ID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0VGVtcGxhdGVWaXNpYmlsaXR5KCkge1xuICAgIGlmICh0aGlzLnZpc2liaWxpdHkpIHtcbiAgICAgIGlmICh0aGlzLnZpc2liaWxpdHkuaXNfcGVyc29uYWwpIHtcbiAgICAgICAgaWYgKHRoaXMudmlzaWJpbGl0eS5pc19wdWJsaWMpIHtcbiAgICAgICAgICByZXR1cm4gJ3BlcnNvbmFsICYgcHVibGljJ1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAncGVyc29uYWwnO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy52aXNpYmlsaXR5LmlzX3B1YmxpYykge1xuICAgICAgICAgIHJldHVybiAncHVibGljICYgb3JnJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gJ29yZyc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIHNldFVwZGF0ZVZpc2liaWxpdHkoKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxfdmlzaWJpbGl0eSA9IHRoaXMuZ2V0VGVtcGxhdGVWaXNpYmlsaXR5KCk7XG4gICAgdGhpcy51cGRhdGVWaXNpYmlsaXR5ID0gb3JpZ2luYWxfdmlzaWJpbGl0eSAhPT0gdGhpcy50ZW1wbGF0ZV92aXNpYmlsaXR5O1xuICB9XG5cbiAgYXN5bmMgc2F2ZUNoYW5nZXMoKSB7XG4gICAgdGhpcy5pc1NhdmluZyA9IHRydWU7XG4gICAgY29uc3QgYm9keSA9IHt9O1xuICAgICAgaWYgKHRoaXMudXBkYXRlVmlzaWJpbGl0eSAmJiB0aGlzLnRlbXBsYXRlKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy50ZW1wbGF0ZV92aXNpYmlsaXR5KSB7XG4gICAgICAgICAgY2FzZSAncGVyc29uYWwnOlxuICAgICAgICAgICAgYm9keVsnaXNfcGVyc29uYWwnXSA9IHRydWU7XG4gICAgICAgICAgICBib2R5Wydpc19wdWJsaWMnXSA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnb3JnJzpcbiAgICAgICAgICAgIGJvZHlbJ2lzX3BlcnNvbmFsJ10gPSBmYWxzZTtcbiAgICAgICAgICAgIGJvZHlbJ2lzX3B1YmxpYyddID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdwdWJsaWMgJiBvcmcnOlxuICAgICAgICAgICAgYm9keVsnaXNfcGVyc29uYWwnXSA9IGZhbHNlO1xuICAgICAgICAgICAgYm9keVsnaXNfcHVibGljJ10gPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAncGVyc29uYWwgJiBwdWJsaWMnOlxuICAgICAgICAgICAgYm9keVsnaXNfcGVyc29uYWwnXSA9IHRydWU7XG4gICAgICAgICAgICBib2R5Wydpc19wdWJsaWMnXSA9IHRydWU7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCB0ZW1wbGF0ZTogSVRlbXBsYXRlID0gYXdhaXQgdGhpcy52ZXJkb2NzSGVhZGVyU2VydmljZS51cGRhdGVUZW1wbGF0ZSh0aGlzLnRlbXBsYXRlLmlkLCBib2R5KTtcbiAgICAgIHRoaXMudXBkYXRlVmlzaWJpbGl0eSA9IGZhbHNlO1xuICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICB9XG5cbiAgZ2V0IGNhblNoYXJlV2l0aFB1YmxpYygpIHtcbiAgICBpZiAodGhpcy50ZW1wbGF0ZSAmJiB0eXBlb2YgKHRoaXMuX2NhblNoYXJlV2l0aFB1YmxpYykgIT09ICdib29sZWFuJykge1xuICAgICAgdGhpcy5fY2FuU2hhcmVXaXRoUHVibGljID0gKHRoaXMudGVtcGxhdGVHdWFyZC5jYW5QZXJmb3JtQWN0aW9uKFRlbXBsYXRlQWN0aW9ucy5DSEFOR0VfVklTSUJJTElUWV9QVUJMSUMsIHRoaXMudGVtcGxhdGUpKVsnY2FuUGVyZm9ybSddO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fY2FuU2hhcmVXaXRoUHVibGljXG4gIH1cblxuICBnZXQgY2FuQ2hhbmdlVmlzaWJpbGl0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5jYW5NYWtlSXRQcml2YXRlIHx8IHRoaXMuY2FuU2hhcmVXaXRoT3JnIHx8IHRoaXMuY2FuU2hhcmVXaXRoUHVibGljXG4gIH1cblxuICBnZXQgY2FuU2hhcmVXaXRoT3JnKCkge1xuICAgIGlmICh0aGlzLnRlbXBsYXRlICYmIHR5cGVvZiAodGhpcy5fY2FuU2hhcmVXaXRoT3JnKSAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICB0aGlzLl9jYW5TaGFyZVdpdGhPcmcgPSAodGhpcy50ZW1wbGF0ZUd1YXJkLmNhblBlcmZvcm1BY3Rpb24oVGVtcGxhdGVBY3Rpb25zLkNIQU5HRV9WSVNJQklMSVRZX09SRywgdGhpcy50ZW1wbGF0ZSkpWydjYW5QZXJmb3JtJ107XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9jYW5TaGFyZVdpdGhPcmdcbiAgfVxuXG4gIGdldCBjYW5NYWtlSXRQcml2YXRlKCkge1xuICAgIGlmICh0aGlzLnRlbXBsYXRlICYmIHR5cGVvZiAodGhpcy5fY2FuTWFrZUl0UHJpdmF0ZSkgIT09ICdib29sZWFuJykge1xuICAgICAgdGhpcy5fY2FuTWFrZUl0UHJpdmF0ZSA9XG4gICAgICAgICh0aGlzLnRlbXBsYXRlR3VhcmQuY2FuUGVyZm9ybUFjdGlvbihUZW1wbGF0ZUFjdGlvbnMuQ0hBTkdFX1ZJU0lCSUxJVFlfUEVSU09OQUwsIHRoaXMudGVtcGxhdGUpKVsnY2FuUGVyZm9ybSddO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fY2FuTWFrZUl0UHJpdmF0ZVxuICB9XG5cbn1cbiJdfQ==