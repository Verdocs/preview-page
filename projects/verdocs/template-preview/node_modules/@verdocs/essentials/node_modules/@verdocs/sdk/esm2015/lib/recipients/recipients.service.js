/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { ReplaySubject } from 'rxjs';
import { VSDKConfigToken } from '../angular-api.module';
import { findIndex } from 'lodash';
export class RecipientService {
    /**
     * @param {?} httpClient
     * @param {?} injector
     */
    constructor(httpClient, injector) {
        this.httpClient = httpClient;
        this.injector = injector;
        this.recipientsSubject = new ReplaySubject();
        this.recipients = [];
        this._config_token = this.injector.get(VSDKConfigToken);
        this._rForm_backend_url = this._config_token.rForm_backend_url;
    }
    /**
     * @private
     * @param {?} recipient
     * @return {?}
     */
    updateRecipients(recipient) {
        if (recipient && recipient['length'] && recipient['length'] > 0) {
            this.recipients = (/** @type {?} */ (recipient));
        }
        else if (recipient) {
            if (this.recipients && this.recipients['length'] && this.recipients['length'] > 0) {
                /** @type {?} */
                const updatedRecipientIndex = findIndex((/** @type {?} */ (this.recipients)), { role_name: recipient['role_name'] });
                if (updatedRecipientIndex !== -1) {
                    this.recipients[updatedRecipientIndex] = (/** @type {?} */ (recipient));
                }
            }
            else {
                this.recipients.push((/** @type {?} */ (recipient)));
            }
        }
        this.recipientsSubject.next(this.recipients);
    }
    /**
     * @param {?} envelopeId
     * @return {?}
     */
    getRecipients(envelopeId) {
        return this.httpClient.get(this._rForm_backend_url + `/envelopes/${envelopeId}/recipients`)
            .toPromise().then((/**
         * @param {?} recipients
         * @return {?}
         */
        (recipients) => {
            this.updateRecipients(recipients);
            return recipients;
        })).catch((/**
         * @param {?} err
         * @return {?}
         */
        err => {
            console.error(err);
            return [];
        }));
    }
    /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} recipientsToUpdate
     * @return {?}
     */
    prepareRecipients(envId, roleName, recipientsToUpdate) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envId}/recipients/${roleName}`, { action: 'prepare', recipients: recipientsToUpdate }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        (updatedRecipient) => {
            this.updateRecipients(updatedRecipient);
        }));
    }
    /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} newFullName
     * @return {?}
     */
    updateRecipientName(envId, roleName, newFullName) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envId}/recipients/${roleName}`, { action: 'update', new_full_name: newFullName }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        (updatedRecipient) => {
            this.updateRecipients(updatedRecipient);
        }));
    }
    /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    setAsAgreed(envId, roleName) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envId}/recipients/${roleName}`, { action: 'update', agreed: true }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        (updatedRecipient) => {
            this.updateRecipients(updatedRecipient);
        }));
    }
    /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} profileToClaim
     * @return {?}
     */
    claimProfile(envId, roleName, profileToClaim) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envId}/recipients/${roleName}/claim`, { profile: profileToClaim }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        (updatedRecipient) => {
            this.updateRecipients(updatedRecipient);
        }));
    }
    /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @param {?} recipientInfo
     * @return {?}
     */
    updateRecipientInfoByOwner(envelopeId, roleName, recipientInfo) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envelopeId}/recipients/${roleName}`, { action: 'owner_update', full_name: recipientInfo.full_name, email: recipientInfo.email, phone: recipientInfo.phone }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        (updatedRecipient) => {
            this.updateRecipients(updatedRecipient);
            return updatedRecipient;
        }));
    }
    /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @return {?}
     */
    getInPersonLink(envelopeId, roleName) {
        return this.httpClient.get(this._rForm_backend_url + `/envelopes/${envelopeId}/recipients/${roleName}?in_person_link=true`)
            .toPromise().then((/**
         * @param {?} inPersonLink
         * @return {?}
         */
        (inPersonLink) => {
            return inPersonLink;
        }));
    }
}
RecipientService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
RecipientService.ctorParameters = () => [
    { type: HttpClient },
    { type: Injector }
];
if (false) {
    /** @type {?} */
    RecipientService.prototype.recipientsSubject;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype._config_token;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype._rForm_backend_url;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype.recipients;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjaXBpZW50cy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZlcmRvY3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL3JlY2lwaWVudHMvcmVjaXBpZW50cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVyQyxPQUFPLEVBQWMsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUduQyxNQUFNLE9BQU8sZ0JBQWdCOzs7OztJQU8zQixZQUNVLFVBQXNCLEVBQ3RCLFFBQWtCO1FBRGxCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQVJyQixzQkFBaUIsR0FBRyxJQUFJLGFBQWEsRUFBZ0IsQ0FBQztRQUlyRCxlQUFVLEdBQWlCLEVBQUUsQ0FBQztRQU1wQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDO0lBQ2pFLENBQUM7Ozs7OztJQUVPLGdCQUFnQixDQUFDLFNBQW9DO1FBQzNELElBQUksU0FBUyxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQy9ELElBQUksQ0FBQyxVQUFVLEdBQUcsbUJBQUEsU0FBUyxFQUFnQixDQUFDO1NBQzdDO2FBQU0sSUFBSSxTQUFTLEVBQUU7WUFDcEIsSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7O3NCQUMzRSxxQkFBcUIsR0FBRyxTQUFTLENBQUMsbUJBQUEsSUFBSSxDQUFDLFVBQVUsRUFBTyxFQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO2dCQUN0RyxJQUFJLHFCQUFxQixLQUFLLENBQUMsQ0FBQyxFQUFFO29CQUNoQyxJQUFJLENBQUMsVUFBVSxDQUFDLHFCQUFxQixDQUFDLEdBQUcsbUJBQUEsU0FBUyxFQUFjLENBQUM7aUJBQ2xFO2FBQ0Y7aUJBQU07Z0JBQ0wsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsbUJBQUEsU0FBUyxFQUFjLENBQUMsQ0FBQzthQUMvQztTQUNGO1FBQ0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDL0MsQ0FBQzs7Ozs7SUFFTSxhQUFhLENBQUMsVUFBVTtRQUM3QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxjQUFjLFVBQVUsYUFBYSxDQUFDO2FBQ3hGLFNBQVMsRUFBRSxDQUFDLElBQUk7Ozs7UUFBQyxDQUFDLFVBQXdCLEVBQUUsRUFBRTtZQUM3QyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbEMsT0FBTyxVQUFVLENBQUM7UUFDcEIsQ0FBQyxFQUFDLENBQUMsS0FBSzs7OztRQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNsQixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsRUFBQyxDQUFBO0lBQ04sQ0FBQzs7Ozs7OztJQUVELGlCQUFpQixDQUFDLEtBQWEsRUFBRSxRQUFnQixFQUFFLGtCQUF5QjtRQUMxRSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUN4QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsY0FBYyxLQUFLLGVBQWUsUUFBUSxFQUFFLEVBQ3RFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsa0JBQWtCLEVBQUUsQ0FDdEQsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxnQkFBNEIsRUFBRSxFQUFFO1lBQ2xELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFDLENBQUMsRUFBQyxDQUFBO0lBQ0osQ0FBQzs7Ozs7OztJQUVELG1CQUFtQixDQUFDLEtBQWEsRUFBRSxRQUFnQixFQUFFLFdBQW1CO1FBQ3RFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQ3hCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxjQUFjLEtBQUssZUFBZSxRQUFRLEVBQUUsRUFDdEUsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsQ0FDakQsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxnQkFBNEIsRUFBRSxFQUFFO1lBQ2xELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFDLENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7O0lBRUQsV0FBVyxDQUFDLEtBQWEsRUFBRSxRQUFnQjtRQUN6QyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUN4QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsY0FBYyxLQUFLLGVBQWUsUUFBUSxFQUFFLEVBQ3RFLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQ25DLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSTs7OztRQUFDLENBQUMsZ0JBQTRCLEVBQUUsRUFBRTtZQUNsRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUMxQyxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7Ozs7SUFFRCxZQUFZLENBQUMsS0FBYSxFQUFFLFFBQWdCLEVBQUUsY0FBbUI7UUFDL0QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FDeEIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGNBQWMsS0FBSyxlQUFlLFFBQVEsUUFBUSxFQUM1RSxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FDNUIsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxnQkFBNEIsRUFBRSxFQUFFO1lBQ2xELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFDLENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7OztJQUVELDBCQUEwQixDQUFDLFVBQWtCLEVBQUUsUUFBZ0IsRUFBRSxhQUFtRTtRQUNsSSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUN4QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsY0FBYyxVQUFVLGVBQWUsUUFBUSxFQUFFLEVBQzNFLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUN2SCxDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUk7Ozs7UUFBQyxDQUFDLGdCQUE0QixFQUFFLEVBQUU7WUFDbEQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDeEMsT0FBTyxnQkFBZ0IsQ0FBQztRQUMxQixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7OztJQUVELGVBQWUsQ0FBQyxVQUFVLEVBQUUsUUFBZ0I7UUFDMUMsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FDeEIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGNBQWMsVUFBVSxlQUFlLFFBQVEsc0JBQXNCLENBQUM7YUFDL0YsU0FBUyxFQUFFLENBQUMsSUFBSTs7OztRQUFDLENBQUMsWUFBWSxFQUFFLEVBQUU7WUFDakMsT0FBTyxZQUFZLENBQUM7UUFDdEIsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7WUEvRkYsVUFBVTs7OztZQVBGLFVBQVU7WUFERSxRQUFROzs7O0lBVTNCLDZDQUE2RDs7Ozs7SUFFN0QseUNBQWtDOzs7OztJQUNsQyw4Q0FBbUM7Ozs7O0lBQ25DLHNDQUFzQzs7Ozs7SUFHcEMsc0NBQThCOzs7OztJQUM5QixvQ0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgVlNES0NvbmZpZywgVlNES0NvbmZpZ1Rva2VuIH0gZnJvbSAnLi4vYW5ndWxhci1hcGkubW9kdWxlJztcbmltcG9ydCB7IElSZWNpcGllbnQgfSBmcm9tICcuLi9tb2RlbHMvcmVjaXBpZW50Lm1vZGVsJztcbmltcG9ydCB7IGZpbmRJbmRleCB9IGZyb20gJ2xvZGFzaCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSZWNpcGllbnRTZXJ2aWNlIHtcbiAgcHVibGljIHJlY2lwaWVudHNTdWJqZWN0ID0gbmV3IFJlcGxheVN1YmplY3Q8SVJlY2lwaWVudFtdPigpO1xuXG4gIHByaXZhdGUgX2NvbmZpZ190b2tlbjogVlNES0NvbmZpZztcbiAgcHJpdmF0ZSBfckZvcm1fYmFja2VuZF91cmw6IHN0cmluZztcbiAgcHJpdmF0ZSByZWNpcGllbnRzOiBJUmVjaXBpZW50W10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcbiAgKSB7XG4gICAgdGhpcy5fY29uZmlnX3Rva2VuID0gdGhpcy5pbmplY3Rvci5nZXQoVlNES0NvbmZpZ1Rva2VuKTtcbiAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCA9IHRoaXMuX2NvbmZpZ190b2tlbi5yRm9ybV9iYWNrZW5kX3VybDtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUmVjaXBpZW50cyhyZWNpcGllbnQ6IElSZWNpcGllbnQgfCBJUmVjaXBpZW50W10pIHtcbiAgICBpZiAocmVjaXBpZW50ICYmIHJlY2lwaWVudFsnbGVuZ3RoJ10gJiYgcmVjaXBpZW50WydsZW5ndGgnXSA+IDApIHtcbiAgICAgIHRoaXMucmVjaXBpZW50cyA9IHJlY2lwaWVudCBhcyBJUmVjaXBpZW50W107XG4gICAgfSBlbHNlIGlmIChyZWNpcGllbnQpIHtcbiAgICAgIGlmICh0aGlzLnJlY2lwaWVudHMgJiYgdGhpcy5yZWNpcGllbnRzWydsZW5ndGgnXSAmJiB0aGlzLnJlY2lwaWVudHNbJ2xlbmd0aCddID4gMCkge1xuICAgICAgICBjb25zdCB1cGRhdGVkUmVjaXBpZW50SW5kZXggPSBmaW5kSW5kZXgodGhpcy5yZWNpcGllbnRzIGFzIGFueSwgeyByb2xlX25hbWU6IHJlY2lwaWVudFsncm9sZV9uYW1lJ10gfSk7XG4gICAgICAgIGlmICh1cGRhdGVkUmVjaXBpZW50SW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5yZWNpcGllbnRzW3VwZGF0ZWRSZWNpcGllbnRJbmRleF0gPSByZWNpcGllbnQgYXMgSVJlY2lwaWVudDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZWNpcGllbnRzLnB1c2gocmVjaXBpZW50IGFzIElSZWNpcGllbnQpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnJlY2lwaWVudHNTdWJqZWN0Lm5leHQodGhpcy5yZWNpcGllbnRzKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRSZWNpcGllbnRzKGVudmVsb3BlSWQpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCh0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArIGAvZW52ZWxvcGVzLyR7ZW52ZWxvcGVJZH0vcmVjaXBpZW50c2ApXG4gICAgICAudG9Qcm9taXNlKCkudGhlbigocmVjaXBpZW50czogSVJlY2lwaWVudFtdKSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlUmVjaXBpZW50cyhyZWNpcGllbnRzKTtcbiAgICAgICAgcmV0dXJuIHJlY2lwaWVudHM7XG4gICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycilcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfSlcbiAgfVxuXG4gIHByZXBhcmVSZWNpcGllbnRzKGVudklkOiBzdHJpbmcsIHJvbGVOYW1lOiBzdHJpbmcsIHJlY2lwaWVudHNUb1VwZGF0ZTogYW55W10pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dChcbiAgICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfWAsXG4gICAgICB7IGFjdGlvbjogJ3ByZXBhcmUnLCByZWNpcGllbnRzOiByZWNpcGllbnRzVG9VcGRhdGUgfVxuICAgICkudG9Qcm9taXNlKCkudGhlbigodXBkYXRlZFJlY2lwaWVudDogSVJlY2lwaWVudCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVSZWNpcGllbnRzKHVwZGF0ZWRSZWNpcGllbnQpO1xuICAgIH0pXG4gIH1cblxuICB1cGRhdGVSZWNpcGllbnROYW1lKGVudklkOiBzdHJpbmcsIHJvbGVOYW1lOiBzdHJpbmcsIG5ld0Z1bGxOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dChcbiAgICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfWAsXG4gICAgICB7IGFjdGlvbjogJ3VwZGF0ZScsIG5ld19mdWxsX25hbWU6IG5ld0Z1bGxOYW1lIH1cbiAgICApLnRvUHJvbWlzZSgpLnRoZW4oKHVwZGF0ZWRSZWNpcGllbnQ6IElSZWNpcGllbnQpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlUmVjaXBpZW50cyh1cGRhdGVkUmVjaXBpZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldEFzQWdyZWVkKGVudklkOiBzdHJpbmcsIHJvbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dChcbiAgICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfWAsXG4gICAgICB7IGFjdGlvbjogJ3VwZGF0ZScsIGFncmVlZDogdHJ1ZSB9XG4gICAgKS50b1Byb21pc2UoKS50aGVuKCh1cGRhdGVkUmVjaXBpZW50OiBJUmVjaXBpZW50KSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVJlY2lwaWVudHModXBkYXRlZFJlY2lwaWVudCk7XG4gICAgfSk7XG4gIH1cblxuICBjbGFpbVByb2ZpbGUoZW52SWQ6IHN0cmluZywgcm9sZU5hbWU6IHN0cmluZywgcHJvZmlsZVRvQ2xhaW06IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucHV0KFxuICAgICAgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2VudmVsb3Blcy8ke2VudklkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9L2NsYWltYCxcbiAgICAgIHsgcHJvZmlsZTogcHJvZmlsZVRvQ2xhaW0gfVxuICAgICkudG9Qcm9taXNlKCkudGhlbigodXBkYXRlZFJlY2lwaWVudDogSVJlY2lwaWVudCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVSZWNpcGllbnRzKHVwZGF0ZWRSZWNpcGllbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlUmVjaXBpZW50SW5mb0J5T3duZXIoZW52ZWxvcGVJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nLCByZWNpcGllbnRJbmZvOiB7IGZ1bGxfbmFtZTogc3RyaW5nOyBlbWFpbDogc3RyaW5nOyBwaG9uZTogc3RyaW5nOyB9KSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQoXG4gICAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArIGAvZW52ZWxvcGVzLyR7ZW52ZWxvcGVJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfWAsXG4gICAgICB7IGFjdGlvbjogJ293bmVyX3VwZGF0ZScsIGZ1bGxfbmFtZTogcmVjaXBpZW50SW5mby5mdWxsX25hbWUsIGVtYWlsOiByZWNpcGllbnRJbmZvLmVtYWlsLCBwaG9uZTogcmVjaXBpZW50SW5mby5waG9uZSB9XG4gICAgKS50b1Byb21pc2UoKS50aGVuKCh1cGRhdGVkUmVjaXBpZW50OiBJUmVjaXBpZW50KSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVJlY2lwaWVudHModXBkYXRlZFJlY2lwaWVudCk7XG4gICAgICByZXR1cm4gdXBkYXRlZFJlY2lwaWVudDtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEluUGVyc29uTGluayhlbnZlbG9wZUlkLCByb2xlTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQoXG4gICAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArIGAvZW52ZWxvcGVzLyR7ZW52ZWxvcGVJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfT9pbl9wZXJzb25fbGluaz10cnVlYClcbiAgICAgIC50b1Byb21pc2UoKS50aGVuKChpblBlcnNvbkxpbmspID0+IHtcbiAgICAgICAgcmV0dXJuIGluUGVyc29uTGluaztcbiAgICAgIH0pO1xuICB9XG59XG4iXX0=