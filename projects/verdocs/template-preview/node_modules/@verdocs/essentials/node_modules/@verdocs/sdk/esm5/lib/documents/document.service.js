/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { HttpClient, HttpResponse, HttpRequest, HttpHeaders } from '@angular/common/http';
import { BehaviorSubject, empty } from 'rxjs';
import { concatMap, map } from 'rxjs/operators';
import { findIndex } from 'lodash';
import { differenceBy } from 'lodash';
import { VerdocsTokenObjectService, VerdocsStateService } from '@verdocs/tokens';
// import { saveAs } from 'file-saver';
// import * as jszip from 'jszip';
// import * as moment from 'moment';
import { ValidatorService } from '../validators/validator.service';
import { getRGBA, nameToRGBA } from '../functions/rgb';
import { VSDKConfigToken } from '../angular-api.module';
import { FieldData } from '../models/field-data.model';
var DocumentsService = /** @class */ (function () {
    function DocumentsService(httpClient, validatorService, tokenObjectService, vTokenStateService, injector, platform) {
        this.httpClient = httpClient;
        this.validatorService = validatorService;
        this.tokenObjectService = tokenObjectService;
        this.vTokenStateService = vTokenStateService;
        this.injector = injector;
        this.platform = platform;
        this._currentFields = new BehaviorSubject([]);
        this._currEnvelope = new BehaviorSubject('');
        this.allEnvelopes = new BehaviorSubject([]);
        this._currentExtendedEnvelope = new BehaviorSubject({});
        this._customFilterSubject = new BehaviorSubject({});
        this.currEnvelope$ = this._currEnvelope.asObservable();
        this.fieldsStream = this._currentFields.asObservable();
        this.inProgressSubject = new BehaviorSubject(false);
        this.workingField = new FieldData({ order: 0 });
        this.envelope = null;
        this.validators = {};
        this.toggleNextSubject = new BehaviorSubject(false);
        this._config_token = this.injector.get(VSDKConfigToken);
        this._rForm_backend_url = this._config_token.rForm_backend_url;
        this._documentUrl = this._rForm_backend_url + "/envelopes";
    }
    /**
     * @param {?} id
     * @return {?}
     */
    DocumentsService.prototype.setCurrentEnvelope = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.currEnvelope = id;
        this._currEnvelope.next(id);
    };
    /**
     * @param {?} envId
     * @param {?} roleId
     * @return {?}
     */
    DocumentsService.prototype.setEnvData = /**
     * @param {?} envId
     * @param {?} roleId
     * @return {?}
     */
    function (envId, roleId) {
        this.currEnvelope = envId;
        this.currRoleName = roleId;
    };
    /**
     * @param {?} envelopes
     * @return {?}
     */
    DocumentsService.prototype.updateEnvelopes = /**
     * @param {?} envelopes
     * @return {?}
     */
    function (envelopes) {
        this.allEnvelopes.next(envelopes);
    };
    Object.defineProperty(DocumentsService.prototype, "role_name", {
        get: /**
         * @return {?}
         */
        function () {
            return this.currRoleName;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DocumentsService.prototype, "env_id", {
        get: /**
         * @return {?}
         */
        function () {
            return this.currEnvelope;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} body
     * @return {?}
     */
    DocumentsService.prototype.sendInvite = /**
     * @param {?} body
     * @return {?}
     */
    function (body) {
        return this.httpClient.post(this._documentUrl, body)
            .pipe(map((/**
         * @param {?} envelope
         * @return {?}
         */
        function (envelope) { return envelope; }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            return err;
        })));
    };
    /**
     * @param {?} envelopeId
     * @param {?} role
     * @return {?}
     */
    DocumentsService.prototype.sendDelegate = /**
     * @param {?} envelopeId
     * @param {?} role
     * @return {?}
     */
    function (envelopeId, role) {
        return this.httpClient.post(this._documentUrl + ("/" + envelopeId + "/recipients/" + this.currRoleName + "/delegate"), role)
            .pipe(map((/**
         * @param {?} envelope
         * @return {?}
         */
        function (envelope) { return envelope; }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return err; })));
    };
    /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @return {?}
     */
    DocumentsService.prototype.resendInvitation = /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @return {?}
     */
    function (envelopeId, roleName) {
        return this.httpClient.post(this._documentUrl + ("/" + envelopeId + "/recipients/" + roleName + "/resend_invitation"), null);
    };
    /**
     * @param {?=} id
     * @return {?}
     */
    DocumentsService.prototype.getEnvelope = /**
     * @param {?=} id
     * @return {?}
     */
    function (id) {
        var _this = this;
        /** @type {?} */
        var envelopeId = id ? id : this.currEnvelope;
        this.setCurrentEnvelope(envelopeId);
        return this.httpClient.get(this._documentUrl + ("/" + envelopeId))
            .pipe(map((/**
         * @param {?} envelopeExtended
         * @return {?}
         */
        function (envelopeExtended) {
            _this.envelope = (/** @type {?} */ (envelopeExtended));
            _this.envelope.recipients = _this.sortRecipients(_this.envelope);
            _this._currentExtendedEnvelope.next(_this.envelope);
            _this.envelopeData = _this.envelope;
            return _this.envelope;
        })));
    };
    /**
     * @param {?=} templateId
     * @return {?}
     */
    DocumentsService.prototype.getAllEnvelopes = /**
     * @param {?=} templateId
     * @return {?}
     */
    function (templateId) {
        var _this = this;
        /** @type {?} */
        var endpoint = templateId ? this._documentUrl + ("?template_id=" + templateId) : this._documentUrl;
        return this.httpClient.request(new HttpRequest('GET', endpoint, {}, {
            reportProgress: true,
            responseType: 'json'
        })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (event instanceof HttpResponse) {
                _this.updateEnvelopes(event.body);
                return (/** @type {?} */ (event));
            }
            return event;
        })));
    };
    /**
     * @param {?} searchParams
     * @return {?}
     */
    DocumentsService.prototype.searchEnvelopes = /**
     * @param {?} searchParams
     * @return {?}
     */
    function (searchParams) {
        var _this = this;
        for (var key in searchParams) {
            if (searchParams.hasOwnProperty(key)) {
                if (searchParams[key] === null) {
                    delete searchParams[key];
                }
            }
        }
        return this.httpClient.request(new HttpRequest('POST', this._documentUrl + '/search', searchParams, {
            reportProgress: true,
            responseType: 'json'
        })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (event instanceof HttpResponse) {
                _this.updateEnvelopes(event.body);
                return (/** @type {?} */ (event));
            }
            return event;
        })));
    };
    /**
     * @param {?=} page
     * @return {?}
     */
    DocumentsService.prototype.getRecentActivities = /**
     * @param {?=} page
     * @return {?}
     */
    function (page) {
        /** @type {?} */
        var searchBody = {
            sort_by: (/** @type {?} */ ('updated_at')),
            ascending: false,
            row: 5,
            page: page ? page : 1
        };
        return this.searchEnvelopes(searchBody);
    };
    /**
     * @param {?} filters
     * @param {?} searchParams
     * @return {?}
     */
    DocumentsService.prototype.applyCustomSearch = /**
     * @param {?} filters
     * @param {?} searchParams
     * @return {?}
     */
    function (filters, searchParams) {
        if (filters['envelope_status'] && !searchParams['envelope_status']) {
            searchParams['envelope_status'] = filters['envelope_status'];
        }
        if (filters['updated_at']) {
            if (!searchParams['updated_at'] && !!searchParams['envelope_status']) {
                searchParams['updated_at'] = filters['updated_at'];
            }
            else if (!searchParams['envelope_status']) {
                searchParams['created_at'] = filters['updated_at'];
                if (!searchParams['sort_by']) {
                    searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                }
            }
        }
        if (filters['recipient_name']) {
            searchParams['recipient_name'] = filters['recipient_name'];
        }
        if (filters['envelope_name']) {
            searchParams['envelope_name'] = filters['envelope_name'];
        }
        if (filters['recipient_email']) {
            searchParams['recipient_email'] = filters['recipient_email'];
        }
        if (filters['text_field_value']) {
            searchParams['text_field_value'] = filters['text_field_value'];
        }
        return searchParams;
    };
    /**
     * @param {?} type
     * @param {?=} ascending
     * @param {?=} row
     * @param {?=} page
     * @param {?=} filterTime
     * @param {?=} sortBy
     * @param {?=} customFilters
     * @return {?}
     */
    DocumentsService.prototype.filterSearchBy = /**
     * @param {?} type
     * @param {?=} ascending
     * @param {?=} row
     * @param {?=} page
     * @param {?=} filterTime
     * @param {?=} sortBy
     * @param {?=} customFilters
     * @return {?}
     */
    function (type, ascending, row, page, filterTime, sortBy, customFilters) {
        /** @type {?} */
        var searchParams = {
            ascending: ascending || false,
            row: row || 10,
            page: page || 1
        };
        switch (type) {
            case 'action_required':
                searchParams['is_recipient'] = true;
                searchParams['recipient_status'] = ['invited', 'opened', 'signed'];
                searchParams['envelope_status'] = ['pending', 'in progress'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy));
                if (filterTime) {
                    searchParams['updated_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('updated_at'));
                    }
                }
                break;
            case 'waiting_on_others':
                return this.getWaitingOnOthers(ascending, row, page, filterTime, sortBy, customFilters);
            case 'waiting_on_others_unfiltered':
                searchParams['is_owner'] = true;
                searchParams['envelope_status'] = ['pending', 'in progress'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['updated_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('updated_at'));
                    }
                }
                break;
            case 'inbox':
                searchParams['is_recipient'] = true;
                searchParams['recipient_status'] = ['invited', 'declined', 'opened', 'signed', 'submitted', 'canceled'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['created_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                    }
                }
                break;
            case 'completed':
                searchParams['envelope_status'] = ['complete'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['updated_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('updated_at'));
                    }
                }
                break;
            case 'sent':
                searchParams['is_owner'] = true;
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['created_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                    }
                }
                break;
            case 'all':
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['created_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                    }
                }
                break;
            default:
                break;
        }
        if (!!customFilters) {
            searchParams = this.applyCustomSearch(customFilters, tslib_1.__assign({}, searchParams));
        }
        return this.searchEnvelopes(searchParams);
    };
    /**
     * @param {?=} ascending
     * @param {?=} row
     * @param {?=} page
     * @param {?=} filterTime
     * @param {?=} sortBy
     * @param {?=} customFilters
     * @return {?}
     */
    DocumentsService.prototype.getWaitingOnOthers = /**
     * @param {?=} ascending
     * @param {?=} row
     * @param {?=} page
     * @param {?=} filterTime
     * @param {?=} sortBy
     * @param {?=} customFilters
     * @return {?}
     */
    function (ascending, row, page, filterTime, sortBy, customFilters) {
        var _this = this;
        /** @type {?} */
        var actionRequiredEnvelopes = null;
        return this.filterSearchBy('action_required', ascending, row, page, filterTime, sortBy, customFilters)
            .pipe(concatMap((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (res instanceof HttpResponse) {
                actionRequiredEnvelopes = res.body['result'];
                return _this.filterSearchBy('waiting_on_others_unfiltered', ascending, row, page, filterTime, sortBy, customFilters);
            }
            else {
                return empty();
            }
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response instanceof HttpResponse && actionRequiredEnvelopes) {
                /** @type {?} */
                var unfilteredWaitingOnOthers = response['body']['result'];
                /** @type {?} */
                var filteredWaitingOnOthers = differenceBy(unfilteredWaitingOnOthers, actionRequiredEnvelopes, 'id');
                response.body['result'] = filteredWaitingOnOthers;
                response.body['total'] = filteredWaitingOnOthers.length;
            }
            return response;
        })));
    };
    /**
     * @param {?} envId
     * @return {?}
     */
    DocumentsService.prototype.getEnvelopeOwnerInfo = /**
     * @param {?} envId
     * @return {?}
     */
    function (envId) {
        return this.httpClient.get(this._documentUrl + ("/" + envId + "?owner_info=true")).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res;
        })));
    };
    /**
     * @param {?} envId
     * @param {?} docId
     * @return {?}
     */
    DocumentsService.prototype.getEnvelopeDocUrl = /**
     * @param {?} envId
     * @param {?} docId
     * @return {?}
     */
    function (envId, docId) {
        var _this = this;
        return this.httpClient.get(this._documentUrl + ("/" + envId + "/envelope_documents/" + docId + "?file=true"), { responseType: 'blob' })
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            if (isPlatformBrowser(_this.platform)) {
                /** @type {?} */
                var urlCreator = window.URL;
                /** @type {?} */
                var pdfUrl = urlCreator.createObjectURL(res);
                return pdfUrl;
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            // use a snackBar/error.service
            console.error(err);
        })));
    };
    /**
     * @param {?} envelopeId
     * @param {?} documentId
     * @return {?}
     */
    DocumentsService.prototype.getEnvelopePdfWithProgress = /**
     * @param {?} envelopeId
     * @param {?} documentId
     * @return {?}
     */
    function (envelopeId, documentId) {
        /** @type {?} */
        var requestUrl = this._documentUrl + ("/" + envelopeId + "/envelope_documents/" + documentId + "?file=true");
        return this.httpClient.request(new HttpRequest('GET', requestUrl, {}, { reportProgress: true, responseType: 'blob' })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return event; })));
    };
    /**
     * @param {?} envId
     * @param {?} docId
     * @return {?}
     */
    DocumentsService.prototype.getEnvelopeDocBlob = /**
     * @param {?} envId
     * @param {?} docId
     * @return {?}
     */
    function (envId, docId) {
        return this.httpClient.get(this._documentUrl + ("/" + envId + "/envelope_documents/" + docId + "?file=true"), { responseType: 'blob' })
            .pipe(map((/**
         * @param {?} file
         * @return {?}
         */
        function (file) {
            return file;
        })));
    };
    /**
     * @param {?} envId
     * @return {?}
     */
    DocumentsService.prototype.getEnvelopeCertificateBlob = /**
     * @param {?} envId
     * @return {?}
     */
    function (envId) {
        return this.httpClient.get(this._documentUrl + ("/" + envId + "?certificate_file=true"), { responseType: 'blob' })
            .pipe(map((/**
         * @param {?} file
         * @return {?}
         */
        function (file) {
            return file;
        })));
    };
    /********************************
     * Move logic to public library *
     *******************************/
    // downloadEnvelope(envelope) {
    //   this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(pdfBlob => {
    //     saveAs(pdfBlob, envelope.name + '-' + moment(envelope.updated_at).format('MM-DD-YY') + '.pdf');
    //   });
    // }
    // downloadEnvelopeCertificate(envelope) {
    //   this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(pdfBlob => {
    //     if (pdfBlob) {
    //       saveAs(pdfBlob, `${envelope.name}_certificate.pdf`);
    //     }
    //   });
    // }
    /**
     * *****************************
     * Move logic to public library *
     * *****************************
     * @param {?} templateId
     * @param {?} token
     * @param {?} file
     * @return {?}
     */
    // downloadEnvelope(envelope) {
    //   this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(pdfBlob => {
    //     saveAs(pdfBlob, envelope.name + '-' + moment(envelope.updated_at).format('MM-DD-YY') + '.pdf');
    //   });
    // }
    // downloadEnvelopeCertificate(envelope) {
    //   this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(pdfBlob => {
    //     if (pdfBlob) {
    //       saveAs(pdfBlob, `${envelope.name}_certificate.pdf`);
    //     }
    //   });
    // }
    DocumentsService.prototype.getTemplateDoc = /**
     * *****************************
     * Move logic to public library *
     * *****************************
     * @param {?} templateId
     * @param {?} token
     * @param {?} file
     * @return {?}
     */
    // downloadEnvelope(envelope) {
    //   this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(pdfBlob => {
    //     saveAs(pdfBlob, envelope.name + '-' + moment(envelope.updated_at).format('MM-DD-YY') + '.pdf');
    //   });
    // }
    // downloadEnvelopeCertificate(envelope) {
    //   this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(pdfBlob => {
    //     if (pdfBlob) {
    //       saveAs(pdfBlob, `${envelope.name}_certificate.pdf`);
    //     }
    //   });
    // }
    function (templateId, token, file) {
        /** @type {?} */
        var requestUrl = this._rForm_backend_url + ("/liveview/" + templateId + "/token/" + token);
        return this.httpClient.get(requestUrl, { responseType: 'json' })
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res;
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.error(err);
            return err;
        })));
    };
    /**
     * @param {?} templateId
     * @param {?} token
     * @return {?}
     */
    DocumentsService.prototype.getTemplatePDF = /**
     * @param {?} templateId
     * @param {?} token
     * @return {?}
     */
    function (templateId, token) {
        /** @type {?} */
        var requestUrl = this._rForm_backend_url + ("/liveview/" + templateId + "/token/" + token + "?file=true");
        return this.httpClient.request(new HttpRequest('GET', requestUrl, {}, { reportProgress: true, responseType: 'blob' })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            return event;
        })));
    };
    /**
     * @param {?} id
     * @return {?}
     */
    DocumentsService.prototype.cancelEnvelope = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return this.httpClient.put(this._documentUrl + ("/" + id), { action: 'cancel' }, { responseType: 'json' })
            .pipe(map((/**
         * @param {?} envelopeData
         * @return {?}
         */
        function (envelopeData) { return envelopeData; }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) { return err; })));
    };
    /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    DocumentsService.prototype.submitEnvelope = /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    function (envId, roleName) {
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envId + "/recipients/" + roleName), { action: 'submit' }).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res;
        })));
    };
    /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    DocumentsService.prototype.declineEnvelope = /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    function (envId, roleName) {
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envId + "/recipients/" + roleName), { action: 'decline' }).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res;
        })));
    };
    /**
     * @param {?} envelopeId
     * @param {?} file
     * @param {?} fieldName
     * @return {?}
     */
    DocumentsService.prototype.uploadAttachment = /**
     * @param {?} envelopeId
     * @param {?} file
     * @param {?} fieldName
     * @return {?}
     */
    function (envelopeId, file, fieldName) {
        /** @type {?} */
        var req;
        if (file) {
            /** @type {?} */
            var formdata = new FormData();
            formdata.append('document', file, file.name);
            req = new HttpRequest('PUT', this._rForm_backend_url + '/envelopes/' + envelopeId +
                '/fields/' + fieldName, formdata, {
                reportProgress: true
            });
            return this.httpClient.request(req).pipe(map((/**
             * @param {?} res
             * @return {?}
             */
            function (res) { return res; })));
        }
    };
    /**
     * @param {?} field
     * @return {?}
     */
    DocumentsService.prototype.downloadAttachment = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        /** @type {?} */
        var header = new HttpHeaders().set('content-type', field.settings.type);
        return this.httpClient.get(this._rForm_backend_url + '/envelopes/' + field.envelope_id +
            '/fields/' + field.name + '/document', { headers: header, responseType: 'blob' })
            .pipe(map((/**
         * @param {?} file
         * @return {?}
         */
        function (file) {
            return file;
        })));
    };
    /**
     * @param {?} envelope
     * @return {?}
     */
    DocumentsService.prototype.getAttachmentDataByRecipients = /**
     * @param {?} envelope
     * @return {?}
     */
    function (envelope) {
        var e_1, _a, e_2, _b;
        /** @type {?} */
        var recipients = envelope['recipients'];
        if (recipients && recipients.length > 0) {
            /** @type {?} */
            var attachments = [];
            try {
                for (var recipients_1 = tslib_1.__values(recipients), recipients_1_1 = recipients_1.next(); !recipients_1_1.done; recipients_1_1 = recipients_1.next()) {
                    var recipient = recipients_1_1.value;
                    if (recipient.fields && recipient.fields.length > 0) {
                        try {
                            for (var _c = (e_2 = void 0, tslib_1.__values(recipient.fields)), _d = _c.next(); !_d.done; _d = _c.next()) {
                                var field = _d.value;
                                if (field.type === 'attachment' && !!field.settings.url) {
                                    attachments.push({
                                        recipient: recipient.full_name,
                                        fieldObject: field
                                    });
                                }
                            }
                        }
                        catch (e_2_1) { e_2 = { error: e_2_1 }; }
                        finally {
                            try {
                                if (_d && !_d.done && (_b = _c.return)) _b.call(_c);
                            }
                            finally { if (e_2) throw e_2.error; }
                        }
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (recipients_1_1 && !recipients_1_1.done && (_a = recipients_1.return)) _a.call(recipients_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return attachments;
        }
        return [];
    };
    /*****************
     * Signature API *
     ****************/
    /**
     * **************
     * Signature API *
     * **************
     * @param {?} signatureBlob
     * @return {?}
     */
    DocumentsService.prototype.postSignatureBlob = /**
     * **************
     * Signature API *
     * **************
     * @param {?} signatureBlob
     * @return {?}
     */
    function (signatureBlob) {
        /** @type {?} */
        var blobFile = signatureBlob;
        /** @type {?} */
        var formData = new FormData();
        formData.append('signature', blobFile, blobFile['name']);
        /** @type {?} */
        var request = new HttpRequest('POST', this._rForm_backend_url + '/signatures', formData);
        return this.httpClient.request(request)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response && response['body']) {
                return response['body'];
            }
            else {
                console.error('Failed to upload signature image');
            }
        }));
    };
    /**
     * @param {?} initialBlob
     * @return {?}
     */
    DocumentsService.prototype.postInitialBlob = /**
     * @param {?} initialBlob
     * @return {?}
     */
    function (initialBlob) {
        /** @type {?} */
        var blobFile = initialBlob;
        /** @type {?} */
        var formData = new FormData();
        formData.append('initial', blobFile, blobFile['name']);
        /** @type {?} */
        var request = new HttpRequest('POST', this._rForm_backend_url + '/initials', formData);
        return this.httpClient.request(request)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response && response['body']) {
                return response['body'];
            }
            else {
                console.error('Failed to upload Initial');
            }
        }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} signatureId
     * @return {?}
     */
    DocumentsService.prototype.putSignatureField = /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} signatureId
     * @return {?}
     */
    function (envelopeId, fieldName, signatureId) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var ipAddress;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getPublicIp()];
                    case 1:
                        ipAddress = _a.sent();
                        this.httpClient
                            .put(this._documentUrl + ("/" + envelopeId + "/fields/" + fieldName + "/signature/" + signatureId), {
                            ip_address: ipAddress
                        }).toPromise().then((/**
                         * @param {?} res
                         * @return {?}
                         */
                        function (res) {
                            return resolve(res);
                        }));
                        return [2 /*return*/];
                }
            });
        }); }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} initialId
     * @return {?}
     */
    DocumentsService.prototype.putInitialField = /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} initialId
     * @return {?}
     */
    function (envelopeId, fieldName, initialId) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var ipAddress;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getPublicIp()];
                    case 1:
                        ipAddress = _a.sent();
                        this.httpClient
                            .put(this._documentUrl + ("/" + envelopeId + "/fields/" + fieldName + "/initial/" + initialId), {
                            ip_address: ipAddress
                        }).toPromise().then((/**
                         * @param {?} res
                         * @return {?}
                         */
                        function (res) {
                            return resolve(res);
                        }));
                        return [2 /*return*/];
                }
            });
        }); }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} result
     * @return {?}
     */
    DocumentsService.prototype.putEnvelopeField = /**
     * @param {?} envelopeId
     * @param {?} result
     * @return {?}
     */
    function (envelopeId, result) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.httpClient
                .put(_this._documentUrl + ("/" + envelopeId + "/fields/" + _this.workingField.fName), result).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                return resolve(res);
            }));
        }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} body
     * @param {?} fieldName
     * @param {?=} ifPrepared
     * @return {?}
     */
    DocumentsService.prototype.updateGroupedField = /**
     * @param {?} envelopeId
     * @param {?} body
     * @param {?} fieldName
     * @param {?=} ifPrepared
     * @return {?}
     */
    function (envelopeId, body, fieldName, ifPrepared) {
        var _this = this;
        if (typeof (ifPrepared) === 'boolean') {
            body['prepared'] = ifPrepared;
        }
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.httpClient
                .put(_this._documentUrl + ("/" + envelopeId + "/fields/" + fieldName), body).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                return resolve(res);
            }));
        }));
    };
    /**
     * @private
     * @return {?}
     */
    DocumentsService.prototype.getPublicIp = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var apiUrl = 'https://api.ipify.org?format=jsonp';
        /** @type {?} */
        var callback = 'callback=JSONP_CALLBACK';
        return this.httpClient
            .jsonp(apiUrl, callback)
            .toPromise()
            .then((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res['ip'];
        })).catch((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.error('Failed to get ip', err);
            return 'ip_unavailable';
        }));
    };
    /********************************
     * Move logic to public library *
     *******************************/
    // async zipEnvelopeDocs(envelope) {
    //   const zip = new jszip();
    //   const envelopeZipName = envelope.name + ' - ' + moment(envelope.updated_at).format('MM-DD-YY');
    //   await this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(envelopeBlob => {
    //     zip.file(envelope.name + '.pdf', envelopeBlob, { compression: 'DEFLATE' });
    //   });
    //   if (this.hasCertificate(envelope)) {
    //     await this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(envelopeCertificateBlob => {
    //       zip.file(envelope.name + '_certificate.pdf', envelopeCertificateBlob, { compression: 'DEFLATE' });
    //     });
    //   }
    //   const attachment = zip.folder('attachments');
    //   const fields = envelope.fields;
    //   let numOfAttachments = 0;
    //   for (let x = 0; x < fields.length; x++) {
    //     if (fields[x] && fields[x].type === 'attachment' && fields[x].settings['name']) {
    //       await this.downloadAttachment(fields[x]).toPromise().then(fileBlob => {
    //         attachment.file(fields[x].settings.name, fileBlob, { compression: 'DEFLATE' });
    //         numOfAttachments++;
    //       });
    //     }
    //   }
    //   if (numOfAttachments === 0) {
    //     zip.remove('attachments');
    //   }
    //   zip.generateAsync({ type: 'blob', compression: 'DEFLATE' }).then(content => {
    //     saveAs(content, envelopeZipName + '.zip');
    //   })
    // }
    /**
     * *****************************
     * Move logic to public library *
     * *****************************
     * @param {?} envelope
     * @return {?}
     */
    // async zipEnvelopeDocs(envelope) {
    //   const zip = new jszip();
    //   const envelopeZipName = envelope.name + ' - ' + moment(envelope.updated_at).format('MM-DD-YY');
    //   await this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(envelopeBlob => {
    //     zip.file(envelope.name + '.pdf', envelopeBlob, { compression: 'DEFLATE' });
    //   });
    //   if (this.hasCertificate(envelope)) {
    //     await this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(envelopeCertificateBlob => {
    //       zip.file(envelope.name + '_certificate.pdf', envelopeCertificateBlob, { compression: 'DEFLATE' });
    //     });
    //   }
    //   const attachment = zip.folder('attachments');
    //   const fields = envelope.fields;
    //   let numOfAttachments = 0;
    //   for (let x = 0; x < fields.length; x++) {
    //     if (fields[x] && fields[x].type === 'attachment' && fields[x].settings['name']) {
    //       await this.downloadAttachment(fields[x]).toPromise().then(fileBlob => {
    //         attachment.file(fields[x].settings.name, fileBlob, { compression: 'DEFLATE' });
    //         numOfAttachments++;
    //       });
    //     }
    //   }
    //   if (numOfAttachments === 0) {
    //     zip.remove('attachments');
    //   }
    //   zip.generateAsync({ type: 'blob', compression: 'DEFLATE' }).then(content => {
    //     saveAs(content, envelopeZipName + '.zip');
    //   })
    // }
    DocumentsService.prototype.sortRecipients = /**
     * *****************************
     * Move logic to public library *
     * *****************************
     * @param {?} envelope
     * @return {?}
     */
    // async zipEnvelopeDocs(envelope) {
    //   const zip = new jszip();
    //   const envelopeZipName = envelope.name + ' - ' + moment(envelope.updated_at).format('MM-DD-YY');
    //   await this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(envelopeBlob => {
    //     zip.file(envelope.name + '.pdf', envelopeBlob, { compression: 'DEFLATE' });
    //   });
    //   if (this.hasCertificate(envelope)) {
    //     await this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(envelopeCertificateBlob => {
    //       zip.file(envelope.name + '_certificate.pdf', envelopeCertificateBlob, { compression: 'DEFLATE' });
    //     });
    //   }
    //   const attachment = zip.folder('attachments');
    //   const fields = envelope.fields;
    //   let numOfAttachments = 0;
    //   for (let x = 0; x < fields.length; x++) {
    //     if (fields[x] && fields[x].type === 'attachment' && fields[x].settings['name']) {
    //       await this.downloadAttachment(fields[x]).toPromise().then(fileBlob => {
    //         attachment.file(fields[x].settings.name, fileBlob, { compression: 'DEFLATE' });
    //         numOfAttachments++;
    //       });
    //     }
    //   }
    //   if (numOfAttachments === 0) {
    //     zip.remove('attachments');
    //   }
    //   zip.generateAsync({ type: 'blob', compression: 'DEFLATE' }).then(content => {
    //     saveAs(content, envelopeZipName + '.zip');
    //   })
    // }
    function (envelope) {
        if (envelope.recipients.length < 1) {
            return [];
        }
        /** @type {?} */
        var recipients = envelope.recipients.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            if (a.sequence === b.sequence) {
                return a.role_name < b.role_name ? -1 : a.role_name > b.role_name ? 1 : 0;
            }
            return b.sequence > a.sequence ? -1 : b.sequence < a.sequence ? 1 : 0;
        }));
        /** @type {?} */
        var signers = recipients.filter((/**
         * @param {?} recipient
         * @return {?}
         */
        function (recipient) {
            return recipient.type === 'signer';
        }));
        for (var x = 0; x < signers.length; x++) {
            /** @type {?} */
            var rIndex = findIndex(recipients, { sequence: signers[x].sequence, role_name: signers[x].role_name });
            if (rIndex >= 0) {
                recipients[rIndex]['rgba'] = getRGBA(x);
            }
        }
        return recipients;
    };
    /**
     * @param {?} name
     * @param {?=} index
     * @return {?}
     */
    DocumentsService.prototype.getRecipientColor = /**
     * @param {?} name
     * @param {?=} index
     * @return {?}
     */
    function (name, index) {
        if (index) {
            return getRGBA(index);
        }
        else if (this.envelope && this.envelope.recipients && this.envelope.recipients.length > 0) {
            /** @type {?} */
            var index_1 = findIndex(this.envelope.recipients, { role_name: name });
            if (index_1 >= 0 && this.envelope.recipients[index_1].rgba) {
                return this.envelope.recipients[index_1].rgba;
            }
        }
        else {
            return nameToRGBA(name);
        }
    };
    // Check the logic
    // Check the logic
    /**
     * @return {?}
     */
    DocumentsService.prototype.validateEnvelopeField = 
    // Check the logic
    /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var validators;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(this.workingField.vName != null && this.workingField.value !== '')) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.validatorService.getValidatorsObject()];
                    case 1:
                        validators = _a.sent();
                        return [2 /*return*/, validators[this.workingField.vName].test(this.workingField.value) && this.satisfyRequired()];
                    case 2: return [2 /*return*/, this.satisfyRequired()];
                }
            });
        });
    };
    /**
     * @private
     * @return {?}
     */
    DocumentsService.prototype.satisfyRequired = /**
     * @private
     * @return {?}
     */
    function () {
        if (!!this.workingField.required && this.workingField.type !== 'checkbox' && this.workingField.type !== 'timestamp') {
            return !!this.workingField.value;
        }
        return true;
    };
    /**
     * @param {?} fields
     * @return {?}
     */
    DocumentsService.prototype.sortFields = /**
     * @param {?} fields
     * @return {?}
     */
    function (fields) {
        var _this = this;
        fields = fields.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            return a.page - b.page;
        }));
        /** @type {?} */
        var previousDistance = null;
        fields = fields.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        function (a, b) {
            /** @type {?} */
            var setting = 'settings';
            /** @type {?} */
            var distance = _this.canBeSameRow(a, b).distance;
            /** @type {?} */
            var higherHeight = _this.canBeSameRow(a, b).higherHeight;
            if (!a[setting]) {
                setting = 'setting';
            }
            if (a.page < b.page) {
                return -1;
            }
            if (a.page > b.page) {
                return 1;
            }
            /** @type {?} */
            var ax = a[setting].x;
            /** @type {?} */
            var bx = b[setting].x;
            /** @type {?} */
            var ay = a[setting].y;
            /** @type {?} */
            var by = b[setting].y;
            if (distance >= -3 && distance <= higherHeight) {
                previousDistance = previousDistance === null ? distance : distance < previousDistance ? distance : previousDistance;
                if (ax < bx) {
                    return -1;
                }
                else if (ax > bx) {
                    return 1;
                }
                else if (previousDistance >= distance) {
                    return -1;
                }
                else if (previousDistance <= distance) {
                    return 1;
                }
                return 0;
            }
            return b[setting].y - a[setting].y;
        }));
        return fields;
    };
    /**
     * @param {?} envelope
     * @return {?}
     */
    DocumentsService.prototype.checkIfEnvelopeOwner = /**
     * @param {?} envelope
     * @return {?}
     */
    function (envelope) {
        /** @type {?} */
        var signer_token = this.vTokenStateService.getOtherCookie('signer_token');
        /** @type {?} */
        var profile = this.tokenObjectService.getProfile();
        if (signer_token && !profile) {
            return false;
        }
        else if (envelope) {
            /** @type {?} */
            var currentUserId = profile['id'];
            return currentUserId === envelope['profile_id'];
        }
    };
    /**
     * @private
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    DocumentsService.prototype.canBeSameRow = /**
     * @private
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    function (a, b) {
        /** @type {?} */
        var setting = 'setting';
        if (!a[setting]) {
            setting = 'settings';
        }
        /** @type {?} */
        var aHeight = this.getHeight(a);
        /** @type {?} */
        var bHeight = this.getHeight(b);
        /** @type {?} */
        var aBottom = a[setting].y;
        /** @type {?} */
        var bBottom = b[setting].y;
        /** @type {?} */
        var top;
        /** @type {?} */
        var higherBottom;
        /** @type {?} */
        var higherHeight;
        if (aBottom < bBottom) {
            top = aHeight + aBottom;
            higherBottom = bBottom;
            higherHeight = bHeight;
        }
        else {
            top = bHeight + bBottom;
            higherBottom = aBottom;
            higherHeight = aHeight;
        }
        /** @type {?} */
        var distance = top - higherBottom;
        return { distance: distance, higherHeight: higherHeight };
    };
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    DocumentsService.prototype.getHeight = /**
     * @private
     * @param {?} field
     * @return {?}
     */
    function (field) {
        /** @type {?} */
        var setting = 'setting';
        if (!field[setting]) {
            setting = 'settings';
        }
        /** @type {?} */
        var height = 0;
        switch (field.type) {
            case 'signature':
            case 'initial':
                height = 36;
                break;
            case 'checkbox':
                height = 13.5;
                break;
            case 'attachment':
            case 'payment':
                height = 24;
                break;
            default:
                height = field[setting]['height'] || 0;
                break;
        }
        return height;
    };
    /**
     * @param {?} envelope
     * @return {?}
     */
    DocumentsService.prototype.hasCertificate = /**
     * @param {?} envelope
     * @return {?}
     */
    function (envelope) {
        return envelope.certificate_document_id || ['complete', 'canceled', 'declined'].indexOf(this.envelope.status) !== -1;
    };
    DocumentsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DocumentsService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: ValidatorService },
        { type: VerdocsTokenObjectService },
        { type: VerdocsStateService },
        { type: Injector },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    return DocumentsService;
}());
export { DocumentsService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._config_token;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._currentFields;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._currEnvelope;
    /** @type {?} */
    DocumentsService.prototype.allEnvelopes;
    /** @type {?} */
    DocumentsService.prototype._currentExtendedEnvelope;
    /** @type {?} */
    DocumentsService.prototype._customFilterSubject;
    /** @type {?} */
    DocumentsService.prototype.currEnvelope$;
    /** @type {?} */
    DocumentsService.prototype.fieldsStream;
    /** @type {?} */
    DocumentsService.prototype.inProgressSubject;
    /** @type {?} */
    DocumentsService.prototype.envelopeData;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.currEnvelope;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.currRoleName;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._rForm_backend_url;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._documentUrl;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.workingField;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.envelope;
    /** @type {?} */
    DocumentsService.prototype.validators;
    /** @type {?} */
    DocumentsService.prototype.toggleNextSubject;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.validatorService;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.tokenObjectService;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.vTokenStateService;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9kb2N1bWVudHMvZG9jdW1lbnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUcsTUFBTSxlQUFlLENBQUM7QUFDM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBYSxNQUFNLHNCQUFzQixDQUFDO0FBQ3JHLE9BQU8sRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzFELE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNuQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7O0FBS2pGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLHVCQUF1QixDQUFDO0FBS3BFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUl2RDtJQXVCRSwwQkFDVSxVQUFzQixFQUN0QixnQkFBa0MsRUFDbEMsa0JBQTZDLEVBQzdDLGtCQUF1QyxFQUN2QyxRQUFrQixFQUNHLFFBQVE7UUFMN0IsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBMkI7UUFDN0MsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFxQjtRQUN2QyxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ0csYUFBUSxHQUFSLFFBQVEsQ0FBQTtRQTFCL0IsbUJBQWMsR0FBRyxJQUFJLGVBQWUsQ0FBUSxFQUFFLENBQUMsQ0FBQztRQUNoRCxrQkFBYSxHQUFHLElBQUksZUFBZSxDQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELGlCQUFZLEdBQUcsSUFBSSxlQUFlLENBQWMsRUFBRSxDQUFDLENBQUM7UUFDcEQsNkJBQXdCLEdBQUcsSUFBSSxlQUFlLENBQU0sRUFBRSxDQUFDLENBQUM7UUFDeEQseUJBQW9CLEdBQUcsSUFBSSxlQUFlLENBQU0sRUFBRSxDQUFDLENBQUM7UUFFcEQsa0JBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ2xELGlCQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNsRCxzQkFBaUIsR0FBRyxJQUFJLGVBQWUsQ0FBVSxLQUFLLENBQUMsQ0FBQztRQU92RCxpQkFBWSxHQUFtQixJQUFJLFNBQVMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzNELGFBQVEsR0FBYyxJQUFJLENBQUM7UUFDNUIsZUFBVSxHQUFRLEVBQUUsQ0FBQztRQUNyQixzQkFBaUIsR0FBRyxJQUFJLGVBQWUsQ0FBVSxLQUFLLENBQUMsQ0FBQztRQVU3RCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDO1FBQy9ELElBQUksQ0FBQyxZQUFZLEdBQU0sSUFBSSxDQUFDLGtCQUFrQixlQUFZLENBQUE7SUFDNUQsQ0FBQzs7Ozs7SUFFTSw2Q0FBa0I7Ozs7SUFBekIsVUFBMEIsRUFBRTtRQUMxQixJQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM5QixDQUFDOzs7Ozs7SUFFTSxxQ0FBVTs7Ozs7SUFBakIsVUFBa0IsS0FBSyxFQUFFLE1BQU07UUFDN0IsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUM7SUFDN0IsQ0FBQzs7Ozs7SUFFTSwwQ0FBZTs7OztJQUF0QixVQUF1QixTQUFTO1FBQzlCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxzQkFBSSx1Q0FBUzs7OztRQUFiO1lBQ0UsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksb0NBQU07Ozs7UUFBVjtZQUNFLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQztRQUMzQixDQUFDOzs7T0FBQTs7Ozs7SUFFRCxxQ0FBVTs7OztJQUFWLFVBQVcsSUFBSTtRQUNiLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUM7YUFDakQsSUFBSSxDQUNILEdBQUc7Ozs7UUFDRCxVQUFDLFFBQW1CLElBQUssT0FBQSxRQUFRLEVBQVIsQ0FBUTs7OztRQUNqQyxVQUFBLEdBQUc7WUFDRCxPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUMsRUFBQyxDQUNMLENBQUM7SUFDTixDQUFDOzs7Ozs7SUFFRCx1Q0FBWTs7Ozs7SUFBWixVQUFhLFVBQVUsRUFBRSxJQUFJO1FBQzNCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBRyxNQUFJLFVBQVUsb0JBQWUsSUFBSSxDQUFDLFlBQVksY0FBVyxDQUFBLEVBQUUsSUFBSSxDQUFDO2FBQzdHLElBQUksQ0FDSCxHQUFHOzs7O1FBQUMsVUFBQyxRQUFtQixJQUFLLE9BQUEsUUFBUSxFQUFSLENBQVE7Ozs7UUFBRSxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsRUFBSCxDQUFHLEVBQUMsQ0FDbkQsQ0FBQztJQUNOLENBQUM7Ozs7OztJQUVELDJDQUFnQjs7Ozs7SUFBaEIsVUFBaUIsVUFBa0IsRUFBRSxRQUFnQjtRQUNuRCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUcsTUFBSSxVQUFVLG9CQUFlLFFBQVEsdUJBQW9CLENBQUEsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNuSCxDQUFDOzs7OztJQUVELHNDQUFXOzs7O0lBQVgsVUFBWSxFQUFXO1FBQXZCLGlCQWFDOztZQVpPLFVBQVUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVk7UUFDOUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBRyxNQUFJLFVBQVksQ0FBQSxDQUFDO2FBQzdELElBQUksQ0FDSCxHQUFHOzs7O1FBQUMsVUFBQyxnQkFBZ0I7WUFDbkIsS0FBSSxDQUFDLFFBQVEsR0FBRyxtQkFBVyxnQkFBZ0IsRUFBQSxDQUFDO1lBQzVDLEtBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxHQUFHLEtBQUksQ0FBQyxjQUFjLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzlELEtBQUksQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2xELEtBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQztZQUNsQyxPQUFPLEtBQUksQ0FBQyxRQUFRLENBQUM7UUFDdkIsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNOLENBQUM7Ozs7O0lBRUQsMENBQWU7Ozs7SUFBZixVQUFnQixVQUFtQjtRQUFuQyxpQkFtQkM7O1lBbEJPLFFBQVEsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUcsa0JBQWdCLFVBQVksQ0FBQSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWTtRQUNsRyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksV0FBVyxDQUM1QyxLQUFLLEVBQ0wsUUFBUSxFQUNSLEVBQUUsRUFDRjtZQUNFLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLFlBQVksRUFBRSxNQUFNO1NBQ3JCLENBQ0YsQ0FBQyxDQUFDLElBQUksQ0FDTCxHQUFHOzs7O1FBQUMsVUFBQSxLQUFLO1lBQ1AsSUFBSSxLQUFLLFlBQVksWUFBWSxFQUFFO2dCQUNqQyxLQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDakMsT0FBTyxtQkFBQSxLQUFLLEVBQXFCLENBQUE7YUFDbEM7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUMsRUFBQyxDQUNILENBQUM7SUFDSixDQUFDOzs7OztJQUVELDBDQUFlOzs7O0lBQWYsVUFBZ0IsWUFBbUM7UUFBbkQsaUJBeUJDO1FBeEJDLEtBQUssSUFBTSxHQUFHLElBQUksWUFBWSxFQUFFO1lBQzlCLElBQUksWUFBWSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDcEMsSUFBSSxZQUFZLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxFQUFFO29CQUM5QixPQUFPLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDMUI7YUFDRjtTQUNGO1FBQ0QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFdBQVcsQ0FDNUMsTUFBTSxFQUNOLElBQUksQ0FBQyxZQUFZLEdBQUcsU0FBUyxFQUM3QixZQUFZLEVBQ1o7WUFDRSxjQUFjLEVBQUUsSUFBSTtZQUNwQixZQUFZLEVBQUUsTUFBTTtTQUNyQixDQUNGLENBQUMsQ0FBQyxJQUFJLENBQ0wsR0FBRzs7OztRQUFDLFVBQUEsS0FBSztZQUNQLElBQUksS0FBSyxZQUFZLFlBQVksRUFBRTtnQkFDakMsS0FBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2pDLE9BQU8sbUJBQUEsS0FBSyxFQUF1QyxDQUFDO2FBQ3JEO1lBQ0QsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFRCw4Q0FBbUI7Ozs7SUFBbkIsVUFBb0IsSUFBYTs7WUFDekIsVUFBVSxHQUFHO1lBQ2pCLE9BQU8sRUFBRSxtQkFBQSxZQUFZLEVBQXVCO1lBQzVDLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLEdBQUcsRUFBRSxDQUFDO1lBQ04sSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RCO1FBQ0QsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7Ozs7OztJQUVELDRDQUFpQjs7Ozs7SUFBakIsVUFBa0IsT0FBOEIsRUFBRSxZQUFZO1FBQzVELElBQUksT0FBTyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBRTtZQUNsRSxZQUFZLENBQUMsaUJBQWlCLENBQUMsR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtTQUM3RDtRQUNELElBQUksT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO2dCQUNwRSxZQUFZLENBQUMsWUFBWSxDQUFDLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFBO2FBQ25EO2lCQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBRTtnQkFDM0MsWUFBWSxDQUFDLFlBQVksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQTtnQkFDbEQsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsRUFBRTtvQkFDNUIsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLG1CQUFBLFlBQVksRUFBdUIsQ0FBQztpQkFDL0Q7YUFDRjtTQUNGO1FBQ0QsSUFBSSxPQUFPLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtZQUM3QixZQUFZLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtTQUMzRDtRQUNELElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQzVCLFlBQVksQ0FBQyxlQUFlLENBQUMsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUE7U0FDekQ7UUFDRCxJQUFJLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO1lBQzlCLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1NBQzdEO1FBQ0QsSUFBSSxPQUFPLENBQUMsa0JBQWtCLENBQUMsRUFBRTtZQUMvQixZQUFZLENBQUMsa0JBQWtCLENBQUMsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtTQUMvRDtRQUNELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7Ozs7Ozs7Ozs7O0lBRUQseUNBQWM7Ozs7Ozs7Ozs7SUFBZCxVQUFlLElBQVksRUFBRSxTQUFtQixFQUFFLEdBQVksRUFBRSxJQUFhLEVBQUUsVUFBd0IsRUFBRSxNQUE0QixFQUFFLGFBQXFDOztZQUN0SyxZQUFZLEdBQUc7WUFDakIsU0FBUyxFQUFFLFNBQVMsSUFBSSxLQUFLO1lBQzdCLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBRTtZQUNkLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQztTQUNoQjtRQUVELFFBQVEsSUFBSSxFQUFFO1lBQ1osS0FBSyxpQkFBaUI7Z0JBQ3BCLFlBQVksQ0FBQyxjQUFjLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQ3BDLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztnQkFDbkUsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7Z0JBQzdELFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxtQkFBQSxNQUFNLEVBQXVCLENBQUM7Z0JBQ3hELElBQUksVUFBVSxFQUFFO29CQUNkLFlBQVksQ0FBQyxZQUFZLENBQUMsR0FBRyxVQUFVLENBQUM7b0JBQ3hDLElBQUksQ0FBQyxNQUFNLEVBQUU7d0JBQ1gsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLG1CQUFBLFlBQVksRUFBdUIsQ0FBQztxQkFDL0Q7aUJBQ0Y7Z0JBQ0QsTUFBTTtZQUNSLEtBQUssbUJBQW1CO2dCQUN0QixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBQzFGLEtBQUssOEJBQThCO2dCQUNqQyxZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUNoQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQztnQkFDN0QsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLG1CQUFBLE1BQU0sRUFBdUIsSUFBSSxJQUFJLENBQUM7Z0JBQ2hFLElBQUksVUFBVSxFQUFFO29CQUNkLFlBQVksQ0FBQyxZQUFZLENBQUMsR0FBRyxVQUFVLENBQUM7b0JBQ3hDLElBQUksQ0FBQyxNQUFNLEVBQUU7d0JBQ1gsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLG1CQUFBLFlBQVksRUFBdUIsQ0FBQztxQkFDL0Q7aUJBQ0Y7Z0JBQ0QsTUFBTTtZQUNSLEtBQUssT0FBTztnQkFDVixZQUFZLENBQUMsY0FBYyxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUNwQyxZQUFZLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDLENBQUM7Z0JBQ3hHLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxtQkFBQSxNQUFNLEVBQXVCLElBQUksSUFBSSxDQUFDO2dCQUNoRSxJQUFJLFVBQVUsRUFBRTtvQkFDZCxZQUFZLENBQUMsWUFBWSxDQUFDLEdBQUcsVUFBVSxDQUFDO29CQUN4QyxJQUFJLENBQUMsTUFBTSxFQUFFO3dCQUNYLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxtQkFBQSxZQUFZLEVBQXVCLENBQUM7cUJBQy9EO2lCQUNGO2dCQUNELE1BQU07WUFDUixLQUFLLFdBQVc7Z0JBQ2QsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDL0MsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLG1CQUFBLE1BQU0sRUFBdUIsSUFBSSxJQUFJLENBQUM7Z0JBQ2hFLElBQUksVUFBVSxFQUFFO29CQUNkLFlBQVksQ0FBQyxZQUFZLENBQUMsR0FBRyxVQUFVLENBQUM7b0JBQ3hDLElBQUksQ0FBQyxNQUFNLEVBQUU7d0JBQ1gsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLG1CQUFBLFlBQVksRUFBdUIsQ0FBQztxQkFDL0Q7aUJBQ0Y7Z0JBQ0QsTUFBTTtZQUNSLEtBQUssTUFBTTtnQkFDVCxZQUFZLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUNoQyxZQUFZLENBQUMsU0FBUyxDQUFDLEdBQUcsbUJBQUEsTUFBTSxFQUF1QixJQUFJLElBQUksQ0FBQztnQkFDaEUsSUFBSSxVQUFVLEVBQUU7b0JBQ2QsWUFBWSxDQUFDLFlBQVksQ0FBQyxHQUFHLFVBQVUsQ0FBQztvQkFDeEMsSUFBSSxDQUFDLE1BQU0sRUFBRTt3QkFDWCxZQUFZLENBQUMsU0FBUyxDQUFDLEdBQUcsbUJBQUEsWUFBWSxFQUF1QixDQUFDO3FCQUMvRDtpQkFDRjtnQkFDRCxNQUFNO1lBQ1IsS0FBSyxLQUFLO2dCQUNSLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxtQkFBQSxNQUFNLEVBQXVCLElBQUksSUFBSSxDQUFDO2dCQUNoRSxJQUFJLFVBQVUsRUFBRTtvQkFDZCxZQUFZLENBQUMsWUFBWSxDQUFDLEdBQUcsVUFBVSxDQUFDO29CQUN4QyxJQUFJLENBQUMsTUFBTSxFQUFFO3dCQUNYLFlBQVksQ0FBQyxTQUFTLENBQUMsR0FBRyxtQkFBQSxZQUFZLEVBQXVCLENBQUM7cUJBQy9EO2lCQUNGO2dCQUNELE1BQU07WUFDUjtnQkFDRSxNQUFNO1NBQ1Q7UUFFRCxJQUFJLENBQUMsQ0FBQyxhQUFhLEVBQUU7WUFDbkIsWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLHVCQUFPLFlBQVksRUFBRyxDQUFDO1NBQzNFO1FBQ0QsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVDLENBQUM7Ozs7Ozs7Ozs7SUFFTSw2Q0FBa0I7Ozs7Ozs7OztJQUF6QixVQUEwQixTQUFtQixFQUFFLEdBQVksRUFBRSxJQUFhLEVBQUUsVUFBd0IsRUFBRSxNQUE0QixFQUFFLGFBQXFDO1FBQXpLLGlCQXNCQzs7WUFyQkssdUJBQXVCLEdBQUcsSUFBSTtRQUNsQyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxhQUFhLENBQUM7YUFDbkcsSUFBSSxDQUNILFNBQVM7Ozs7UUFBQyxVQUFDLEdBQUc7WUFDWixJQUFJLEdBQUcsWUFBWSxZQUFZLEVBQUU7Z0JBQy9CLHVCQUF1QixHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdDLE9BQU8sS0FBSSxDQUFDLGNBQWMsQ0FBQyw4QkFBOEIsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxDQUFBO2FBQ3BIO2lCQUFNO2dCQUNMLE9BQU8sS0FBSyxFQUFFLENBQUM7YUFDaEI7UUFDSCxDQUFDLEVBQUMsRUFDRixHQUFHOzs7O1FBQUMsVUFBQyxRQUFRO1lBQ1gsSUFBSSxRQUFRLFlBQVksWUFBWSxJQUFJLHVCQUF1QixFQUFFOztvQkFDekQseUJBQXlCLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQzs7b0JBQ3RELHVCQUF1QixHQUFHLFlBQVksQ0FBQyx5QkFBeUIsRUFBRSx1QkFBdUIsRUFBRSxJQUFJLENBQUM7Z0JBQ3RHLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsdUJBQXVCLENBQUM7Z0JBQ2xELFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsdUJBQXVCLENBQUMsTUFBTSxDQUFDO2FBQ3pEO1lBQ0QsT0FBTyxRQUFRLENBQUM7UUFDbEIsQ0FBQyxFQUFDLENBQ0gsQ0FBQTtJQUNMLENBQUM7Ozs7O0lBRUQsK0NBQW9COzs7O0lBQXBCLFVBQXFCLEtBQWE7UUFDaEMsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFHLE1BQUksS0FBSyxxQkFBa0IsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUM5RSxHQUFHOzs7O1FBQUMsVUFBQSxHQUFHO1lBQ0wsT0FBTyxHQUFHLENBQUM7UUFDYixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7O0lBRUQsNENBQWlCOzs7OztJQUFqQixVQUFrQixLQUFhLEVBQUUsS0FBYTtRQUE5QyxpQkFlQztRQWRDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBRyxNQUFJLEtBQUssNEJBQXVCLEtBQUssZUFBWSxDQUFBLEVBQzlGLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxDQUFDO2FBQ3hCLElBQUksQ0FDSCxHQUFHOzs7O1FBQUMsVUFBQSxHQUFHO1lBQ0wsSUFBSSxpQkFBaUIsQ0FBQyxLQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7O29CQUM5QixVQUFVLEdBQUcsTUFBTSxDQUFDLEdBQUc7O29CQUN2QixNQUFNLEdBQUcsVUFBVSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUM7Z0JBQzlDLE9BQU8sTUFBTSxDQUFDO2FBQ2Y7UUFDSCxDQUFDOzs7O1FBQUUsVUFBQSxHQUFHO1lBQ0osK0JBQStCO1lBQy9CLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckIsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNOLENBQUM7Ozs7OztJQUVELHFEQUEwQjs7Ozs7SUFBMUIsVUFBMkIsVUFBa0IsRUFBRSxVQUFrQjs7WUFDekQsVUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLElBQUcsTUFBSSxVQUFVLDRCQUF1QixVQUFVLGVBQVksQ0FBQTtRQUNsRyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLElBQUksV0FBVyxDQUM1QyxLQUFLLEVBQ0wsVUFBVSxFQUNWLEVBQUUsRUFDRixFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxDQUMvQyxDQUFDLENBQUMsSUFBSSxDQUNMLEdBQUc7Ozs7UUFBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssRUFBTCxDQUFLLEVBQUMsQ0FDcEIsQ0FBQztJQUNKLENBQUM7Ozs7OztJQUVELDZDQUFrQjs7Ozs7SUFBbEIsVUFBbUIsS0FBYSxFQUFFLEtBQWE7UUFDN0MsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFHLE1BQUksS0FBSyw0QkFBdUIsS0FBSyxlQUFZLENBQUEsRUFDOUYsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLENBQUM7YUFDeEIsSUFBSSxDQUFDLEdBQUc7Ozs7UUFBQyxVQUFBLElBQUk7WUFDWixPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDUixDQUFDOzs7OztJQUVELHFEQUEwQjs7OztJQUExQixVQUEyQixLQUFhO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBRyxNQUFJLEtBQUssMkJBQXdCLENBQUEsRUFDOUUsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLENBQUM7YUFDeEIsSUFBSSxDQUNILEdBQUc7Ozs7UUFBQyxVQUFBLElBQUk7WUFDTixPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsRUFBQyxDQUNILENBQUM7SUFDTixDQUFDO0lBRUQ7O3FDQUVpQztJQUVqQywrQkFBK0I7SUFDL0Isc0dBQXNHO0lBQ3RHLHNHQUFzRztJQUN0RyxRQUFRO0lBQ1IsSUFBSTtJQUVKLDBDQUEwQztJQUMxQywrRUFBK0U7SUFDL0UscUJBQXFCO0lBQ3JCLDZEQUE2RDtJQUM3RCxRQUFRO0lBQ1IsUUFBUTtJQUNSLElBQUk7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFFSix5Q0FBYzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBQWQsVUFBZSxVQUFrQixFQUFFLEtBQWEsRUFBRSxJQUFhOztZQUN2RCxVQUFVLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixJQUFHLGVBQWEsVUFBVSxlQUFVLEtBQU8sQ0FBQTtRQUNyRixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsQ0FBQzthQUM3RCxJQUFJLENBQ0gsR0FBRzs7OztRQUFDLFVBQUMsR0FBUTtZQUNYLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQzs7OztRQUFFLFVBQUEsR0FBRztZQUNKLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkIsT0FBTyxHQUFHLENBQUM7UUFDYixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ04sQ0FBQzs7Ozs7O0lBRUQseUNBQWM7Ozs7O0lBQWQsVUFBZSxVQUFrQixFQUFFLEtBQWE7O1lBQ3hDLFVBQVUsR0FBRyxJQUFJLENBQUMsa0JBQWtCLElBQUcsZUFBYSxVQUFVLGVBQVUsS0FBSyxlQUFZLENBQUE7UUFDL0YsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFdBQVcsQ0FDNUMsS0FBSyxFQUNMLFVBQVUsRUFDVixFQUFFLEVBQ0YsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsQ0FDL0MsQ0FBQyxDQUFDLElBQUksQ0FDTCxHQUFHOzs7O1FBQUMsVUFBQSxLQUFLO1lBQ1AsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFRCx5Q0FBYzs7OztJQUFkLFVBQWUsRUFBVTtRQUN2QixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUcsTUFBSSxFQUFJLENBQUEsRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsQ0FBQzthQUNyRyxJQUFJLENBQ0gsR0FBRzs7OztRQUFDLFVBQUEsWUFBWSxJQUFJLE9BQUEsWUFBWSxFQUFaLENBQVk7Ozs7UUFBRSxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsRUFBSCxDQUFHLEVBQUMsQ0FDOUMsQ0FBQztJQUNOLENBQUM7Ozs7OztJQUVELHlDQUFjOzs7OztJQUFkLFVBQWUsS0FBYSxFQUFFLFFBQWdCO1FBQzVDLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQ3hCLElBQUksQ0FBQyxrQkFBa0IsSUFBRyxnQkFBYyxLQUFLLG9CQUFlLFFBQVUsQ0FBQSxFQUN0RSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FDckIsQ0FBQyxJQUFJLENBQ0osR0FBRzs7OztRQUFDLFVBQUMsR0FBZTtZQUNsQixPQUFPLEdBQUcsQ0FBQTtRQUNaLENBQUMsRUFBQyxDQUNILENBQUM7SUFDSixDQUFDOzs7Ozs7SUFFRCwwQ0FBZTs7Ozs7SUFBZixVQUFnQixLQUFhLEVBQUUsUUFBZ0I7UUFDN0MsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FDeEIsSUFBSSxDQUFDLGtCQUFrQixJQUFHLGdCQUFjLEtBQUssb0JBQWUsUUFBVSxDQUFBLEVBQ3RFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUN0QixDQUFDLElBQUksQ0FDSixHQUFHOzs7O1FBQUMsVUFBQyxHQUFlO1lBQ2xCLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7Ozs7Ozs7SUFHRCwyQ0FBZ0I7Ozs7OztJQUFoQixVQUFpQixVQUFVLEVBQUUsSUFBVSxFQUFFLFNBQVM7O1lBQzVDLEdBQUc7UUFDUCxJQUFJLElBQUksRUFBRTs7Z0JBQ0YsUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFO1lBQy9CLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0MsR0FBRyxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsYUFBYSxHQUFHLFVBQVU7Z0JBQy9FLFVBQVUsR0FBRyxTQUFTLEVBQUUsUUFBUSxFQUFFO2dCQUNsQyxjQUFjLEVBQUUsSUFBSTthQUNyQixDQUFDLENBQUE7WUFDRixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FDdEMsR0FBRzs7OztZQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsR0FBRyxFQUFILENBQUcsRUFBQyxDQUNoQixDQUFDO1NBQ0g7SUFDSCxDQUFDOzs7OztJQUVELDZDQUFrQjs7OztJQUFsQixVQUFtQixLQUFLOztZQUNoQixNQUFNLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ3pFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGFBQWEsR0FBRyxLQUFLLENBQUMsV0FBVztZQUNwRixVQUFVLEdBQUcsS0FBSyxDQUFDLElBQUksR0FBRyxXQUFXLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsQ0FBQzthQUNoRixJQUFJLENBQ0gsR0FBRzs7OztRQUFDLFVBQUEsSUFBSTtZQUNOLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNOLENBQUM7Ozs7O0lBRUQsd0RBQTZCOzs7O0lBQTdCLFVBQThCLFFBQVE7OztZQUM5QixVQUFVLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQztRQUN6QyxJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTs7Z0JBQ2pDLFdBQVcsR0FBRyxFQUFFOztnQkFDdEIsS0FBd0IsSUFBQSxlQUFBLGlCQUFBLFVBQVUsQ0FBQSxzQ0FBQSw4REFBRTtvQkFBL0IsSUFBTSxTQUFTLHVCQUFBO29CQUNsQixJQUFJLFNBQVMsQ0FBQyxNQUFNLElBQUksU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOzs0QkFDbkQsS0FBb0IsSUFBQSxvQkFBQSxpQkFBQSxTQUFTLENBQUMsTUFBTSxDQUFBLENBQUEsZ0JBQUEsNEJBQUU7Z0NBQWpDLElBQU0sS0FBSyxXQUFBO2dDQUNkLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxZQUFZLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFO29DQUN2RCxXQUFXLENBQUMsSUFBSSxDQUFDO3dDQUNmLFNBQVMsRUFBRSxTQUFTLENBQUMsU0FBUzt3Q0FDOUIsV0FBVyxFQUFFLEtBQUs7cUNBQ25CLENBQUMsQ0FBQztpQ0FDSjs2QkFDRjs7Ozs7Ozs7O3FCQUNGO2lCQUNGOzs7Ozs7Ozs7WUFDRCxPQUFPLFdBQVcsQ0FBQztTQUNwQjtRQUNELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVEOztzQkFFa0I7Ozs7Ozs7O0lBRWxCLDRDQUFpQjs7Ozs7OztJQUFqQixVQUFrQixhQUFtQjs7WUFDN0IsUUFBUSxHQUFHLGFBQWE7O1lBQ3hCLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRTtRQUMvQixRQUFRLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7O1lBQ25ELE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLGFBQWEsRUFBRSxRQUFRLENBQUM7UUFDMUYsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7YUFDcEMsU0FBUyxFQUFFO2FBQ1gsSUFBSTs7OztRQUFDLFVBQUEsUUFBUTtZQUNaLElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDaEMsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDekI7aUJBQU07Z0JBQ0wsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO2FBQ25EO1FBQ0gsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7OztJQUVELDBDQUFlOzs7O0lBQWYsVUFBZ0IsV0FBVzs7WUFDbkIsUUFBUSxHQUFHLFdBQVc7O1lBQ3RCLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRTtRQUMvQixRQUFRLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7O1lBQ2pELE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLFdBQVcsRUFBRSxRQUFRLENBQUM7UUFDeEYsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7YUFDcEMsU0FBUyxFQUFFO2FBQ1gsSUFBSTs7OztRQUFDLFVBQUEsUUFBUTtZQUNaLElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDaEMsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDekI7aUJBQU07Z0JBQ0wsT0FBTyxDQUFDLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO2FBQzNDO1FBQ0gsQ0FBQyxFQUFDLENBQUM7SUFDUCxDQUFDOzs7Ozs7O0lBRUQsNENBQWlCOzs7Ozs7SUFBakIsVUFBa0IsVUFBVSxFQUFFLFNBQVMsRUFBRSxXQUFXO1FBQXBELGlCQVlDO1FBWEMsT0FBTyxJQUFJLE9BQU87Ozs7O1FBQU0sVUFBTyxPQUFPLEVBQUUsTUFBTTs7Ozs0QkFDMUIscUJBQU0sSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFBOzt3QkFBcEMsU0FBUyxHQUFHLFNBQXdCO3dCQUMxQyxJQUFJLENBQUMsVUFBVTs2QkFDWixHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBRyxNQUFJLFVBQVUsZ0JBQVcsU0FBUyxtQkFBYyxXQUFhLENBQUEsRUFDcEY7NEJBQ0UsVUFBVSxFQUFFLFNBQVM7eUJBQ3RCLENBQ0YsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJOzs7O3dCQUFDLFVBQUEsR0FBRzs0QkFDcEIsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQ3RCLENBQUMsRUFBQyxDQUFBOzs7O2FBQ0wsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7OztJQUVELDBDQUFlOzs7Ozs7SUFBZixVQUFnQixVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVM7UUFBaEQsaUJBWUM7UUFYQyxPQUFPLElBQUksT0FBTzs7Ozs7UUFBTSxVQUFPLE9BQU8sRUFBRSxNQUFNOzs7OzRCQUMxQixxQkFBTSxJQUFJLENBQUMsV0FBVyxFQUFFLEVBQUE7O3dCQUFwQyxTQUFTLEdBQUcsU0FBd0I7d0JBQzFDLElBQUksQ0FBQyxVQUFVOzZCQUNaLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFHLE1BQUksVUFBVSxnQkFBVyxTQUFTLGlCQUFZLFNBQVcsQ0FBQSxFQUNoRjs0QkFDRSxVQUFVLEVBQUUsU0FBUzt5QkFDdEIsQ0FDRixDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUk7Ozs7d0JBQUMsVUFBQSxHQUFHOzRCQUNwQixPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQzt3QkFDdEIsQ0FBQyxFQUFDLENBQUE7Ozs7YUFDTCxFQUFDLENBQUM7SUFDTCxDQUFDOzs7Ozs7SUFFRCwyQ0FBZ0I7Ozs7O0lBQWhCLFVBQWlCLFVBQVUsRUFBRSxNQUFNO1FBQW5DLGlCQVNDO1FBUkMsT0FBTyxJQUFJLE9BQU87Ozs7O1FBQU0sVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUN0QyxLQUFJLENBQUMsVUFBVTtpQkFDWixHQUFHLENBQUMsS0FBSSxDQUFDLFlBQVksSUFBRyxNQUFJLFVBQVUsZ0JBQVcsS0FBSSxDQUFDLFlBQVksQ0FBQyxLQUFPLENBQUEsRUFDekUsTUFBTSxDQUNQLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSTs7OztZQUFDLFVBQUEsR0FBRztnQkFDcEIsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxFQUFDLENBQUE7UUFDTixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7Ozs7O0lBRUQsNkNBQWtCOzs7Ozs7O0lBQWxCLFVBQW1CLFVBQVUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLFVBQW9CO1FBQXBFLGlCQVlDO1FBWEMsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssU0FBUyxFQUFFO1lBQ3JDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxVQUFVLENBQUM7U0FDL0I7UUFDRCxPQUFPLElBQUksT0FBTzs7Ozs7UUFBTSxVQUFDLE9BQU8sRUFBRSxNQUFNO1lBQ3RDLEtBQUksQ0FBQyxVQUFVO2lCQUNaLEdBQUcsQ0FBQyxLQUFJLENBQUMsWUFBWSxJQUFHLE1BQUksVUFBVSxnQkFBVyxTQUFXLENBQUEsRUFDM0QsSUFBSSxDQUNMLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSTs7OztZQUFDLFVBQUEsR0FBRztnQkFDcEIsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxFQUFDLENBQUE7UUFDTixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7O0lBRU8sc0NBQVc7Ozs7SUFBbkI7O1lBQ1EsTUFBTSxHQUFHLG9DQUFvQzs7WUFDN0MsUUFBUSxHQUFHLHlCQUF5QjtRQUMxQyxPQUFPLElBQUksQ0FBQyxVQUFVO2FBQ25CLEtBQUssQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDO2FBQ3ZCLFNBQVMsRUFBRTthQUNYLElBQUk7Ozs7UUFBQyxVQUFDLEdBQUc7WUFDUixPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNsQixDQUFDLEVBQUMsQ0FBQyxLQUFLOzs7O1FBQUMsVUFBQyxHQUFHO1lBQ1gsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLENBQUMsQ0FBQTtZQUN0QyxPQUFPLGdCQUFnQixDQUFBO1FBQ3pCLENBQUMsRUFBQyxDQUFDO0lBQ1AsQ0FBQztJQUVEOztxQ0FFaUM7SUFFakMsb0NBQW9DO0lBQ3BDLDZCQUE2QjtJQUM3QixvR0FBb0c7SUFFcEcsaUhBQWlIO0lBQ2pILGtGQUFrRjtJQUNsRixRQUFRO0lBRVIseUNBQXlDO0lBQ3pDLHVHQUF1RztJQUN2RywyR0FBMkc7SUFDM0csVUFBVTtJQUNWLE1BQU07SUFFTixrREFBa0Q7SUFDbEQsb0NBQW9DO0lBQ3BDLDhCQUE4QjtJQUM5Qiw4Q0FBOEM7SUFDOUMsd0ZBQXdGO0lBQ3hGLGdGQUFnRjtJQUNoRiwwRkFBMEY7SUFDMUYsOEJBQThCO0lBQzlCLFlBQVk7SUFDWixRQUFRO0lBQ1IsTUFBTTtJQUNOLGtDQUFrQztJQUNsQyxpQ0FBaUM7SUFDakMsTUFBTTtJQUNOLGtGQUFrRjtJQUNsRixpREFBaUQ7SUFDakQsT0FBTztJQUNQLElBQUk7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFFSix5Q0FBYzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBQWQsVUFBZSxRQUFtQjtRQUNoQyxJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsQyxPQUFPLEVBQUUsQ0FBQztTQUNYOztZQUVLLFVBQVUsR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUk7Ozs7O1FBQUMsVUFBQyxDQUFhLEVBQUUsQ0FBYTtZQUN2RSxJQUFJLENBQUMsQ0FBQyxRQUFRLEtBQUssQ0FBQyxDQUFDLFFBQVEsRUFBRTtnQkFDN0IsT0FBTyxDQUFDLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzNFO1lBQ0QsT0FBTyxDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLENBQUMsRUFBQzs7WUFFSSxPQUFPLEdBQUcsVUFBVSxDQUFDLE1BQU07Ozs7UUFBQyxVQUFBLFNBQVM7WUFDekMsT0FBTyxTQUFTLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQztRQUNyQyxDQUFDLEVBQUM7UUFFRixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7Z0JBQ2pDLE1BQU0sR0FBRyxTQUFTLENBQUMsVUFBVSxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN4RyxJQUFJLE1BQU0sSUFBSSxDQUFDLEVBQUU7Z0JBQ2YsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN6QztTQUNGO1FBRUQsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQzs7Ozs7O0lBRUQsNENBQWlCOzs7OztJQUFqQixVQUFrQixJQUFJLEVBQUUsS0FBTTtRQUM1QixJQUFJLEtBQUssRUFBRTtZQUNULE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3ZCO2FBQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7O2dCQUN2RixPQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDO1lBQ3BFLElBQUksT0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxPQUFLLENBQUMsQ0FBQyxJQUFJLEVBQUU7Z0JBQ3RELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO2FBQzdDO1NBQ0Y7YUFBTTtZQUNMLE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQztJQUVELGtCQUFrQjs7Ozs7SUFDWixnREFBcUI7Ozs7O0lBQTNCOzs7Ozs7NkJBQ00sQ0FBQSxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEtBQUssRUFBRSxDQUFBLEVBQWpFLHdCQUFpRTt3QkFDaEQscUJBQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixFQUFFLEVBQUE7O3dCQUE5RCxVQUFVLEdBQUcsU0FBaUQ7d0JBQ3BFLHNCQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUUsRUFBQzs0QkFFbkcsc0JBQU8sSUFBSSxDQUFDLGVBQWUsRUFBRSxFQUFDOzs7O0tBRWpDOzs7OztJQUVPLDBDQUFlOzs7O0lBQXZCO1FBQ0UsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEtBQUssVUFBVSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxLQUFLLFdBQVcsRUFBRTtZQUNuSCxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQztTQUNsQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7SUFFRCxxQ0FBVTs7OztJQUFWLFVBQVcsTUFBTTtRQUFqQixpQkFrQ0M7UUFqQ0MsTUFBTSxHQUFHLE1BQU0sQ0FBQyxJQUFJOzs7OztRQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUM7WUFDeEIsT0FBTyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDekIsQ0FBQyxFQUFDLENBQUM7O1lBQ0MsZ0JBQWdCLEdBQUcsSUFBSTtRQUMzQixNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUk7Ozs7O1FBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQzs7Z0JBQ3BCLE9BQU8sR0FBRyxVQUFVOztnQkFDcEIsUUFBUSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVE7O2dCQUMzQyxZQUFZLEdBQUcsS0FBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWTtZQUN2RCxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNmLE9BQU8sR0FBRyxTQUFTLENBQUM7YUFDckI7WUFDRCxJQUFJLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRTtnQkFDbkIsT0FBTyxDQUFDLENBQUMsQ0FBQzthQUNYO1lBQ0QsSUFBSSxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUU7Z0JBQ25CLE9BQU8sQ0FBQyxDQUFDO2FBQ1Y7O2dCQUNLLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQzs7Z0JBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDOztnQkFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7O2dCQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNoRixJQUFJLFFBQVEsSUFBSSxDQUFDLENBQUMsSUFBSSxRQUFRLElBQUksWUFBWSxFQUFFO2dCQUM5QyxnQkFBZ0IsR0FBRyxnQkFBZ0IsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDO2dCQUNwSCxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUU7b0JBQ1gsT0FBTyxDQUFDLENBQUMsQ0FBQztpQkFDWDtxQkFBTSxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUU7b0JBQ2xCLE9BQU8sQ0FBQyxDQUFBO2lCQUNUO3FCQUFNLElBQUksZ0JBQWdCLElBQUksUUFBUSxFQUFFO29CQUN2QyxPQUFPLENBQUMsQ0FBQyxDQUFDO2lCQUNYO3FCQUFNLElBQUksZ0JBQWdCLElBQUksUUFBUSxFQUFFO29CQUN2QyxPQUFPLENBQUMsQ0FBQTtpQkFDVDtnQkFBQyxPQUFPLENBQUMsQ0FBQzthQUNaO1lBQ0QsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDcEMsQ0FBQyxFQUFDLENBQUE7UUFDRixPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDOzs7OztJQUVELCtDQUFvQjs7OztJQUFwQixVQUFxQixRQUFROztZQUNyQixZQUFZLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUM7O1lBQ3JFLE9BQU8sR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsVUFBVSxFQUFFO1FBQ3BELElBQUksWUFBWSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQzVCLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7YUFBTSxJQUFJLFFBQVEsRUFBRTs7Z0JBQ2IsYUFBYSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDbkMsT0FBTyxhQUFhLEtBQUssUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ2pEO0lBQ0gsQ0FBQzs7Ozs7OztJQUVPLHVDQUFZOzs7Ozs7SUFBcEIsVUFBcUIsQ0FBQyxFQUFFLENBQUM7O1lBQ25CLE9BQU8sR0FBRyxTQUFTO1FBQ3ZCLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDZixPQUFPLEdBQUcsVUFBVSxDQUFDO1NBQ3RCOztZQUNLLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQzs7WUFDM0IsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDOztZQUMzQixPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7O1lBQ3RCLE9BQU8sR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQzs7WUFDeEIsR0FBRzs7WUFDSCxZQUFZOztZQUNaLFlBQVk7UUFDaEIsSUFBSSxPQUFPLEdBQUcsT0FBTyxFQUFFO1lBQ3JCLEdBQUcsR0FBRyxPQUFPLEdBQUcsT0FBTyxDQUFDO1lBQ3hCLFlBQVksR0FBRyxPQUFPLENBQUM7WUFDdkIsWUFBWSxHQUFHLE9BQU8sQ0FBQztTQUN4QjthQUFNO1lBQ0wsR0FBRyxHQUFHLE9BQU8sR0FBRyxPQUFPLENBQUM7WUFDeEIsWUFBWSxHQUFHLE9BQU8sQ0FBQztZQUN2QixZQUFZLEdBQUcsT0FBTyxDQUFDO1NBQ3hCOztZQUNLLFFBQVEsR0FBRyxHQUFHLEdBQUcsWUFBWTtRQUNuQyxPQUFPLEVBQUUsUUFBUSxVQUFBLEVBQUUsWUFBWSxjQUFBLEVBQUUsQ0FBQztJQUNwQyxDQUFDOzs7Ozs7SUFFTyxvQ0FBUzs7Ozs7SUFBakIsVUFBa0IsS0FBSzs7WUFDakIsT0FBTyxHQUFHLFNBQVM7UUFDdkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNuQixPQUFPLEdBQUcsVUFBVSxDQUFDO1NBQ3RCOztZQUNHLE1BQU0sR0FBRyxDQUFDO1FBQ2QsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1lBQ2xCLEtBQUssV0FBVyxDQUFDO1lBQ2pCLEtBQUssU0FBUztnQkFDWixNQUFNLEdBQUcsRUFBRSxDQUFDO2dCQUNaLE1BQU07WUFDUixLQUFLLFVBQVU7Z0JBQ2IsTUFBTSxHQUFHLElBQUksQ0FBQztnQkFDZCxNQUFNO1lBQ1IsS0FBSyxZQUFZLENBQUM7WUFDbEIsS0FBSyxTQUFTO2dCQUNaLE1BQU0sR0FBRyxFQUFFLENBQUM7Z0JBQ1osTUFBTTtZQUNSO2dCQUNFLE1BQU0sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN2QyxNQUFNO1NBQ1Q7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDOzs7OztJQUVNLHlDQUFjOzs7O0lBQXJCLFVBQXNCLFFBQVE7UUFDNUIsT0FBTyxRQUFRLENBQUMsdUJBQXVCLElBQUksQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3ZILENBQUM7O2dCQXp2QkYsVUFBVTs7OztnQkFyQkYsVUFBVTtnQkFVVixnQkFBZ0I7Z0JBTGhCLHlCQUF5QjtnQkFBRSxtQkFBbUI7Z0JBUGxDLFFBQVE7Z0RBb0R4QixNQUFNLFNBQUMsV0FBVzs7SUE2dEJ2Qix1QkFBQztDQUFBLEFBMXZCRCxJQTB2QkM7U0F6dkJZLGdCQUFnQjs7Ozs7O0lBQzNCLHlDQUFrQzs7Ozs7SUFDbEMsMENBQXdEOzs7OztJQUN4RCx5Q0FBd0Q7O0lBQ3hELHdDQUEyRDs7SUFDM0Qsb0RBQStEOztJQUMvRCxnREFBMkQ7O0lBRTNELHlDQUF5RDs7SUFDekQsd0NBQXlEOztJQUN6RCw2Q0FBK0Q7O0lBQy9ELHdDQUErQjs7Ozs7SUFFL0Isd0NBQTZCOzs7OztJQUM3Qix3Q0FBNkI7Ozs7O0lBQzdCLDhDQUFtQzs7Ozs7SUFDbkMsd0NBQTZCOzs7OztJQUM3Qix3Q0FBbUU7Ozs7O0lBQ25FLG9DQUFtQzs7SUFDbkMsc0NBQTRCOztJQUM1Qiw2Q0FBK0Q7Ozs7O0lBRzdELHNDQUE4Qjs7Ozs7SUFDOUIsNENBQTBDOzs7OztJQUMxQyw4Q0FBcUQ7Ozs7O0lBQ3JELDhDQUErQzs7Ozs7SUFDL0Msb0NBQTBCOzs7OztJQUMxQixvQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgSW5qZWN0LCBQTEFURk9STV9JRCAgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBSZXNwb25zZSwgSHR0cFJlcXVlc3QsIEh0dHBIZWFkZXJzLCBIdHRwRXZlbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGVtcHR5LCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjb25jYXRNYXAsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGZpbmRJbmRleCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBkaWZmZXJlbmNlQnkgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgVmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZSwgVmVyZG9jc1N0YXRlU2VydmljZSB9IGZyb20gJ0B2ZXJkb2NzL3Rva2Vucyc7XG4vLyBpbXBvcnQgeyBzYXZlQXMgfSBmcm9tICdmaWxlLXNhdmVyJztcbi8vIGltcG9ydCAqIGFzIGpzemlwIGZyb20gJ2pzemlwJztcbi8vIGltcG9ydCAqIGFzIG1vbWVudCBmcm9tICdtb21lbnQnO1xuXG5pbXBvcnQgeyBWYWxpZGF0b3JTZXJ2aWNlIH0gZnJvbSAnLi4vdmFsaWRhdG9ycy92YWxpZGF0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBnZXRSR0JBLCBuYW1lVG9SR0JBIH0gZnJvbSAnLi4vZnVuY3Rpb25zL3JnYic7XG5pbXBvcnQgeyBWU0RLQ29uZmlnVG9rZW4sIFZTREtDb25maWcgfSBmcm9tICcuLi9hbmd1bGFyLWFwaS5tb2R1bGUnO1xuXG4vLyBNb2RlbHNcbmltcG9ydCB7IElFbnZlbG9wZVNlYXJjaFBhcmFtcywgRG9jdW1lbnRTb3J0T3B0aW9ucywgSUVudmVsb3BlU2VhcmNoUmVzdWx0IH0gZnJvbSAnLi4vbW9kZWxzL2RvY3VtZW50X3NlYXJjaC5tb2RlbCc7XG5pbXBvcnQgeyBJVGltZVBlcmlvZCB9IGZyb20gJy4uL21vZGVscy90aW1lX3BlcmlvZC5tb2RlbCc7XG5pbXBvcnQgeyBGaWVsZERhdGEgfSBmcm9tICcuLi9tb2RlbHMvZmllbGQtZGF0YS5tb2RlbCc7XG5pbXBvcnQgeyBJRG9jdW1lbnQgfSBmcm9tICcuLi9tb2RlbHMvZG9jdW1lbnQubW9kZWwnO1xuaW1wb3J0IHsgSVJlY2lwaWVudCB9IGZyb20gJy4uL21vZGVscy9yZWNpcGllbnQubW9kZWwnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRG9jdW1lbnRzU2VydmljZSB7XG4gIHByaXZhdGUgX2NvbmZpZ190b2tlbjogVlNES0NvbmZpZztcbiAgcHJpdmF0ZSBfY3VycmVudEZpZWxkcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55W10+KFtdKTtcbiAgcHJpdmF0ZSBfY3VyckVudmVsb3BlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KCcnKTtcbiAgcHVibGljIGFsbEVudmVsb3BlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8SURvY3VtZW50W10+KFtdKTtcbiAgcHVibGljIF9jdXJyZW50RXh0ZW5kZWRFbnZlbG9wZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG4gIHB1YmxpYyBfY3VzdG9tRmlsdGVyU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG5cbiAgcHVibGljIGN1cnJFbnZlbG9wZSQgPSB0aGlzLl9jdXJyRW52ZWxvcGUuYXNPYnNlcnZhYmxlKCk7XG4gIHB1YmxpYyBmaWVsZHNTdHJlYW0gPSB0aGlzLl9jdXJyZW50RmllbGRzLmFzT2JzZXJ2YWJsZSgpO1xuICBwdWJsaWMgaW5Qcm9ncmVzc1N1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcbiAgcHVibGljIGVudmVsb3BlRGF0YTogSURvY3VtZW50O1xuXG4gIHByaXZhdGUgY3VyckVudmVsb3BlOiBzdHJpbmc7XG4gIHByaXZhdGUgY3VyclJvbGVOYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgX3JGb3JtX2JhY2tlbmRfdXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgX2RvY3VtZW50VXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgd29ya2luZ0ZpZWxkOiBGaWVsZERhdGE8YW55PiA9IG5ldyBGaWVsZERhdGEoeyBvcmRlcjogMCB9KTtcbiAgcHJpdmF0ZSBlbnZlbG9wZTogSURvY3VtZW50ID0gbnVsbDtcbiAgcHVibGljIHZhbGlkYXRvcnM6IGFueSA9IHt9O1xuICBwdWJsaWMgdG9nZ2xlTmV4dFN1YmplY3QgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3JTZXJ2aWNlOiBWYWxpZGF0b3JTZXJ2aWNlLFxuICAgIHByaXZhdGUgdG9rZW5PYmplY3RTZXJ2aWNlOiBWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLFxuICAgIHByaXZhdGUgdlRva2VuU3RhdGVTZXJ2aWNlOiBWZXJkb2NzU3RhdGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1cbiAgKSB7XG4gICAgdGhpcy5fY29uZmlnX3Rva2VuID0gdGhpcy5pbmplY3Rvci5nZXQoVlNES0NvbmZpZ1Rva2VuKTtcbiAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCA9IHRoaXMuX2NvbmZpZ190b2tlbi5yRm9ybV9iYWNrZW5kX3VybDtcbiAgICB0aGlzLl9kb2N1bWVudFVybCA9IGAke3RoaXMuX3JGb3JtX2JhY2tlbmRfdXJsfS9lbnZlbG9wZXNgXG4gIH1cblxuICBwdWJsaWMgc2V0Q3VycmVudEVudmVsb3BlKGlkKSB7XG4gICAgdGhpcy5jdXJyRW52ZWxvcGUgPSBpZDtcbiAgICB0aGlzLl9jdXJyRW52ZWxvcGUubmV4dChpZCk7XG4gIH1cblxuICBwdWJsaWMgc2V0RW52RGF0YShlbnZJZCwgcm9sZUlkKSB7XG4gICAgdGhpcy5jdXJyRW52ZWxvcGUgPSBlbnZJZDtcbiAgICB0aGlzLmN1cnJSb2xlTmFtZSA9IHJvbGVJZDtcbiAgfVxuXG4gIHB1YmxpYyB1cGRhdGVFbnZlbG9wZXMoZW52ZWxvcGVzKSB7XG4gICAgdGhpcy5hbGxFbnZlbG9wZXMubmV4dChlbnZlbG9wZXMpO1xuICB9XG5cbiAgZ2V0IHJvbGVfbmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyUm9sZU5hbWU7XG4gIH1cblxuICBnZXQgZW52X2lkKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJFbnZlbG9wZTtcbiAgfVxuXG4gIHNlbmRJbnZpdGUoYm9keSk6IE9ic2VydmFibGU8SURvY3VtZW50IHwgbmV2ZXI+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodGhpcy5fZG9jdW1lbnRVcmwsIGJvZHkpXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKFxuICAgICAgICAgIChlbnZlbG9wZTogSURvY3VtZW50KSA9PiBlbnZlbG9wZSxcbiAgICAgICAgICBlcnIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIHNlbmREZWxlZ2F0ZShlbnZlbG9wZUlkLCByb2xlKTogT2JzZXJ2YWJsZTxJRG9jdW1lbnQgfCBuZXZlcj4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh0aGlzLl9kb2N1bWVudFVybCArIGAvJHtlbnZlbG9wZUlkfS9yZWNpcGllbnRzLyR7dGhpcy5jdXJyUm9sZU5hbWV9L2RlbGVnYXRlYCwgcm9sZSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGVudmVsb3BlOiBJRG9jdW1lbnQpID0+IGVudmVsb3BlLCBlcnIgPT4gZXJyKVxuICAgICAgKTtcbiAgfVxuXG4gIHJlc2VuZEludml0YXRpb24oZW52ZWxvcGVJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L3JlY2lwaWVudHMvJHtyb2xlTmFtZX0vcmVzZW5kX2ludml0YXRpb25gLCBudWxsKTtcbiAgfVxuXG4gIGdldEVudmVsb3BlKGlkPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxJRG9jdW1lbnQ+IHtcbiAgICBjb25zdCBlbnZlbG9wZUlkID0gaWQgPyBpZCA6IHRoaXMuY3VyckVudmVsb3BlO1xuICAgIHRoaXMuc2V0Q3VycmVudEVudmVsb3BlKGVudmVsb3BlSWQpO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9YClcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKGVudmVsb3BlRXh0ZW5kZWQpID0+IHtcbiAgICAgICAgICB0aGlzLmVudmVsb3BlID0gPElEb2N1bWVudD5lbnZlbG9wZUV4dGVuZGVkO1xuICAgICAgICAgIHRoaXMuZW52ZWxvcGUucmVjaXBpZW50cyA9IHRoaXMuc29ydFJlY2lwaWVudHModGhpcy5lbnZlbG9wZSk7XG4gICAgICAgICAgdGhpcy5fY3VycmVudEV4dGVuZGVkRW52ZWxvcGUubmV4dCh0aGlzLmVudmVsb3BlKTtcbiAgICAgICAgICB0aGlzLmVudmVsb3BlRGF0YSA9IHRoaXMuZW52ZWxvcGU7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZW52ZWxvcGU7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgZ2V0QWxsRW52ZWxvcGVzKHRlbXBsYXRlSWQ/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBlbmRwb2ludCA9IHRlbXBsYXRlSWQgPyB0aGlzLl9kb2N1bWVudFVybCArIGA/dGVtcGxhdGVfaWQ9JHt0ZW1wbGF0ZUlkfWAgOiB0aGlzLl9kb2N1bWVudFVybDtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QobmV3IEh0dHBSZXF1ZXN0KFxuICAgICAgJ0dFVCcsXG4gICAgICBlbmRwb2ludCxcbiAgICAgIHt9LFxuICAgICAge1xuICAgICAgICByZXBvcnRQcm9ncmVzczogdHJ1ZSxcbiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbidcbiAgICAgIH1cbiAgICApKS5waXBlKFxuICAgICAgbWFwKGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKGV2ZW50IGluc3RhbmNlb2YgSHR0cFJlc3BvbnNlKSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVFbnZlbG9wZXMoZXZlbnQuYm9keSk7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50IGFzIEh0dHBSZXNwb25zZTxhbnk+XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV2ZW50O1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgc2VhcmNoRW52ZWxvcGVzKHNlYXJjaFBhcmFtczogSUVudmVsb3BlU2VhcmNoUGFyYW1zKTogT2JzZXJ2YWJsZTxIdHRwRXZlbnQ8YW55PiB8IElFbnZlbG9wZVNlYXJjaFJlc3VsdD4ge1xuICAgIGZvciAoY29uc3Qga2V5IGluIHNlYXJjaFBhcmFtcykge1xuICAgICAgaWYgKHNlYXJjaFBhcmFtcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIGlmIChzZWFyY2hQYXJhbXNba2V5XSA9PT0gbnVsbCkge1xuICAgICAgICAgIGRlbGV0ZSBzZWFyY2hQYXJhbXNba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QobmV3IEh0dHBSZXF1ZXN0KFxuICAgICAgJ1BPU1QnLFxuICAgICAgdGhpcy5fZG9jdW1lbnRVcmwgKyAnL3NlYXJjaCcsXG4gICAgICBzZWFyY2hQYXJhbXMsXG4gICAgICB7XG4gICAgICAgIHJlcG9ydFByb2dyZXNzOiB0cnVlLFxuICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJ1xuICAgICAgfVxuICAgICkpLnBpcGUoXG4gICAgICBtYXAoZXZlbnQgPT4ge1xuICAgICAgICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2UpIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUVudmVsb3BlcyhldmVudC5ib2R5KTtcbiAgICAgICAgICByZXR1cm4gZXZlbnQgYXMgSHR0cFJlc3BvbnNlPElFbnZlbG9wZVNlYXJjaFJlc3VsdD47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV2ZW50O1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgZ2V0UmVjZW50QWN0aXZpdGllcyhwYWdlPzogbnVtYmVyKSB7XG4gICAgY29uc3Qgc2VhcmNoQm9keSA9IHtcbiAgICAgIHNvcnRfYnk6ICd1cGRhdGVkX2F0JyBhcyBEb2N1bWVudFNvcnRPcHRpb25zLFxuICAgICAgYXNjZW5kaW5nOiBmYWxzZSxcbiAgICAgIHJvdzogNSxcbiAgICAgIHBhZ2U6IHBhZ2UgPyBwYWdlIDogMVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zZWFyY2hFbnZlbG9wZXMoc2VhcmNoQm9keSlcbiAgfVxuXG4gIGFwcGx5Q3VzdG9tU2VhcmNoKGZpbHRlcnM6IElFbnZlbG9wZVNlYXJjaFBhcmFtcywgc2VhcmNoUGFyYW1zKSB7XG4gICAgaWYgKGZpbHRlcnNbJ2VudmVsb3BlX3N0YXR1cyddICYmICFzZWFyY2hQYXJhbXNbJ2VudmVsb3BlX3N0YXR1cyddKSB7XG4gICAgICBzZWFyY2hQYXJhbXNbJ2VudmVsb3BlX3N0YXR1cyddID0gZmlsdGVyc1snZW52ZWxvcGVfc3RhdHVzJ11cbiAgICB9XG4gICAgaWYgKGZpbHRlcnNbJ3VwZGF0ZWRfYXQnXSkge1xuICAgICAgaWYgKCFzZWFyY2hQYXJhbXNbJ3VwZGF0ZWRfYXQnXSAmJiAhIXNlYXJjaFBhcmFtc1snZW52ZWxvcGVfc3RhdHVzJ10pIHtcbiAgICAgICAgc2VhcmNoUGFyYW1zWyd1cGRhdGVkX2F0J10gPSBmaWx0ZXJzWyd1cGRhdGVkX2F0J11cbiAgICAgIH0gZWxzZSBpZiAoIXNlYXJjaFBhcmFtc1snZW52ZWxvcGVfc3RhdHVzJ10pIHtcbiAgICAgICAgc2VhcmNoUGFyYW1zWydjcmVhdGVkX2F0J10gPSBmaWx0ZXJzWyd1cGRhdGVkX2F0J11cbiAgICAgICAgaWYgKCFzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gJ2NyZWF0ZWRfYXQnIGFzIERvY3VtZW50U29ydE9wdGlvbnM7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGZpbHRlcnNbJ3JlY2lwaWVudF9uYW1lJ10pIHtcbiAgICAgIHNlYXJjaFBhcmFtc1sncmVjaXBpZW50X25hbWUnXSA9IGZpbHRlcnNbJ3JlY2lwaWVudF9uYW1lJ11cbiAgICB9XG4gICAgaWYgKGZpbHRlcnNbJ2VudmVsb3BlX25hbWUnXSkge1xuICAgICAgc2VhcmNoUGFyYW1zWydlbnZlbG9wZV9uYW1lJ10gPSBmaWx0ZXJzWydlbnZlbG9wZV9uYW1lJ11cbiAgICB9XG4gICAgaWYgKGZpbHRlcnNbJ3JlY2lwaWVudF9lbWFpbCddKSB7XG4gICAgICBzZWFyY2hQYXJhbXNbJ3JlY2lwaWVudF9lbWFpbCddID0gZmlsdGVyc1sncmVjaXBpZW50X2VtYWlsJ11cbiAgICB9XG4gICAgaWYgKGZpbHRlcnNbJ3RleHRfZmllbGRfdmFsdWUnXSkge1xuICAgICAgc2VhcmNoUGFyYW1zWyd0ZXh0X2ZpZWxkX3ZhbHVlJ10gPSBmaWx0ZXJzWyd0ZXh0X2ZpZWxkX3ZhbHVlJ11cbiAgICB9XG4gICAgcmV0dXJuIHNlYXJjaFBhcmFtcztcbiAgfVxuXG4gIGZpbHRlclNlYXJjaEJ5KHR5cGU6IHN0cmluZywgYXNjZW5kaW5nPzogYm9vbGVhbiwgcm93PzogbnVtYmVyLCBwYWdlPzogbnVtYmVyLCBmaWx0ZXJUaW1lPzogSVRpbWVQZXJpb2QsIHNvcnRCeT86IERvY3VtZW50U29ydE9wdGlvbnMsIGN1c3RvbUZpbHRlcnM/OiBJRW52ZWxvcGVTZWFyY2hQYXJhbXMpIHtcbiAgICBsZXQgc2VhcmNoUGFyYW1zID0ge1xuICAgICAgYXNjZW5kaW5nOiBhc2NlbmRpbmcgfHwgZmFsc2UsXG4gICAgICByb3c6IHJvdyB8fCAxMCxcbiAgICAgIHBhZ2U6IHBhZ2UgfHwgMVxuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAnYWN0aW9uX3JlcXVpcmVkJzpcbiAgICAgICAgc2VhcmNoUGFyYW1zWydpc19yZWNpcGllbnQnXSA9IHRydWU7XG4gICAgICAgIHNlYXJjaFBhcmFtc1sncmVjaXBpZW50X3N0YXR1cyddID0gWydpbnZpdGVkJywgJ29wZW5lZCcsICdzaWduZWQnXTtcbiAgICAgICAgc2VhcmNoUGFyYW1zWydlbnZlbG9wZV9zdGF0dXMnXSA9IFsncGVuZGluZycsICdpbiBwcm9ncmVzcyddO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9IHNvcnRCeSBhcyBEb2N1bWVudFNvcnRPcHRpb25zO1xuICAgICAgICBpZiAoZmlsdGVyVGltZSkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtc1sndXBkYXRlZF9hdCddID0gZmlsdGVyVGltZTtcbiAgICAgICAgICBpZiAoIXNvcnRCeSkge1xuICAgICAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSAndXBkYXRlZF9hdCcgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd3YWl0aW5nX29uX290aGVycyc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldFdhaXRpbmdPbk90aGVycyhhc2NlbmRpbmcsIHJvdywgcGFnZSwgZmlsdGVyVGltZSwgc29ydEJ5LCBjdXN0b21GaWx0ZXJzKTtcbiAgICAgIGNhc2UgJ3dhaXRpbmdfb25fb3RoZXJzX3VuZmlsdGVyZWQnOlxuICAgICAgICBzZWFyY2hQYXJhbXNbJ2lzX293bmVyJ10gPSB0cnVlO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ2VudmVsb3BlX3N0YXR1cyddID0gWydwZW5kaW5nJywgJ2luIHByb2dyZXNzJ107XG4gICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gc29ydEJ5IGFzIERvY3VtZW50U29ydE9wdGlvbnMgfHwgbnVsbDtcbiAgICAgICAgaWYgKGZpbHRlclRpbWUpIHtcbiAgICAgICAgICBzZWFyY2hQYXJhbXNbJ3VwZGF0ZWRfYXQnXSA9IGZpbHRlclRpbWU7XG4gICAgICAgICAgaWYgKCFzb3J0QnkpIHtcbiAgICAgICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gJ3VwZGF0ZWRfYXQnIGFzIERvY3VtZW50U29ydE9wdGlvbnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnaW5ib3gnOlxuICAgICAgICBzZWFyY2hQYXJhbXNbJ2lzX3JlY2lwaWVudCddID0gdHJ1ZTtcbiAgICAgICAgc2VhcmNoUGFyYW1zWydyZWNpcGllbnRfc3RhdHVzJ10gPSBbJ2ludml0ZWQnLCAnZGVjbGluZWQnLCAnb3BlbmVkJywgJ3NpZ25lZCcsICdzdWJtaXR0ZWQnLCAnY2FuY2VsZWQnXTtcbiAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSBzb3J0QnkgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucyB8fCBudWxsO1xuICAgICAgICBpZiAoZmlsdGVyVGltZSkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtc1snY3JlYXRlZF9hdCddID0gZmlsdGVyVGltZTtcbiAgICAgICAgICBpZiAoIXNvcnRCeSkge1xuICAgICAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSAnY3JlYXRlZF9hdCcgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjb21wbGV0ZWQnOlxuICAgICAgICBzZWFyY2hQYXJhbXNbJ2VudmVsb3BlX3N0YXR1cyddID0gWydjb21wbGV0ZSddO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9IHNvcnRCeSBhcyBEb2N1bWVudFNvcnRPcHRpb25zIHx8IG51bGw7XG4gICAgICAgIGlmIChmaWx0ZXJUaW1lKSB7XG4gICAgICAgICAgc2VhcmNoUGFyYW1zWyd1cGRhdGVkX2F0J10gPSBmaWx0ZXJUaW1lO1xuICAgICAgICAgIGlmICghc29ydEJ5KSB7XG4gICAgICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9ICd1cGRhdGVkX2F0JyBhcyBEb2N1bWVudFNvcnRPcHRpb25zO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3NlbnQnOlxuICAgICAgICBzZWFyY2hQYXJhbXNbJ2lzX293bmVyJ10gPSB0cnVlO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9IHNvcnRCeSBhcyBEb2N1bWVudFNvcnRPcHRpb25zIHx8IG51bGw7XG4gICAgICAgIGlmIChmaWx0ZXJUaW1lKSB7XG4gICAgICAgICAgc2VhcmNoUGFyYW1zWydjcmVhdGVkX2F0J10gPSBmaWx0ZXJUaW1lO1xuICAgICAgICAgIGlmICghc29ydEJ5KSB7XG4gICAgICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9ICdjcmVhdGVkX2F0JyBhcyBEb2N1bWVudFNvcnRPcHRpb25zO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2FsbCc6XG4gICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gc29ydEJ5IGFzIERvY3VtZW50U29ydE9wdGlvbnMgfHwgbnVsbDtcbiAgICAgICAgaWYgKGZpbHRlclRpbWUpIHtcbiAgICAgICAgICBzZWFyY2hQYXJhbXNbJ2NyZWF0ZWRfYXQnXSA9IGZpbHRlclRpbWU7XG4gICAgICAgICAgaWYgKCFzb3J0QnkpIHtcbiAgICAgICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gJ2NyZWF0ZWRfYXQnIGFzIERvY3VtZW50U29ydE9wdGlvbnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKCEhY3VzdG9tRmlsdGVycykge1xuICAgICAgc2VhcmNoUGFyYW1zID0gdGhpcy5hcHBseUN1c3RvbVNlYXJjaChjdXN0b21GaWx0ZXJzLCB7IC4uLnNlYXJjaFBhcmFtcyB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoRW52ZWxvcGVzKHNlYXJjaFBhcmFtcyk7XG4gIH1cblxuICBwdWJsaWMgZ2V0V2FpdGluZ09uT3RoZXJzKGFzY2VuZGluZz86IGJvb2xlYW4sIHJvdz86IG51bWJlciwgcGFnZT86IG51bWJlciwgZmlsdGVyVGltZT86IElUaW1lUGVyaW9kLCBzb3J0Qnk/OiBEb2N1bWVudFNvcnRPcHRpb25zLCBjdXN0b21GaWx0ZXJzPzogSUVudmVsb3BlU2VhcmNoUGFyYW1zKSB7XG4gICAgbGV0IGFjdGlvblJlcXVpcmVkRW52ZWxvcGVzID0gbnVsbDtcbiAgICByZXR1cm4gdGhpcy5maWx0ZXJTZWFyY2hCeSgnYWN0aW9uX3JlcXVpcmVkJywgYXNjZW5kaW5nLCByb3csIHBhZ2UsIGZpbHRlclRpbWUsIHNvcnRCeSwgY3VzdG9tRmlsdGVycylcbiAgICAgIC5waXBlKFxuICAgICAgICBjb25jYXRNYXAoKHJlcykgPT4ge1xuICAgICAgICAgIGlmIChyZXMgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGFjdGlvblJlcXVpcmVkRW52ZWxvcGVzID0gcmVzLmJvZHlbJ3Jlc3VsdCddO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyU2VhcmNoQnkoJ3dhaXRpbmdfb25fb3RoZXJzX3VuZmlsdGVyZWQnLCBhc2NlbmRpbmcsIHJvdywgcGFnZSwgZmlsdGVyVGltZSwgc29ydEJ5LCBjdXN0b21GaWx0ZXJzKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZW1wdHkoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBtYXAoKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgSHR0cFJlc3BvbnNlICYmIGFjdGlvblJlcXVpcmVkRW52ZWxvcGVzKSB7XG4gICAgICAgICAgICBjb25zdCB1bmZpbHRlcmVkV2FpdGluZ09uT3RoZXJzID0gcmVzcG9uc2VbJ2JvZHknXVsncmVzdWx0J107XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZFdhaXRpbmdPbk90aGVycyA9IGRpZmZlcmVuY2VCeSh1bmZpbHRlcmVkV2FpdGluZ09uT3RoZXJzLCBhY3Rpb25SZXF1aXJlZEVudmVsb3BlcywgJ2lkJyk7XG4gICAgICAgICAgICByZXNwb25zZS5ib2R5WydyZXN1bHQnXSA9IGZpbHRlcmVkV2FpdGluZ09uT3RoZXJzO1xuICAgICAgICAgICAgcmVzcG9uc2UuYm9keVsndG90YWwnXSA9IGZpbHRlcmVkV2FpdGluZ09uT3RoZXJzLmxlbmd0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9KVxuICAgICAgKVxuICB9XG5cbiAgZ2V0RW52ZWxvcGVPd25lckluZm8oZW52SWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudklkfT9vd25lcl9pbmZvPXRydWVgKS5waXBlKFxuICAgICAgbWFwKHJlcyA9PiB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZXRFbnZlbG9wZURvY1VybChlbnZJZDogc3RyaW5nLCBkb2NJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52SWR9L2VudmVsb3BlX2RvY3VtZW50cy8ke2RvY0lkfT9maWxlPXRydWVgLFxuICAgICAgeyByZXNwb25zZVR5cGU6ICdibG9iJyB9KVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcChyZXMgPT4ge1xuICAgICAgICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgICAgICAgY29uc3QgdXJsQ3JlYXRvciA9IHdpbmRvdy5VUkw7XG4gICAgICAgICAgICBjb25zdCBwZGZVcmwgPSB1cmxDcmVhdG9yLmNyZWF0ZU9iamVjdFVSTChyZXMpO1xuICAgICAgICAgICAgcmV0dXJuIHBkZlVybDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgLy8gdXNlIGEgc25hY2tCYXIvZXJyb3Iuc2VydmljZVxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBnZXRFbnZlbG9wZVBkZldpdGhQcm9ncmVzcyhlbnZlbG9wZUlkOiBzdHJpbmcsIGRvY3VtZW50SWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHJlcXVlc3RVcmwgPSB0aGlzLl9kb2N1bWVudFVybCArIGAvJHtlbnZlbG9wZUlkfS9lbnZlbG9wZV9kb2N1bWVudHMvJHtkb2N1bWVudElkfT9maWxlPXRydWVgO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdChuZXcgSHR0cFJlcXVlc3QoXG4gICAgICAnR0VUJyxcbiAgICAgIHJlcXVlc3RVcmwsXG4gICAgICB7fSxcbiAgICAgIHsgcmVwb3J0UHJvZ3Jlc3M6IHRydWUsIHJlc3BvbnNlVHlwZTogJ2Jsb2InIH1cbiAgICApKS5waXBlKFxuICAgICAgbWFwKGV2ZW50ID0+IGV2ZW50KVxuICAgICk7XG4gIH1cblxuICBnZXRFbnZlbG9wZURvY0Jsb2IoZW52SWQ6IHN0cmluZywgZG9jSWQ6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudklkfS9lbnZlbG9wZV9kb2N1bWVudHMvJHtkb2NJZH0/ZmlsZT10cnVlYCxcbiAgICAgIHsgcmVzcG9uc2VUeXBlOiAnYmxvYicgfSlcbiAgICAgIC5waXBlKG1hcChmaWxlID0+IHtcbiAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgICB9KSk7XG4gIH1cblxuICBnZXRFbnZlbG9wZUNlcnRpZmljYXRlQmxvYihlbnZJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52SWR9P2NlcnRpZmljYXRlX2ZpbGU9dHJ1ZWAsXG4gICAgICB7IHJlc3BvbnNlVHlwZTogJ2Jsb2InIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKGZpbGUgPT4ge1xuICAgICAgICAgIHJldHVybiBmaWxlO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBNb3ZlIGxvZ2ljIHRvIHB1YmxpYyBsaWJyYXJ5ICpcbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiAgLy8gZG93bmxvYWRFbnZlbG9wZShlbnZlbG9wZSkge1xuICAvLyAgIHRoaXMuZ2V0RW52ZWxvcGVEb2NCbG9iKGVudmVsb3BlLmlkLCBlbnZlbG9wZS5lbnZlbG9wZV9kb2N1bWVudF9pZCkudG9Qcm9taXNlKCkudGhlbihwZGZCbG9iID0+IHtcbiAgLy8gICAgIHNhdmVBcyhwZGZCbG9iLCBlbnZlbG9wZS5uYW1lICsgJy0nICsgbW9tZW50KGVudmVsb3BlLnVwZGF0ZWRfYXQpLmZvcm1hdCgnTU0tREQtWVknKSArICcucGRmJyk7XG4gIC8vICAgfSk7XG4gIC8vIH1cblxuICAvLyBkb3dubG9hZEVudmVsb3BlQ2VydGlmaWNhdGUoZW52ZWxvcGUpIHtcbiAgLy8gICB0aGlzLmdldEVudmVsb3BlQ2VydGlmaWNhdGVCbG9iKGVudmVsb3BlLmlkKS50b1Byb21pc2UoKS50aGVuKHBkZkJsb2IgPT4ge1xuICAvLyAgICAgaWYgKHBkZkJsb2IpIHtcbiAgLy8gICAgICAgc2F2ZUFzKHBkZkJsb2IsIGAke2VudmVsb3BlLm5hbWV9X2NlcnRpZmljYXRlLnBkZmApO1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvLyB9XG5cbiAgZ2V0VGVtcGxhdGVEb2ModGVtcGxhdGVJZDogc3RyaW5nLCB0b2tlbjogc3RyaW5nLCBmaWxlOiBib29sZWFuKSB7XG4gICAgY29uc3QgcmVxdWVzdFVybCA9IHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9saXZldmlldy8ke3RlbXBsYXRlSWR9L3Rva2VuLyR7dG9rZW59YDtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldChyZXF1ZXN0VXJsLCB7IHJlc3BvbnNlVHlwZTogJ2pzb24nIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKChyZXM6IGFueSkgPT4ge1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH0sIGVyciA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgIHJldHVybiBlcnI7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgZ2V0VGVtcGxhdGVQREYodGVtcGxhdGVJZDogc3RyaW5nLCB0b2tlbjogc3RyaW5nKSB7XG4gICAgY29uc3QgcmVxdWVzdFVybCA9IHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9saXZldmlldy8ke3RlbXBsYXRlSWR9L3Rva2VuLyR7dG9rZW59P2ZpbGU9dHJ1ZWA7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0KG5ldyBIdHRwUmVxdWVzdChcbiAgICAgICdHRVQnLFxuICAgICAgcmVxdWVzdFVybCxcbiAgICAgIHt9LFxuICAgICAgeyByZXBvcnRQcm9ncmVzczogdHJ1ZSwgcmVzcG9uc2VUeXBlOiAnYmxvYicgfVxuICAgICkpLnBpcGUoXG4gICAgICBtYXAoZXZlbnQgPT4ge1xuICAgICAgICByZXR1cm4gZXZlbnQ7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBjYW5jZWxFbnZlbG9wZShpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7aWR9YCwgeyBhY3Rpb246ICdjYW5jZWwnIH0sIHsgcmVzcG9uc2VUeXBlOiAnanNvbicgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoZW52ZWxvcGVEYXRhID0+IGVudmVsb3BlRGF0YSwgZXJyID0+IGVycilcbiAgICAgICk7XG4gIH1cblxuICBzdWJtaXRFbnZlbG9wZShlbnZJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxJUmVjaXBpZW50PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQoXG4gICAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArIGAvZW52ZWxvcGVzLyR7ZW52SWR9L3JlY2lwaWVudHMvJHtyb2xlTmFtZX1gLFxuICAgICAgeyBhY3Rpb246ICdzdWJtaXQnIH1cbiAgICApLnBpcGUoXG4gICAgICBtYXAoKHJlczogSVJlY2lwaWVudCkgPT4ge1xuICAgICAgICByZXR1cm4gcmVzXG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBkZWNsaW5lRW52ZWxvcGUoZW52SWQ6IHN0cmluZywgcm9sZU5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8SVJlY2lwaWVudD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucHV0KFxuICAgICAgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2VudmVsb3Blcy8ke2VudklkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9YCxcbiAgICAgIHsgYWN0aW9uOiAnZGVjbGluZScgfVxuICAgICkucGlwZShcbiAgICAgIG1hcCgocmVzOiBJUmVjaXBpZW50KSA9PiB7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuXG4gIHVwbG9hZEF0dGFjaG1lbnQoZW52ZWxvcGVJZCwgZmlsZTogRmlsZSwgZmllbGROYW1lKSB7XG4gICAgbGV0IHJlcTtcbiAgICBpZiAoZmlsZSkge1xuICAgICAgY29uc3QgZm9ybWRhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIGZvcm1kYXRhLmFwcGVuZCgnZG9jdW1lbnQnLCBmaWxlLCBmaWxlLm5hbWUpO1xuICAgICAgcmVxID0gbmV3IEh0dHBSZXF1ZXN0KCdQVVQnLCB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArICcvZW52ZWxvcGVzLycgKyBlbnZlbG9wZUlkICtcbiAgICAgICAgJy9maWVsZHMvJyArIGZpZWxkTmFtZSwgZm9ybWRhdGEsIHtcbiAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHRydWVcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QocmVxKS5waXBlKFxuICAgICAgICBtYXAocmVzID0+IHJlcylcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZG93bmxvYWRBdHRhY2htZW50KGZpZWxkKSB7XG4gICAgY29uc3QgaGVhZGVyID0gbmV3IEh0dHBIZWFkZXJzKCkuc2V0KCdjb250ZW50LXR5cGUnLCBmaWVsZC5zZXR0aW5ncy50eXBlKTtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCh0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArICcvZW52ZWxvcGVzLycgKyBmaWVsZC5lbnZlbG9wZV9pZCArXG4gICAgICAnL2ZpZWxkcy8nICsgZmllbGQubmFtZSArICcvZG9jdW1lbnQnLCB7IGhlYWRlcnM6IGhlYWRlciwgcmVzcG9uc2VUeXBlOiAnYmxvYicgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoZmlsZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgZ2V0QXR0YWNobWVudERhdGFCeVJlY2lwaWVudHMoZW52ZWxvcGUpIHtcbiAgICBjb25zdCByZWNpcGllbnRzID0gZW52ZWxvcGVbJ3JlY2lwaWVudHMnXTtcbiAgICBpZiAocmVjaXBpZW50cyAmJiByZWNpcGllbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGF0dGFjaG1lbnRzID0gW11cbiAgICAgIGZvciAoY29uc3QgcmVjaXBpZW50IG9mIHJlY2lwaWVudHMpIHtcbiAgICAgICAgaWYgKHJlY2lwaWVudC5maWVsZHMgJiYgcmVjaXBpZW50LmZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiByZWNpcGllbnQuZmllbGRzKSB7XG4gICAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2F0dGFjaG1lbnQnICYmICEhZmllbGQuc2V0dGluZ3MudXJsKSB7XG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHJlY2lwaWVudDogcmVjaXBpZW50LmZ1bGxfbmFtZSxcbiAgICAgICAgICAgICAgICBmaWVsZE9iamVjdDogZmllbGRcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYXR0YWNobWVudHM7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIC8qKioqKioqKioqKioqKioqKlxuICAgKiBTaWduYXR1cmUgQVBJICpcbiAgICoqKioqKioqKioqKioqKiovXG5cbiAgcG9zdFNpZ25hdHVyZUJsb2Ioc2lnbmF0dXJlQmxvYjogQmxvYikge1xuICAgIGNvbnN0IGJsb2JGaWxlID0gc2lnbmF0dXJlQmxvYjtcbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgnc2lnbmF0dXJlJywgYmxvYkZpbGUsIGJsb2JGaWxlWyduYW1lJ10pO1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3QoJ1BPU1QnLCB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArICcvc2lnbmF0dXJlcycsIGZvcm1EYXRhKTtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QocmVxdWVzdClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2VbJ2JvZHknXSkge1xuICAgICAgICAgIHJldHVybiByZXNwb25zZVsnYm9keSddO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGxvYWQgc2lnbmF0dXJlIGltYWdlJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgcG9zdEluaXRpYWxCbG9iKGluaXRpYWxCbG9iKSB7XG4gICAgY29uc3QgYmxvYkZpbGUgPSBpbml0aWFsQmxvYjtcbiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgnaW5pdGlhbCcsIGJsb2JGaWxlLCBibG9iRmlsZVsnbmFtZSddKTtcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0KCdQT1NUJywgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyAnL2luaXRpYWxzJywgZm9ybURhdGEpO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdChyZXF1ZXN0KVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZVsnYm9keSddKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWydib2R5J107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwbG9hZCBJbml0aWFsJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgcHV0U2lnbmF0dXJlRmllbGQoZW52ZWxvcGVJZCwgZmllbGROYW1lLCBzaWduYXR1cmVJZCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGlwQWRkcmVzcyA9IGF3YWl0IHRoaXMuZ2V0UHVibGljSXAoKTtcbiAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAucHV0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L2ZpZWxkcy8ke2ZpZWxkTmFtZX0vc2lnbmF0dXJlLyR7c2lnbmF0dXJlSWR9YCxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpcF9hZGRyZXNzOiBpcEFkZHJlc3NcbiAgICAgICAgICB9XG4gICAgICAgICkudG9Qcm9taXNlKCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgfSk7XG4gIH1cblxuICBwdXRJbml0aWFsRmllbGQoZW52ZWxvcGVJZCwgZmllbGROYW1lLCBpbml0aWFsSWQpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8YW55Pihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBpcEFkZHJlc3MgPSBhd2FpdCB0aGlzLmdldFB1YmxpY0lwKCk7XG4gICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgLnB1dCh0aGlzLl9kb2N1bWVudFVybCArIGAvJHtlbnZlbG9wZUlkfS9maWVsZHMvJHtmaWVsZE5hbWV9L2luaXRpYWwvJHtpbml0aWFsSWR9YCxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpcF9hZGRyZXNzOiBpcEFkZHJlc3NcbiAgICAgICAgICB9XG4gICAgICAgICkudG9Qcm9taXNlKCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgfSk7XG4gIH1cblxuICBwdXRFbnZlbG9wZUZpZWxkKGVudmVsb3BlSWQsIHJlc3VsdCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAucHV0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L2ZpZWxkcy8ke3RoaXMud29ya2luZ0ZpZWxkLmZOYW1lfWAsXG4gICAgICAgICAgcmVzdWx0XG4gICAgICAgICkudG9Qcm9taXNlKCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGVHcm91cGVkRmllbGQoZW52ZWxvcGVJZCwgYm9keSwgZmllbGROYW1lLCBpZlByZXBhcmVkPzogYm9vbGVhbikge1xuICAgIGlmICh0eXBlb2YgKGlmUHJlcGFyZWQpID09PSAnYm9vbGVhbicpIHtcbiAgICAgIGJvZHlbJ3ByZXBhcmVkJ10gPSBpZlByZXBhcmVkO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgLnB1dCh0aGlzLl9kb2N1bWVudFVybCArIGAvJHtlbnZlbG9wZUlkfS9maWVsZHMvJHtmaWVsZE5hbWV9YCxcbiAgICAgICAgICBib2R5XG4gICAgICAgICkudG9Qcm9taXNlKCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlcyk7XG4gICAgICAgIH0pXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFB1YmxpY0lwKCkge1xuICAgIGNvbnN0IGFwaVVybCA9ICdodHRwczovL2FwaS5pcGlmeS5vcmc/Zm9ybWF0PWpzb25wJztcbiAgICBjb25zdCBjYWxsYmFjayA9ICdjYWxsYmFjaz1KU09OUF9DQUxMQkFDSyc7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudFxuICAgICAgLmpzb25wKGFwaVVybCwgY2FsbGJhY2spXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc1snaXAnXVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGlwJywgZXJyKVxuICAgICAgICByZXR1cm4gJ2lwX3VuYXZhaWxhYmxlJ1xuICAgICAgfSk7XG4gIH1cblxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogTW92ZSBsb2dpYyB0byBwdWJsaWMgbGlicmFyeSAqXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8vIGFzeW5jIHppcEVudmVsb3BlRG9jcyhlbnZlbG9wZSkge1xuICAvLyAgIGNvbnN0IHppcCA9IG5ldyBqc3ppcCgpO1xuICAvLyAgIGNvbnN0IGVudmVsb3BlWmlwTmFtZSA9IGVudmVsb3BlLm5hbWUgKyAnIC0gJyArIG1vbWVudChlbnZlbG9wZS51cGRhdGVkX2F0KS5mb3JtYXQoJ01NLURELVlZJyk7XG5cbiAgLy8gICBhd2FpdCB0aGlzLmdldEVudmVsb3BlRG9jQmxvYihlbnZlbG9wZS5pZCwgZW52ZWxvcGUuZW52ZWxvcGVfZG9jdW1lbnRfaWQpLnRvUHJvbWlzZSgpLnRoZW4oZW52ZWxvcGVCbG9iID0+IHtcbiAgLy8gICAgIHppcC5maWxlKGVudmVsb3BlLm5hbWUgKyAnLnBkZicsIGVudmVsb3BlQmxvYiwgeyBjb21wcmVzc2lvbjogJ0RFRkxBVEUnIH0pO1xuICAvLyAgIH0pO1xuXG4gIC8vICAgaWYgKHRoaXMuaGFzQ2VydGlmaWNhdGUoZW52ZWxvcGUpKSB7XG4gIC8vICAgICBhd2FpdCB0aGlzLmdldEVudmVsb3BlQ2VydGlmaWNhdGVCbG9iKGVudmVsb3BlLmlkKS50b1Byb21pc2UoKS50aGVuKGVudmVsb3BlQ2VydGlmaWNhdGVCbG9iID0+IHtcbiAgLy8gICAgICAgemlwLmZpbGUoZW52ZWxvcGUubmFtZSArICdfY2VydGlmaWNhdGUucGRmJywgZW52ZWxvcGVDZXJ0aWZpY2F0ZUJsb2IsIHsgY29tcHJlc3Npb246ICdERUZMQVRFJyB9KTtcbiAgLy8gICAgIH0pO1xuICAvLyAgIH1cblxuICAvLyAgIGNvbnN0IGF0dGFjaG1lbnQgPSB6aXAuZm9sZGVyKCdhdHRhY2htZW50cycpO1xuICAvLyAgIGNvbnN0IGZpZWxkcyA9IGVudmVsb3BlLmZpZWxkcztcbiAgLy8gICBsZXQgbnVtT2ZBdHRhY2htZW50cyA9IDA7XG4gIC8vICAgZm9yIChsZXQgeCA9IDA7IHggPCBmaWVsZHMubGVuZ3RoOyB4KyspIHtcbiAgLy8gICAgIGlmIChmaWVsZHNbeF0gJiYgZmllbGRzW3hdLnR5cGUgPT09ICdhdHRhY2htZW50JyAmJiBmaWVsZHNbeF0uc2V0dGluZ3NbJ25hbWUnXSkge1xuICAvLyAgICAgICBhd2FpdCB0aGlzLmRvd25sb2FkQXR0YWNobWVudChmaWVsZHNbeF0pLnRvUHJvbWlzZSgpLnRoZW4oZmlsZUJsb2IgPT4ge1xuICAvLyAgICAgICAgIGF0dGFjaG1lbnQuZmlsZShmaWVsZHNbeF0uc2V0dGluZ3MubmFtZSwgZmlsZUJsb2IsIHsgY29tcHJlc3Npb246ICdERUZMQVRFJyB9KTtcbiAgLy8gICAgICAgICBudW1PZkF0dGFjaG1lbnRzKys7XG4gIC8vICAgICAgIH0pO1xuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gICBpZiAobnVtT2ZBdHRhY2htZW50cyA9PT0gMCkge1xuICAvLyAgICAgemlwLnJlbW92ZSgnYXR0YWNobWVudHMnKTtcbiAgLy8gICB9XG4gIC8vICAgemlwLmdlbmVyYXRlQXN5bmMoeyB0eXBlOiAnYmxvYicsIGNvbXByZXNzaW9uOiAnREVGTEFURScgfSkudGhlbihjb250ZW50ID0+IHtcbiAgLy8gICAgIHNhdmVBcyhjb250ZW50LCBlbnZlbG9wZVppcE5hbWUgKyAnLnppcCcpO1xuICAvLyAgIH0pXG4gIC8vIH1cblxuICBzb3J0UmVjaXBpZW50cyhlbnZlbG9wZTogSURvY3VtZW50KSB7XG4gICAgaWYgKGVudmVsb3BlLnJlY2lwaWVudHMubGVuZ3RoIDwgMSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IHJlY2lwaWVudHMgPSBlbnZlbG9wZS5yZWNpcGllbnRzLnNvcnQoKGE6IElSZWNpcGllbnQsIGI6IElSZWNpcGllbnQpID0+IHtcbiAgICAgIGlmIChhLnNlcXVlbmNlID09PSBiLnNlcXVlbmNlKSB7XG4gICAgICAgIHJldHVybiBhLnJvbGVfbmFtZSA8IGIucm9sZV9uYW1lID8gLTEgOiBhLnJvbGVfbmFtZSA+IGIucm9sZV9uYW1lID8gMSA6IDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gYi5zZXF1ZW5jZSA+IGEuc2VxdWVuY2UgPyAtMSA6IGIuc2VxdWVuY2UgPCBhLnNlcXVlbmNlID8gMSA6IDA7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzaWduZXJzID0gcmVjaXBpZW50cy5maWx0ZXIocmVjaXBpZW50ID0+IHtcbiAgICAgIHJldHVybiByZWNpcGllbnQudHlwZSA9PT0gJ3NpZ25lcic7XG4gICAgfSk7XG5cbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHNpZ25lcnMubGVuZ3RoOyB4KyspIHtcbiAgICAgIGNvbnN0IHJJbmRleCA9IGZpbmRJbmRleChyZWNpcGllbnRzLCB7IHNlcXVlbmNlOiBzaWduZXJzW3hdLnNlcXVlbmNlLCByb2xlX25hbWU6IHNpZ25lcnNbeF0ucm9sZV9uYW1lIH0pO1xuICAgICAgaWYgKHJJbmRleCA+PSAwKSB7XG4gICAgICAgIHJlY2lwaWVudHNbckluZGV4XVsncmdiYSddID0gZ2V0UkdCQSh4KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVjaXBpZW50cztcbiAgfVxuXG4gIGdldFJlY2lwaWVudENvbG9yKG5hbWUsIGluZGV4Pykge1xuICAgIGlmIChpbmRleCkge1xuICAgICAgcmV0dXJuIGdldFJHQkEoaW5kZXgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5lbnZlbG9wZSAmJiB0aGlzLmVudmVsb3BlLnJlY2lwaWVudHMgJiYgdGhpcy5lbnZlbG9wZS5yZWNpcGllbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBpbmRleCA9IGZpbmRJbmRleCh0aGlzLmVudmVsb3BlLnJlY2lwaWVudHMsIHsgcm9sZV9uYW1lOiBuYW1lIH0pO1xuICAgICAgaWYgKGluZGV4ID49IDAgJiYgdGhpcy5lbnZlbG9wZS5yZWNpcGllbnRzW2luZGV4XS5yZ2JhKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVudmVsb3BlLnJlY2lwaWVudHNbaW5kZXhdLnJnYmE7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBuYW1lVG9SR0JBKG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIENoZWNrIHRoZSBsb2dpY1xuICBhc3luYyB2YWxpZGF0ZUVudmVsb3BlRmllbGQoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKHRoaXMud29ya2luZ0ZpZWxkLnZOYW1lICE9IG51bGwgJiYgdGhpcy53b3JraW5nRmllbGQudmFsdWUgIT09ICcnKSB7XG4gICAgICBjb25zdCB2YWxpZGF0b3JzID0gYXdhaXQgdGhpcy52YWxpZGF0b3JTZXJ2aWNlLmdldFZhbGlkYXRvcnNPYmplY3QoKTtcbiAgICAgIHJldHVybiB2YWxpZGF0b3JzW3RoaXMud29ya2luZ0ZpZWxkLnZOYW1lXS50ZXN0KHRoaXMud29ya2luZ0ZpZWxkLnZhbHVlKSAmJiB0aGlzLnNhdGlzZnlSZXF1aXJlZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5zYXRpc2Z5UmVxdWlyZWQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNhdGlzZnlSZXF1aXJlZCgpIHtcbiAgICBpZiAoISF0aGlzLndvcmtpbmdGaWVsZC5yZXF1aXJlZCAmJiB0aGlzLndvcmtpbmdGaWVsZC50eXBlICE9PSAnY2hlY2tib3gnICYmIHRoaXMud29ya2luZ0ZpZWxkLnR5cGUgIT09ICd0aW1lc3RhbXAnKSB7XG4gICAgICByZXR1cm4gISF0aGlzLndvcmtpbmdGaWVsZC52YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBzb3J0RmllbGRzKGZpZWxkcykge1xuICAgIGZpZWxkcyA9IGZpZWxkcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICByZXR1cm4gYS5wYWdlIC0gYi5wYWdlO1xuICAgIH0pO1xuICAgIGxldCBwcmV2aW91c0Rpc3RhbmNlID0gbnVsbDtcbiAgICBmaWVsZHMgPSBmaWVsZHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgbGV0IHNldHRpbmcgPSAnc2V0dGluZ3MnO1xuICAgICAgbGV0IGRpc3RhbmNlID0gdGhpcy5jYW5CZVNhbWVSb3coYSwgYikuZGlzdGFuY2U7XG4gICAgICBsZXQgaGlnaGVySGVpZ2h0ID0gdGhpcy5jYW5CZVNhbWVSb3coYSwgYikuaGlnaGVySGVpZ2h0O1xuICAgICAgaWYgKCFhW3NldHRpbmddKSB7XG4gICAgICAgIHNldHRpbmcgPSAnc2V0dGluZyc7XG4gICAgICB9XG4gICAgICBpZiAoYS5wYWdlIDwgYi5wYWdlKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIGlmIChhLnBhZ2UgPiBiLnBhZ2UpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG4gICAgICBjb25zdCBheCA9IGFbc2V0dGluZ10ueCwgYnggPSBiW3NldHRpbmddLngsIGF5ID0gYVtzZXR0aW5nXS55LCBieSA9IGJbc2V0dGluZ10ueTtcbiAgICAgIGlmIChkaXN0YW5jZSA+PSAtMyAmJiBkaXN0YW5jZSA8PSBoaWdoZXJIZWlnaHQpIHtcbiAgICAgICAgcHJldmlvdXNEaXN0YW5jZSA9IHByZXZpb3VzRGlzdGFuY2UgPT09IG51bGwgPyBkaXN0YW5jZSA6IGRpc3RhbmNlIDwgcHJldmlvdXNEaXN0YW5jZSA/IGRpc3RhbmNlIDogcHJldmlvdXNEaXN0YW5jZTtcbiAgICAgICAgaWYgKGF4IDwgYngpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH0gZWxzZSBpZiAoYXggPiBieCkge1xuICAgICAgICAgIHJldHVybiAxXG4gICAgICAgIH0gZWxzZSBpZiAocHJldmlvdXNEaXN0YW5jZSA+PSBkaXN0YW5jZSkge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfSBlbHNlIGlmIChwcmV2aW91c0Rpc3RhbmNlIDw9IGRpc3RhbmNlKSB7XG4gICAgICAgICAgcmV0dXJuIDFcbiAgICAgICAgfSByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiW3NldHRpbmddLnkgLSBhW3NldHRpbmddLnlcbiAgICB9KVxuICAgIHJldHVybiBmaWVsZHM7XG4gIH1cblxuICBjaGVja0lmRW52ZWxvcGVPd25lcihlbnZlbG9wZSkge1xuICAgIGNvbnN0IHNpZ25lcl90b2tlbiA9IHRoaXMudlRva2VuU3RhdGVTZXJ2aWNlLmdldE90aGVyQ29va2llKCdzaWduZXJfdG9rZW4nKTtcbiAgICBjb25zdCBwcm9maWxlID0gdGhpcy50b2tlbk9iamVjdFNlcnZpY2UuZ2V0UHJvZmlsZSgpO1xuICAgIGlmIChzaWduZXJfdG9rZW4gJiYgIXByb2ZpbGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGVudmVsb3BlKSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlcklkID0gcHJvZmlsZVsnaWQnXTtcbiAgICAgIHJldHVybiBjdXJyZW50VXNlcklkID09PSBlbnZlbG9wZVsncHJvZmlsZV9pZCddO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FuQmVTYW1lUm93KGEsIGIpIHtcbiAgICBsZXQgc2V0dGluZyA9ICdzZXR0aW5nJztcbiAgICBpZiAoIWFbc2V0dGluZ10pIHtcbiAgICAgIHNldHRpbmcgPSAnc2V0dGluZ3MnO1xuICAgIH1cbiAgICBjb25zdCBhSGVpZ2h0ID0gdGhpcy5nZXRIZWlnaHQoYSk7XG4gICAgY29uc3QgYkhlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KGIpO1xuICAgIGNvbnN0IGFCb3R0b20gPSBhW3NldHRpbmddLnk7XG4gICAgY29uc3QgYkJvdHRvbSA9IGJbc2V0dGluZ10ueTtcbiAgICBsZXQgdG9wO1xuICAgIGxldCBoaWdoZXJCb3R0b207XG4gICAgbGV0IGhpZ2hlckhlaWdodDtcbiAgICBpZiAoYUJvdHRvbSA8IGJCb3R0b20pIHtcbiAgICAgIHRvcCA9IGFIZWlnaHQgKyBhQm90dG9tO1xuICAgICAgaGlnaGVyQm90dG9tID0gYkJvdHRvbTtcbiAgICAgIGhpZ2hlckhlaWdodCA9IGJIZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRvcCA9IGJIZWlnaHQgKyBiQm90dG9tO1xuICAgICAgaGlnaGVyQm90dG9tID0gYUJvdHRvbTtcbiAgICAgIGhpZ2hlckhlaWdodCA9IGFIZWlnaHQ7XG4gICAgfVxuICAgIGNvbnN0IGRpc3RhbmNlID0gdG9wIC0gaGlnaGVyQm90dG9tO1xuICAgIHJldHVybiB7IGRpc3RhbmNlLCBoaWdoZXJIZWlnaHQgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SGVpZ2h0KGZpZWxkKSB7XG4gICAgbGV0IHNldHRpbmcgPSAnc2V0dGluZyc7XG4gICAgaWYgKCFmaWVsZFtzZXR0aW5nXSkge1xuICAgICAgc2V0dGluZyA9ICdzZXR0aW5ncyc7XG4gICAgfVxuICAgIGxldCBoZWlnaHQgPSAwO1xuICAgIHN3aXRjaCAoZmllbGQudHlwZSkge1xuICAgICAgY2FzZSAnc2lnbmF0dXJlJzpcbiAgICAgIGNhc2UgJ2luaXRpYWwnOlxuICAgICAgICBoZWlnaHQgPSAzNjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjaGVja2JveCc6XG4gICAgICAgIGhlaWdodCA9IDEzLjU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYXR0YWNobWVudCc6XG4gICAgICBjYXNlICdwYXltZW50JzpcbiAgICAgICAgaGVpZ2h0ID0gMjQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaGVpZ2h0ID0gZmllbGRbc2V0dGluZ11bJ2hlaWdodCddIHx8IDA7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gaGVpZ2h0O1xuICB9XG5cbiAgcHVibGljIGhhc0NlcnRpZmljYXRlKGVudmVsb3BlKSB7XG4gICAgcmV0dXJuIGVudmVsb3BlLmNlcnRpZmljYXRlX2RvY3VtZW50X2lkIHx8IFsnY29tcGxldGUnLCAnY2FuY2VsZWQnLCAnZGVjbGluZWQnXS5pbmRleE9mKHRoaXMuZW52ZWxvcGUuc3RhdHVzKSAhPT0gLTE7XG4gIH1cbn0iXX0=