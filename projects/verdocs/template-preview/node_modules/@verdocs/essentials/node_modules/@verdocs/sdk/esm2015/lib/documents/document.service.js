/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { HttpClient, HttpResponse, HttpRequest, HttpHeaders } from '@angular/common/http';
import { BehaviorSubject, empty } from 'rxjs';
import { concatMap, map } from 'rxjs/operators';
import { findIndex } from 'lodash';
import { differenceBy } from 'lodash';
import { VerdocsTokenObjectService, VerdocsStateService } from '@verdocs/tokens';
// import { saveAs } from 'file-saver';
// import * as jszip from 'jszip';
// import * as moment from 'moment';
import { ValidatorService } from '../validators/validator.service';
import { getRGBA, nameToRGBA } from '../functions/rgb';
import { VSDKConfigToken } from '../angular-api.module';
import { FieldData } from '../models/field-data.model';
export class DocumentsService {
    /**
     * @param {?} httpClient
     * @param {?} validatorService
     * @param {?} tokenObjectService
     * @param {?} vTokenStateService
     * @param {?} injector
     * @param {?} platform
     */
    constructor(httpClient, validatorService, tokenObjectService, vTokenStateService, injector, platform) {
        this.httpClient = httpClient;
        this.validatorService = validatorService;
        this.tokenObjectService = tokenObjectService;
        this.vTokenStateService = vTokenStateService;
        this.injector = injector;
        this.platform = platform;
        this._currentFields = new BehaviorSubject([]);
        this._currEnvelope = new BehaviorSubject('');
        this.allEnvelopes = new BehaviorSubject([]);
        this._currentExtendedEnvelope = new BehaviorSubject({});
        this._customFilterSubject = new BehaviorSubject({});
        this.currEnvelope$ = this._currEnvelope.asObservable();
        this.fieldsStream = this._currentFields.asObservable();
        this.inProgressSubject = new BehaviorSubject(false);
        this.workingField = new FieldData({ order: 0 });
        this.envelope = null;
        this.validators = {};
        this.toggleNextSubject = new BehaviorSubject(false);
        this._config_token = this.injector.get(VSDKConfigToken);
        this._rForm_backend_url = this._config_token.rForm_backend_url;
        this._documentUrl = `${this._rForm_backend_url}/envelopes`;
    }
    /**
     * @param {?} id
     * @return {?}
     */
    setCurrentEnvelope(id) {
        this.currEnvelope = id;
        this._currEnvelope.next(id);
    }
    /**
     * @param {?} envId
     * @param {?} roleId
     * @return {?}
     */
    setEnvData(envId, roleId) {
        this.currEnvelope = envId;
        this.currRoleName = roleId;
    }
    /**
     * @param {?} envelopes
     * @return {?}
     */
    updateEnvelopes(envelopes) {
        this.allEnvelopes.next(envelopes);
    }
    /**
     * @return {?}
     */
    get role_name() {
        return this.currRoleName;
    }
    /**
     * @return {?}
     */
    get env_id() {
        return this.currEnvelope;
    }
    /**
     * @param {?} body
     * @return {?}
     */
    sendInvite(body) {
        return this.httpClient.post(this._documentUrl, body)
            .pipe(map((/**
         * @param {?} envelope
         * @return {?}
         */
        (envelope) => envelope), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            return err;
        })));
    }
    /**
     * @param {?} envelopeId
     * @param {?} role
     * @return {?}
     */
    sendDelegate(envelopeId, role) {
        return this.httpClient.post(this._documentUrl + `/${envelopeId}/recipients/${this.currRoleName}/delegate`, role)
            .pipe(map((/**
         * @param {?} envelope
         * @return {?}
         */
        (envelope) => envelope), (/**
         * @param {?} err
         * @return {?}
         */
        err => err)));
    }
    /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @return {?}
     */
    resendInvitation(envelopeId, roleName) {
        return this.httpClient.post(this._documentUrl + `/${envelopeId}/recipients/${roleName}/resend_invitation`, null);
    }
    /**
     * @param {?=} id
     * @return {?}
     */
    getEnvelope(id) {
        /** @type {?} */
        const envelopeId = id ? id : this.currEnvelope;
        this.setCurrentEnvelope(envelopeId);
        return this.httpClient.get(this._documentUrl + `/${envelopeId}`)
            .pipe(map((/**
         * @param {?} envelopeExtended
         * @return {?}
         */
        (envelopeExtended) => {
            this.envelope = (/** @type {?} */ (envelopeExtended));
            this.envelope.recipients = this.sortRecipients(this.envelope);
            this._currentExtendedEnvelope.next(this.envelope);
            this.envelopeData = this.envelope;
            return this.envelope;
        })));
    }
    /**
     * @param {?=} templateId
     * @return {?}
     */
    getAllEnvelopes(templateId) {
        /** @type {?} */
        const endpoint = templateId ? this._documentUrl + `?template_id=${templateId}` : this._documentUrl;
        return this.httpClient.request(new HttpRequest('GET', endpoint, {}, {
            reportProgress: true,
            responseType: 'json'
        })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            if (event instanceof HttpResponse) {
                this.updateEnvelopes(event.body);
                return (/** @type {?} */ (event));
            }
            return event;
        })));
    }
    /**
     * @param {?} searchParams
     * @return {?}
     */
    searchEnvelopes(searchParams) {
        for (const key in searchParams) {
            if (searchParams.hasOwnProperty(key)) {
                if (searchParams[key] === null) {
                    delete searchParams[key];
                }
            }
        }
        return this.httpClient.request(new HttpRequest('POST', this._documentUrl + '/search', searchParams, {
            reportProgress: true,
            responseType: 'json'
        })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            if (event instanceof HttpResponse) {
                this.updateEnvelopes(event.body);
                return (/** @type {?} */ (event));
            }
            return event;
        })));
    }
    /**
     * @param {?=} page
     * @return {?}
     */
    getRecentActivities(page) {
        /** @type {?} */
        const searchBody = {
            sort_by: (/** @type {?} */ ('updated_at')),
            ascending: false,
            row: 5,
            page: page ? page : 1
        };
        return this.searchEnvelopes(searchBody);
    }
    /**
     * @param {?} filters
     * @param {?} searchParams
     * @return {?}
     */
    applyCustomSearch(filters, searchParams) {
        if (filters['envelope_status'] && !searchParams['envelope_status']) {
            searchParams['envelope_status'] = filters['envelope_status'];
        }
        if (filters['updated_at']) {
            if (!searchParams['updated_at'] && !!searchParams['envelope_status']) {
                searchParams['updated_at'] = filters['updated_at'];
            }
            else if (!searchParams['envelope_status']) {
                searchParams['created_at'] = filters['updated_at'];
                if (!searchParams['sort_by']) {
                    searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                }
            }
        }
        if (filters['recipient_name']) {
            searchParams['recipient_name'] = filters['recipient_name'];
        }
        if (filters['envelope_name']) {
            searchParams['envelope_name'] = filters['envelope_name'];
        }
        if (filters['recipient_email']) {
            searchParams['recipient_email'] = filters['recipient_email'];
        }
        if (filters['text_field_value']) {
            searchParams['text_field_value'] = filters['text_field_value'];
        }
        return searchParams;
    }
    /**
     * @param {?} type
     * @param {?=} ascending
     * @param {?=} row
     * @param {?=} page
     * @param {?=} filterTime
     * @param {?=} sortBy
     * @param {?=} customFilters
     * @return {?}
     */
    filterSearchBy(type, ascending, row, page, filterTime, sortBy, customFilters) {
        /** @type {?} */
        let searchParams = {
            ascending: ascending || false,
            row: row || 10,
            page: page || 1
        };
        switch (type) {
            case 'action_required':
                searchParams['is_recipient'] = true;
                searchParams['recipient_status'] = ['invited', 'opened', 'signed'];
                searchParams['envelope_status'] = ['pending', 'in progress'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy));
                if (filterTime) {
                    searchParams['updated_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('updated_at'));
                    }
                }
                break;
            case 'waiting_on_others':
                return this.getWaitingOnOthers(ascending, row, page, filterTime, sortBy, customFilters);
            case 'waiting_on_others_unfiltered':
                searchParams['is_owner'] = true;
                searchParams['envelope_status'] = ['pending', 'in progress'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['updated_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('updated_at'));
                    }
                }
                break;
            case 'inbox':
                searchParams['is_recipient'] = true;
                searchParams['recipient_status'] = ['invited', 'declined', 'opened', 'signed', 'submitted', 'canceled'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['created_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                    }
                }
                break;
            case 'completed':
                searchParams['envelope_status'] = ['complete'];
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['updated_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('updated_at'));
                    }
                }
                break;
            case 'sent':
                searchParams['is_owner'] = true;
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['created_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                    }
                }
                break;
            case 'all':
                searchParams['sort_by'] = (/** @type {?} */ (sortBy)) || null;
                if (filterTime) {
                    searchParams['created_at'] = filterTime;
                    if (!sortBy) {
                        searchParams['sort_by'] = (/** @type {?} */ ('created_at'));
                    }
                }
                break;
            default:
                break;
        }
        if (!!customFilters) {
            searchParams = this.applyCustomSearch(customFilters, Object.assign({}, searchParams));
        }
        return this.searchEnvelopes(searchParams);
    }
    /**
     * @param {?=} ascending
     * @param {?=} row
     * @param {?=} page
     * @param {?=} filterTime
     * @param {?=} sortBy
     * @param {?=} customFilters
     * @return {?}
     */
    getWaitingOnOthers(ascending, row, page, filterTime, sortBy, customFilters) {
        /** @type {?} */
        let actionRequiredEnvelopes = null;
        return this.filterSearchBy('action_required', ascending, row, page, filterTime, sortBy, customFilters)
            .pipe(concatMap((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            if (res instanceof HttpResponse) {
                actionRequiredEnvelopes = res.body['result'];
                return this.filterSearchBy('waiting_on_others_unfiltered', ascending, row, page, filterTime, sortBy, customFilters);
            }
            else {
                return empty();
            }
        })), map((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            if (response instanceof HttpResponse && actionRequiredEnvelopes) {
                /** @type {?} */
                const unfilteredWaitingOnOthers = response['body']['result'];
                /** @type {?} */
                const filteredWaitingOnOthers = differenceBy(unfilteredWaitingOnOthers, actionRequiredEnvelopes, 'id');
                response.body['result'] = filteredWaitingOnOthers;
                response.body['total'] = filteredWaitingOnOthers.length;
            }
            return response;
        })));
    }
    /**
     * @param {?} envId
     * @return {?}
     */
    getEnvelopeOwnerInfo(envId) {
        return this.httpClient.get(this._documentUrl + `/${envId}?owner_info=true`).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            return res;
        })));
    }
    /**
     * @param {?} envId
     * @param {?} docId
     * @return {?}
     */
    getEnvelopeDocUrl(envId, docId) {
        return this.httpClient.get(this._documentUrl + `/${envId}/envelope_documents/${docId}?file=true`, { responseType: 'blob' })
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        res => {
            if (isPlatformBrowser(this.platform)) {
                /** @type {?} */
                const urlCreator = window.URL;
                /** @type {?} */
                const pdfUrl = urlCreator.createObjectURL(res);
                return pdfUrl;
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            // use a snackBar/error.service
            console.error(err);
        })));
    }
    /**
     * @param {?} envelopeId
     * @param {?} documentId
     * @return {?}
     */
    getEnvelopePdfWithProgress(envelopeId, documentId) {
        /** @type {?} */
        const requestUrl = this._documentUrl + `/${envelopeId}/envelope_documents/${documentId}?file=true`;
        return this.httpClient.request(new HttpRequest('GET', requestUrl, {}, { reportProgress: true, responseType: 'blob' })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        event => event)));
    }
    /**
     * @param {?} envId
     * @param {?} docId
     * @return {?}
     */
    getEnvelopeDocBlob(envId, docId) {
        return this.httpClient.get(this._documentUrl + `/${envId}/envelope_documents/${docId}?file=true`, { responseType: 'blob' })
            .pipe(map((/**
         * @param {?} file
         * @return {?}
         */
        file => {
            return file;
        })));
    }
    /**
     * @param {?} envId
     * @return {?}
     */
    getEnvelopeCertificateBlob(envId) {
        return this.httpClient.get(this._documentUrl + `/${envId}?certificate_file=true`, { responseType: 'blob' })
            .pipe(map((/**
         * @param {?} file
         * @return {?}
         */
        file => {
            return file;
        })));
    }
    /**
     * *****************************
     * Move logic to public library *
     * *****************************
     * @param {?} templateId
     * @param {?} token
     * @param {?} file
     * @return {?}
     */
    // downloadEnvelope(envelope) {
    //   this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(pdfBlob => {
    //     saveAs(pdfBlob, envelope.name + '-' + moment(envelope.updated_at).format('MM-DD-YY') + '.pdf');
    //   });
    // }
    // downloadEnvelopeCertificate(envelope) {
    //   this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(pdfBlob => {
    //     if (pdfBlob) {
    //       saveAs(pdfBlob, `${envelope.name}_certificate.pdf`);
    //     }
    //   });
    // }
    getTemplateDoc(templateId, token, file) {
        /** @type {?} */
        const requestUrl = this._rForm_backend_url + `/liveview/${templateId}/token/${token}`;
        return this.httpClient.get(requestUrl, { responseType: 'json' })
            .pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res;
        }), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            console.error(err);
            return err;
        })));
    }
    /**
     * @param {?} templateId
     * @param {?} token
     * @return {?}
     */
    getTemplatePDF(templateId, token) {
        /** @type {?} */
        const requestUrl = this._rForm_backend_url + `/liveview/${templateId}/token/${token}?file=true`;
        return this.httpClient.request(new HttpRequest('GET', requestUrl, {}, { reportProgress: true, responseType: 'blob' })).pipe(map((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            return event;
        })));
    }
    /**
     * @param {?} id
     * @return {?}
     */
    cancelEnvelope(id) {
        return this.httpClient.put(this._documentUrl + `/${id}`, { action: 'cancel' }, { responseType: 'json' })
            .pipe(map((/**
         * @param {?} envelopeData
         * @return {?}
         */
        envelopeData => envelopeData), (/**
         * @param {?} err
         * @return {?}
         */
        err => err)));
    }
    /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    submitEnvelope(envId, roleName) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envId}/recipients/${roleName}`, { action: 'submit' }).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res;
        })));
    }
    /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    declineEnvelope(envId, roleName) {
        return this.httpClient.put(this._rForm_backend_url + `/envelopes/${envId}/recipients/${roleName}`, { action: 'decline' }).pipe(map((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res;
        })));
    }
    /**
     * @param {?} envelopeId
     * @param {?} file
     * @param {?} fieldName
     * @return {?}
     */
    uploadAttachment(envelopeId, file, fieldName) {
        /** @type {?} */
        let req;
        if (file) {
            /** @type {?} */
            const formdata = new FormData();
            formdata.append('document', file, file.name);
            req = new HttpRequest('PUT', this._rForm_backend_url + '/envelopes/' + envelopeId +
                '/fields/' + fieldName, formdata, {
                reportProgress: true
            });
            return this.httpClient.request(req).pipe(map((/**
             * @param {?} res
             * @return {?}
             */
            res => res)));
        }
    }
    /**
     * @param {?} field
     * @return {?}
     */
    downloadAttachment(field) {
        /** @type {?} */
        const header = new HttpHeaders().set('content-type', field.settings.type);
        return this.httpClient.get(this._rForm_backend_url + '/envelopes/' + field.envelope_id +
            '/fields/' + field.name + '/document', { headers: header, responseType: 'blob' })
            .pipe(map((/**
         * @param {?} file
         * @return {?}
         */
        file => {
            return file;
        })));
    }
    /**
     * @param {?} envelope
     * @return {?}
     */
    getAttachmentDataByRecipients(envelope) {
        /** @type {?} */
        const recipients = envelope['recipients'];
        if (recipients && recipients.length > 0) {
            /** @type {?} */
            const attachments = [];
            for (const recipient of recipients) {
                if (recipient.fields && recipient.fields.length > 0) {
                    for (const field of recipient.fields) {
                        if (field.type === 'attachment' && !!field.settings.url) {
                            attachments.push({
                                recipient: recipient.full_name,
                                fieldObject: field
                            });
                        }
                    }
                }
            }
            return attachments;
        }
        return [];
    }
    /**
     * **************
     * Signature API *
     * **************
     * @param {?} signatureBlob
     * @return {?}
     */
    postSignatureBlob(signatureBlob) {
        /** @type {?} */
        const blobFile = signatureBlob;
        /** @type {?} */
        const formData = new FormData();
        formData.append('signature', blobFile, blobFile['name']);
        /** @type {?} */
        const request = new HttpRequest('POST', this._rForm_backend_url + '/signatures', formData);
        return this.httpClient.request(request)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            if (response && response['body']) {
                return response['body'];
            }
            else {
                console.error('Failed to upload signature image');
            }
        }));
    }
    /**
     * @param {?} initialBlob
     * @return {?}
     */
    postInitialBlob(initialBlob) {
        /** @type {?} */
        const blobFile = initialBlob;
        /** @type {?} */
        const formData = new FormData();
        formData.append('initial', blobFile, blobFile['name']);
        /** @type {?} */
        const request = new HttpRequest('POST', this._rForm_backend_url + '/initials', formData);
        return this.httpClient.request(request)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            if (response && response['body']) {
                return response['body'];
            }
            else {
                console.error('Failed to upload Initial');
            }
        }));
    }
    /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} signatureId
     * @return {?}
     */
    putSignatureField(envelopeId, fieldName, signatureId) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const ipAddress = yield this.getPublicIp();
            this.httpClient
                .put(this._documentUrl + `/${envelopeId}/fields/${fieldName}/signature/${signatureId}`, {
                ip_address: ipAddress
            }).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            res => {
                return resolve(res);
            }));
        })));
    }
    /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} initialId
     * @return {?}
     */
    putInitialField(envelopeId, fieldName, initialId) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const ipAddress = yield this.getPublicIp();
            this.httpClient
                .put(this._documentUrl + `/${envelopeId}/fields/${fieldName}/initial/${initialId}`, {
                ip_address: ipAddress
            }).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            res => {
                return resolve(res);
            }));
        })));
    }
    /**
     * @param {?} envelopeId
     * @param {?} result
     * @return {?}
     */
    putEnvelopeField(envelopeId, result) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.httpClient
                .put(this._documentUrl + `/${envelopeId}/fields/${this.workingField.fName}`, result).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            res => {
                return resolve(res);
            }));
        }));
    }
    /**
     * @param {?} envelopeId
     * @param {?} body
     * @param {?} fieldName
     * @param {?=} ifPrepared
     * @return {?}
     */
    updateGroupedField(envelopeId, body, fieldName, ifPrepared) {
        if (typeof (ifPrepared) === 'boolean') {
            body['prepared'] = ifPrepared;
        }
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.httpClient
                .put(this._documentUrl + `/${envelopeId}/fields/${fieldName}`, body).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            res => {
                return resolve(res);
            }));
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getPublicIp() {
        /** @type {?} */
        const apiUrl = 'https://api.ipify.org?format=jsonp';
        /** @type {?} */
        const callback = 'callback=JSONP_CALLBACK';
        return this.httpClient
            .jsonp(apiUrl, callback)
            .toPromise()
            .then((/**
         * @param {?} res
         * @return {?}
         */
        (res) => {
            return res['ip'];
        })).catch((/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            console.error('Failed to get ip', err);
            return 'ip_unavailable';
        }));
    }
    /**
     * *****************************
     * Move logic to public library *
     * *****************************
     * @param {?} envelope
     * @return {?}
     */
    // async zipEnvelopeDocs(envelope) {
    //   const zip = new jszip();
    //   const envelopeZipName = envelope.name + ' - ' + moment(envelope.updated_at).format('MM-DD-YY');
    //   await this.getEnvelopeDocBlob(envelope.id, envelope.envelope_document_id).toPromise().then(envelopeBlob => {
    //     zip.file(envelope.name + '.pdf', envelopeBlob, { compression: 'DEFLATE' });
    //   });
    //   if (this.hasCertificate(envelope)) {
    //     await this.getEnvelopeCertificateBlob(envelope.id).toPromise().then(envelopeCertificateBlob => {
    //       zip.file(envelope.name + '_certificate.pdf', envelopeCertificateBlob, { compression: 'DEFLATE' });
    //     });
    //   }
    //   const attachment = zip.folder('attachments');
    //   const fields = envelope.fields;
    //   let numOfAttachments = 0;
    //   for (let x = 0; x < fields.length; x++) {
    //     if (fields[x] && fields[x].type === 'attachment' && fields[x].settings['name']) {
    //       await this.downloadAttachment(fields[x]).toPromise().then(fileBlob => {
    //         attachment.file(fields[x].settings.name, fileBlob, { compression: 'DEFLATE' });
    //         numOfAttachments++;
    //       });
    //     }
    //   }
    //   if (numOfAttachments === 0) {
    //     zip.remove('attachments');
    //   }
    //   zip.generateAsync({ type: 'blob', compression: 'DEFLATE' }).then(content => {
    //     saveAs(content, envelopeZipName + '.zip');
    //   })
    // }
    sortRecipients(envelope) {
        if (envelope.recipients.length < 1) {
            return [];
        }
        /** @type {?} */
        const recipients = envelope.recipients.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            if (a.sequence === b.sequence) {
                return a.role_name < b.role_name ? -1 : a.role_name > b.role_name ? 1 : 0;
            }
            return b.sequence > a.sequence ? -1 : b.sequence < a.sequence ? 1 : 0;
        }));
        /** @type {?} */
        const signers = recipients.filter((/**
         * @param {?} recipient
         * @return {?}
         */
        recipient => {
            return recipient.type === 'signer';
        }));
        for (let x = 0; x < signers.length; x++) {
            /** @type {?} */
            const rIndex = findIndex(recipients, { sequence: signers[x].sequence, role_name: signers[x].role_name });
            if (rIndex >= 0) {
                recipients[rIndex]['rgba'] = getRGBA(x);
            }
        }
        return recipients;
    }
    /**
     * @param {?} name
     * @param {?=} index
     * @return {?}
     */
    getRecipientColor(name, index) {
        if (index) {
            return getRGBA(index);
        }
        else if (this.envelope && this.envelope.recipients && this.envelope.recipients.length > 0) {
            /** @type {?} */
            let index = findIndex(this.envelope.recipients, { role_name: name });
            if (index >= 0 && this.envelope.recipients[index].rgba) {
                return this.envelope.recipients[index].rgba;
            }
        }
        else {
            return nameToRGBA(name);
        }
    }
    // Check the logic
    /**
     * @return {?}
     */
    validateEnvelopeField() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (this.workingField.vName != null && this.workingField.value !== '') {
                /** @type {?} */
                const validators = yield this.validatorService.getValidatorsObject();
                return validators[this.workingField.vName].test(this.workingField.value) && this.satisfyRequired();
            }
            else {
                return this.satisfyRequired();
            }
        });
    }
    /**
     * @private
     * @return {?}
     */
    satisfyRequired() {
        if (!!this.workingField.required && this.workingField.type !== 'checkbox' && this.workingField.type !== 'timestamp') {
            return !!this.workingField.value;
        }
        return true;
    }
    /**
     * @param {?} fields
     * @return {?}
     */
    sortFields(fields) {
        fields = fields.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            return a.page - b.page;
        }));
        /** @type {?} */
        let previousDistance = null;
        fields = fields.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            /** @type {?} */
            let setting = 'settings';
            /** @type {?} */
            let distance = this.canBeSameRow(a, b).distance;
            /** @type {?} */
            let higherHeight = this.canBeSameRow(a, b).higherHeight;
            if (!a[setting]) {
                setting = 'setting';
            }
            if (a.page < b.page) {
                return -1;
            }
            if (a.page > b.page) {
                return 1;
            }
            /** @type {?} */
            const ax = a[setting].x;
            /** @type {?} */
            const bx = b[setting].x;
            /** @type {?} */
            const ay = a[setting].y;
            /** @type {?} */
            const by = b[setting].y;
            if (distance >= -3 && distance <= higherHeight) {
                previousDistance = previousDistance === null ? distance : distance < previousDistance ? distance : previousDistance;
                if (ax < bx) {
                    return -1;
                }
                else if (ax > bx) {
                    return 1;
                }
                else if (previousDistance >= distance) {
                    return -1;
                }
                else if (previousDistance <= distance) {
                    return 1;
                }
                return 0;
            }
            return b[setting].y - a[setting].y;
        }));
        return fields;
    }
    /**
     * @param {?} envelope
     * @return {?}
     */
    checkIfEnvelopeOwner(envelope) {
        /** @type {?} */
        const signer_token = this.vTokenStateService.getOtherCookie('signer_token');
        /** @type {?} */
        const profile = this.tokenObjectService.getProfile();
        if (signer_token && !profile) {
            return false;
        }
        else if (envelope) {
            /** @type {?} */
            const currentUserId = profile['id'];
            return currentUserId === envelope['profile_id'];
        }
    }
    /**
     * @private
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    canBeSameRow(a, b) {
        /** @type {?} */
        let setting = 'setting';
        if (!a[setting]) {
            setting = 'settings';
        }
        /** @type {?} */
        const aHeight = this.getHeight(a);
        /** @type {?} */
        const bHeight = this.getHeight(b);
        /** @type {?} */
        const aBottom = a[setting].y;
        /** @type {?} */
        const bBottom = b[setting].y;
        /** @type {?} */
        let top;
        /** @type {?} */
        let higherBottom;
        /** @type {?} */
        let higherHeight;
        if (aBottom < bBottom) {
            top = aHeight + aBottom;
            higherBottom = bBottom;
            higherHeight = bHeight;
        }
        else {
            top = bHeight + bBottom;
            higherBottom = aBottom;
            higherHeight = aHeight;
        }
        /** @type {?} */
        const distance = top - higherBottom;
        return { distance, higherHeight };
    }
    /**
     * @private
     * @param {?} field
     * @return {?}
     */
    getHeight(field) {
        /** @type {?} */
        let setting = 'setting';
        if (!field[setting]) {
            setting = 'settings';
        }
        /** @type {?} */
        let height = 0;
        switch (field.type) {
            case 'signature':
            case 'initial':
                height = 36;
                break;
            case 'checkbox':
                height = 13.5;
                break;
            case 'attachment':
            case 'payment':
                height = 24;
                break;
            default:
                height = field[setting]['height'] || 0;
                break;
        }
        return height;
    }
    /**
     * @param {?} envelope
     * @return {?}
     */
    hasCertificate(envelope) {
        return envelope.certificate_document_id || ['complete', 'canceled', 'declined'].indexOf(this.envelope.status) !== -1;
    }
}
DocumentsService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
DocumentsService.ctorParameters = () => [
    { type: HttpClient },
    { type: ValidatorService },
    { type: VerdocsTokenObjectService },
    { type: VerdocsStateService },
    { type: Injector },
    { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._config_token;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._currentFields;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._currEnvelope;
    /** @type {?} */
    DocumentsService.prototype.allEnvelopes;
    /** @type {?} */
    DocumentsService.prototype._currentExtendedEnvelope;
    /** @type {?} */
    DocumentsService.prototype._customFilterSubject;
    /** @type {?} */
    DocumentsService.prototype.currEnvelope$;
    /** @type {?} */
    DocumentsService.prototype.fieldsStream;
    /** @type {?} */
    DocumentsService.prototype.inProgressSubject;
    /** @type {?} */
    DocumentsService.prototype.envelopeData;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.currEnvelope;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.currRoleName;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._rForm_backend_url;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype._documentUrl;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.workingField;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.envelope;
    /** @type {?} */
    DocumentsService.prototype.validators;
    /** @type {?} */
    DocumentsService.prototype.toggleNextSubject;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.validatorService;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.tokenObjectService;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.vTokenStateService;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    DocumentsService.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL3Nkay8iLCJzb3VyY2VzIjpbImxpYi9kb2N1bWVudHMvZG9jdW1lbnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUcsTUFBTSxlQUFlLENBQUM7QUFDM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBYSxNQUFNLHNCQUFzQixDQUFDO0FBQ3JHLE9BQU8sRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQzFELE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUNuQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7O0FBS2pGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGVBQWUsRUFBYyxNQUFNLHVCQUF1QixDQUFDO0FBS3BFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUt2RCxNQUFNLE9BQU8sZ0JBQWdCOzs7Ozs7Ozs7SUFzQjNCLFlBQ1UsVUFBc0IsRUFDdEIsZ0JBQWtDLEVBQ2xDLGtCQUE2QyxFQUM3QyxrQkFBdUMsRUFDdkMsUUFBa0IsRUFDRyxRQUFRO1FBTDdCLGVBQVUsR0FBVixVQUFV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QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBJbmplY3QsIFBMQVRGT1JNX0lEICB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cFJlc3BvbnNlLCBIdHRwUmVxdWVzdCwgSHR0cEhlYWRlcnMsIEh0dHBFdmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgZW1wdHksIE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNvbmNhdE1hcCwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgZmluZEluZGV4IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGRpZmZlcmVuY2VCeSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLCBWZXJkb2NzU3RhdGVTZXJ2aWNlIH0gZnJvbSAnQHZlcmRvY3MvdG9rZW5zJztcbi8vIGltcG9ydCB7IHNhdmVBcyB9IGZyb20gJ2ZpbGUtc2F2ZXInO1xuLy8gaW1wb3J0ICogYXMganN6aXAgZnJvbSAnanN6aXAnO1xuLy8gaW1wb3J0ICogYXMgbW9tZW50IGZyb20gJ21vbWVudCc7XG5cbmltcG9ydCB7IFZhbGlkYXRvclNlcnZpY2UgfSBmcm9tICcuLi92YWxpZGF0b3JzL3ZhbGlkYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IGdldFJHQkEsIG5hbWVUb1JHQkEgfSBmcm9tICcuLi9mdW5jdGlvbnMvcmdiJztcbmltcG9ydCB7IFZTREtDb25maWdUb2tlbiwgVlNES0NvbmZpZyB9IGZyb20gJy4uL2FuZ3VsYXItYXBpLm1vZHVsZSc7XG5cbi8vIE1vZGVsc1xuaW1wb3J0IHsgSUVudmVsb3BlU2VhcmNoUGFyYW1zLCBEb2N1bWVudFNvcnRPcHRpb25zLCBJRW52ZWxvcGVTZWFyY2hSZXN1bHQgfSBmcm9tICcuLi9tb2RlbHMvZG9jdW1lbnRfc2VhcmNoLm1vZGVsJztcbmltcG9ydCB7IElUaW1lUGVyaW9kIH0gZnJvbSAnLi4vbW9kZWxzL3RpbWVfcGVyaW9kLm1vZGVsJztcbmltcG9ydCB7IEZpZWxkRGF0YSB9IGZyb20gJy4uL21vZGVscy9maWVsZC1kYXRhLm1vZGVsJztcbmltcG9ydCB7IElEb2N1bWVudCB9IGZyb20gJy4uL21vZGVscy9kb2N1bWVudC5tb2RlbCc7XG5pbXBvcnQgeyBJUmVjaXBpZW50IH0gZnJvbSAnLi4vbW9kZWxzL3JlY2lwaWVudC5tb2RlbCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEb2N1bWVudHNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBfY29uZmlnX3Rva2VuOiBWU0RLQ29uZmlnO1xuICBwcml2YXRlIF9jdXJyZW50RmllbGRzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnlbXT4oW10pO1xuICBwcml2YXRlIF9jdXJyRW52ZWxvcGUgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHN0cmluZz4oJycpO1xuICBwdWJsaWMgYWxsRW52ZWxvcGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxJRG9jdW1lbnRbXT4oW10pO1xuICBwdWJsaWMgX2N1cnJlbnRFeHRlbmRlZEVudmVsb3BlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHt9KTtcbiAgcHVibGljIF9jdXN0b21GaWx0ZXJTdWJqZWN0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHt9KTtcblxuICBwdWJsaWMgY3VyckVudmVsb3BlJCA9IHRoaXMuX2N1cnJFbnZlbG9wZS5hc09ic2VydmFibGUoKTtcbiAgcHVibGljIGZpZWxkc1N0cmVhbSA9IHRoaXMuX2N1cnJlbnRGaWVsZHMuYXNPYnNlcnZhYmxlKCk7XG4gIHB1YmxpYyBpblByb2dyZXNzU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuICBwdWJsaWMgZW52ZWxvcGVEYXRhOiBJRG9jdW1lbnQ7XG5cbiAgcHJpdmF0ZSBjdXJyRW52ZWxvcGU6IHN0cmluZztcbiAgcHJpdmF0ZSBjdXJyUm9sZU5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBfckZvcm1fYmFja2VuZF91cmw6IHN0cmluZztcbiAgcHJpdmF0ZSBfZG9jdW1lbnRVcmw6IHN0cmluZztcbiAgcHJpdmF0ZSB3b3JraW5nRmllbGQ6IEZpZWxkRGF0YTxhbnk+ID0gbmV3IEZpZWxkRGF0YSh7IG9yZGVyOiAwIH0pO1xuICBwcml2YXRlIGVudmVsb3BlOiBJRG9jdW1lbnQgPSBudWxsO1xuICBwdWJsaWMgdmFsaWRhdG9yczogYW55ID0ge307XG4gIHB1YmxpYyB0b2dnbGVOZXh0U3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIHZhbGlkYXRvclNlcnZpY2U6IFZhbGlkYXRvclNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0b2tlbk9iamVjdFNlcnZpY2U6IFZlcmRvY3NUb2tlbk9iamVjdFNlcnZpY2UsXG4gICAgcHJpdmF0ZSB2VG9rZW5TdGF0ZVNlcnZpY2U6IFZlcmRvY3NTdGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybVxuICApIHtcbiAgICB0aGlzLl9jb25maWdfdG9rZW4gPSB0aGlzLmluamVjdG9yLmdldChWU0RLQ29uZmlnVG9rZW4pO1xuICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsID0gdGhpcy5fY29uZmlnX3Rva2VuLnJGb3JtX2JhY2tlbmRfdXJsO1xuICAgIHRoaXMuX2RvY3VtZW50VXJsID0gYCR7dGhpcy5fckZvcm1fYmFja2VuZF91cmx9L2VudmVsb3Blc2BcbiAgfVxuXG4gIHB1YmxpYyBzZXRDdXJyZW50RW52ZWxvcGUoaWQpIHtcbiAgICB0aGlzLmN1cnJFbnZlbG9wZSA9IGlkO1xuICAgIHRoaXMuX2N1cnJFbnZlbG9wZS5uZXh0KGlkKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRFbnZEYXRhKGVudklkLCByb2xlSWQpIHtcbiAgICB0aGlzLmN1cnJFbnZlbG9wZSA9IGVudklkO1xuICAgIHRoaXMuY3VyclJvbGVOYW1lID0gcm9sZUlkO1xuICB9XG5cbiAgcHVibGljIHVwZGF0ZUVudmVsb3BlcyhlbnZlbG9wZXMpIHtcbiAgICB0aGlzLmFsbEVudmVsb3Blcy5uZXh0KGVudmVsb3Blcyk7XG4gIH1cblxuICBnZXQgcm9sZV9uYW1lKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJSb2xlTmFtZTtcbiAgfVxuXG4gIGdldCBlbnZfaWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VyckVudmVsb3BlO1xuICB9XG5cbiAgc2VuZEludml0ZShib2R5KTogT2JzZXJ2YWJsZTxJRG9jdW1lbnQgfCBuZXZlcj4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucG9zdCh0aGlzLl9kb2N1bWVudFVybCwgYm9keSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoXG4gICAgICAgICAgKGVudmVsb3BlOiBJRG9jdW1lbnQpID0+IGVudmVsb3BlLFxuICAgICAgICAgIGVyciA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZXJyO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgc2VuZERlbGVnYXRlKGVudmVsb3BlSWQsIHJvbGUpOiBPYnNlcnZhYmxlPElEb2N1bWVudCB8IG5ldmVyPiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wb3N0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L3JlY2lwaWVudHMvJHt0aGlzLmN1cnJSb2xlTmFtZX0vZGVsZWdhdGVgLCByb2xlKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgoZW52ZWxvcGU6IElEb2N1bWVudCkgPT4gZW52ZWxvcGUsIGVyciA9PiBlcnIpXG4gICAgICApO1xuICB9XG5cbiAgcmVzZW5kSW52aXRhdGlvbihlbnZlbG9wZUlkOiBzdHJpbmcsIHJvbGVOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnBvc3QodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52ZWxvcGVJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfS9yZXNlbmRfaW52aXRhdGlvbmAsIG51bGwpO1xuICB9XG5cbiAgZ2V0RW52ZWxvcGUoaWQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPElEb2N1bWVudD4ge1xuICAgIGNvbnN0IGVudmVsb3BlSWQgPSBpZCA/IGlkIDogdGhpcy5jdXJyRW52ZWxvcGU7XG4gICAgdGhpcy5zZXRDdXJyZW50RW52ZWxvcGUoZW52ZWxvcGVJZCk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52ZWxvcGVJZH1gKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCgoZW52ZWxvcGVFeHRlbmRlZCkgPT4ge1xuICAgICAgICAgIHRoaXMuZW52ZWxvcGUgPSA8SURvY3VtZW50PmVudmVsb3BlRXh0ZW5kZWQ7XG4gICAgICAgICAgdGhpcy5lbnZlbG9wZS5yZWNpcGllbnRzID0gdGhpcy5zb3J0UmVjaXBpZW50cyh0aGlzLmVudmVsb3BlKTtcbiAgICAgICAgICB0aGlzLl9jdXJyZW50RXh0ZW5kZWRFbnZlbG9wZS5uZXh0KHRoaXMuZW52ZWxvcGUpO1xuICAgICAgICAgIHRoaXMuZW52ZWxvcGVEYXRhID0gdGhpcy5lbnZlbG9wZTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5lbnZlbG9wZTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBnZXRBbGxFbnZlbG9wZXModGVtcGxhdGVJZD86IHN0cmluZykge1xuICAgIGNvbnN0IGVuZHBvaW50ID0gdGVtcGxhdGVJZCA/IHRoaXMuX2RvY3VtZW50VXJsICsgYD90ZW1wbGF0ZV9pZD0ke3RlbXBsYXRlSWR9YCA6IHRoaXMuX2RvY3VtZW50VXJsO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdChuZXcgSHR0cFJlcXVlc3QoXG4gICAgICAnR0VUJyxcbiAgICAgIGVuZHBvaW50LFxuICAgICAge30sXG4gICAgICB7XG4gICAgICAgIHJlcG9ydFByb2dyZXNzOiB0cnVlLFxuICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJ1xuICAgICAgfVxuICAgICkpLnBpcGUoXG4gICAgICBtYXAoZXZlbnQgPT4ge1xuICAgICAgICBpZiAoZXZlbnQgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2UpIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUVudmVsb3BlcyhldmVudC5ib2R5KTtcbiAgICAgICAgICByZXR1cm4gZXZlbnQgYXMgSHR0cFJlc3BvbnNlPGFueT5cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXZlbnQ7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBzZWFyY2hFbnZlbG9wZXMoc2VhcmNoUGFyYW1zOiBJRW52ZWxvcGVTZWFyY2hQYXJhbXMpOiBPYnNlcnZhYmxlPEh0dHBFdmVudDxhbnk+IHwgSUVudmVsb3BlU2VhcmNoUmVzdWx0PiB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gc2VhcmNoUGFyYW1zKSB7XG4gICAgICBpZiAoc2VhcmNoUGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgaWYgKHNlYXJjaFBhcmFtc1trZXldID09PSBudWxsKSB7XG4gICAgICAgICAgZGVsZXRlIHNlYXJjaFBhcmFtc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdChuZXcgSHR0cFJlcXVlc3QoXG4gICAgICAnUE9TVCcsXG4gICAgICB0aGlzLl9kb2N1bWVudFVybCArICcvc2VhcmNoJyxcbiAgICAgIHNlYXJjaFBhcmFtcyxcbiAgICAgIHtcbiAgICAgICAgcmVwb3J0UHJvZ3Jlc3M6IHRydWUsXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nXG4gICAgICB9XG4gICAgKSkucGlwZShcbiAgICAgIG1hcChldmVudCA9PiB7XG4gICAgICAgIGlmIChldmVudCBpbnN0YW5jZW9mIEh0dHBSZXNwb25zZSkge1xuICAgICAgICAgIHRoaXMudXBkYXRlRW52ZWxvcGVzKGV2ZW50LmJvZHkpO1xuICAgICAgICAgIHJldHVybiBldmVudCBhcyBIdHRwUmVzcG9uc2U8SUVudmVsb3BlU2VhcmNoUmVzdWx0PjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXZlbnQ7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZXRSZWNlbnRBY3Rpdml0aWVzKHBhZ2U/OiBudW1iZXIpIHtcbiAgICBjb25zdCBzZWFyY2hCb2R5ID0ge1xuICAgICAgc29ydF9ieTogJ3VwZGF0ZWRfYXQnIGFzIERvY3VtZW50U29ydE9wdGlvbnMsXG4gICAgICBhc2NlbmRpbmc6IGZhbHNlLFxuICAgICAgcm93OiA1LFxuICAgICAgcGFnZTogcGFnZSA/IHBhZ2UgOiAxXG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNlYXJjaEVudmVsb3BlcyhzZWFyY2hCb2R5KVxuICB9XG5cbiAgYXBwbHlDdXN0b21TZWFyY2goZmlsdGVyczogSUVudmVsb3BlU2VhcmNoUGFyYW1zLCBzZWFyY2hQYXJhbXMpIHtcbiAgICBpZiAoZmlsdGVyc1snZW52ZWxvcGVfc3RhdHVzJ10gJiYgIXNlYXJjaFBhcmFtc1snZW52ZWxvcGVfc3RhdHVzJ10pIHtcbiAgICAgIHNlYXJjaFBhcmFtc1snZW52ZWxvcGVfc3RhdHVzJ10gPSBmaWx0ZXJzWydlbnZlbG9wZV9zdGF0dXMnXVxuICAgIH1cbiAgICBpZiAoZmlsdGVyc1sndXBkYXRlZF9hdCddKSB7XG4gICAgICBpZiAoIXNlYXJjaFBhcmFtc1sndXBkYXRlZF9hdCddICYmICEhc2VhcmNoUGFyYW1zWydlbnZlbG9wZV9zdGF0dXMnXSkge1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ3VwZGF0ZWRfYXQnXSA9IGZpbHRlcnNbJ3VwZGF0ZWRfYXQnXVxuICAgICAgfSBlbHNlIGlmICghc2VhcmNoUGFyYW1zWydlbnZlbG9wZV9zdGF0dXMnXSkge1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ2NyZWF0ZWRfYXQnXSA9IGZpbHRlcnNbJ3VwZGF0ZWRfYXQnXVxuICAgICAgICBpZiAoIXNlYXJjaFBhcmFtc1snc29ydF9ieSddKSB7XG4gICAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSAnY3JlYXRlZF9hdCcgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZmlsdGVyc1sncmVjaXBpZW50X25hbWUnXSkge1xuICAgICAgc2VhcmNoUGFyYW1zWydyZWNpcGllbnRfbmFtZSddID0gZmlsdGVyc1sncmVjaXBpZW50X25hbWUnXVxuICAgIH1cbiAgICBpZiAoZmlsdGVyc1snZW52ZWxvcGVfbmFtZSddKSB7XG4gICAgICBzZWFyY2hQYXJhbXNbJ2VudmVsb3BlX25hbWUnXSA9IGZpbHRlcnNbJ2VudmVsb3BlX25hbWUnXVxuICAgIH1cbiAgICBpZiAoZmlsdGVyc1sncmVjaXBpZW50X2VtYWlsJ10pIHtcbiAgICAgIHNlYXJjaFBhcmFtc1sncmVjaXBpZW50X2VtYWlsJ10gPSBmaWx0ZXJzWydyZWNpcGllbnRfZW1haWwnXVxuICAgIH1cbiAgICBpZiAoZmlsdGVyc1sndGV4dF9maWVsZF92YWx1ZSddKSB7XG4gICAgICBzZWFyY2hQYXJhbXNbJ3RleHRfZmllbGRfdmFsdWUnXSA9IGZpbHRlcnNbJ3RleHRfZmllbGRfdmFsdWUnXVxuICAgIH1cbiAgICByZXR1cm4gc2VhcmNoUGFyYW1zO1xuICB9XG5cbiAgZmlsdGVyU2VhcmNoQnkodHlwZTogc3RyaW5nLCBhc2NlbmRpbmc/OiBib29sZWFuLCByb3c/OiBudW1iZXIsIHBhZ2U/OiBudW1iZXIsIGZpbHRlclRpbWU/OiBJVGltZVBlcmlvZCwgc29ydEJ5PzogRG9jdW1lbnRTb3J0T3B0aW9ucywgY3VzdG9tRmlsdGVycz86IElFbnZlbG9wZVNlYXJjaFBhcmFtcykge1xuICAgIGxldCBzZWFyY2hQYXJhbXMgPSB7XG4gICAgICBhc2NlbmRpbmc6IGFzY2VuZGluZyB8fCBmYWxzZSxcbiAgICAgIHJvdzogcm93IHx8IDEwLFxuICAgICAgcGFnZTogcGFnZSB8fCAxXG4gICAgfVxuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdhY3Rpb25fcmVxdWlyZWQnOlxuICAgICAgICBzZWFyY2hQYXJhbXNbJ2lzX3JlY2lwaWVudCddID0gdHJ1ZTtcbiAgICAgICAgc2VhcmNoUGFyYW1zWydyZWNpcGllbnRfc3RhdHVzJ10gPSBbJ2ludml0ZWQnLCAnb3BlbmVkJywgJ3NpZ25lZCddO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ2VudmVsb3BlX3N0YXR1cyddID0gWydwZW5kaW5nJywgJ2luIHByb2dyZXNzJ107XG4gICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gc29ydEJ5IGFzIERvY3VtZW50U29ydE9wdGlvbnM7XG4gICAgICAgIGlmIChmaWx0ZXJUaW1lKSB7XG4gICAgICAgICAgc2VhcmNoUGFyYW1zWyd1cGRhdGVkX2F0J10gPSBmaWx0ZXJUaW1lO1xuICAgICAgICAgIGlmICghc29ydEJ5KSB7XG4gICAgICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9ICd1cGRhdGVkX2F0JyBhcyBEb2N1bWVudFNvcnRPcHRpb25zO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3dhaXRpbmdfb25fb3RoZXJzJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0V2FpdGluZ09uT3RoZXJzKGFzY2VuZGluZywgcm93LCBwYWdlLCBmaWx0ZXJUaW1lLCBzb3J0QnksIGN1c3RvbUZpbHRlcnMpO1xuICAgICAgY2FzZSAnd2FpdGluZ19vbl9vdGhlcnNfdW5maWx0ZXJlZCc6XG4gICAgICAgIHNlYXJjaFBhcmFtc1snaXNfb3duZXInXSA9IHRydWU7XG4gICAgICAgIHNlYXJjaFBhcmFtc1snZW52ZWxvcGVfc3RhdHVzJ10gPSBbJ3BlbmRpbmcnLCAnaW4gcHJvZ3Jlc3MnXTtcbiAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSBzb3J0QnkgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucyB8fCBudWxsO1xuICAgICAgICBpZiAoZmlsdGVyVGltZSkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtc1sndXBkYXRlZF9hdCddID0gZmlsdGVyVGltZTtcbiAgICAgICAgICBpZiAoIXNvcnRCeSkge1xuICAgICAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSAndXBkYXRlZF9hdCcgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdpbmJveCc6XG4gICAgICAgIHNlYXJjaFBhcmFtc1snaXNfcmVjaXBpZW50J10gPSB0cnVlO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ3JlY2lwaWVudF9zdGF0dXMnXSA9IFsnaW52aXRlZCcsICdkZWNsaW5lZCcsICdvcGVuZWQnLCAnc2lnbmVkJywgJ3N1Ym1pdHRlZCcsICdjYW5jZWxlZCddO1xuICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9IHNvcnRCeSBhcyBEb2N1bWVudFNvcnRPcHRpb25zIHx8IG51bGw7XG4gICAgICAgIGlmIChmaWx0ZXJUaW1lKSB7XG4gICAgICAgICAgc2VhcmNoUGFyYW1zWydjcmVhdGVkX2F0J10gPSBmaWx0ZXJUaW1lO1xuICAgICAgICAgIGlmICghc29ydEJ5KSB7XG4gICAgICAgICAgICBzZWFyY2hQYXJhbXNbJ3NvcnRfYnknXSA9ICdjcmVhdGVkX2F0JyBhcyBEb2N1bWVudFNvcnRPcHRpb25zO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NvbXBsZXRlZCc6XG4gICAgICAgIHNlYXJjaFBhcmFtc1snZW52ZWxvcGVfc3RhdHVzJ10gPSBbJ2NvbXBsZXRlJ107XG4gICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gc29ydEJ5IGFzIERvY3VtZW50U29ydE9wdGlvbnMgfHwgbnVsbDtcbiAgICAgICAgaWYgKGZpbHRlclRpbWUpIHtcbiAgICAgICAgICBzZWFyY2hQYXJhbXNbJ3VwZGF0ZWRfYXQnXSA9IGZpbHRlclRpbWU7XG4gICAgICAgICAgaWYgKCFzb3J0QnkpIHtcbiAgICAgICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gJ3VwZGF0ZWRfYXQnIGFzIERvY3VtZW50U29ydE9wdGlvbnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2VudCc6XG4gICAgICAgIHNlYXJjaFBhcmFtc1snaXNfb3duZXInXSA9IHRydWU7XG4gICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gc29ydEJ5IGFzIERvY3VtZW50U29ydE9wdGlvbnMgfHwgbnVsbDtcbiAgICAgICAgaWYgKGZpbHRlclRpbWUpIHtcbiAgICAgICAgICBzZWFyY2hQYXJhbXNbJ2NyZWF0ZWRfYXQnXSA9IGZpbHRlclRpbWU7XG4gICAgICAgICAgaWYgKCFzb3J0QnkpIHtcbiAgICAgICAgICAgIHNlYXJjaFBhcmFtc1snc29ydF9ieSddID0gJ2NyZWF0ZWRfYXQnIGFzIERvY3VtZW50U29ydE9wdGlvbnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYWxsJzpcbiAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSBzb3J0QnkgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucyB8fCBudWxsO1xuICAgICAgICBpZiAoZmlsdGVyVGltZSkge1xuICAgICAgICAgIHNlYXJjaFBhcmFtc1snY3JlYXRlZF9hdCddID0gZmlsdGVyVGltZTtcbiAgICAgICAgICBpZiAoIXNvcnRCeSkge1xuICAgICAgICAgICAgc2VhcmNoUGFyYW1zWydzb3J0X2J5J10gPSAnY3JlYXRlZF9hdCcgYXMgRG9jdW1lbnRTb3J0T3B0aW9ucztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBpZiAoISFjdXN0b21GaWx0ZXJzKSB7XG4gICAgICBzZWFyY2hQYXJhbXMgPSB0aGlzLmFwcGx5Q3VzdG9tU2VhcmNoKGN1c3RvbUZpbHRlcnMsIHsgLi4uc2VhcmNoUGFyYW1zIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zZWFyY2hFbnZlbG9wZXMoc2VhcmNoUGFyYW1zKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRXYWl0aW5nT25PdGhlcnMoYXNjZW5kaW5nPzogYm9vbGVhbiwgcm93PzogbnVtYmVyLCBwYWdlPzogbnVtYmVyLCBmaWx0ZXJUaW1lPzogSVRpbWVQZXJpb2QsIHNvcnRCeT86IERvY3VtZW50U29ydE9wdGlvbnMsIGN1c3RvbUZpbHRlcnM/OiBJRW52ZWxvcGVTZWFyY2hQYXJhbXMpIHtcbiAgICBsZXQgYWN0aW9uUmVxdWlyZWRFbnZlbG9wZXMgPSBudWxsO1xuICAgIHJldHVybiB0aGlzLmZpbHRlclNlYXJjaEJ5KCdhY3Rpb25fcmVxdWlyZWQnLCBhc2NlbmRpbmcsIHJvdywgcGFnZSwgZmlsdGVyVGltZSwgc29ydEJ5LCBjdXN0b21GaWx0ZXJzKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGNvbmNhdE1hcCgocmVzKSA9PiB7XG4gICAgICAgICAgaWYgKHJlcyBpbnN0YW5jZW9mIEh0dHBSZXNwb25zZSkge1xuICAgICAgICAgICAgYWN0aW9uUmVxdWlyZWRFbnZlbG9wZXMgPSByZXMuYm9keVsncmVzdWx0J107XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJTZWFyY2hCeSgnd2FpdGluZ19vbl9vdGhlcnNfdW5maWx0ZXJlZCcsIGFzY2VuZGluZywgcm93LCBwYWdlLCBmaWx0ZXJUaW1lLCBzb3J0QnksIGN1c3RvbUZpbHRlcnMpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIG1hcCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBpZiAocmVzcG9uc2UgaW5zdGFuY2VvZiBIdHRwUmVzcG9uc2UgJiYgYWN0aW9uUmVxdWlyZWRFbnZlbG9wZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHVuZmlsdGVyZWRXYWl0aW5nT25PdGhlcnMgPSByZXNwb25zZVsnYm9keSddWydyZXN1bHQnXTtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkV2FpdGluZ09uT3RoZXJzID0gZGlmZmVyZW5jZUJ5KHVuZmlsdGVyZWRXYWl0aW5nT25PdGhlcnMsIGFjdGlvblJlcXVpcmVkRW52ZWxvcGVzLCAnaWQnKTtcbiAgICAgICAgICAgIHJlc3BvbnNlLmJvZHlbJ3Jlc3VsdCddID0gZmlsdGVyZWRXYWl0aW5nT25PdGhlcnM7XG4gICAgICAgICAgICByZXNwb25zZS5ib2R5Wyd0b3RhbCddID0gZmlsdGVyZWRXYWl0aW5nT25PdGhlcnMubGVuZ3RoO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0pXG4gICAgICApXG4gIH1cblxuICBnZXRFbnZlbG9wZU93bmVySW5mbyhlbnZJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52SWR9P293bmVyX2luZm89dHJ1ZWApLnBpcGUoXG4gICAgICBtYXAocmVzID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGdldEVudmVsb3BlRG9jVXJsKGVudklkOiBzdHJpbmcsIGRvY0lkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCh0aGlzLl9kb2N1bWVudFVybCArIGAvJHtlbnZJZH0vZW52ZWxvcGVfZG9jdW1lbnRzLyR7ZG9jSWR9P2ZpbGU9dHJ1ZWAsXG4gICAgICB7IHJlc3BvbnNlVHlwZTogJ2Jsb2InIH0pXG4gICAgICAucGlwZShcbiAgICAgICAgbWFwKHJlcyA9PiB7XG4gICAgICAgICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICAgICAgICBjb25zdCB1cmxDcmVhdG9yID0gd2luZG93LlVSTDtcbiAgICAgICAgICAgIGNvbnN0IHBkZlVybCA9IHVybENyZWF0b3IuY3JlYXRlT2JqZWN0VVJMKHJlcyk7XG4gICAgICAgICAgICByZXR1cm4gcGRmVXJsO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICAvLyB1c2UgYSBzbmFja0Jhci9lcnJvci5zZXJ2aWNlXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIGdldEVudmVsb3BlUGRmV2l0aFByb2dyZXNzKGVudmVsb3BlSWQ6IHN0cmluZywgZG9jdW1lbnRJZDogc3RyaW5nKSB7XG4gICAgY29uc3QgcmVxdWVzdFVybCA9IHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L2VudmVsb3BlX2RvY3VtZW50cy8ke2RvY3VtZW50SWR9P2ZpbGU9dHJ1ZWA7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0KG5ldyBIdHRwUmVxdWVzdChcbiAgICAgICdHRVQnLFxuICAgICAgcmVxdWVzdFVybCxcbiAgICAgIHt9LFxuICAgICAgeyByZXBvcnRQcm9ncmVzczogdHJ1ZSwgcmVzcG9uc2VUeXBlOiAnYmxvYicgfVxuICAgICkpLnBpcGUoXG4gICAgICBtYXAoZXZlbnQgPT4gZXZlbnQpXG4gICAgKTtcbiAgfVxuXG4gIGdldEVudmVsb3BlRG9jQmxvYihlbnZJZDogc3RyaW5nLCBkb2NJZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52SWR9L2VudmVsb3BlX2RvY3VtZW50cy8ke2RvY0lkfT9maWxlPXRydWVgLFxuICAgICAgeyByZXNwb25zZVR5cGU6ICdibG9iJyB9KVxuICAgICAgLnBpcGUobWFwKGZpbGUgPT4ge1xuICAgICAgICByZXR1cm4gZmlsZTtcbiAgICAgIH0pKTtcbiAgfVxuXG4gIGdldEVudmVsb3BlQ2VydGlmaWNhdGVCbG9iKGVudklkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCh0aGlzLl9kb2N1bWVudFVybCArIGAvJHtlbnZJZH0/Y2VydGlmaWNhdGVfZmlsZT10cnVlYCxcbiAgICAgIHsgcmVzcG9uc2VUeXBlOiAnYmxvYicgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoZmlsZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZpbGU7XG4gICAgICAgIH0pXG4gICAgICApO1xuICB9XG5cbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIE1vdmUgbG9naWMgdG8gcHVibGljIGxpYnJhcnkgKlxuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvLyBkb3dubG9hZEVudmVsb3BlKGVudmVsb3BlKSB7XG4gIC8vICAgdGhpcy5nZXRFbnZlbG9wZURvY0Jsb2IoZW52ZWxvcGUuaWQsIGVudmVsb3BlLmVudmVsb3BlX2RvY3VtZW50X2lkKS50b1Byb21pc2UoKS50aGVuKHBkZkJsb2IgPT4ge1xuICAvLyAgICAgc2F2ZUFzKHBkZkJsb2IsIGVudmVsb3BlLm5hbWUgKyAnLScgKyBtb21lbnQoZW52ZWxvcGUudXBkYXRlZF9hdCkuZm9ybWF0KCdNTS1ERC1ZWScpICsgJy5wZGYnKTtcbiAgLy8gICB9KTtcbiAgLy8gfVxuXG4gIC8vIGRvd25sb2FkRW52ZWxvcGVDZXJ0aWZpY2F0ZShlbnZlbG9wZSkge1xuICAvLyAgIHRoaXMuZ2V0RW52ZWxvcGVDZXJ0aWZpY2F0ZUJsb2IoZW52ZWxvcGUuaWQpLnRvUHJvbWlzZSgpLnRoZW4ocGRmQmxvYiA9PiB7XG4gIC8vICAgICBpZiAocGRmQmxvYikge1xuICAvLyAgICAgICBzYXZlQXMocGRmQmxvYiwgYCR7ZW52ZWxvcGUubmFtZX1fY2VydGlmaWNhdGUucGRmYCk7XG4gIC8vICAgICB9XG4gIC8vICAgfSk7XG4gIC8vIH1cblxuICBnZXRUZW1wbGF0ZURvYyh0ZW1wbGF0ZUlkOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcsIGZpbGU6IGJvb2xlYW4pIHtcbiAgICBjb25zdCByZXF1ZXN0VXJsID0gdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2xpdmV2aWV3LyR7dGVtcGxhdGVJZH0vdG9rZW4vJHt0b2tlbn1gO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KHJlcXVlc3RVcmwsIHsgcmVzcG9uc2VUeXBlOiAnanNvbicgfSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtYXAoKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfSwgZXJyID0+IHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBnZXRUZW1wbGF0ZVBERih0ZW1wbGF0ZUlkOiBzdHJpbmcsIHRva2VuOiBzdHJpbmcpIHtcbiAgICBjb25zdCByZXF1ZXN0VXJsID0gdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2xpdmV2aWV3LyR7dGVtcGxhdGVJZH0vdG9rZW4vJHt0b2tlbn0/ZmlsZT10cnVlYDtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QobmV3IEh0dHBSZXF1ZXN0KFxuICAgICAgJ0dFVCcsXG4gICAgICByZXF1ZXN0VXJsLFxuICAgICAge30sXG4gICAgICB7IHJlcG9ydFByb2dyZXNzOiB0cnVlLCByZXNwb25zZVR5cGU6ICdibG9iJyB9XG4gICAgKSkucGlwZShcbiAgICAgIG1hcChldmVudCA9PiB7XG4gICAgICAgIHJldHVybiBldmVudDtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGNhbmNlbEVudmVsb3BlKGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dCh0aGlzLl9kb2N1bWVudFVybCArIGAvJHtpZH1gLCB7IGFjdGlvbjogJ2NhbmNlbCcgfSwgeyByZXNwb25zZVR5cGU6ICdqc29uJyB9KVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcChlbnZlbG9wZURhdGEgPT4gZW52ZWxvcGVEYXRhLCBlcnIgPT4gZXJyKVxuICAgICAgKTtcbiAgfVxuXG4gIHN1Ym1pdEVudmVsb3BlKGVudklkOiBzdHJpbmcsIHJvbGVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPElSZWNpcGllbnQ+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dChcbiAgICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZJZH0vcmVjaXBpZW50cy8ke3JvbGVOYW1lfWAsXG4gICAgICB7IGFjdGlvbjogJ3N1Ym1pdCcgfVxuICAgICkucGlwZShcbiAgICAgIG1hcCgocmVzOiBJUmVjaXBpZW50KSA9PiB7XG4gICAgICAgIHJldHVybiByZXNcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGRlY2xpbmVFbnZlbG9wZShlbnZJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxJUmVjaXBpZW50PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQoXG4gICAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArIGAvZW52ZWxvcGVzLyR7ZW52SWR9L3JlY2lwaWVudHMvJHtyb2xlTmFtZX1gLFxuICAgICAgeyBhY3Rpb246ICdkZWNsaW5lJyB9XG4gICAgKS5waXBlKFxuICAgICAgbWFwKChyZXM6IElSZWNpcGllbnQpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG5cbiAgdXBsb2FkQXR0YWNobWVudChlbnZlbG9wZUlkLCBmaWxlOiBGaWxlLCBmaWVsZE5hbWUpIHtcbiAgICBsZXQgcmVxO1xuICAgIGlmIChmaWxlKSB7XG4gICAgICBjb25zdCBmb3JtZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgZm9ybWRhdGEuYXBwZW5kKCdkb2N1bWVudCcsIGZpbGUsIGZpbGUubmFtZSk7XG4gICAgICByZXEgPSBuZXcgSHR0cFJlcXVlc3QoJ1BVVCcsIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgJy9lbnZlbG9wZXMvJyArIGVudmVsb3BlSWQgK1xuICAgICAgICAnL2ZpZWxkcy8nICsgZmllbGROYW1lLCBmb3JtZGF0YSwge1xuICAgICAgICByZXBvcnRQcm9ncmVzczogdHJ1ZVxuICAgICAgfSlcbiAgICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdChyZXEpLnBpcGUoXG4gICAgICAgIG1hcChyZXMgPT4gcmVzKVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBkb3dubG9hZEF0dGFjaG1lbnQoZmllbGQpIHtcbiAgICBjb25zdCBoZWFkZXIgPSBuZXcgSHR0cEhlYWRlcnMoKS5zZXQoJ2NvbnRlbnQtdHlwZScsIGZpZWxkLnNldHRpbmdzLnR5cGUpO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgJy9lbnZlbG9wZXMvJyArIGZpZWxkLmVudmVsb3BlX2lkICtcbiAgICAgICcvZmllbGRzLycgKyBmaWVsZC5uYW1lICsgJy9kb2N1bWVudCcsIHsgaGVhZGVyczogaGVhZGVyLCByZXNwb25zZVR5cGU6ICdibG9iJyB9KVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcChmaWxlID0+IHtcbiAgICAgICAgICByZXR1cm4gZmlsZTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gIH1cblxuICBnZXRBdHRhY2htZW50RGF0YUJ5UmVjaXBpZW50cyhlbnZlbG9wZSkge1xuICAgIGNvbnN0IHJlY2lwaWVudHMgPSBlbnZlbG9wZVsncmVjaXBpZW50cyddO1xuICAgIGlmIChyZWNpcGllbnRzICYmIHJlY2lwaWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgYXR0YWNobWVudHMgPSBbXVxuICAgICAgZm9yIChjb25zdCByZWNpcGllbnQgb2YgcmVjaXBpZW50cykge1xuICAgICAgICBpZiAocmVjaXBpZW50LmZpZWxkcyAmJiByZWNpcGllbnQuZmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIHJlY2lwaWVudC5maWVsZHMpIHtcbiAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnYXR0YWNobWVudCcgJiYgISFmaWVsZC5zZXR0aW5ncy51cmwpIHtcbiAgICAgICAgICAgICAgYXR0YWNobWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgcmVjaXBpZW50OiByZWNpcGllbnQuZnVsbF9uYW1lLFxuICAgICAgICAgICAgICAgIGZpZWxkT2JqZWN0OiBmaWVsZFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBhdHRhY2htZW50cztcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgLyoqKioqKioqKioqKioqKioqXG4gICAqIFNpZ25hdHVyZSBBUEkgKlxuICAgKioqKioqKioqKioqKioqKi9cblxuICBwb3N0U2lnbmF0dXJlQmxvYihzaWduYXR1cmVCbG9iOiBCbG9iKSB7XG4gICAgY29uc3QgYmxvYkZpbGUgPSBzaWduYXR1cmVCbG9iO1xuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdzaWduYXR1cmUnLCBibG9iRmlsZSwgYmxvYkZpbGVbJ25hbWUnXSk7XG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdCgnUE9TVCcsIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgJy9zaWduYXR1cmVzJywgZm9ybURhdGEpO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucmVxdWVzdChyZXF1ZXN0KVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZVsnYm9keSddKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWydib2R5J107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwbG9hZCBzaWduYXR1cmUgaW1hZ2UnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBwb3N0SW5pdGlhbEJsb2IoaW5pdGlhbEJsb2IpIHtcbiAgICBjb25zdCBibG9iRmlsZSA9IGluaXRpYWxCbG9iO1xuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdpbml0aWFsJywgYmxvYkZpbGUsIGJsb2JGaWxlWyduYW1lJ10pO1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3QoJ1BPU1QnLCB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArICcvaW5pdGlhbHMnLCBmb3JtRGF0YSk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0KHJlcXVlc3QpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlWydib2R5J10pIHtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbJ2JvZHknXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdXBsb2FkIEluaXRpYWwnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBwdXRTaWduYXR1cmVGaWVsZChlbnZlbG9wZUlkLCBmaWVsZE5hbWUsIHNpZ25hdHVyZUlkKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgaXBBZGRyZXNzID0gYXdhaXQgdGhpcy5nZXRQdWJsaWNJcCgpO1xuICAgICAgdGhpcy5odHRwQ2xpZW50XG4gICAgICAgIC5wdXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52ZWxvcGVJZH0vZmllbGRzLyR7ZmllbGROYW1lfS9zaWduYXR1cmUvJHtzaWduYXR1cmVJZH1gLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlwX2FkZHJlc3M6IGlwQWRkcmVzc1xuICAgICAgICAgIH1cbiAgICAgICAgKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIHB1dEluaXRpYWxGaWVsZChlbnZlbG9wZUlkLCBmaWVsZE5hbWUsIGluaXRpYWxJZCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGlwQWRkcmVzcyA9IGF3YWl0IHRoaXMuZ2V0UHVibGljSXAoKTtcbiAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAucHV0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L2ZpZWxkcy8ke2ZpZWxkTmFtZX0vaW5pdGlhbC8ke2luaXRpYWxJZH1gLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlwX2FkZHJlc3M6IGlwQWRkcmVzc1xuICAgICAgICAgIH1cbiAgICAgICAgKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIHB1dEVudmVsb3BlRmllbGQoZW52ZWxvcGVJZCwgcmVzdWx0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwQ2xpZW50XG4gICAgICAgIC5wdXQodGhpcy5fZG9jdW1lbnRVcmwgKyBgLyR7ZW52ZWxvcGVJZH0vZmllbGRzLyR7dGhpcy53b3JraW5nRmllbGQuZk5hbWV9YCxcbiAgICAgICAgICByZXN1bHRcbiAgICAgICAgKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUdyb3VwZWRGaWVsZChlbnZlbG9wZUlkLCBib2R5LCBmaWVsZE5hbWUsIGlmUHJlcGFyZWQ/OiBib29sZWFuKSB7XG4gICAgaWYgKHR5cGVvZiAoaWZQcmVwYXJlZCkgPT09ICdib29sZWFuJykge1xuICAgICAgYm9keVsncHJlcGFyZWQnXSA9IGlmUHJlcGFyZWQ7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAucHV0KHRoaXMuX2RvY3VtZW50VXJsICsgYC8ke2VudmVsb3BlSWR9L2ZpZWxkcy8ke2ZpZWxkTmFtZX1gLFxuICAgICAgICAgIGJvZHlcbiAgICAgICAgKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UHVibGljSXAoKSB7XG4gICAgY29uc3QgYXBpVXJsID0gJ2h0dHBzOi8vYXBpLmlwaWZ5Lm9yZz9mb3JtYXQ9anNvbnAnO1xuICAgIGNvbnN0IGNhbGxiYWNrID0gJ2NhbGxiYWNrPUpTT05QX0NBTExCQUNLJztcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50XG4gICAgICAuanNvbnAoYXBpVXJsLCBjYWxsYmFjaylcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICByZXR1cm4gcmVzWydpcCddXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgaXAnLCBlcnIpXG4gICAgICAgIHJldHVybiAnaXBfdW5hdmFpbGFibGUnXG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBNb3ZlIGxvZ2ljIHRvIHB1YmxpYyBsaWJyYXJ5ICpcbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiAgLy8gYXN5bmMgemlwRW52ZWxvcGVEb2NzKGVudmVsb3BlKSB7XG4gIC8vICAgY29uc3QgemlwID0gbmV3IGpzemlwKCk7XG4gIC8vICAgY29uc3QgZW52ZWxvcGVaaXBOYW1lID0gZW52ZWxvcGUubmFtZSArICcgLSAnICsgbW9tZW50KGVudmVsb3BlLnVwZGF0ZWRfYXQpLmZvcm1hdCgnTU0tREQtWVknKTtcblxuICAvLyAgIGF3YWl0IHRoaXMuZ2V0RW52ZWxvcGVEb2NCbG9iKGVudmVsb3BlLmlkLCBlbnZlbG9wZS5lbnZlbG9wZV9kb2N1bWVudF9pZCkudG9Qcm9taXNlKCkudGhlbihlbnZlbG9wZUJsb2IgPT4ge1xuICAvLyAgICAgemlwLmZpbGUoZW52ZWxvcGUubmFtZSArICcucGRmJywgZW52ZWxvcGVCbG9iLCB7IGNvbXByZXNzaW9uOiAnREVGTEFURScgfSk7XG4gIC8vICAgfSk7XG5cbiAgLy8gICBpZiAodGhpcy5oYXNDZXJ0aWZpY2F0ZShlbnZlbG9wZSkpIHtcbiAgLy8gICAgIGF3YWl0IHRoaXMuZ2V0RW52ZWxvcGVDZXJ0aWZpY2F0ZUJsb2IoZW52ZWxvcGUuaWQpLnRvUHJvbWlzZSgpLnRoZW4oZW52ZWxvcGVDZXJ0aWZpY2F0ZUJsb2IgPT4ge1xuICAvLyAgICAgICB6aXAuZmlsZShlbnZlbG9wZS5uYW1lICsgJ19jZXJ0aWZpY2F0ZS5wZGYnLCBlbnZlbG9wZUNlcnRpZmljYXRlQmxvYiwgeyBjb21wcmVzc2lvbjogJ0RFRkxBVEUnIH0pO1xuICAvLyAgICAgfSk7XG4gIC8vICAgfVxuXG4gIC8vICAgY29uc3QgYXR0YWNobWVudCA9IHppcC5mb2xkZXIoJ2F0dGFjaG1lbnRzJyk7XG4gIC8vICAgY29uc3QgZmllbGRzID0gZW52ZWxvcGUuZmllbGRzO1xuICAvLyAgIGxldCBudW1PZkF0dGFjaG1lbnRzID0gMDtcbiAgLy8gICBmb3IgKGxldCB4ID0gMDsgeCA8IGZpZWxkcy5sZW5ndGg7IHgrKykge1xuICAvLyAgICAgaWYgKGZpZWxkc1t4XSAmJiBmaWVsZHNbeF0udHlwZSA9PT0gJ2F0dGFjaG1lbnQnICYmIGZpZWxkc1t4XS5zZXR0aW5nc1snbmFtZSddKSB7XG4gIC8vICAgICAgIGF3YWl0IHRoaXMuZG93bmxvYWRBdHRhY2htZW50KGZpZWxkc1t4XSkudG9Qcm9taXNlKCkudGhlbihmaWxlQmxvYiA9PiB7XG4gIC8vICAgICAgICAgYXR0YWNobWVudC5maWxlKGZpZWxkc1t4XS5zZXR0aW5ncy5uYW1lLCBmaWxlQmxvYiwgeyBjb21wcmVzc2lvbjogJ0RFRkxBVEUnIH0pO1xuICAvLyAgICAgICAgIG51bU9mQXR0YWNobWVudHMrKztcbiAgLy8gICAgICAgfSk7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIGlmIChudW1PZkF0dGFjaG1lbnRzID09PSAwKSB7XG4gIC8vICAgICB6aXAucmVtb3ZlKCdhdHRhY2htZW50cycpO1xuICAvLyAgIH1cbiAgLy8gICB6aXAuZ2VuZXJhdGVBc3luYyh7IHR5cGU6ICdibG9iJywgY29tcHJlc3Npb246ICdERUZMQVRFJyB9KS50aGVuKGNvbnRlbnQgPT4ge1xuICAvLyAgICAgc2F2ZUFzKGNvbnRlbnQsIGVudmVsb3BlWmlwTmFtZSArICcuemlwJyk7XG4gIC8vICAgfSlcbiAgLy8gfVxuXG4gIHNvcnRSZWNpcGllbnRzKGVudmVsb3BlOiBJRG9jdW1lbnQpIHtcbiAgICBpZiAoZW52ZWxvcGUucmVjaXBpZW50cy5sZW5ndGggPCAxKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgcmVjaXBpZW50cyA9IGVudmVsb3BlLnJlY2lwaWVudHMuc29ydCgoYTogSVJlY2lwaWVudCwgYjogSVJlY2lwaWVudCkgPT4ge1xuICAgICAgaWYgKGEuc2VxdWVuY2UgPT09IGIuc2VxdWVuY2UpIHtcbiAgICAgICAgcmV0dXJuIGEucm9sZV9uYW1lIDwgYi5yb2xlX25hbWUgPyAtMSA6IGEucm9sZV9uYW1lID4gYi5yb2xlX25hbWUgPyAxIDogMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiLnNlcXVlbmNlID4gYS5zZXF1ZW5jZSA/IC0xIDogYi5zZXF1ZW5jZSA8IGEuc2VxdWVuY2UgPyAxIDogMDtcbiAgICB9KTtcblxuICAgIGNvbnN0IHNpZ25lcnMgPSByZWNpcGllbnRzLmZpbHRlcihyZWNpcGllbnQgPT4ge1xuICAgICAgcmV0dXJuIHJlY2lwaWVudC50eXBlID09PSAnc2lnbmVyJztcbiAgICB9KTtcblxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgc2lnbmVycy5sZW5ndGg7IHgrKykge1xuICAgICAgY29uc3QgckluZGV4ID0gZmluZEluZGV4KHJlY2lwaWVudHMsIHsgc2VxdWVuY2U6IHNpZ25lcnNbeF0uc2VxdWVuY2UsIHJvbGVfbmFtZTogc2lnbmVyc1t4XS5yb2xlX25hbWUgfSk7XG4gICAgICBpZiAockluZGV4ID49IDApIHtcbiAgICAgICAgcmVjaXBpZW50c1tySW5kZXhdWydyZ2JhJ10gPSBnZXRSR0JBKHgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZWNpcGllbnRzO1xuICB9XG5cbiAgZ2V0UmVjaXBpZW50Q29sb3IobmFtZSwgaW5kZXg/KSB7XG4gICAgaWYgKGluZGV4KSB7XG4gICAgICByZXR1cm4gZ2V0UkdCQShpbmRleCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVudmVsb3BlICYmIHRoaXMuZW52ZWxvcGUucmVjaXBpZW50cyAmJiB0aGlzLmVudmVsb3BlLnJlY2lwaWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IGluZGV4ID0gZmluZEluZGV4KHRoaXMuZW52ZWxvcGUucmVjaXBpZW50cywgeyByb2xlX25hbWU6IG5hbWUgfSk7XG4gICAgICBpZiAoaW5kZXggPj0gMCAmJiB0aGlzLmVudmVsb3BlLnJlY2lwaWVudHNbaW5kZXhdLnJnYmEpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW52ZWxvcGUucmVjaXBpZW50c1tpbmRleF0ucmdiYTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5hbWVUb1JHQkEobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2hlY2sgdGhlIGxvZ2ljXG4gIGFzeW5jIHZhbGlkYXRlRW52ZWxvcGVGaWVsZCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAodGhpcy53b3JraW5nRmllbGQudk5hbWUgIT0gbnVsbCAmJiB0aGlzLndvcmtpbmdGaWVsZC52YWx1ZSAhPT0gJycpIHtcbiAgICAgIGNvbnN0IHZhbGlkYXRvcnMgPSBhd2FpdCB0aGlzLnZhbGlkYXRvclNlcnZpY2UuZ2V0VmFsaWRhdG9yc09iamVjdCgpO1xuICAgICAgcmV0dXJuIHZhbGlkYXRvcnNbdGhpcy53b3JraW5nRmllbGQudk5hbWVdLnRlc3QodGhpcy53b3JraW5nRmllbGQudmFsdWUpICYmIHRoaXMuc2F0aXNmeVJlcXVpcmVkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnNhdGlzZnlSZXF1aXJlZCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2F0aXNmeVJlcXVpcmVkKCkge1xuICAgIGlmICghIXRoaXMud29ya2luZ0ZpZWxkLnJlcXVpcmVkICYmIHRoaXMud29ya2luZ0ZpZWxkLnR5cGUgIT09ICdjaGVja2JveCcgJiYgdGhpcy53b3JraW5nRmllbGQudHlwZSAhPT0gJ3RpbWVzdGFtcCcpIHtcbiAgICAgIHJldHVybiAhIXRoaXMud29ya2luZ0ZpZWxkLnZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHNvcnRGaWVsZHMoZmllbGRzKSB7XG4gICAgZmllbGRzID0gZmllbGRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIHJldHVybiBhLnBhZ2UgLSBiLnBhZ2U7XG4gICAgfSk7XG4gICAgbGV0IHByZXZpb3VzRGlzdGFuY2UgPSBudWxsO1xuICAgIGZpZWxkcyA9IGZpZWxkcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBsZXQgc2V0dGluZyA9ICdzZXR0aW5ncyc7XG4gICAgICBsZXQgZGlzdGFuY2UgPSB0aGlzLmNhbkJlU2FtZVJvdyhhLCBiKS5kaXN0YW5jZTtcbiAgICAgIGxldCBoaWdoZXJIZWlnaHQgPSB0aGlzLmNhbkJlU2FtZVJvdyhhLCBiKS5oaWdoZXJIZWlnaHQ7XG4gICAgICBpZiAoIWFbc2V0dGluZ10pIHtcbiAgICAgICAgc2V0dGluZyA9ICdzZXR0aW5nJztcbiAgICAgIH1cbiAgICAgIGlmIChhLnBhZ2UgPCBiLnBhZ2UpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfVxuICAgICAgaWYgKGEucGFnZSA+IGIucGFnZSkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGF4ID0gYVtzZXR0aW5nXS54LCBieCA9IGJbc2V0dGluZ10ueCwgYXkgPSBhW3NldHRpbmddLnksIGJ5ID0gYltzZXR0aW5nXS55O1xuICAgICAgaWYgKGRpc3RhbmNlID49IC0zICYmIGRpc3RhbmNlIDw9IGhpZ2hlckhlaWdodCkge1xuICAgICAgICBwcmV2aW91c0Rpc3RhbmNlID0gcHJldmlvdXNEaXN0YW5jZSA9PT0gbnVsbCA/IGRpc3RhbmNlIDogZGlzdGFuY2UgPCBwcmV2aW91c0Rpc3RhbmNlID8gZGlzdGFuY2UgOiBwcmV2aW91c0Rpc3RhbmNlO1xuICAgICAgICBpZiAoYXggPCBieCkge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfSBlbHNlIGlmIChheCA+IGJ4KSB7XG4gICAgICAgICAgcmV0dXJuIDFcbiAgICAgICAgfSBlbHNlIGlmIChwcmV2aW91c0Rpc3RhbmNlID49IGRpc3RhbmNlKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2UgaWYgKHByZXZpb3VzRGlzdGFuY2UgPD0gZGlzdGFuY2UpIHtcbiAgICAgICAgICByZXR1cm4gMVxuICAgICAgICB9IHJldHVybiAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJbc2V0dGluZ10ueSAtIGFbc2V0dGluZ10ueVxuICAgIH0pXG4gICAgcmV0dXJuIGZpZWxkcztcbiAgfVxuXG4gIGNoZWNrSWZFbnZlbG9wZU93bmVyKGVudmVsb3BlKSB7XG4gICAgY29uc3Qgc2lnbmVyX3Rva2VuID0gdGhpcy52VG9rZW5TdGF0ZVNlcnZpY2UuZ2V0T3RoZXJDb29raWUoJ3NpZ25lcl90b2tlbicpO1xuICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnRva2VuT2JqZWN0U2VydmljZS5nZXRQcm9maWxlKCk7XG4gICAgaWYgKHNpZ25lcl90b2tlbiAmJiAhcHJvZmlsZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoZW52ZWxvcGUpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VySWQgPSBwcm9maWxlWydpZCddO1xuICAgICAgcmV0dXJuIGN1cnJlbnRVc2VySWQgPT09IGVudmVsb3BlWydwcm9maWxlX2lkJ107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYW5CZVNhbWVSb3coYSwgYikge1xuICAgIGxldCBzZXR0aW5nID0gJ3NldHRpbmcnO1xuICAgIGlmICghYVtzZXR0aW5nXSkge1xuICAgICAgc2V0dGluZyA9ICdzZXR0aW5ncyc7XG4gICAgfVxuICAgIGNvbnN0IGFIZWlnaHQgPSB0aGlzLmdldEhlaWdodChhKTtcbiAgICBjb25zdCBiSGVpZ2h0ID0gdGhpcy5nZXRIZWlnaHQoYik7XG4gICAgY29uc3QgYUJvdHRvbSA9IGFbc2V0dGluZ10ueTtcbiAgICBjb25zdCBiQm90dG9tID0gYltzZXR0aW5nXS55O1xuICAgIGxldCB0b3A7XG4gICAgbGV0IGhpZ2hlckJvdHRvbTtcbiAgICBsZXQgaGlnaGVySGVpZ2h0O1xuICAgIGlmIChhQm90dG9tIDwgYkJvdHRvbSkge1xuICAgICAgdG9wID0gYUhlaWdodCArIGFCb3R0b207XG4gICAgICBoaWdoZXJCb3R0b20gPSBiQm90dG9tO1xuICAgICAgaGlnaGVySGVpZ2h0ID0gYkhlaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgdG9wID0gYkhlaWdodCArIGJCb3R0b207XG4gICAgICBoaWdoZXJCb3R0b20gPSBhQm90dG9tO1xuICAgICAgaGlnaGVySGVpZ2h0ID0gYUhlaWdodDtcbiAgICB9XG4gICAgY29uc3QgZGlzdGFuY2UgPSB0b3AgLSBoaWdoZXJCb3R0b207XG4gICAgcmV0dXJuIHsgZGlzdGFuY2UsIGhpZ2hlckhlaWdodCB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRIZWlnaHQoZmllbGQpIHtcbiAgICBsZXQgc2V0dGluZyA9ICdzZXR0aW5nJztcbiAgICBpZiAoIWZpZWxkW3NldHRpbmddKSB7XG4gICAgICBzZXR0aW5nID0gJ3NldHRpbmdzJztcbiAgICB9XG4gICAgbGV0IGhlaWdodCA9IDA7XG4gICAgc3dpdGNoIChmaWVsZC50eXBlKSB7XG4gICAgICBjYXNlICdzaWduYXR1cmUnOlxuICAgICAgY2FzZSAnaW5pdGlhbCc6XG4gICAgICAgIGhlaWdodCA9IDM2O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgaGVpZ2h0ID0gMTMuNTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdhdHRhY2htZW50JzpcbiAgICAgIGNhc2UgJ3BheW1lbnQnOlxuICAgICAgICBoZWlnaHQgPSAyNDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBoZWlnaHQgPSBmaWVsZFtzZXR0aW5nXVsnaGVpZ2h0J10gfHwgMDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBoZWlnaHQ7XG4gIH1cblxuICBwdWJsaWMgaGFzQ2VydGlmaWNhdGUoZW52ZWxvcGUpIHtcbiAgICByZXR1cm4gZW52ZWxvcGUuY2VydGlmaWNhdGVfZG9jdW1lbnRfaWQgfHwgWydjb21wbGV0ZScsICdjYW5jZWxlZCcsICdkZWNsaW5lZCddLmluZGV4T2YodGhpcy5lbnZlbG9wZS5zdGF0dXMpICE9PSAtMTtcbiAgfVxufSJdfQ==