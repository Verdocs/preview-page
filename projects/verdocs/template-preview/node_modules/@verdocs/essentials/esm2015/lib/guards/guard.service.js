/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Inject, Injector, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { MatDialog } from '@angular/material/dialog';
import { PlansDialog } from '../dialogs/plan-dialogs/plans-dialog.component';
import { VerdocsStateService } from '@verdocs/tokens';
import { EssentialsConfigToken } from '../essentials.module';
export class GuardService {
    /**
     * @param {?} injector
     * @param {?} stateService
     * @param {?} dialog
     * @param {?} platform
     */
    constructor(injector, stateService, dialog, platform) {
        this.injector = injector;
        this.stateService = stateService;
        this.dialog = dialog;
        this.platform = platform;
        this._redirectUrl = null;
        this._config_token = this.injector.get(EssentialsConfigToken);
        this._plans = this._config_token.plans;
        this._rAccount_frontend_url = this._config_token.rAccount_frontend_url;
    }
    /**
     * @param {?} type
     * @param {?} subscriptionType
     * @param {?} openDialog
     * @return {?}
     */
    checkSubscription(type, subscriptionType, openDialog) {
        /** @type {?} */
        const idToken = this.stateService.getIDToken();
        /** @type {?} */
        const userId = this.toTokenObject(idToken)['sub'].slice(6);
        this._redirectUrl = `${this._rAccount_frontend_url}/rAccount/user/${userId}/billing`;
        switch (type) {
            case 'reminders':
                if (subscriptionType === this._plans['level-2'] || subscriptionType === this._plans['level-3']) {
                    return true;
                }
                else {
                    if (openDialog === true) {
                        /** @type {?} */
                        const essentialDialog = this.dialog.open(PlansDialog, {
                            panelClass: 'confirmation'
                        });
                        essentialDialog.componentInstance.type = 'essential';
                        essentialDialog.componentInstance.redirectUrl = this._redirectUrl;
                    }
                    return false;
                }
            case 'live-link':
            case 'attachment':
            case 'payment':
                if (subscriptionType === this._plans['level-3']) {
                    return true;
                }
                else {
                    if (openDialog === true) {
                        /** @type {?} */
                        const proDialog = this.dialog.open(PlansDialog, {
                            panelClass: 'confirmation'
                        });
                        proDialog.componentInstance.type = 'pro';
                        proDialog.componentInstance.redirectUrl = this._redirectUrl;
                    }
                    return false;
                }
            case 'open-free-envelopes':
                /** @type {?} */
                const freeDialog = this.dialog.open(PlansDialog, {
                    panelClass: 'confirmation'
                });
                freeDialog.componentInstance.type = 'free';
                freeDialog.componentInstance.redirectUrl = this._redirectUrl;
                return false;
            default:
                return false;
        }
    }
    /**
     * @param {?} accessToken
     * @return {?}
     */
    toTokenObject(accessToken) {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            const base64Url = accessToken.split('.')[1];
            /** @type {?} */
            const base64 = base64Url.replace('-', '+').replace('_', '/');
            return JSON.parse(window.atob(base64));
        }
    }
    /**
     * @param {?} plans
     * @return {?}
     */
    getHighestEnvelopePlan(plans) {
        /** @type {?} */
        let plan = null;
        for (let x = 0; x < plans.length; x++) {
            if (plans[x] === this._plans['level-3']) {
                plan = plans[x];
            }
            else if (plans[x] === this._plans['level-2'] && (plan === null || plan === 'env:free')) {
                plan = plans[x];
            }
            else if (plans[x] === this._plans['level-1'] && plan === null) {
                plan = plans[x];
            }
        }
        return plan;
    }
}
GuardService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
GuardService.ctorParameters = () => [
    { type: Injector },
    { type: VerdocsStateService },
    { type: MatDialog },
    { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype._config_token;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype._plans;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype._rAccount_frontend_url;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype._redirectUrl;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype.stateService;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    GuardService.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VhcmQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL2Vzc2VudGlhbHMvIiwic291cmNlcyI6WyJsaWIvZ3VhcmRzL2d1YXJkLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXJELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUM3RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RCxPQUFPLEVBQW9CLHFCQUFxQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHL0UsTUFBTSxPQUFPLFlBQVk7Ozs7Ozs7SUFVdkIsWUFDVSxRQUFrQixFQUNsQixZQUFpQyxFQUNqQyxNQUFpQixFQUNJLFFBQVE7UUFIN0IsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixpQkFBWSxHQUFaLFlBQVksQ0FBcUI7UUFDakMsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNJLGFBQVEsR0FBUixRQUFRLENBQUE7UUFOL0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFRMUIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQzlELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDdkMsSUFBSSxDQUFDLHNCQUFzQixHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUM7SUFDekUsQ0FBQzs7Ozs7OztJQUVELGlCQUFpQixDQUFDLElBQVksRUFBRSxnQkFBd0IsRUFBRSxVQUFt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QyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFO2dCQUN2QyxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2pCO2lCQUFNLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksS0FBSyxVQUFVLENBQUMsRUFBRTtnQkFDeEYsSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNqQjtpQkFBTSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksS0FBSyxJQUFJLEVBQUU7Z0JBQy9ELElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDakI7U0FDRjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7O1lBekZGLFVBQVU7Ozs7WUFSa0IsUUFBUTtZQUs1QixtQkFBbUI7WUFIbkIsU0FBUzs0Q0FxQmIsTUFBTSxTQUFDLFdBQVc7Ozs7Ozs7SUFickIscUNBQXdDOzs7OztJQUN4Qyw4QkFJRTs7Ozs7SUFDRiw4Q0FBdUM7Ozs7O0lBQ3ZDLG9DQUE0Qjs7Ozs7SUFHMUIsZ0NBQTBCOzs7OztJQUMxQixvQ0FBeUM7Ozs7O0lBQ3pDLDhCQUF5Qjs7Ozs7SUFDekIsZ0NBQXFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBJbmplY3RvciwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IE1hdERpYWxvZyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5cbmltcG9ydCB7IFBsYW5zRGlhbG9nIH0gZnJvbSAnLi4vZGlhbG9ncy9wbGFuLWRpYWxvZ3MvcGxhbnMtZGlhbG9nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBWZXJkb2NzU3RhdGVTZXJ2aWNlIH0gZnJvbSAnQHZlcmRvY3MvdG9rZW5zJztcbmltcG9ydCB7IEVzc2VudGlhbHNDb25maWcsIEVzc2VudGlhbHNDb25maWdUb2tlbiB9IGZyb20gJy4uL2Vzc2VudGlhbHMubW9kdWxlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEd1YXJkU2VydmljZSB7XG4gIHByaXZhdGUgX2NvbmZpZ190b2tlbjogRXNzZW50aWFsc0NvbmZpZztcbiAgcHJpdmF0ZSBfcGxhbnM6IHtcbiAgICAnbGV2ZWwtMSc6IHN0cmluZztcbiAgICAnbGV2ZWwtMic6IHN0cmluZztcbiAgICAnbGV2ZWwtMyc6IHN0cmluZztcbiAgfTtcbiAgcHJpdmF0ZSBfckFjY291bnRfZnJvbnRlbmRfdXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgX3JlZGlyZWN0VXJsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcbiAgICBwcml2YXRlIHN0YXRlU2VydmljZTogVmVyZG9jc1N0YXRlU2VydmljZSxcbiAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nLFxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1cbiAgKSB7XG4gICAgdGhpcy5fY29uZmlnX3Rva2VuID0gdGhpcy5pbmplY3Rvci5nZXQoRXNzZW50aWFsc0NvbmZpZ1Rva2VuKTtcbiAgICB0aGlzLl9wbGFucyA9IHRoaXMuX2NvbmZpZ190b2tlbi5wbGFucztcbiAgICB0aGlzLl9yQWNjb3VudF9mcm9udGVuZF91cmwgPSB0aGlzLl9jb25maWdfdG9rZW4uckFjY291bnRfZnJvbnRlbmRfdXJsO1xuICB9XG5cbiAgY2hlY2tTdWJzY3JpcHRpb24odHlwZTogc3RyaW5nLCBzdWJzY3JpcHRpb25UeXBlOiBzdHJpbmcsIG9wZW5EaWFsb2c6IGJvb2xlYW4pIHtcbiAgICBjb25zdCBpZFRva2VuID0gdGhpcy5zdGF0ZVNlcnZpY2UuZ2V0SURUb2tlbigpO1xuICAgIGNvbnN0IHVzZXJJZCA9IHRoaXMudG9Ub2tlbk9iamVjdChpZFRva2VuKVsnc3ViJ10uc2xpY2UoNik7XG5cbiAgICB0aGlzLl9yZWRpcmVjdFVybCA9IGAke3RoaXMuX3JBY2NvdW50X2Zyb250ZW5kX3VybH0vckFjY291bnQvdXNlci8ke3VzZXJJZH0vYmlsbGluZ2A7XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgJ3JlbWluZGVycyc6XG4gICAgICAgIGlmIChzdWJzY3JpcHRpb25UeXBlID09PSB0aGlzLl9wbGFuc1snbGV2ZWwtMiddIHx8IHN1YnNjcmlwdGlvblR5cGUgPT09IHRoaXMuX3BsYW5zWydsZXZlbC0zJ10pIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAob3BlbkRpYWxvZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgZXNzZW50aWFsRGlhbG9nID0gdGhpcy5kaWFsb2cub3BlbihQbGFuc0RpYWxvZywge1xuICAgICAgICAgICAgICBwYW5lbENsYXNzOiAnY29uZmlybWF0aW9uJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBlc3NlbnRpYWxEaWFsb2cuY29tcG9uZW50SW5zdGFuY2UudHlwZSA9ICdlc3NlbnRpYWwnO1xuICAgICAgICAgICAgZXNzZW50aWFsRGlhbG9nLmNvbXBvbmVudEluc3RhbmNlLnJlZGlyZWN0VXJsID0gdGhpcy5fcmVkaXJlY3RVcmw7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgY2FzZSAnbGl2ZS1saW5rJzpcbiAgICAgIGNhc2UgJ2F0dGFjaG1lbnQnOlxuICAgICAgY2FzZSAncGF5bWVudCc6XG4gICAgICAgIGlmIChzdWJzY3JpcHRpb25UeXBlID09PSB0aGlzLl9wbGFuc1snbGV2ZWwtMyddKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKG9wZW5EaWFsb2cgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHByb0RpYWxvZyA9IHRoaXMuZGlhbG9nLm9wZW4oUGxhbnNEaWFsb2csIHtcbiAgICAgICAgICAgICAgcGFuZWxDbGFzczogJ2NvbmZpcm1hdGlvbidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcHJvRGlhbG9nLmNvbXBvbmVudEluc3RhbmNlLnR5cGUgPSAncHJvJztcbiAgICAgICAgICAgIHByb0RpYWxvZy5jb21wb25lbnRJbnN0YW5jZS5yZWRpcmVjdFVybCA9IHRoaXMuX3JlZGlyZWN0VXJsO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ29wZW4tZnJlZS1lbnZlbG9wZXMnOlxuICAgICAgICBjb25zdCBmcmVlRGlhbG9nID0gdGhpcy5kaWFsb2cub3BlbihQbGFuc0RpYWxvZywge1xuICAgICAgICAgIHBhbmVsQ2xhc3M6ICdjb25maXJtYXRpb24nXG4gICAgICAgIH0pO1xuICAgICAgICBmcmVlRGlhbG9nLmNvbXBvbmVudEluc3RhbmNlLnR5cGUgPSAnZnJlZSc7XG4gICAgICAgIGZyZWVEaWFsb2cuY29tcG9uZW50SW5zdGFuY2UucmVkaXJlY3RVcmwgPSB0aGlzLl9yZWRpcmVjdFVybDtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHRvVG9rZW5PYmplY3QoYWNjZXNzVG9rZW4pIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGNvbnN0IGJhc2U2NFVybCA9IGFjY2Vzc1Rva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICBjb25zdCBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgnLScsICcrJykucmVwbGFjZSgnXycsICcvJyk7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh3aW5kb3cuYXRvYihiYXNlNjQpKTtcbiAgICB9XG4gIH1cblxuICBnZXRIaWdoZXN0RW52ZWxvcGVQbGFuKHBsYW5zKSB7XG4gICAgbGV0IHBsYW4gPSBudWxsO1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgcGxhbnMubGVuZ3RoOyB4KyspIHtcbiAgICAgIGlmIChwbGFuc1t4XSA9PT0gdGhpcy5fcGxhbnNbJ2xldmVsLTMnXSkge1xuICAgICAgICBwbGFuID0gcGxhbnNbeF07XG4gICAgICB9IGVsc2UgaWYgKHBsYW5zW3hdID09PSB0aGlzLl9wbGFuc1snbGV2ZWwtMiddICYmIChwbGFuID09PSBudWxsIHx8IHBsYW4gPT09ICdlbnY6ZnJlZScpKSB7XG4gICAgICAgIHBsYW4gPSBwbGFuc1t4XTtcbiAgICAgIH0gZWxzZSBpZiAocGxhbnNbeF0gPT09IHRoaXMuX3BsYW5zWydsZXZlbC0xJ10gJiYgcGxhbiA9PT0gbnVsbCkge1xuICAgICAgICBwbGFuID0gcGxhbnNbeF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwbGFuO1xuICB9XG59XG4iXX0=