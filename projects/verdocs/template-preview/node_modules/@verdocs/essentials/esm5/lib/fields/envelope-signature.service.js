/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector } from '@angular/core';
import { HttpClient, HttpRequest } from '@angular/common/http';
import { DocumentsService, FieldData } from '@verdocs/sdk';
import { VerdocsStateService } from '@verdocs/tokens';
import { BehaviorSubject, ReplaySubject } from 'rxjs';
import { EssentialsConfigToken } from '../essentials.module';
import { dataURLtoBlob } from '../functions/utils';
var SignatureService = /** @class */ (function () {
    function SignatureService(httpClient, injector, envelopeSvc, vTokenStateService) {
        this.httpClient = httpClient;
        this.injector = injector;
        this.envelopeSvc = envelopeSvc;
        this.vTokenStateService = vTokenStateService;
        this.workingField = new FieldData({ order: 0, fName: '' });
        this.fields = [];
        this._total = -1;
        this._fields = new ReplaySubject();
        this._recipient = new ReplaySubject();
        this._showSig = new ReplaySubject();
        this._signedFields = new BehaviorSubject({});
        this._envId = new ReplaySubject();
        this._rName = new ReplaySubject();
        this.signImgSubject = new ReplaySubject();
        this.initialImgSubject = new ReplaySubject();
        this.initialIdSubject = new ReplaySubject();
        this.signatureIdSubject = new ReplaySubject();
        this.signedFields = {};
        this.mode = '';
        this._config_token = this.injector.get(EssentialsConfigToken);
        this._rForm_backend_url = this._config_token.rForm_backend_url;
        this.envUrl = this._rForm_backend_url + "/envelopes";
    }
    /**
     * @param {?} payment
     * @return {?}
     */
    SignatureService.prototype.setWorkingPayment = /**
     * @param {?} payment
     * @return {?}
     */
    function (payment) {
        this.workingPayment = payment;
    };
    /**
     * @param {?} fields
     * @return {?}
     */
    SignatureService.prototype.updateFields = /**
     * @param {?} fields
     * @return {?}
     */
    function (fields) {
        this.fields = fields;
        this._fields.next(this.fields);
    };
    /**
     * @return {?}
     */
    SignatureService.prototype.postSignatureBlob = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var blobFile = this.signatureBlob;
        /** @type {?} */
        var formData = new FormData();
        formData.append('signature', blobFile, blobFile['name']);
        /** @type {?} */
        var request = new HttpRequest('POST', this._rForm_backend_url + '/signatures', formData);
        return this.httpClient.request(request)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response && response['body']) {
                return response['body'];
            }
            else {
                console.error('Failed to upload signature image');
            }
        }));
    };
    /**
     * @return {?}
     */
    SignatureService.prototype.postInitialBlob = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var blobFile = this.initialBlob;
        /** @type {?} */
        var formData = new FormData();
        formData.append('initial', blobFile, blobFile['name']);
        /** @type {?} */
        var request = new HttpRequest('POST', this._rForm_backend_url + '/initials', formData);
        return this.httpClient.request(request)
            .toPromise()
            .then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response && response['body']) {
                return response['body'];
            }
            else {
                console.error('Failed to upload Initial');
            }
        }));
    };
    /**
     * @param {?} bool
     * @return {?}
     */
    SignatureService.prototype.toggleSig = /**
     * @param {?} bool
     * @return {?}
     */
    function (bool) {
        this._showSig.next(bool);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    SignatureService.prototype.setSigId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.signatureId = id;
        this.signatureIdSubject.next(id);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    SignatureService.prototype.setInitialId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.initialId = id;
        this.initialIdSubject.next(id);
    };
    /**
     * @param {?} url
     * @return {?}
     */
    SignatureService.prototype.setSignImg = /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        this.signImg = url;
        this.signImgSubject.next(this.signImg);
    };
    /**
     * @return {?}
     */
    SignatureService.prototype.getSignImg = /**
     * @return {?}
     */
    function () {
        return this.signImg;
    };
    /**
     * @param {?} url
     * @return {?}
     */
    SignatureService.prototype.setInitialImg = /**
     * @param {?} url
     * @return {?}
     */
    function (url) {
        this.initialImg = url;
        this.initialImgSubject.next(this.initialImg);
    };
    /**
     * @return {?}
     */
    SignatureService.prototype.getInitialImg = /**
     * @return {?}
     */
    function () {
        return this.initialImg;
    };
    /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} signatureId
     * @return {?}
     */
    SignatureService.prototype.putSignatureField = /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} signatureId
     * @return {?}
     */
    function (envelopeId, fieldName, signatureId) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var ipAddress;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getPublicIp()];
                    case 1:
                        ipAddress = _a.sent();
                        this.httpClient
                            .put(this.envUrl + ("/" + envelopeId + "/fields/" + fieldName + "/signature/" + signatureId), {
                            ip_address: ipAddress
                        }).toPromise().then((/**
                         * @param {?} res
                         * @return {?}
                         */
                        function (res) {
                            return resolve(res);
                        }));
                        return [2 /*return*/];
                }
            });
        }); }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} initialId
     * @return {?}
     */
    SignatureService.prototype.putInitialField = /**
     * @param {?} envelopeId
     * @param {?} fieldName
     * @param {?} initialId
     * @return {?}
     */
    function (envelopeId, fieldName, initialId) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var ipAddress;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getPublicIp()];
                    case 1:
                        ipAddress = _a.sent();
                        this.httpClient
                            .put(this.envUrl + ("/" + envelopeId + "/fields/" + fieldName + "/initial/" + initialId), {
                            ip_address: ipAddress
                        }).toPromise().then((/**
                         * @param {?} res
                         * @return {?}
                         */
                        function (res) {
                            return resolve(res);
                        }));
                        return [2 /*return*/];
                }
            });
        }); }));
    };
    // refactor it to 4 functions
    // refactor it to 4 functions
    /**
     * @param {?} envelopeId
     * @param {?=} ifPrepared
     * @return {?}
     */
    SignatureService.prototype.updateEnvelopeField = 
    // refactor it to 4 functions
    /**
     * @param {?} envelopeId
     * @param {?=} ifPrepared
     * @return {?}
     */
    function (envelopeId, ifPrepared) {
        if (this.workingField && this.workingField.type) {
            /** @type {?} */
            var result = this.getEnvelopeFieldValue(ifPrepared);
            this.putEnvelopeField(envelopeId, result);
        }
    };
    /**
     * @param {?=} isPrepared
     * @return {?}
     */
    SignatureService.prototype.getEnvelopeFieldValue = /**
     * @param {?=} isPrepared
     * @return {?}
     */
    function (isPrepared) {
        if (this.workingField && this.workingField.type) {
            /** @type {?} */
            var result = {
                value: ''
            };
            if (typeof (isPrepared) === 'boolean') {
                result['prepared'] = isPrepared;
            }
            switch (this.workingField.type.toLowerCase()) {
                case 'textbox':
                case 'checkbox':
                case 'date':
                    result.value = this.workingField.value;
                    break;
                default:
                    break;
            }
            return result;
        }
        return null;
    };
    /**
     * @param {?} envelopeId
     * @param {?} result
     * @return {?}
     */
    SignatureService.prototype.putEnvelopeField = /**
     * @param {?} envelopeId
     * @param {?} result
     * @return {?}
     */
    function (envelopeId, result) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.httpClient
                .put(_this.envUrl + ("/" + envelopeId + "/fields/" + _this.workingField.fName), result).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                return resolve(res);
            }));
        }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} body
     * @param {?} fieldName
     * @param {?=} ifPrepared
     * @return {?}
     */
    SignatureService.prototype.updateGroupedField = /**
     * @param {?} envelopeId
     * @param {?} body
     * @param {?} fieldName
     * @param {?=} ifPrepared
     * @return {?}
     */
    function (envelopeId, body, fieldName, ifPrepared) {
        var _this = this;
        if (typeof (ifPrepared) === 'boolean') {
            body['prepared'] = ifPrepared;
        }
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) {
            _this.httpClient
                .put(_this.envUrl + ("/" + envelopeId + "/fields/" + fieldName), body).toPromise().then((/**
             * @param {?} res
             * @return {?}
             */
            function (res) {
                return resolve(res);
            }));
        }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} setPrepared
     * @return {?}
     */
    SignatureService.prototype.prepareEnvelopeField = /**
     * @param {?} envelopeId
     * @param {?} setPrepared
     * @return {?}
     */
    function (envelopeId, setPrepared) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var fieldType, fieldResponse;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(this.workingField && this.workingField.type)) return [3 /*break*/, 3];
                        fieldType = this.workingField.type.toLowerCase();
                        if (!(fieldType !== 'textbox' && fieldType !== 'date' && fieldType !== 'checkbox')) return [3 /*break*/, 1];
                        return [2 /*return*/, false];
                    case 1: return [4 /*yield*/, this.updateEnvelopeField(envelopeId, setPrepared)];
                    case 2:
                        fieldResponse = _a.sent();
                        if (fieldResponse) {
                            return [2 /*return*/, fieldResponse.prepared];
                        }
                        _a.label = 3;
                    case 3: return [2 /*return*/, false];
                }
            });
        });
    };
    /**
     * @private
     * @return {?}
     */
    SignatureService.prototype.getPublicIp = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var apiUrl = 'https://api.ipify.org?format=jsonp';
        /** @type {?} */
        var callback = 'callback=JSONP_CALLBACK';
        return this.httpClient
            .jsonp(apiUrl, callback)
            .toPromise()
            .then((/**
         * @param {?} res
         * @return {?}
         */
        function (res) {
            return res['ip'];
        })).catch((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.error('Failed to get ip', err);
            return 'ip_unavailable';
        }));
    };
    /**
     * @param {?} fName
     * @param {?} result
     * @param {?} vName
     * @param {?} pageNum
     * @param {?} id
     * @param {?} required
     * @param {?} order
     * @param {?} type
     * @return {?}
     */
    SignatureService.prototype.updateCurrentField = /**
     * @param {?} fName
     * @param {?} result
     * @param {?} vName
     * @param {?} pageNum
     * @param {?} id
     * @param {?} required
     * @param {?} order
     * @param {?} type
     * @return {?}
     */
    function (fName, result, vName, pageNum, id, required, order, type) {
        this.workingField.fName = fName;
        this.workingField.value = result;
        this.workingField.pageNum = pageNum;
        this.workingField.id = id;
        this.workingField.vName = vName;
        this.workingField.required = required;
        this.workingField.order = order;
        this.workingField.type = type;
    };
    /**
     * @param {?} fields
     * @return {?}
     */
    SignatureService.prototype.setCurrentFields = /**
     * @param {?} fields
     * @return {?}
     */
    function (fields) {
        this.currentFields = fields;
    };
    Object.defineProperty(SignatureService.prototype, "currField", {
        get: /**
         * @return {?}
         */
        function () {
            return this.workingField;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} pageNum
     * @param {?} id
     * @return {?}
     */
    SignatureService.prototype.errorMessages = /**
     * @param {?} pageNum
     * @param {?} id
     * @return {?}
     */
    function (pageNum, id) {
        return this.currentFields[pageNum][id]['error'];
    };
    /**
     * @param {?} id
     * @return {?}
     */
    SignatureService.prototype.setEnvId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this._envId.next(id);
    };
    /**
     * @param {?} role
     * @return {?}
     */
    SignatureService.prototype.setrName = /**
     * @param {?} role
     * @return {?}
     */
    function (role) {
        this.rName = role;
        this._rName.next(role);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    SignatureService.prototype.getSignatureUrl = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        if (data) {
            /** @type {?} */
            var blob = dataURLtoBlob(data);
            /** @type {?} */
            var url = URL.createObjectURL(blob);
            return url;
        }
        return null;
    };
    /**
     * @param {?} data
     * @return {?}
     */
    SignatureService.prototype.setSignatureData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var blob = dataURLtoBlob(data);
        /** @type {?} */
        var url = URL.createObjectURL(blob);
        this.signatureBlob = blob;
        this.setSignImg(url);
    };
    /**
     * @param {?} data
     * @return {?}
     */
    SignatureService.prototype.setInitialData = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var blob = dataURLtoBlob(data);
        /** @type {?} */
        var url = URL.createObjectURL(blob);
        this.initialBlob = blob;
        this.setInitialImg(url);
    };
    /**
     * @param {?} fName
     * @param {?} result
     * @return {?}
     */
    SignatureService.prototype.updateSigned = /**
     * @param {?} fName
     * @param {?} result
     * @return {?}
     */
    function (fName, result) {
        this.workingField['value'] = 'signed';
        this.signedFields[fName] = result;
        this._signedFields.next(this.signedFields);
    };
    /**
     * @param {?} fName
     * @param {?} result
     * @return {?}
     */
    SignatureService.prototype.updateInitialed = /**
     * @param {?} fName
     * @param {?} result
     * @return {?}
     */
    function (fName, result) {
        this.workingField['value'] = 'initialed';
        this.signedFields[fName] = result;
        this._signedFields.next(this.signedFields);
    };
    /**
     * @param {?} id
     * @return {?}
     */
    SignatureService.prototype.setSignatureId = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        this.signatureId = id;
        this.signatureIdSubject.next(id);
    };
    /**
     * @param {?} recipient
     * @return {?}
     */
    SignatureService.prototype.setRecipient = /**
     * @param {?} recipient
     * @return {?}
     */
    function (recipient) {
        this._recipient.next(recipient);
    };
    /**
     * @param {?} t
     * @return {?}
     */
    SignatureService.prototype.setTotal = /**
     * @param {?} t
     * @return {?}
     */
    function (t) {
        this._total = t;
    };
    SignatureService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    SignatureService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: Injector },
        { type: DocumentsService },
        { type: VerdocsStateService }
    ]; };
    return SignatureService;
}());
export { SignatureService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype._config_token;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.signatureId;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.initialId;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype._rForm_backend_url;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.envUrl;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.currentFields;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.workingField;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.signatureBlob;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.initialBlob;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.fields;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype._total;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.initialImg;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.workingPayment;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.rName;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.recipients;
    /** @type {?} */
    SignatureService.prototype._fields;
    /** @type {?} */
    SignatureService.prototype._recipient;
    /** @type {?} */
    SignatureService.prototype._showSig;
    /** @type {?} */
    SignatureService.prototype._signedFields;
    /** @type {?} */
    SignatureService.prototype._envId;
    /** @type {?} */
    SignatureService.prototype._rName;
    /** @type {?} */
    SignatureService.prototype.signImgSubject;
    /** @type {?} */
    SignatureService.prototype.initialImgSubject;
    /** @type {?} */
    SignatureService.prototype.initialIdSubject;
    /** @type {?} */
    SignatureService.prototype.signatureIdSubject;
    /** @type {?} */
    SignatureService.prototype.signedFields;
    /** @type {?} */
    SignatureService.prototype.signImg;
    /** @type {?} */
    SignatureService.prototype.mode;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.envelopeSvc;
    /**
     * @type {?}
     * @private
     */
    SignatureService.prototype.vTokenStateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW52ZWxvcGUtc2lnbmF0dXJlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdmVyZG9jcy9lc3NlbnRpYWxzLyIsInNvdXJjZXMiOlsibGliL2ZpZWxkcy9lbnZlbG9wZS1zaWduYXR1cmUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JELE9BQU8sRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFNBQVMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUV0RCxPQUFPLEVBQW9CLHFCQUFxQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDL0UsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRW5EO0lBZ0NFLDBCQUNVLFVBQXNCLEVBQ3RCLFFBQWtCLEVBQ2xCLFdBQTZCLEVBQzdCLGtCQUF1QztRQUh2QyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsZ0JBQVcsR0FBWCxXQUFXLENBQWtCO1FBQzdCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBcUI7UUE1QnpDLGlCQUFZLEdBQW1CLElBQUksU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUd0RSxXQUFNLEdBQVUsRUFBRSxDQUFDO1FBQ25CLFdBQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQU1iLFlBQU8sR0FBRyxJQUFJLGFBQWEsRUFBUyxDQUFDO1FBQ3JDLGVBQVUsR0FBRyxJQUFJLGFBQWEsRUFB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LFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEMsQ0FBQzs7Ozs7SUFFRCxtQ0FBUTs7OztJQUFSLFVBQVMsQ0FBUztRQUNoQixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNsQixDQUFDOztnQkEzVEYsVUFBVTs7OztnQkFSRixVQUFVO2dCQURFLFFBQVE7Z0JBRXBCLGdCQUFnQjtnQkFDaEIsbUJBQW1COztJQW1VNUIsdUJBQUM7Q0FBQSxBQTdURCxJQTZUQztTQTVUWSxnQkFBZ0I7Ozs7OztJQUMzQix5Q0FBd0M7Ozs7O0lBQ3hDLHVDQUE0Qjs7Ozs7SUFDNUIscUNBQTBCOzs7OztJQUMxQiw4Q0FBbUM7Ozs7O0lBQ25DLGtDQUF1Qjs7Ozs7SUFDdkIseUNBQTZCOzs7OztJQUM3Qix3Q0FBOEU7Ozs7O0lBQzlFLHlDQUE0Qjs7Ozs7SUFDNUIsdUNBQTBCOzs7OztJQUMxQixrQ0FBMkI7Ozs7O0lBQzNCLGtDQUFvQjs7Ozs7SUFDcEIsc0NBQXdCOzs7OztJQUN4QiwwQ0FBNEI7Ozs7O0lBQzVCLGlDQUFzQjs7Ozs7SUFDdEIsc0NBQTBCOztJQUUxQixtQ0FBNEM7O0lBQzVDLHNDQUFnRDs7SUFDaEQsb0NBQStDOztJQUMvQyx5Q0FBb0Q7O0lBQ3BELGtDQUE0Qzs7SUFDNUMsa0NBQTRDOztJQUM1QywwQ0FBaUQ7O0lBQ2pELDZDQUFvRDs7SUFDcEQsNENBQXNEOztJQUN0RCw4Q0FBd0Q7O0lBQ3hELHdDQUE4Qjs7SUFDOUIsbUNBQW9COztJQUNwQixnQ0FBaUI7Ozs7O0lBR2Ysc0NBQThCOzs7OztJQUM5QixvQ0FBMEI7Ozs7O0lBQzFCLHVDQUFxQzs7Ozs7SUFDckMsOENBQStDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBSZXF1ZXN0IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgRG9jdW1lbnRzU2VydmljZSwgRmllbGREYXRhIH0gZnJvbSAnQHZlcmRvY3Mvc2RrJztcbmltcG9ydCB7IFZlcmRvY3NTdGF0ZVNlcnZpY2UgfSBmcm9tICdAdmVyZG9jcy90b2tlbnMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IEVzc2VudGlhbHNDb25maWcsIEVzc2VudGlhbHNDb25maWdUb2tlbiB9IGZyb20gJy4uL2Vzc2VudGlhbHMubW9kdWxlJztcbmltcG9ydCB7IGRhdGFVUkx0b0Jsb2IgfSBmcm9tICcuLi9mdW5jdGlvbnMvdXRpbHMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU2lnbmF0dXJlU2VydmljZSB7XG4gIHByaXZhdGUgX2NvbmZpZ190b2tlbjogRXNzZW50aWFsc0NvbmZpZztcbiAgcHJpdmF0ZSBzaWduYXR1cmVJZDogc3RyaW5nO1xuICBwcml2YXRlIGluaXRpYWxJZDogc3RyaW5nO1xuICBwcml2YXRlIF9yRm9ybV9iYWNrZW5kX3VybDogc3RyaW5nO1xuICBwcml2YXRlIGVudlVybDogc3RyaW5nO1xuICBwcml2YXRlIGN1cnJlbnRGaWVsZHM6IGFueVtdO1xuICBwcml2YXRlIHdvcmtpbmdGaWVsZDogRmllbGREYXRhPGFueT4gPSBuZXcgRmllbGREYXRhKHsgb3JkZXI6IDAsIGZOYW1lOiAnJyB9KTtcbiAgcHJpdmF0ZSBzaWduYXR1cmVCbG9iOiBCbG9iO1xuICBwcml2YXRlIGluaXRpYWxCbG9iOiBCbG9iO1xuICBwcml2YXRlIGZpZWxkczogYW55W10gPSBbXTtcbiAgcHJpdmF0ZSBfdG90YWwgPSAtMTtcbiAgcHJpdmF0ZSBpbml0aWFsSW1nOiBhbnk7XG4gIHByaXZhdGUgd29ya2luZ1BheW1lbnQ6IGFueTtcbiAgcHJpdmF0ZSByTmFtZTogc3RyaW5nO1xuICBwcml2YXRlIHJlY2lwaWVudHM6IGFueVtdO1xuXG4gIHB1YmxpYyBfZmllbGRzID0gbmV3IFJlcGxheVN1YmplY3Q8YW55W10+KCk7XG4gIHB1YmxpYyBfcmVjaXBpZW50ID0gbmV3IFJlcGxheVN1YmplY3Q8c3RyaW5nPigpO1xuICBwdWJsaWMgX3Nob3dTaWcgPSBuZXcgUmVwbGF5U3ViamVjdDxib29sZWFuPigpO1xuICBwdWJsaWMgX3NpZ25lZEZpZWxkcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55Pih7fSk7XG4gIHB1YmxpYyBfZW52SWQgPSBuZXcgUmVwbGF5U3ViamVjdDxzdHJpbmc+KCk7XG4gIHB1YmxpYyBfck5hbWUgPSBuZXcgUmVwbGF5U3ViamVjdDxzdHJpbmc+KCk7XG4gIHB1YmxpYyBzaWduSW1nU3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PGFueT4oKTtcbiAgcHVibGljIGluaXRpYWxJbWdTdWJqZWN0ID0gbmV3IFJlcGxheVN1YmplY3Q8YW55PigpO1xuICBwdWJsaWMgaW5pdGlhbElkU3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PHN0cmluZz4oKTtcbiAgcHVibGljIHNpZ25hdHVyZUlkU3ViamVjdCA9IG5ldyBSZXBsYXlTdWJqZWN0PHN0cmluZz4oKTtcbiAgcHVibGljIHNpZ25lZEZpZWxkczogYW55ID0ge307XG4gIHB1YmxpYyBzaWduSW1nOiBhbnk7XG4gIHB1YmxpYyBtb2RlID0gJyc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxuICAgIHByaXZhdGUgZW52ZWxvcGVTdmM6IERvY3VtZW50c1NlcnZpY2UsXG4gICAgcHJpdmF0ZSB2VG9rZW5TdGF0ZVNlcnZpY2U6IFZlcmRvY3NTdGF0ZVNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5fY29uZmlnX3Rva2VuID0gdGhpcy5pbmplY3Rvci5nZXQoRXNzZW50aWFsc0NvbmZpZ1Rva2VuKTtcbiAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCA9IHRoaXMuX2NvbmZpZ190b2tlbi5yRm9ybV9iYWNrZW5kX3VybDtcbiAgICB0aGlzLmVudlVybCA9IGAke3RoaXMuX3JGb3JtX2JhY2tlbmRfdXJsfS9lbnZlbG9wZXNgXG4gIH1cblxuICBzZXRXb3JraW5nUGF5bWVudChwYXltZW50OiBhbnkpIHtcbiAgICB0aGlzLndvcmtpbmdQYXltZW50ID0gcGF5bWVudDtcbiAgfVxuXG4gIHVwZGF0ZUZpZWxkcyhmaWVsZHM6IGFueVtdKTogdm9pZCB7XG4gICAgdGhpcy5maWVsZHMgPSBmaWVsZHM7XG4gICAgdGhpcy5fZmllbGRzLm5leHQodGhpcy5maWVsZHMpO1xuICB9XG5cbiAgcG9zdFNpZ25hdHVyZUJsb2IoKSB7XG4gICAgY29uc3QgYmxvYkZpbGUgPSB0aGlzLnNpZ25hdHVyZUJsb2I7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ3NpZ25hdHVyZScsIGJsb2JGaWxlLCBibG9iRmlsZVsnbmFtZSddKTtcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IEh0dHBSZXF1ZXN0KCdQT1NUJywgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyAnL3NpZ25hdHVyZXMnLCBmb3JtRGF0YSk7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5yZXF1ZXN0KHJlcXVlc3QpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlWydib2R5J10pIHtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbJ2JvZHknXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdXBsb2FkIHNpZ25hdHVyZSBpbWFnZScpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIHBvc3RJbml0aWFsQmxvYigpIHtcbiAgICBjb25zdCBibG9iRmlsZSA9IHRoaXMuaW5pdGlhbEJsb2I7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ2luaXRpYWwnLCBibG9iRmlsZSwgYmxvYkZpbGVbJ25hbWUnXSk7XG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBIdHRwUmVxdWVzdCgnUE9TVCcsIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgJy9pbml0aWFscycsIGZvcm1EYXRhKTtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnJlcXVlc3QocmVxdWVzdClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2VbJ2JvZHknXSkge1xuICAgICAgICAgIHJldHVybiByZXNwb25zZVsnYm9keSddO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGxvYWQgSW5pdGlhbCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZVNpZyhib29sKTogdm9pZCB7XG4gICAgdGhpcy5fc2hvd1NpZy5uZXh0KGJvb2wpO1xuICB9XG5cbiAgc2V0U2lnSWQoaWQpOiB2b2lkIHtcbiAgICB0aGlzLnNpZ25hdHVyZUlkID0gaWQ7XG4gICAgdGhpcy5zaWduYXR1cmVJZFN1YmplY3QubmV4dChpZCk7XG4gIH1cblxuICBzZXRJbml0aWFsSWQoaWQpOiB2b2lkIHtcbiAgICB0aGlzLmluaXRpYWxJZCA9IGlkO1xuICAgIHRoaXMuaW5pdGlhbElkU3ViamVjdC5uZXh0KGlkKTtcbiAgfVxuXG4gIHNldFNpZ25JbWcodXJsKSB7XG4gICAgdGhpcy5zaWduSW1nID0gdXJsO1xuICAgIHRoaXMuc2lnbkltZ1N1YmplY3QubmV4dCh0aGlzLnNpZ25JbWcpO1xuICB9XG5cbiAgZ2V0U2lnbkltZygpIHtcbiAgICByZXR1cm4gdGhpcy5zaWduSW1nO1xuICB9XG5cbiAgc2V0SW5pdGlhbEltZyh1cmwpIHtcbiAgICB0aGlzLmluaXRpYWxJbWcgPSB1cmw7XG4gICAgdGhpcy5pbml0aWFsSW1nU3ViamVjdC5uZXh0KHRoaXMuaW5pdGlhbEltZyk7XG4gIH1cblxuICBnZXRJbml0aWFsSW1nKCkge1xuICAgIHJldHVybiB0aGlzLmluaXRpYWxJbWc7XG4gIH1cblxuICBwdXRTaWduYXR1cmVGaWVsZChlbnZlbG9wZUlkLCBmaWVsZE5hbWUsIHNpZ25hdHVyZUlkKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgaXBBZGRyZXNzID0gYXdhaXQgdGhpcy5nZXRQdWJsaWNJcCgpO1xuICAgICAgdGhpcy5odHRwQ2xpZW50XG4gICAgICAgIC5wdXQodGhpcy5lbnZVcmwgKyBgLyR7ZW52ZWxvcGVJZH0vZmllbGRzLyR7ZmllbGROYW1lfS9zaWduYXR1cmUvJHtzaWduYXR1cmVJZH1gLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlwX2FkZHJlc3M6IGlwQWRkcmVzc1xuICAgICAgICAgIH1cbiAgICAgICAgKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIHB1dEluaXRpYWxGaWVsZChlbnZlbG9wZUlkLCBmaWVsZE5hbWUsIGluaXRpYWxJZCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGlwQWRkcmVzcyA9IGF3YWl0IHRoaXMuZ2V0UHVibGljSXAoKTtcbiAgICAgIHRoaXMuaHR0cENsaWVudFxuICAgICAgICAucHV0KHRoaXMuZW52VXJsICsgYC8ke2VudmVsb3BlSWR9L2ZpZWxkcy8ke2ZpZWxkTmFtZX0vaW5pdGlhbC8ke2luaXRpYWxJZH1gLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlwX2FkZHJlc3M6IGlwQWRkcmVzc1xuICAgICAgICAgIH1cbiAgICAgICAgKS50b1Byb21pc2UoKS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzKTtcbiAgICAgICAgfSlcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHJlZmFjdG9yIGl0IHRvIDQgZnVuY3Rpb25zXG4gIHVwZGF0ZUVudmVsb3BlRmllbGQoZW52ZWxvcGVJZCwgaWZQcmVwYXJlZD86IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy53b3JraW5nRmllbGQgJiYgdGhpcy53b3JraW5nRmllbGQudHlwZSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5nZXRFbnZlbG9wZUZpZWxkVmFsdWUoaWZQcmVwYXJlZCk7XG4gICAgICB0aGlzLnB1dEVudmVsb3BlRmllbGQoZW52ZWxvcGVJZCwgcmVzdWx0KTtcbiAgICB9XG4gIH1cblxuICBnZXRFbnZlbG9wZUZpZWxkVmFsdWUoaXNQcmVwYXJlZD86IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy53b3JraW5nRmllbGQgJiYgdGhpcy53b3JraW5nRmllbGQudHlwZSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICB2YWx1ZTogJydcbiAgICAgIH07XG4gICAgICBpZiAodHlwZW9mIChpc1ByZXBhcmVkKSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHJlc3VsdFsncHJlcGFyZWQnXSA9IGlzUHJlcGFyZWQ7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKHRoaXMud29ya2luZ0ZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICBjYXNlICd0ZXh0Ym94JzpcbiAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICBjYXNlICdkYXRlJzpcbiAgICAgICAgICByZXN1bHQudmFsdWUgPSB0aGlzLndvcmtpbmdGaWVsZC52YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHV0RW52ZWxvcGVGaWVsZChlbnZlbG9wZUlkLCByZXN1bHQpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8YW55PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmh0dHBDbGllbnRcbiAgICAgICAgLnB1dCh0aGlzLmVudlVybCArIGAvJHtlbnZlbG9wZUlkfS9maWVsZHMvJHt0aGlzLndvcmtpbmdGaWVsZC5mTmFtZX1gLFxuICAgICAgICAgIHJlc3VsdFxuICAgICAgICApLnRvUHJvbWlzZSgpLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlR3JvdXBlZEZpZWxkKGVudmVsb3BlSWQsIGJvZHksIGZpZWxkTmFtZSwgaWZQcmVwYXJlZD86IGJvb2xlYW4pIHtcbiAgICBpZiAodHlwZW9mIChpZlByZXBhcmVkKSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBib2R5WydwcmVwYXJlZCddID0gaWZQcmVwYXJlZDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5odHRwQ2xpZW50XG4gICAgICAgIC5wdXQodGhpcy5lbnZVcmwgKyBgLyR7ZW52ZWxvcGVJZH0vZmllbGRzLyR7ZmllbGROYW1lfWAsXG4gICAgICAgICAgYm9keVxuICAgICAgICApLnRvUHJvbWlzZSgpLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXMpO1xuICAgICAgICB9KVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgcHJlcGFyZUVudmVsb3BlRmllbGQoZW52ZWxvcGVJZCwgc2V0UHJlcGFyZWQpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAodGhpcy53b3JraW5nRmllbGQgJiYgdGhpcy53b3JraW5nRmllbGQudHlwZSkge1xuICAgICAgY29uc3QgZmllbGRUeXBlID0gdGhpcy53b3JraW5nRmllbGQudHlwZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGZpZWxkVHlwZSAhPT0gJ3RleHRib3gnICYmIGZpZWxkVHlwZSAhPT0gJ2RhdGUnICYmIGZpZWxkVHlwZSAhPT0gJ2NoZWNrYm94Jykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBmaWVsZFJlc3BvbnNlOiBhbnkgPSBhd2FpdCB0aGlzLnVwZGF0ZUVudmVsb3BlRmllbGQoZW52ZWxvcGVJZCwgc2V0UHJlcGFyZWQpO1xuICAgICAgICBpZiAoZmllbGRSZXNwb25zZSkge1xuICAgICAgICAgIHJldHVybiBmaWVsZFJlc3BvbnNlLnByZXBhcmVkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRQdWJsaWNJcCgpIHtcbiAgICBjb25zdCBhcGlVcmwgPSAnaHR0cHM6Ly9hcGkuaXBpZnkub3JnP2Zvcm1hdD1qc29ucCc7XG4gICAgY29uc3QgY2FsbGJhY2sgPSAnY2FsbGJhY2s9SlNPTlBfQ0FMTEJBQ0snO1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnRcbiAgICAgIC5qc29ucChhcGlVcmwsIGNhbGxiYWNrKVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIHJldHVybiByZXNbJ2lwJ11cbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGdldCBpcCcsIGVycilcbiAgICAgICAgcmV0dXJuICdpcF91bmF2YWlsYWJsZSdcbiAgICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlQ3VycmVudEZpZWxkKFxuICAgIGZOYW1lOiBzdHJpbmcsXG4gICAgcmVzdWx0OiBzdHJpbmcsXG4gICAgdk5hbWU6IHN0cmluZyxcbiAgICBwYWdlTnVtOiBudW1iZXIsXG4gICAgaWQ6IG51bWJlcixcbiAgICByZXF1aXJlZDogYm9vbGVhbixcbiAgICBvcmRlcjogbnVtYmVyLFxuICAgIHR5cGU6IHN0cmluZ1xuICApIHtcbiAgICB0aGlzLndvcmtpbmdGaWVsZC5mTmFtZSA9IGZOYW1lO1xuICAgIHRoaXMud29ya2luZ0ZpZWxkLnZhbHVlID0gcmVzdWx0O1xuICAgIHRoaXMud29ya2luZ0ZpZWxkLnBhZ2VOdW0gPSBwYWdlTnVtO1xuICAgIHRoaXMud29ya2luZ0ZpZWxkLmlkID0gaWQ7XG4gICAgdGhpcy53b3JraW5nRmllbGQudk5hbWUgPSB2TmFtZTtcbiAgICB0aGlzLndvcmtpbmdGaWVsZC5yZXF1aXJlZCA9IHJlcXVpcmVkO1xuICAgIHRoaXMud29ya2luZ0ZpZWxkLm9yZGVyID0gb3JkZXI7XG4gICAgdGhpcy53b3JraW5nRmllbGQudHlwZSA9IHR5cGU7XG4gIH1cblxuICBzZXRDdXJyZW50RmllbGRzKGZpZWxkczogYW55W10pIHtcbiAgICB0aGlzLmN1cnJlbnRGaWVsZHMgPSBmaWVsZHM7XG4gIH1cblxuICBnZXQgY3VyckZpZWxkKCkge1xuICAgIHJldHVybiB0aGlzLndvcmtpbmdGaWVsZDtcbiAgfVxuXG4gIGVycm9yTWVzc2FnZXMocGFnZU51bSwgaWQpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RmllbGRzW3BhZ2VOdW1dW2lkXVsnZXJyb3InXTtcbiAgfVxuXG4gIHNldEVudklkKGlkKTogdm9pZCB7XG4gICAgdGhpcy5fZW52SWQubmV4dChpZCk7XG4gIH1cblxuICBzZXRyTmFtZShyb2xlKTogdm9pZCB7XG4gICAgdGhpcy5yTmFtZSA9IHJvbGU7XG4gICAgdGhpcy5fck5hbWUubmV4dChyb2xlKTtcbiAgfVxuXG4gIGdldFNpZ25hdHVyZVVybChkYXRhKSB7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIGNvbnN0IGJsb2IgPSBkYXRhVVJMdG9CbG9iKGRhdGEpO1xuICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgc2V0U2lnbmF0dXJlRGF0YShkYXRhKSB7XG4gICAgY29uc3QgYmxvYiA9IGRhdGFVUkx0b0Jsb2IoZGF0YSk7XG4gICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICB0aGlzLnNpZ25hdHVyZUJsb2IgPSBibG9iO1xuICAgIHRoaXMuc2V0U2lnbkltZyh1cmwpO1xuICB9XG5cbiAgc2V0SW5pdGlhbERhdGEoZGF0YSkge1xuICAgIGNvbnN0IGJsb2IgPSBkYXRhVVJMdG9CbG9iKGRhdGEpO1xuICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgdGhpcy5pbml0aWFsQmxvYiA9IGJsb2I7XG4gICAgdGhpcy5zZXRJbml0aWFsSW1nKHVybCk7XG4gIH1cblxuICB1cGRhdGVTaWduZWQoZk5hbWUsIHJlc3VsdCkge1xuICAgIHRoaXMud29ya2luZ0ZpZWxkWyd2YWx1ZSddID0gJ3NpZ25lZCc7XG4gICAgdGhpcy5zaWduZWRGaWVsZHNbZk5hbWVdID0gcmVzdWx0O1xuICAgIHRoaXMuX3NpZ25lZEZpZWxkcy5uZXh0KHRoaXMuc2lnbmVkRmllbGRzKTtcbiAgfVxuXG4gIHVwZGF0ZUluaXRpYWxlZChmTmFtZSwgcmVzdWx0KSB7XG4gICAgdGhpcy53b3JraW5nRmllbGRbJ3ZhbHVlJ10gPSAnaW5pdGlhbGVkJztcbiAgICB0aGlzLnNpZ25lZEZpZWxkc1tmTmFtZV0gPSByZXN1bHQ7XG4gICAgdGhpcy5fc2lnbmVkRmllbGRzLm5leHQodGhpcy5zaWduZWRGaWVsZHMpO1xuICB9XG5cbiAgc2V0U2lnbmF0dXJlSWQoaWQpIHtcbiAgICB0aGlzLnNpZ25hdHVyZUlkID0gaWQ7XG4gICAgdGhpcy5zaWduYXR1cmVJZFN1YmplY3QubmV4dChpZCk7XG4gIH1cblxuICBzZXRSZWNpcGllbnQocmVjaXBpZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLl9yZWNpcGllbnQubmV4dChyZWNpcGllbnQpO1xuICB9XG5cbiAgc2V0VG90YWwodDogbnVtYmVyKSB7XG4gICAgdGhpcy5fdG90YWwgPSB0O1xuICB9XG5cbn1cbiJdfQ==