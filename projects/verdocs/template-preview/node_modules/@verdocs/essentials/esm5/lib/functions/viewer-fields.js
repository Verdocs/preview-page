/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DynamicField } from '../models/dynamic-field.model';
import { findIndex } from 'lodash';
/**
 * @param {?} fields
 * @param {?} mode
 * @return {?}
 */
export function buildFields(fields, mode) {
    /*
       * PDF 72 DPI
       * Width: 612px
       * Height: 792px
       * */
    /*
         * PDF 72 DPI
         * Width: 612px
         * Height: 792px
         * */
    /** @type {?} */
    var _fields = [];
    /** @type {?} */
    var order = 0;
    /** @type {?} */
    var role;
    switch (mode) {
        case 'signerview':
        case 'prepareview':
        case 'preview':
            role = 'recipient_role';
            break;
        case 'liveview':
            role = 'role_name';
            break;
        default:
            role = 'recipient_role';
            break;
    }
    /** @type {?} */
    var setting = 'setting';
    for (var fieldIndex in fields) {
        if (fields.hasOwnProperty(fieldIndex) && fields[fieldIndex]) {
            /** @type {?} */
            var field = fields[fieldIndex];
            /** @type {?} */
            var keyNameSuffix = '';
            if (!!field['settings']) {
                setting = 'settings';
            }
            ;
            switch (field.type.toLowerCase()) {
                case 'attachment':
                case 'payment':
                    field[setting]['width'] = 24;
                    field[setting]['height'] = 24;
                    break;
                case 'checkbox':
                case 'checkbox_group':
                case 'radio_button_group':
                    field[setting]['width'] = 13.5;
                    field[setting]['height'] = 13.5;
                    keyNameSuffix = field['optionId'] ? '-' + field['optionId'] : '';
                    break;
                case 'signature':
                    field[setting]['width'] = 82.63636363636;
                    field[setting]['height'] = 36;
                    break;
                case 'initial':
                    field[setting]['width'] = 82.63636363636;
                    field[setting]['height'] = 36;
                    break;
                default:
                    break;
            }
            /** @type {?} */
            var fieldValues = new DynamicField({
                key: field.name + keyNameSuffix,
                value: field[setting]['result'] || '',
                required: field.required,
                controlType: field.type,
                order: order++,
                validator: field.validator,
                showCounter: false,
                prepared: field.prepared || false,
                recipientRole: field[role],
                field_name: field.name,
                dirty: false
            });
            switch (field.type) {
                case 'attachment':
                    fieldValues.value = field[setting]['name'] ? field[setting]['name'] : '';
                    break;
                case 'checkbox':
                    fieldValues.value = field[setting]['result'] === false ? false : true;
                    break;
                case 'payment':
                    fieldValues.value = field[setting]['payment_id'] ? field[setting]['payment_id'] : '';
                    break;
                case 'checkbox_group':
                    fieldValues.value = field[setting]['checked'];
                    if (field.required || field[setting]['maximum_checked'] > 0) {
                        fieldValues['min_checked'] = field[setting]['minimum_checked'];
                        fieldValues['max_checked'] = field[setting]['maximum_checked'];
                    }
                    break;
                case 'radio_button_group':
                    fieldValues.value = field[setting]['selected'];
                    break;
                case 'dropdown':
                    fieldValues.value = field[setting]['value'];
                    fieldValues['options'] = field[setting]['options'];
                    break;
                default:
                    break;
            }
            ;
            if (field[setting]['url']) {
                fieldValues['url'] = field[setting]['url'];
                fieldValues['name'] = field[setting]['name'];
                fieldValues['value'] = field[setting]['name'];
            }
            if (fields[fieldIndex]) {
                _fields[fieldIndex] = fieldValues;
            }
        }
    }
    return _fields;
}
/**
 * @param {?} fields
 * @param {?} pageNum
 * @return {?}
 */
export function getFieldsMap(fields, pageNum) {
    /** @type {?} */
    var fieldsMap = {};
    for (var fieldIndex in fields) {
        if (fields.hasOwnProperty(fieldIndex) && fields[fieldIndex]) {
            /** @type {?} */
            var field = fields[fieldIndex];
            /** @type {?} */
            var keyNameSuffix = '';
            switch (field.type.toLowerCase()) {
                case 'checkbox':
                case 'checkbox_group':
                case 'radio_button_group':
                    keyNameSuffix = field['optionId'] ? '-' + field['optionId'] : '';
                    break;
                default:
                    break;
            }
            fieldsMap[field.name + keyNameSuffix] = {
                field_name: field.name,
                keyNameSuffix: field['optionId'] ? '-' + field['optionId'] : null,
                option_id: field['optionId'],
                field_pageNum: pageNum,
                field_field_index: fieldIndex
            };
        }
    }
    return fieldsMap;
}
/**
 * @param {?} fields
 * @param {?} _fields
 * @param {?} mode
 * @param {?} browserType
 * @return {?}
 */
export function updateElementStyles(fields, _fields, mode, browserType) {
    if (fields && _fields && fields.length === _fields.length) {
        for (var x = 0; x < _fields.length; x++) {
            /** @type {?} */
            var fieldIndex = findIndex(fields, { name: _fields[x].field_name });
            if (fieldIndex >= 0) {
                _fields[x]['initialStyle'] = getInputStyle(fields[fieldIndex], mode, browserType);
                if (_fields[x].controlType.toLowerCase() === 'checkbox' || _fields[x].controlType.toLowerCase() === 'checkbox_group' || _fields[x].controlType.toLowerCase() === 'radio_button_group') {
                    _fields[x]['checkboxStyle'] = generateCheckboxLabel(fields[fieldIndex].required);
                }
            }
        }
    }
    return _fields;
}
/**
 * @param {?} field
 * @param {?} mode
 * @param {?} browserType
 * @return {?}
 */
export function getInputStyle(field, mode, browserType) {
    /** @type {?} */
    var fontSize = 11;
    /** @type {?} */
    var setting = 'setting';
    if (!!field['settings']) {
        setting = 'settings';
    }
    /** @type {?} */
    var inputStyle = {
        'height': '100%',
        'width': '100%',
        'background': 'none'
    };
    if ((field[setting] && field[setting].font_size) || field.type === 'date' || field.type === 'signature' || field.type === 'initial' || field.type === 'timestamp') {
        inputStyle['fontSize'] = fontSize + 'px';
        inputStyle['letterSpacing'] = '.3px !important';
    }
    if (field.type === 'dropdown') {
        inputStyle['fontSize'] = '10.8px';
        delete inputStyle.background;
    }
    if (field.type === 'textbox') {
        inputStyle['fontSize'] = fontSize + 'px';
        inputStyle['letterSpacing'] = getLetterSpacing(browserType) + 'px';
    }
    if (field['required']) {
        inputStyle['border'] = '1px solid #cc0000';
    }
    if (field['prepared'] && field['prepared'] === true && mode !== 'prepareview') {
        inputStyle['visibility'] = 'hidden';
    }
    if (field[setting] && field[setting].color) {
        inputStyle['color'] = field[setting].color;
    }
    if (field[setting] && field[setting].upperCase) {
        inputStyle['textTransform'] = 'uppercase';
    }
    if (field[setting] && field[setting].leading > 0) {
        inputStyle['lineHeight'] = rescale(1, field[setting].leading + .5) + "px";
    }
    else if (field.leading && field.leading > 0) {
        inputStyle['lineHeight'] = rescale(1, field.leading + .5) + "px";
    }
    return inputStyle;
}
/**
 * @param {?} required
 * @return {?}
 */
export function generateCheckboxLabel(required) {
    /** @type {?} */
    var labelStyle = {
        position: 'absolute',
        top: 0,
        left: 0,
        cursor: 'pointer',
        height: "13.5px",
        width: "13.5px",
        backgroundColor: 'transparent',
        border: '1px solid #777'
    };
    if (required === true) {
        labelStyle['boxShadow'] = '0 0 0 1px #cc0000';
    }
    return labelStyle;
}
;
/**
 * @param {?} browserType
 * @return {?}
 */
export function getLetterSpacing(browserType) {
    switch (browserType) {
        case 'opera':
            return -0.0018;
        case 'firefox':
            return -0.23594210526315787;
        case 'ie':
            return -0.0019;
        case 'edge':
            return -0.0019;
        case 'chrome':
            return -0.0018;
        case 'safari':
            return -0.0018;
        case 'blink':
            return -0.0018;
        default:
            return -0.0018;
    }
}
/**
 * @param {?} r
 * @param {?} n
 * @return {?}
 */
export function rescale(r, n) {
    return r * n;
}
/**
 * @param {?} fields
 * @return {?}
 */
export function prepareFieldsForSigner(fields) {
    /** @type {?} */
    var fieldsForCurrentSigner = new Array(fields.length);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld2VyLWZpZWxkcy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL2Vzc2VudGlhbHMvIiwic291cmNlcyI6WyJsaWIvZnVuY3Rpb25zL3ZpZXdlci1maWVsZHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sUUFBUSxDQUFDOzs7Ozs7QUFFbkMsTUFBTSxVQUFVLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSTtJQUN0Qzs7OztXQUlPOzs7Ozs7O1FBRUQsT0FBTyxHQUFHLEVBQUU7O1FBQ2QsS0FBSyxHQUFHLENBQUM7O1FBQ1QsSUFBSTtJQUNSLFFBQVEsSUFBSSxFQUFFO1FBQ1osS0FBSyxZQUFZLENBQUM7UUFDbEIsS0FBSyxhQUFhLENBQUM7UUFDbkIsS0FBSyxTQUFTO1lBQ1osSUFBSSxHQUFHLGdCQUFnQixDQUFDO1lBQ3hCLE1BQU07UUFDUixLQUFLLFVBQVU7WUFDYixJQUFJLEdBQUcsV0FBVyxDQUFDO1lBQ25CLE1BQU07UUFDUjtZQUNFLElBQUksR0FBRyxnQkFBZ0IsQ0FBQztZQUN4QixNQUFNO0tBQ1Q7O1FBQ0csT0FBTyxHQUFHLFNBQVM7SUFFdkIsS0FBSyxJQUFNLFVBQVUsSUFBSSxNQUFNLEVBQUU7UUFDL0IsSUFBSSxNQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRTs7Z0JBQ3JELEtBQUssR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDOztnQkFDNUIsYUFBYSxHQUFHLEVBQUU7WUFDdEIsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUN2QixPQUFPLEdBQUcsVUFBVSxDQUFBO2FBQ3JCO1lBQUEsQ0FBQztZQUNGLFFBQVEsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRTtnQkFDaEMsS0FB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QUFHLG1CQUFtQixDQUFDO0tBQy9DO0lBQ0QsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQUFBLENBQUM7Ozs7O0FBRUYsTUFBTSxVQUFVLGdCQUFnQixDQUFDLFdBQVc7SUFDMUMsUUFBUSxXQUFXLEVBQUU7UUFDbkIsS0FBSyxPQUFPO1lBQ1YsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUNqQixLQUFLLFNBQVM7WUFDWixPQUFPLENBQUMsbUJBQW1CLENBQUM7UUFDOUIsS0FBSyxJQUFJO1lBQ1AsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUNqQixLQUFLLE1BQU07WUFDVCxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQ2pCLEtBQUssUUFBUTtZQUNYLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDakIsS0FBSyxRQUFRO1lBQ1gsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUNqQixLQUFLLE9BQU87WUFDVixPQUFPLENBQUMsTUFBTSxDQUFDO1FBQ2pCO1lBQ0UsT0FBTyxDQUFDLE1BQU0sQ0FBQztLQUNsQjtBQUNILENBQUM7Ozs7OztBQUVELE1BQU0sVUFBVSxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsQ0FBQzs7Ozs7QUFFRCxNQUFNLFVBQVUsc0JBQXNCLENBQUMsTUFBTTs7UUFDdkMsc0JBQXNCLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUN2RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHluYW1pY0ZpZWxkIH0gZnJvbSAnLi4vbW9kZWxzL2R5bmFtaWMtZmllbGQubW9kZWwnO1xuaW1wb3J0IHsgZmluZEluZGV4IH0gZnJvbSAnbG9kYXNoJztcblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkRmllbGRzKGZpZWxkcywgbW9kZSkge1xuICAvKlxuICAgICAqIFBERiA3MiBEUElcbiAgICAgKiBXaWR0aDogNjEycHhcbiAgICAgKiBIZWlnaHQ6IDc5MnB4XG4gICAgICogKi9cblxuICBjb25zdCBfZmllbGRzID0gW107XG4gIGxldCBvcmRlciA9IDA7XG4gIGxldCByb2xlO1xuICBzd2l0Y2ggKG1vZGUpIHtcbiAgICBjYXNlICdzaWduZXJ2aWV3JzpcbiAgICBjYXNlICdwcmVwYXJldmlldyc6XG4gICAgY2FzZSAncHJldmlldyc6XG4gICAgICByb2xlID0gJ3JlY2lwaWVudF9yb2xlJztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2xpdmV2aWV3JzpcbiAgICAgIHJvbGUgPSAncm9sZV9uYW1lJztcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICByb2xlID0gJ3JlY2lwaWVudF9yb2xlJztcbiAgICAgIGJyZWFrO1xuICB9XG4gIGxldCBzZXR0aW5nID0gJ3NldHRpbmcnO1xuXG4gIGZvciAoY29uc3QgZmllbGRJbmRleCBpbiBmaWVsZHMpIHtcbiAgICBpZiAoZmllbGRzLmhhc093blByb3BlcnR5KGZpZWxkSW5kZXgpICYmIGZpZWxkc1tmaWVsZEluZGV4XSkge1xuICAgICAgY29uc3QgZmllbGQgPSBmaWVsZHNbZmllbGRJbmRleF07XG4gICAgICBsZXQga2V5TmFtZVN1ZmZpeCA9ICcnO1xuICAgICAgaWYgKCEhZmllbGRbJ3NldHRpbmdzJ10pIHtcbiAgICAgICAgc2V0dGluZyA9ICdzZXR0aW5ncydcbiAgICAgIH07XG4gICAgICBzd2l0Y2ggKGZpZWxkLnR5cGUudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICBjYXNlICdhdHRhY2htZW50JzpcbiAgICAgICAgY2FzZSAncGF5bWVudCc6XG4gICAgICAgICAgZmllbGRbc2V0dGluZ11bJ3dpZHRoJ10gPSAyNDtcbiAgICAgICAgICBmaWVsZFtzZXR0aW5nXVsnaGVpZ2h0J10gPSAyNDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICBjYXNlICdjaGVja2JveF9ncm91cCc6XG4gICAgICAgIGNhc2UgJ3JhZGlvX2J1dHRvbl9ncm91cCc6XG4gICAgICAgICAgZmllbGRbc2V0dGluZ11bJ3dpZHRoJ10gPSAxMy41O1xuICAgICAgICAgIGZpZWxkW3NldHRpbmddWydoZWlnaHQnXSA9IDEzLjU7XG4gICAgICAgICAga2V5TmFtZVN1ZmZpeCA9IGZpZWxkWydvcHRpb25JZCddID8gJy0nICsgZmllbGRbJ29wdGlvbklkJ10gOiAnJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc2lnbmF0dXJlJzpcbiAgICAgICAgICBmaWVsZFtzZXR0aW5nXVsnd2lkdGgnXSA9IDgyLjYzNjM2MzYzNjM2O1xuICAgICAgICAgIGZpZWxkW3NldHRpbmddWydoZWlnaHQnXSA9IDM2O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdpbml0aWFsJzpcbiAgICAgICAgICBmaWVsZFtzZXR0aW5nXVsnd2lkdGgnXSA9IDgyLjYzNjM2MzYzNjM2O1xuICAgICAgICAgIGZpZWxkW3NldHRpbmddWydoZWlnaHQnXSA9IDM2O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmaWVsZFZhbHVlcyA9IG5ldyBEeW5hbWljRmllbGQoe1xuICAgICAgICBrZXk6IGZpZWxkLm5hbWUgKyBrZXlOYW1lU3VmZml4LFxuICAgICAgICB2YWx1ZTogZmllbGRbc2V0dGluZ11bJ3Jlc3VsdCddIHx8ICcnLFxuICAgICAgICByZXF1aXJlZDogZmllbGQucmVxdWlyZWQsXG4gICAgICAgIGNvbnRyb2xUeXBlOiBmaWVsZC50eXBlLFxuICAgICAgICBvcmRlcjogb3JkZXIrKyxcbiAgICAgICAgdmFsaWRhdG9yOiBmaWVsZC52YWxpZGF0b3IsXG4gICAgICAgIHNob3dDb3VudGVyOiBmYWxzZSxcbiAgICAgICAgcHJlcGFyZWQ6IGZpZWxkLnByZXBhcmVkIHx8IGZhbHNlLFxuICAgICAgICByZWNpcGllbnRSb2xlOiBmaWVsZFtyb2xlXSxcbiAgICAgICAgZmllbGRfbmFtZTogZmllbGQubmFtZSxcbiAgICAgICAgZGlydHk6IGZhbHNlXG4gICAgICB9KTtcblxuICAgICAgc3dpdGNoIChmaWVsZC50eXBlKSB7XG4gICAgICAgIGNhc2UgJ2F0dGFjaG1lbnQnOlxuICAgICAgICAgIGZpZWxkVmFsdWVzLnZhbHVlID0gZmllbGRbc2V0dGluZ11bJ25hbWUnXSA/IGZpZWxkW3NldHRpbmddWyduYW1lJ10gOiAnJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnY2hlY2tib3gnOlxuICAgICAgICAgIGZpZWxkVmFsdWVzLnZhbHVlID0gZmllbGRbc2V0dGluZ11bJ3Jlc3VsdCddID09PSBmYWxzZSA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncGF5bWVudCc6XG4gICAgICAgICAgZmllbGRWYWx1ZXMudmFsdWUgPSBmaWVsZFtzZXR0aW5nXVsncGF5bWVudF9pZCddID8gZmllbGRbc2V0dGluZ11bJ3BheW1lbnRfaWQnXSA6ICcnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdjaGVja2JveF9ncm91cCc6XG4gICAgICAgICAgZmllbGRWYWx1ZXMudmFsdWUgPSBmaWVsZFtzZXR0aW5nXVsnY2hlY2tlZCddO1xuICAgICAgICAgIGlmIChmaWVsZC5yZXF1aXJlZCB8fCBmaWVsZFtzZXR0aW5nXVsnbWF4aW11bV9jaGVja2VkJ10gPiAwKSB7XG4gICAgICAgICAgICBmaWVsZFZhbHVlc1snbWluX2NoZWNrZWQnXSA9IGZpZWxkW3NldHRpbmddWydtaW5pbXVtX2NoZWNrZWQnXTtcbiAgICAgICAgICAgIGZpZWxkVmFsdWVzWydtYXhfY2hlY2tlZCddID0gZmllbGRbc2V0dGluZ11bJ21heGltdW1fY2hlY2tlZCddO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmFkaW9fYnV0dG9uX2dyb3VwJzpcbiAgICAgICAgICBmaWVsZFZhbHVlcy52YWx1ZSA9IGZpZWxkW3NldHRpbmddWydzZWxlY3RlZCddO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdkcm9wZG93bic6XG4gICAgICAgICAgZmllbGRWYWx1ZXMudmFsdWUgPSBmaWVsZFtzZXR0aW5nXVsndmFsdWUnXTtcbiAgICAgICAgICBmaWVsZFZhbHVlc1snb3B0aW9ucyddID0gZmllbGRbc2V0dGluZ11bJ29wdGlvbnMnXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBicmVhaztcbiAgICAgIH07XG5cbiAgICAgIGlmIChmaWVsZFtzZXR0aW5nXVsndXJsJ10pIHtcbiAgICAgICAgZmllbGRWYWx1ZXNbJ3VybCddID0gZmllbGRbc2V0dGluZ11bJ3VybCddO1xuICAgICAgICBmaWVsZFZhbHVlc1snbmFtZSddID0gZmllbGRbc2V0dGluZ11bJ25hbWUnXTtcbiAgICAgICAgZmllbGRWYWx1ZXNbJ3ZhbHVlJ10gPSBmaWVsZFtzZXR0aW5nXVsnbmFtZSddO1xuICAgICAgfVxuXG4gICAgICBpZiAoZmllbGRzW2ZpZWxkSW5kZXhdKSB7XG4gICAgICAgIF9maWVsZHNbZmllbGRJbmRleF0gPSBmaWVsZFZhbHVlcztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIF9maWVsZHM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWVsZHNNYXAoZmllbGRzLCBwYWdlTnVtOiBudW1iZXIpIHtcbiAgbGV0IGZpZWxkc01hcCA9IHt9O1xuICBmb3IgKGNvbnN0IGZpZWxkSW5kZXggaW4gZmllbGRzKSB7XG4gICAgaWYgKGZpZWxkcy5oYXNPd25Qcm9wZXJ0eShmaWVsZEluZGV4KSAmJiBmaWVsZHNbZmllbGRJbmRleF0pIHtcbiAgICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2ZpZWxkSW5kZXhdO1xuICAgICAgbGV0IGtleU5hbWVTdWZmaXggPSAnJztcbiAgICAgIHN3aXRjaCAoZmllbGQudHlwZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgIGNhc2UgJ2NoZWNrYm94JzpcbiAgICAgICAgY2FzZSAnY2hlY2tib3hfZ3JvdXAnOlxuICAgICAgICBjYXNlICdyYWRpb19idXR0b25fZ3JvdXAnOlxuICAgICAgICAgIGtleU5hbWVTdWZmaXggPSBmaWVsZFsnb3B0aW9uSWQnXSA/ICctJyArIGZpZWxkWydvcHRpb25JZCddIDogJyc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBmaWVsZHNNYXBbZmllbGQubmFtZSArIGtleU5hbWVTdWZmaXhdID0ge1xuICAgICAgICBmaWVsZF9uYW1lOiBmaWVsZC5uYW1lLFxuICAgICAgICBrZXlOYW1lU3VmZml4OiBmaWVsZFsnb3B0aW9uSWQnXSA/ICctJyArIGZpZWxkWydvcHRpb25JZCddIDogbnVsbCxcbiAgICAgICAgb3B0aW9uX2lkOiBmaWVsZFsnb3B0aW9uSWQnXSxcbiAgICAgICAgZmllbGRfcGFnZU51bTogcGFnZU51bSxcbiAgICAgICAgZmllbGRfZmllbGRfaW5kZXg6IGZpZWxkSW5kZXhcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZpZWxkc01hcDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUVsZW1lbnRTdHlsZXMoZmllbGRzLCBfZmllbGRzLCBtb2RlLCBicm93c2VyVHlwZSkge1xuICBpZiAoZmllbGRzICYmIF9maWVsZHMgJiYgZmllbGRzLmxlbmd0aCA9PT0gX2ZpZWxkcy5sZW5ndGgpIHtcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IF9maWVsZHMubGVuZ3RoOyB4KyspIHtcbiAgICAgIGxldCBmaWVsZEluZGV4ID0gZmluZEluZGV4KGZpZWxkcywgeyBuYW1lOiBfZmllbGRzW3hdLmZpZWxkX25hbWUgfSk7XG4gICAgICBpZiAoZmllbGRJbmRleCA+PSAwKSB7XG4gICAgICAgIF9maWVsZHNbeF1bJ2luaXRpYWxTdHlsZSddID0gZ2V0SW5wdXRTdHlsZShmaWVsZHNbZmllbGRJbmRleF0sIG1vZGUsIGJyb3dzZXJUeXBlKTtcbiAgICAgICAgaWYgKF9maWVsZHNbeF0uY29udHJvbFR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2NoZWNrYm94JyB8fCBfZmllbGRzW3hdLmNvbnRyb2xUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICdjaGVja2JveF9ncm91cCcgfHwgX2ZpZWxkc1t4XS5jb250cm9sVHlwZS50b0xvd2VyQ2FzZSgpID09PSAncmFkaW9fYnV0dG9uX2dyb3VwJykge1xuICAgICAgICAgIF9maWVsZHNbeF1bJ2NoZWNrYm94U3R5bGUnXSA9IGdlbmVyYXRlQ2hlY2tib3hMYWJlbChmaWVsZHNbZmllbGRJbmRleF0ucmVxdWlyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBfZmllbGRzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5wdXRTdHlsZShmaWVsZCwgbW9kZSwgYnJvd3NlclR5cGUpIHtcbiAgY29uc3QgZm9udFNpemUgPSAxMTtcbiAgbGV0IHNldHRpbmcgPSAnc2V0dGluZyc7XG4gIGlmICghIWZpZWxkWydzZXR0aW5ncyddKSB7XG4gICAgc2V0dGluZyA9ICdzZXR0aW5ncyc7XG4gIH1cbiAgY29uc3QgaW5wdXRTdHlsZSA9IHtcbiAgICAnaGVpZ2h0JzogJzEwMCUnLFxuICAgICd3aWR0aCc6ICcxMDAlJyxcbiAgICAnYmFja2dyb3VuZCc6ICdub25lJ1xuICB9O1xuICBpZiAoKGZpZWxkW3NldHRpbmddICYmIGZpZWxkW3NldHRpbmddLmZvbnRfc2l6ZSkgfHwgZmllbGQudHlwZSA9PT0gJ2RhdGUnIHx8IGZpZWxkLnR5cGUgPT09ICdzaWduYXR1cmUnIHx8IGZpZWxkLnR5cGUgPT09ICdpbml0aWFsJyB8fCBmaWVsZC50eXBlID09PSAndGltZXN0YW1wJykge1xuICAgIGlucHV0U3R5bGVbJ2ZvbnRTaXplJ10gPSBmb250U2l6ZSArICdweCc7XG4gICAgaW5wdXRTdHlsZVsnbGV0dGVyU3BhY2luZyddID0gJy4zcHggIWltcG9ydGFudCc7XG4gIH1cblxuICBpZiAoZmllbGQudHlwZSA9PT0gJ2Ryb3Bkb3duJykge1xuICAgIGlucHV0U3R5bGVbJ2ZvbnRTaXplJ10gPSAnMTAuOHB4JztcbiAgICBkZWxldGUgaW5wdXRTdHlsZS5iYWNrZ3JvdW5kO1xuICB9XG5cbiAgaWYgKGZpZWxkLnR5cGUgPT09ICd0ZXh0Ym94Jykge1xuICAgIGlucHV0U3R5bGVbJ2ZvbnRTaXplJ10gPSBmb250U2l6ZSArICdweCc7XG4gICAgaW5wdXRTdHlsZVsnbGV0dGVyU3BhY2luZyddID0gZ2V0TGV0dGVyU3BhY2luZyhicm93c2VyVHlwZSkgKyAncHgnO1xuICB9XG4gIGlmIChmaWVsZFsncmVxdWlyZWQnXSkge1xuICAgIGlucHV0U3R5bGVbJ2JvcmRlciddID0gJzFweCBzb2xpZCAjY2MwMDAwJztcbiAgfVxuICBpZiAoZmllbGRbJ3ByZXBhcmVkJ10gJiYgZmllbGRbJ3ByZXBhcmVkJ10gPT09IHRydWUgJiYgbW9kZSAhPT0gJ3ByZXBhcmV2aWV3Jykge1xuICAgIGlucHV0U3R5bGVbJ3Zpc2liaWxpdHknXSA9ICdoaWRkZW4nO1xuICB9XG4gIGlmIChmaWVsZFtzZXR0aW5nXSAmJiBmaWVsZFtzZXR0aW5nXS5jb2xvcikge1xuICAgIGlucHV0U3R5bGVbJ2NvbG9yJ10gPSBmaWVsZFtzZXR0aW5nXS5jb2xvcjtcbiAgfVxuICBpZiAoZmllbGRbc2V0dGluZ10gJiYgZmllbGRbc2V0dGluZ10udXBwZXJDYXNlKSB7XG4gICAgaW5wdXRTdHlsZVsndGV4dFRyYW5zZm9ybSddID0gJ3VwcGVyY2FzZSc7XG4gIH1cblxuICBpZiAoZmllbGRbc2V0dGluZ10gJiYgZmllbGRbc2V0dGluZ10ubGVhZGluZyA+IDApIHtcbiAgICBpbnB1dFN0eWxlWydsaW5lSGVpZ2h0J10gPSBgJHtyZXNjYWxlKDEsIGZpZWxkW3NldHRpbmddLmxlYWRpbmcgKyAuNSl9cHhgO1xuICB9IGVsc2UgaWYgKGZpZWxkLmxlYWRpbmcgJiYgZmllbGQubGVhZGluZyA+IDApIHtcbiAgICBpbnB1dFN0eWxlWydsaW5lSGVpZ2h0J10gPSBgJHtyZXNjYWxlKDEsIGZpZWxkLmxlYWRpbmcgKyAuNSl9cHhgO1xuICB9XG5cbiAgcmV0dXJuIGlucHV0U3R5bGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUNoZWNrYm94TGFiZWwocmVxdWlyZWQpIHtcbiAgY29uc3QgbGFiZWxTdHlsZSA9IHtcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICB0b3A6IDAsXG4gICAgbGVmdDogMCxcbiAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICBoZWlnaHQ6IGAxMy41cHhgLFxuICAgIHdpZHRoOiBgMTMuNXB4YCxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgYm9yZGVyOiAnMXB4IHNvbGlkICM3NzcnXG4gIH1cbiAgaWYgKHJlcXVpcmVkID09PSB0cnVlKSB7XG4gICAgbGFiZWxTdHlsZVsnYm94U2hhZG93J10gPSAnMCAwIDAgMXB4ICNjYzAwMDAnO1xuICB9XG4gIHJldHVybiBsYWJlbFN0eWxlO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldExldHRlclNwYWNpbmcoYnJvd3NlclR5cGUpIHtcbiAgc3dpdGNoIChicm93c2VyVHlwZSkge1xuICAgIGNhc2UgJ29wZXJhJzpcbiAgICAgIHJldHVybiAtMC4wMDE4O1xuICAgIGNhc2UgJ2ZpcmVmb3gnOlxuICAgICAgcmV0dXJuIC0wLjIzNTk0MjEwNTI2MzE1Nzg3O1xuICAgIGNhc2UgJ2llJzpcbiAgICAgIHJldHVybiAtMC4wMDE5O1xuICAgIGNhc2UgJ2VkZ2UnOlxuICAgICAgcmV0dXJuIC0wLjAwMTk7XG4gICAgY2FzZSAnY2hyb21lJzpcbiAgICAgIHJldHVybiAtMC4wMDE4O1xuICAgIGNhc2UgJ3NhZmFyaSc6XG4gICAgICByZXR1cm4gLTAuMDAxODtcbiAgICBjYXNlICdibGluayc6XG4gICAgICByZXR1cm4gLTAuMDAxODtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIC0wLjAwMTg7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2NhbGUociwgbik6IG51bWJlciB7XG4gIHJldHVybiByICogbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByZXBhcmVGaWVsZHNGb3JTaWduZXIoZmllbGRzKSB7XG4gIGxldCBmaWVsZHNGb3JDdXJyZW50U2lnbmVyID0gbmV3IEFycmF5KGZpZWxkcy5sZW5ndGgpO1xufVxuIl19