!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@verdocs/sdk"),require("lodash"),require("print-js"),require("@angular/core"),require("@angular/common"),require("@angular/material/snack-bar"),require("@angular/common/http"),require("@angular/router"),require("rxjs"),require("@verdocs/tokens"),require("@verdocs/profiles"),require("@angular/material/dialog"),require("rxjs/operators"),require("@verdocs/event-tracker"),require("uuid"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define("@verdocs/essentials",["exports","@verdocs/sdk","lodash","print-js","@angular/core","@angular/common","@angular/material/snack-bar","@angular/common/http","@angular/router","rxjs","@verdocs/tokens","@verdocs/profiles","@angular/material/dialog","rxjs/operators","@verdocs/event-tracker","uuid","@angular/platform-browser"],t):t(((e=e||self).verdocs=e.verdocs||{},e.verdocs.essentials={}),e.sdk,e.lodash,e.printJS,e.ng.core,e.ng.common,e.ng.material["snack-bar"],e.ng.common.http,e.ng.router,e.rxjs,e.tokens,e.profiles,e.ng.material.dialog,e.rxjs.operators,e.eventTracker,e.uuid,e.ng.platformBrowser)}(this,function(exports,sdk,lodash,printJS,core,common,snackBar,http,router,rxjs,tokens,profiles,dialog,operators,eventTracker,uuid,platformBrowser){"use strict";printJS=printJS&&printJS.hasOwnProperty("default")?printJS.default:printJS;var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}function __decorate(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function __param(e,t){return function(r,i){t(r,i,e)}}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})}function __generator(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function __exportStar(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function __values(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,n,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return a}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function __spreadArrays(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(e,t||[]),o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){n[e]&&(i[e]=function(t){return new Promise(function(r,i){o.push([e,t,r,i])>1||s(e,t)})})}function s(e,t){try{(r=n[e](t)).value instanceof __await?Promise.resolve(r.value.v).then(c,l):u(o[0][2],r)}catch(e){u(o[0][3],e)}var r}function c(e){s("next",e)}function l(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function __asyncDelegator(e){var t,r;return t={},i("next"),i("throw",function(e){throw e}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(i,n){t[i]=e[i]?function(t){return(r=!r)?{value:__await(e[i](t)),done:"return"===i}:n?n(t):t}:n}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise(function(i,n){(function(e,t,r,i){Promise.resolve(i).then(function(t){e({value:t,done:r})},t)})(i,n,(t=e[r](t)).done,t.value)})}}}function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function __importStar(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function __importDefault(e){return e&&e.__esModule?e:{default:e}}var DynamicField=function(e){void 0===e&&(e={}),this.value=e.value,this.key=e.key||"",this.required=!!e.required,this.order=void 0===e.order?1:e.order,this.controlType=e.controlType||"",this.validator=void 0===e.validator?"":e.validator,this.maxLength=null==e.maxLength?null:e.maxLength,this.showCounter=!1!==e.showCounter&&e.showCounter,this.prepared=e.prepared,this.recipientRole=e.recipientRole,this.options=e.options,this.field_name=e.field_name,this.min_checked=e.min_checked,this.max_checked=e.max_checked,this.temp_sig=e.temp_sig,this.sig_id=e.sig_id,this.temp_int=e.temp_int,this.int_id=e.int_id,this.dirty=e.dirty,this.full_name=e.full_name,e.url&&(this.url=e.url),e.name&&(this.name=e.name)};function buildFields(e,t){var r,i=[],n=0;switch(t){case"signerview":case"prepareview":case"preview":r="recipient_role";break;case"liveview":r="role_name";break;default:r="recipient_role"}var o="setting";for(var a in e)if(e.hasOwnProperty(a)&&e[a]){var s=e[a],c="";switch(s.settings&&(o="settings"),s.type.toLowerCase()){case"attachment":case"payment":s[o].width=24,s[o].height=24;break;case"checkbox":case"checkbox_group":case"radio_button_group":s[o].width=13.5,s[o].height=13.5,c=s.optionId?"-"+s.optionId:"";break;case"signature":case"initial":s[o].width=82.63636363636,s[o].height=36}var l=new DynamicField({key:s.name+c,value:s[o].result||"",required:s.required,controlType:s.type,order:n++,validator:s.validator,showCounter:!1,prepared:s.prepared||!1,recipientRole:s[r],field_name:s.name,dirty:!1});switch(s.type){case"attachment":l.value=s[o].name?s[o].name:"";break;case"checkbox":l.value=!1!==s[o].result;break;case"payment":l.value=s[o].payment_id?s[o].payment_id:"";break;case"checkbox_group":l.value=s[o].checked,(s.required||s[o].maximum_checked>0)&&(l.min_checked=s[o].minimum_checked,l.max_checked=s[o].maximum_checked);break;case"radio_button_group":l.value=s[o].selected;break;case"dropdown":l.value=s[o].value,l.options=s[o].options}s[o].url&&(l.url=s[o].url,l.name=s[o].name,l.value=s[o].name),e[a]&&(i[a]=l)}return i}function getFieldsMap(e,t){var r={};for(var i in e)if(e.hasOwnProperty(i)&&e[i]){var n=e[i],o="";switch(n.type.toLowerCase()){case"checkbox":case"checkbox_group":case"radio_button_group":o=n.optionId?"-"+n.optionId:""}r[n.name+o]={field_name:n.name,keyNameSuffix:n.optionId?"-"+n.optionId:null,option_id:n.optionId,field_pageNum:t,field_field_index:i}}return r}function updateElementStyles(e,t,r,i){if(e&&t&&e.length===t.length)for(var n=0;n<t.length;n++){var o=lodash.findIndex(e,{name:t[n].field_name});o>=0&&(t[n].initialStyle=getInputStyle(e[o],r,i),"checkbox"!==t[n].controlType.toLowerCase()&&"checkbox_group"!==t[n].controlType.toLowerCase()&&"radio_button_group"!==t[n].controlType.toLowerCase()||(t[n].checkboxStyle=generateCheckboxLabel(e[o].required)))}return t}function getInputStyle(e,t,r){var i="setting";e.settings&&(i="settings");var n={height:"100%",width:"100%",background:"none"};return(e[i]&&e[i].font_size||"date"===e.type||"signature"===e.type||"initial"===e.type||"timestamp"===e.type)&&(n.fontSize="11px",n.letterSpacing=".3px !important"),"dropdown"===e.type&&(n.fontSize="10.8px",delete n.background),"textbox"===e.type&&(n.fontSize="11px",n.letterSpacing=getLetterSpacing(r)+"px"),e.required&&(n.border="1px solid #cc0000"),e.prepared&&!0===e.prepared&&"prepareview"!==t&&(n.visibility="hidden"),e[i]&&e[i].color&&(n.color=e[i].color),e[i]&&e[i].upperCase&&(n.textTransform="uppercase"),e[i]&&e[i].leading>0?n.lineHeight=rescale(1,e[i].leading+.5)+"px":e.leading&&e.leading>0&&(n.lineHeight=rescale(1,e.leading+.5)+"px"),n}function generateCheckboxLabel(e){var t={position:"absolute",top:0,left:0,cursor:"pointer",height:"13.5px",width:"13.5px",backgroundColor:"transparent",border:"1px solid #777"};return!0===e&&(t.boxShadow="0 0 0 1px #cc0000"),t}function getLetterSpacing(e){switch(e){case"opera":return-.0018;case"firefox":return-.23594210526315787;case"ie":case"edge":return-.0019;case"chrome":case"safari":case"blink":default:return-.0018}}function rescale(e,t){return e*t}function prepareFieldsForSigner(e){new Array(e.length)}function getDefaultHeight(e){var t=0;switch(e.type){case"signature":case"initial":t=36;break;case"checkbox":case"checkbox_group":case"radio_button_group":t=13.5;break;case"attachment":case"payment":t=24;break;default:t=e.setting.height||0}return t}function getDefaultWidth(e){var t=0;switch(e.type){case"signature":case"initial":t=82.63636363636;break;case"checkbox":case"checkbox_group":case"radio_button_group":t=13.5;break;case"attachment":case"payment":t=24;break;case"date":t=64;break;case"dropdown":t=e.setting.width||64;break;default:t=e.setting.width||0}return t}function getRTop(e,t,r,i){return r-(e+t)*i}function getRLeft(e,t){return e*t}function getRValue(e,t){return e*t}function getUIFieldStyling(e){var t=getDefaultHeight(e),r={left:e.setting.x+"px",bottom:e.setting.y+"px",height:"100%",width:"100%"};switch(e.type){case"textbox":case"date":case"timestamp":case"placeholder":case"dropdown":r.maxHeight=t+"px",r.maxWidth=e.setting.width+"px";break;case"checkbox":case"checkbox_group":case"radio_button_group":r.maxHeight="13.5px",r.maxWidth="13.5px";break;case"attachment":case"payment":r.maxHeight="24px",r.maxWidth="24px";break;case"signature":case"initial":r.maxHeight="36px",r.maxWidth="82.63636363636px",r["line-height"]="36px"}return r}function blobToBase64(e){var t=new FileReader;return new Promise(function(r,i){t.onerror=function(){i(new DOMException("Problem reading blob."))},t.onload=function(){r(t.result)},t.readAsDataURL(e)})}function setRatio(e,t){for(var r=0;r<e.length;r++)for(var i=0;i<e[r].fields.length;i++)e[r].fields[i]&&(e[r].fields[i].ratio={x:t[r].xRatio,y:t[r].yRatio});return e}function constructPages(e,t,r,i){if(e&&e.length>0){for(var n=new Array(e.length),o=0;o<e.length;o++){n[o]={fields:[]};for(var a=0;a<e[o].fields.length;a++)if(e[o].fields[a].setting&&e[o].fields[a].setting.options&&e[o].fields[a].setting.options.length>0&&"checkbox_group"===e[o].fields[a].type||"radio_button_group"===e[o].fields[a].type){var s=constructGroupFields(e,o,a,t,r,n,i);n[o].fields.concat(s)}else{var c=__assign({},e[o].fields[a]),l=lodash.findIndex(n[o].fields,{name:c.name});c.originalIndex=a,"checkbox_group"!==c.type&&"radio_button_group"!==c.type&&(c.initialStyle=generateInitialStyle(c,t,i),c.style=generateStyle(c,r)),"checkbox"!==c.type&&"checkbox_group"!==c.type&&"radio_button_group"!==c.type||(c.checkboxStyle=generateGroupLabel(o,c.role_name,t,r)),l<0&&(n[o].fields[n[o].fields.length]=c)}}return n}return[]}function constructGroupFields(e,t,r,i,n,o,a){for(var s=0,c=e[t].fields[r].setting.options.length;s<c;){var l=__assign({},e[t].fields[r]),u=e[t].fields[r].setting.options[s];l.setting.x=u.x,l.setting.y=u.y,"checkbox_group"===l.type?l.setting.checked=u.checked:l.setting.selected=u.selected,l.initialStyle=generateInitialStyle(l,i,a),l.style=generateStyle(l,n),l.checkboxStyle=generateGroupLabel(t,l.role_name,i,n),l.originalIndex=r,l.optionIndex=s,l.optionId=u.id,lodash.findIndex(o[t].fields,{optionIndex:l.optionIndex,name:l.name})<0&&(o[t].fields[o[t].fields.length]=l),s++}return o}function generateInitialStyle(e,t,r){var i=e.setting,n={height:"100%",width:"100%",backgroundColor:getRoleColor(e.role_name,t),letterSpacing:null,fontSize:null};switch(e.initialStyle=n,e.type){case"textbox":case"textarea":e.initialStyle.letterSpacing=convertToUIRatio(getLetterSpacing(r),e.ratio.x)+"px";case"signature":case"initial":case"date":case"dropdown":e.initialStyle.fontSize=convertToUIRatio(9.5,e.ratio.x)+"px";break;case"timestamp":e.initialStyle.fontSize=convertToUIRatio(8.5,e.ratio.x)+"px";break;case"attachment":case"payment":e.initialStyle.height="24px",e.initialStyle["mat-icon"]={position:"absolute",top:0,left:0,height:"24px",width:"24px",lineHeight:"24px",fontSize:"18px"}}return i.leading&&i.leading>0&&(e.initialStyle["line-height"]=convertToUIRatio(i.leading+.11395,e.ratio.y)+"px"),e.initialStyle}function generateStyle(e,t){return getUIFieldStyling(e)}function generateGroupLabel(e,t,r,i){return{position:"absolute",top:0,left:0,height:"13.5px",width:"13.5px",backgroundColor:getRoleColor(t,r),border:"2px solid #777"}}function getRoleColor(e,t,r){return r?sdk.getRGBA(r):t&&t.length>0&&(r=lodash.findIndex(t,{name:e}))>=0?t[r].rgba?t[r].rgba:sdk.getRGBA(r):sdk.nameToRGBA(e)}function convertToUIRatio(e,t){return e*t}function isInView(e,t,r){if(void 0===e)return null;if(window){var i=112;window.innerWidth>600&&(i=128);var n=window.innerHeight-i;return topOfPageIsInView(e,t,n)||middleOfPageIsInView(e,t,r,n)||bottomOfPageIsInView(e,t,r,n)}}function topOfPageIsInView(e,t,r){return t>e&&t<e+r}function middleOfPageIsInView(e,t,r,i){return e>t&&e+i<t+r}function bottomOfPageIsInView(e,t,r,i){var n=t+r;return e+i>n&&e<n}function timePeriod(e){var t=(new Date).getTime(),r=new Date,i=r.getMonth(),n=r.getFullYear(),o=null;switch(e){case"30d":o=t-2592e6;break;case"60d":o=t-5184e6;break;case"6m":o=t-15552e6;break;case"this_month":o=new Date(n,i,1).getTime();break;case"last_month":o=new Date(n,i-1,1).getTime(),t=new Date(n,i,0).getTime();break;case"this_year":o=new Date(n,0,1);break;case"all_time":default:o=null,t=null}return null==o&&null==t?null:{start_time:new Date(o).toISOString(),end_time:new Date(t).toISOString()}}function regParse(string){return JSON.parse(string,function(key,value){var prefix;return"string"!=typeof value?value:value.length<8?value:(prefix=value.substring(0,8),"function"===prefix?eval("("+value+")"):"_PxEgEr_"===prefix?eval(value.slice(8)):"_NuFrRa_"===prefix?eval(value.slice(8)):value)})}function dataURLtoBlob(e,t){void 0===t&&(t="image/png");for(var r=e.split(","),i=atob(r[1]),n=i.length,o=new Uint8Array(n);n--;)o[n]=i.charCodeAt(n);return new Blob([o],{type:t})}function printPdfUrl(e){"string"==typeof e?printJS(e):console.error("pdfUrl should be provided, instead received: ",e)}var SnackbarService=function(){function e(e,t){this.snackbar=e,this.platform=t}return e.prototype.initConfig=function(e,t){if(common.isPlatformBrowser(this.platform)){return window&&window.innerWidth>=920?{verticalPosition:t||"bottom",horizontalPosition:"left",duration:e||5e3}:{verticalPosition:t||"top",duration:e||5e3}}},e.prototype.open=function(e,t,r){return this.snackbar.open(e,t||void 0,r||this.initConfig())},e.prototype.dismiss=function(){this.snackbar.dismiss()},e.decorators=[{type:core.Injectable}],e.ctorParameters=function(){return[{type:snackBar.MatSnackBar},{type:void 0,decorators:[{type:core.Inject,args:[core.PLATFORM_ID]}]}]},e}();var BrowserToiTextService=function(){function e(){}return e.prototype.detectBrowser=function(){var e=!1;"InstallTrigger"in window&&(e=!0);var t=!!window.opr&&!!window.opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,r=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||window.safari&&window.safari.pushNotification).toString(),i=!!document.documentMode,n=!i&&!!window.StyleMedia,o=!!window.chrome&&!!window.chrome.webstore,a=(o||t)&&!!window.CSS;return t?"opera":e?"firefox":i?"ie":n?"edge":o?"chrome":a?"blink":r?"safari":"unknown"},e.prototype.getLetterSpacing=function(){switch(this.detectBrowser()){case"opera":return-.0018;case"firefox":return-.23594210526315787;case"ie":case"edge":return-.0019;case"chrome":case"safari":case"blink":default:return-.0018}},e.decorators=[{type:core.Injectable}],e}(),BuilderDataService=function(){function e(e,t,r,i,n,o,a){var s=this;this.http=e,this.router=t,this.templatesService=r,this.templateGuard=i,this.snackbarService=n,this.eventTracker=o,this.injector=a,this.recipients=[],this.roles=[],this.templateSubject=new rxjs.ReplaySubject(1,500),this.hasFields=!1,this.templateNameSubject=new rxjs.ReplaySubject(1,500),this.templatePagesSubject=new rxjs.ReplaySubject(1,500),this.recipientsSubject=new rxjs.ReplaySubject,this.activeRecipientSubject=new rxjs.ReplaySubject,this.scrollInfoSubject=new rxjs.ReplaySubject,this.screenInfoSubject=new rxjs.ReplaySubject,this.newTypeSubject=new rxjs.Subject,this.newOptionSubject=new rxjs.ReplaySubject(1,100),this.duplicateFieldSubject=new rxjs.ReplaySubject,this.saveStatusSubject=new rxjs.ReplaySubject,this.renderedSubject=new rxjs.ReplaySubject,this.activeFieldIndexSubject=new rxjs.ReplaySubject(1,100),this.numberOfRolesSubject=new rxjs.ReplaySubject,this.numberOfSequenceSubject=new rxjs.ReplaySubject,this.hasFieldsSubject=new rxjs.ReplaySubject,this._config_token=this.injector.get(EssentialsConfigToken),this.rForm_backend_url=this._config_token.rForm_backend_url,this.templateSubject.subscribe(function(e){s.template=e,e&&e.name&&s.templateNameSubject.next(e.name)}),this.templateNameSubject.subscribe(function(e){s.templateName=e})}return e.prototype.createTemplate=function(e){var t=this;return this.http.post(this.rForm_backend_url+"/templates",e).pipe(operators.map(function(e){return t.templateSubject.next(e),t.recipientsSubject.next([]),e}))},e.prototype.updateLocalTemplateData=function(){this.templateName=this.template.name,this.templateNameSubject.next(this.templateName),this.templatePages=this.template.pages.length,this.templatePagesSubject.next(this.templatePages)},e.prototype.updateTemplate=function(e){return this.templatesService.updateTemplateObservable(e.id,e).pipe(operators.map(function(e){return e}))},e.prototype.updateTemplateName=function(e,t){var r=this;if(e&&e.id)return this.templatesService.updateTemplateObservable(e.id,{name:t}).pipe(operators.map(function(i){return e.name=i.name,r.updateLocalTemplate(e),r.saveStatusSubject.next("saved"),r.createSnackBar("Name Changed to: "+t),i.name},function(e){return r.saveStatusSubject.next("Failed to save"),r.createSnackBar("Failed to change Template name"),e}));this.templateNameSubject.next(t),this.saveStatusSubject.next("Name will be updated")},e.prototype.getTemplateObservable=function(e){return this.templatesService.getTemplateObservable(e)},e.prototype.getTemplate=function(e){var t=this;return this.templatesService.getTemplate(e).toPromise().then(function(e){return t.updateLocalTemplate(e),t.recipients=t.sortRoles(t.template),t.template.roles=t.recipients,t.roles=t.recipients,t.recipientsSubject.next(t.recipients),t.activeRecipientSubject.next(t.recipients[0]),t.template})},e.prototype.watchForUpdatedTemplate=function(){return this.templateSubject.pipe(operators.map(function(e){return e}))},e.prototype.updateLocalTemplate=function(e){e?(this.template=e,this.template&&this.template.pages&&(this.template.pages=this.template.pages.sort(function(e,t){return e.sequence-t.sequence})),this.template&&(this.updateLocalTemplateData(),this.checkForFields(this.template.roles)),this.recipientsSubject.next(this.template.roles.sort(function(e,t){return e.sequence-t.sequence})),this.templateSubject.next(this.template)):(this.templateNameSubject.next(null),this.templatePagesSubject.next(null),this.numberOfRolesSubject.next(null),this.numberOfSequenceSubject.next(null),this.hasFieldsSubject.next(!1))},e.prototype.uploadTemplateDocument=function(e,t){var r=new FormData;r.append("document",e,e.name);var i=new http.HttpRequest("POST",this.rForm_backend_url+"/templates/"+t.id+"/documents",r,{reportProgress:!0});return this.http.request(i).pipe(operators.map(function(e){return e}),operators.catchError(function(e){return rxjs.throwError(e)}))},e.prototype.getTemplateDocument=function(e){var t=this;return this.templateDoc=this.templatesService.getAllTemplateDocumentsObservable(e).pipe(operators.map(function(e){return t.templateDoc=e[0],t.templateDoc})),this.templateDoc},e.prototype.getTemplateDocumentFile=function(e,t){if(e&&t)return this.templatesService.getTemplateDocumentPDFObservable(e,t).pipe(operators.map(function(e){return URL.createObjectURL(e)}))},e.prototype.setTemplateDocument=function(e){this.templateDoc=e},e.prototype.addTemplatePage=function(e,t,r){var i={sequence:t,page_number:t,document_id:e.id};return this.http.post(this.rForm_backend_url+"/templates/"+r+"/pages",i).pipe(operators.map(function(e){return e}),operators.catchError(function(e){return rxjs.throwError(e)}))},e.prototype.addTemplatePages=function(e,t,r){var i=this;return rxjs.from(t).pipe(operators.mergeMap(function(t){var n={sequence:t,page_number:t,document_id:e.id};return i.http.post(i.rForm_backend_url+"/templates/"+r+"/pages",n).pipe(operators.delay(200))}))},e.prototype.deleteTemplateField=function(e,t,r,i){var n=this;return this.http.delete(this.rForm_backend_url+"/templates/"+e.id+"/fields/"+t.trim()).pipe(operators.map(function(i){var o=lodash.findIndex(e.pages[r].fields,{name:t}),a=lodash.findIndex(e.roles,{name:e.pages[r].fields[o].role_name});if(a>-1){var s=lodash.findIndex(e.roles[a].fields,{name:t});s>-1&&e.roles[a].fields.splice(s,1)}return e.pages[r].fields.splice(o,1),n.updateLocalTemplate(e),n.saveStatusSubject.next("saved"),n.checkForFields(e.roles),e}))},e.prototype.deleteTemplateFields=function(e,t){var r,i;if(e&&e.length>0){var n=t.pages;try{for(var o=__values(e),a=o.next();!a.done;a=o.next())for(var s=a.value,c=0;c<n.length;c++){var l=lodash.findIndex(n[c].fields,{name:s});l>=0&&t.pages[c].fields.splice(l,1)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}this.checkForFields(t.roles)}},e.prototype.addTemplateField=function(e,t,r,i){var n=this;return e.name=e.name.trim(),this.http.post(this.rForm_backend_url+"/templates/"+e.template_id+"/fields",e).pipe(operators.map(function(o){n.eventTracker.createEvent({category:"document",action:"document "+o.type+" field added",label:"document id: "+e.template_id}),i.pages[t].fields[r]=o,n.checkForFields(i.roles);var a=lodash.findIndex(i.roles,{name:o.role_name});return a>=0&&i.roles[a].fields.push(o),n.templateSubject.next(i),i}))},e.prototype.getTemplateOwnerInfo=function(e){return this.templatesService.getTemplateOwnerInfo(e)},e.prototype.updateTemplateField=function(e,t,r,i,n){var o=this;return r=r.trim(),this.http.put(this.rForm_backend_url+"/templates/"+e.id+"/fields/"+r,t).pipe(operators.map(function(t){o.eventTracker.createEvent({category:"document",action:"document "+t.type+" field updated",label:"document id: "+e.id});var n=lodash.findIndex(e.pages[i].fields,{name:r});t.page_sequence-1!==i?(e.pages[i].fields.splice(n,1),e.pages[t.page_sequence-1].fields.push(t)):e.pages[i].fields[n]=t;var a=lodash.findIndex(e.roles,{name:t.role_name});return a>=0&&(e=o.updateRoleField(e,t,a,r)),o.templateSubject.next(e),o.saveStatusSubject.next("saved"),e}))},e.prototype.updateRoleField=function(e,t,r,i){var n=lodash.findIndex(e.roles[r].fields,{name:i});return n>=0?e.roles[r].fields[n]=t:e.roles[r].fields.push(t),e},e.prototype.updateDropdownField=function(e,t,r,i,n){var o=this;return r=r.trim(),this.http.put(this.rForm_backend_url+"/templates/"+e.id+"/fields/"+r,t).pipe(operators.map(function(t){var n=lodash.findIndex(e.pages[i].fields,{name:r});return e.pages[i].fields[n]=t,o.templateSubject.next(e),o.saveStatusSubject.next("saved"),e}))},e.prototype.deleteSequence=function(e,t){return this.templatesService.deleteSequence(e,t)},e.prototype.prepareFieldDuplication=function(e){this.duplicateFieldSubject.next(e)},e.prototype.checkForFields=function(e){var t,r,i=!0;if(e&&e.length>0)try{for(var n=__values(e),o=n.next();!o.done;o=n.next()){var a=o.value;a&&"signer"===a.type&&0===a.fields.length&&(i=!1)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}else i=!1;this.hasFields=i,this.hasFieldsSubject.next(this.hasFields)},e.prototype.createSnackBar=function(e,t){void 0===t&&(t="OK")},e.prototype.editDocsUrl=function(e){return"/builder/"+e+"/docs"},e.prototype.editRolesUrl=function(e){return"/builder/"+e+"/roles"},e.prototype.editTemplateUrl=function(e){return"/builder/"+e+"/fields"},e.prototype.previewTemplateUrl=function(e){return"/document/"+e},e.prototype.addFieldRole=function(e,t,r,i,n){var o=JSON.stringify({field_id:t,role_id:r});return this.http.post(this.rForm_backend_url+"/template/"+e+"/field_role",o).toPromise().then(function(e){return e})},e.prototype.addRole=function(e,t){var r=this,i=this.rForm_backend_url+"/templates/"+t.id+"/roles";this.roles=[],this.roles=this.roles.concat(e);var n=[];return this.roles.forEach(function(e){n.push(r.http.post(i,e))}),this.roles&&this.roles.length>0?rxjs.forkJoin(n).pipe(operators.map(function(e){e.concat(e),t.roles||(t.roles=[]);var i=e.map(function(e){return e.fields=[],e});return t.roles=t.roles.concat(i),r.recipients=r.sortRoles(t),r.roles=r.recipients,r.templateSubject.next(t),r.recipientsSubject.next(r.recipients),r.recipients,t},function(e){return console.error(e),console.error("Couldn't save all the roles"),e})):rxjs.of(t)},e.prototype.addCheckboxGroup=function(e){this.newOptionSubject.next({type:"checkbox_group",page_sequence:e.page_sequence,field_name:e.name})},e.prototype.addRadioGroup=function(e){this.newOptionSubject.next({type:"radio_button_group",page_sequence:e.page_sequence,field_name:e.name})},e.prototype.getRolesInSequence=function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r].sequence-1,n=__assign({},e[r]);n.style={backgroundColor:""+this.getRoleColor(n.name,r)},t[i]?t[i].push(n):t[i]=[n]}return this.numberOfSequenceSubject.next(t.length),this.numberOfRolesSubject.next(e.length),t},e.prototype.deleteRole=function(e,t){var r=this;return this.http.delete(this.rForm_backend_url+"/templates/"+t.id+"/roles/"+e).toPromise().then(function(){lodash.remove(t.roles,function(i){var n,o;if(r.recipients=r.sortRoles(t),i.name===e){var a=i.fields,s=[];try{for(var c=__values(a),l=c.next();!l.done;l=c.next()){var u=l.value;s.push(u.name)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}r.deleteTemplateFields(s,t)}return r.templateSubject.next(t),r.recipientsSubject.next(r.recipients),i.name===e})})},e.prototype.deleteRoles=function(e,t){var r=this,i=[];return e.forEach(function(e){t=__assign({},t,{roles:t.roles.filter(function(t){return t.name!==e})}),i.push(r.http.delete(r.rForm_backend_url+"/templates/"+t.id+"/roles/"+e))}),rxjs.forkJoin(i).pipe(operators.map(function(){return t},function(e){return console.error(e),console.error("Couldn't delete all the roles"),e}))},e.prototype.updateRoles=function(e,t){var r=this,i=[];return e.forEach(function(e){var n={template_id:t.id,name:e.name.trim(),full_name:e.full_name,email:e.email,sequence:e.sequence,type:e.type,delegator:e.delegator,message:e.message,phone:e.phone},o=lodash.findIndex(t.roles,{name:e.old_name});o>=0&&(t.roles[o]=__assign({},t.roles[o],{template_id:t.id,name:e.name.trim(),full_name:e.full_name,email:e.email,sequence:e.sequence,type:e.type,delegator:e.delegator,message:e.message,phone:e.phone})),r.eventTracker.createEvent({category:"document",action:"document role updated",label:"document id: "+t.id}),i.push(r.http.put(r.rForm_backend_url+"/templates/"+t.id+"/roles/"+e.old_name,n))}),rxjs.forkJoin(i).pipe(operators.map(function(){return t},function(e){return console.error(e),console.error("Couldn't save all the roles"),e}))},e.prototype.sortRoles=function(e){if(e.roles.length<1)return[];for(var t=e.roles.sort(function(e,t){return e.sequence===t.sequence?e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0:e.sequence-t.sequence}),r=0;r<t.length;r++)t[r].rgba=sdk.getRGBA(r);return e.roles=t,t},e.prototype.getRoleColor=function(e,t,r){return null!==t&&t>-1?sdk.getRGBA(t):r&&r.roles&&r.roles.length>0?(t=lodash.findIndex(r.roles,{name:e}))>=0?r.roles[t].rgba?r.roles[t].rgba:sdk.getRGBA(t):void 0:sdk.nameToRGBA(e)},e.prototype.updateFullName=function(e,t){for(var r=this,i=0;i<t.pages.length;i++)if(t.pages[i].fields.length>0)for(var n=0;n<t.pages[i].fields.length;n++)if("placeholder"===t.pages[i].fields[n].type&&"full_name"===t.pages[i].fields[n].setting.type&&t.pages[i].fields[n].setting.result!==e.full_name&&t.pages[i].fields[n].role_name===e.name){t.pages[i].fields[n].setting.result=e.full_name;var o=__assign({},t.pages[i].fields[n]);this.updateTemplateField(t,o,o.name,i,n).toPromise().then(function(){r.templateSubject.next(t)})}},e.prototype.setActiveFieldIndex=function(e){this.activeFieldIndex=e,this.activeFieldIndexSubject.next(this.activeFieldIndex)},e.prototype.autoAddSigner=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(r){return[2,new Promise(function(r,i){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.addRole({name:"Signer 1",type:"signer",sequence:1},e).toPromise()];case 1:return t=i.sent(),this.activeRecipientSubject.next(t[0]),setTimeout(function(){r()},500),[2]}})})})]})})},e.prototype.openTemplate=function(e){this.canUserPreview(e)?this.router.navigate(["document/"+e.id]):this.canUserEdit(e)?this.router.navigate(["builder/"+e.id+"/fields"]):this.snackbarService.open("Template is in build mode, and not ready for use.  Please check back soon.")},e.prototype.canUserEdit=function(e){return this.templateGuard.canPerformAction(sdk.TemplateActions.WRITE,e).canPerform},e.prototype.canUserPreview=function(e){var t,r,i,n=this.templateGuard.canPerformAction(sdk.TemplateActions.READ,e).canPerform,o=lodash.filter(e.roles,{type:"signer"});i=o&&o.length>0;try{for(var a=__values(o),s=a.next();!s.done;s=a.next()){var c=s.value;i=c.fields&&c.fields.length>0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n&&i},e.decorators=[{type:core.Injectable}],e.ctorParameters=function(){return[{type:http.HttpClient},{type:router.Router},{type:sdk.TemplatesService},{type:sdk.TemplatesGuardService},{type:SnackbarService},{type:eventTracker.EventTrackerService},{type:core.Injector}]},e}();var BuilderService=function(){function e(){this.sideNavStateSubject=new rxjs.ReplaySubject,this.recipientSideNavStateSubject=new rxjs.ReplaySubject(1,100),this.initiateAutofocus=new rxjs.ReplaySubject,this.recipientAutoFocus=new rxjs.ReplaySubject,this.deleteRoleSubject=new rxjs.ReplaySubject(1,100),this.hasActiveRoleSubject=new rxjs.ReplaySubject}return e.prototype.toggleSideNav=function(){this.sideNavState=!this.sideNavState,this.sideNavStateSubject.next(this.sideNavState),!1===this.sideNavState&&this.initiateAutofocus.next(!1)},e.prototype.toggleRecipientSideNav=function(){this.recipientSideNavState=!this.recipientSideNavState,this.recipientSideNavStateSubject.next(this.recipientSideNavState),!1===this.recipientSideNavState&&this.recipientAutoFocus.next(!1)},e.prototype.openSideNav=function(){this.sideNavState=!0,this.sideNavStateSubject.next(this.sideNavState)},e.prototype.openRecipientSideNav=function(){this.recipientSideNavState=!0,this.recipientSideNavStateSubject.next(this.recipientSideNavState)},e.prototype.closeSideNav=function(){this.sideNavState=!1,this.sideNavStateSubject.next(this.sideNavState),this.initiateAutofocus.next(!1)},e.prototype.closeRecipientSideNav=function(){this.recipientSideNavState=!1,this.recipientSideNavStateSubject.next(this.recipientSideNavState),this.recipientAutoFocus.next(!1)},e.prototype.setActiveRole=function(e){this.activeRole=e,this.hasActiveRoleSubject.next(!0)},e.prototype.deleteRole=function(){this.activeRole&&(this.deleteRoleSubject.next(this.activeRole),this.activeRole=null,this.hasActiveRoleSubject.next(!1))},e.prototype.getSideNavState=function(){return this.sideNavState},e.prototype.getRecipientSideNavState=function(){return this.recipientSideNavState},e.decorators=[{type:core.Injectable}],e}();var ConversionService=function(){function e(){this.ITextWidth=612,this.ITextHeight=792,this.XRatio=1,this.YRatio=1,this.a3Portrait={x:842,y:1191},this.a3Landscape={x:this.a3Portrait.y,y:this.a3Portrait.x},this.a4Portrait={x:595,y:842},this.a4Landscape={x:this.a4Portrait.y,y:this.a4Portrait.x},this.a5Portrait={x:420,y:595},this.a5Landscape={x:this.a5Portrait.y,y:this.a5Portrait.x},this.letterPortrait={x:612,y:792},this.letterLandscape={x:this.letterPortrait.y,y:this.letterPortrait.x},this.legalPortrait={x:612,y:1008},this.legalLandscape={x:this.legalPortrait.y,y:this.legalPortrait.x},this.portraitSizes=[this.a3Portrait,this.a4Portrait,this.a5Portrait,this.letterPortrait,this.legalPortrait],this.landscapeSizes=[this.a3Landscape,this.a4Landscape,this.a5Landscape,this.letterLandscape,this.legalLandscape],this.rFormWidth=0,this.rFormHeight=0,this.pageCache=[]}return e.prototype.setRValue=function(e,t){this.rFormWidth=e,this.rFormHeight=t},e.prototype.setPageCache=function(e){this.pageCache=e},Object.defineProperty(e.prototype,"xRatio",{get:function(){return this.XRatio},enumerable:!0,configurable:!0}),e.prototype.setXRatio=function(e){this.XRatio=e},Object.defineProperty(e.prototype,"yRatio",{get:function(){return this.YRatio},enumerable:!0,configurable:!0}),e.prototype.setYRatio=function(e){this.YRatio=e},e.prototype.getRTop=function(e,t,r,i){return r||(r=this.ITextHeight),i||(i=this.yRatio),r-(e+t)*i},e.prototype.getRValue=function(e,t){return t||(t=this.yRatio),e*t},e.prototype.getRLeft=function(e,t){return t||(t=this.xRatio),e*t},e.prototype.getITextLeft=function(e,t){return t||(t=this.xRatio),e/t},e.prototype.getITextBottomFromRTop=function(e,t,r,i){return r||(r=this.rFormHeight),r-e-t},e.prototype.getITextBottom=function(e){return e},e.prototype.getDefaultHeight=function(e){return getDefaultHeight(e)},e.prototype.getDefaultWidth=function(e){return getDefaultWidth(e)},e.prototype.getUIFieldStyling=function(e,t,r,i){return r||(r=this.xRatio),i||(i=this.yRatio),getUIFieldStyling(e)},e.prototype.getUIFieldSetting=function(e,t,r,i){var n;return"textbox"===e.type||"date"===e.type||"placeholder"===e.type?(n={width:e.setting.width?e.setting.width:150,height:e.setting.height?e.setting.height:15,x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,e.setting.height?e.setting.height:15,i)},"date"===e.type&&(n.width=64)):"timestamp"===e.type?n={width:e.setting.width?e.setting.width:64,height:e.setting.height?e.setting.height:15,x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,e.setting.height?e.setting.height:15,i)}:"signature"===e.type||"initial"===e.type?n={x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,36,i)}:"checkbox_group"===e.type?n={options:[{id:uuid.v4(),x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,13.5,i),checked:!1,value:"Option 1"}]}:"radio_button_group"===e.type?n={options:[{id:uuid.v4(),x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,13.5,i),selected:!1,value:"Option 1"}]}:"dropdown"===e.type?n={x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,15,i),width:e.setting.width?e.setting.width:64,height:e.setting.height?e.setting.height:15,value:null,placeholder:"Choose",options:[{id:uuid.v4(),value:"Option 1"}]}:"attachment"===e.type?n={x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,24,i),label:""}:"payment"===e.type&&(n={x:e.setting.x?e.setting.x:t,y:this.getITextBottomFromRTop(r,24,i),account_id:"",currency:"usd",payment_fee_type:"static",amount:1,if_transfer_fee:!1}),n},e.prototype.updateITextValues=function(e,t){this.ITextHeight=e,this.ITextWidth=t},e.decorators=[{type:core.Injectable}],e}();var SignatureService=function(){function e(e,t,r,i){this.httpClient=e,this.injector=t,this.envelopeSvc=r,this.vTokenStateService=i,this.workingField=new sdk.FieldData({order:0,fName:""}),this.fields=[],this._total=-1,this._fields=new rxjs.ReplaySubject,this._recipient=new rxjs.ReplaySubject,this._showSig=new rxjs.ReplaySubject,this._signedFields=new rxjs.BehaviorSubject({}),this._envId=new rxjs.ReplaySubject,this._rName=new rxjs.ReplaySubject,this.signImgSubject=new rxjs.ReplaySubject,this.initialImgSubject=new rxjs.ReplaySubject,this.initialIdSubject=new rxjs.ReplaySubject,this.signatureIdSubject=new rxjs.ReplaySubject,this.signedFields={},this.mode="",this._config_token=this.injector.get(EssentialsConfigToken),this._rForm_backend_url=this._config_token.rForm_backend_url,this.envUrl=this._rForm_backend_url+"/envelopes"}return e.prototype.setWorkingPayment=function(e){this.workingPayment=e},e.prototype.updateFields=function(e){this.fields=e,this._fields.next(this.fields)},e.prototype.postSignatureBlob=function(){var e=this.signatureBlob,t=new FormData;t.append("signature",e,e.name);var r=new http.HttpRequest("POST",this._rForm_backend_url+"/signatures",t);return this.httpClient.request(r).toPromise().then(function(e){if(e&&e.body)return e.body;console.error("Failed to upload signature image")})},e.prototype.postInitialBlob=function(){var e=this.initialBlob,t=new FormData;t.append("initial",e,e.name);var r=new http.HttpRequest("POST",this._rForm_backend_url+"/initials",t);return this.httpClient.request(r).toPromise().then(function(e){if(e&&e.body)return e.body;console.error("Failed to upload Initial")})},e.prototype.toggleSig=function(e){this._showSig.next(e)},e.prototype.setSigId=function(e){this.signatureId=e,this.signatureIdSubject.next(e)},e.prototype.setInitialId=function(e){this.initialId=e,this.initialIdSubject.next(e)},e.prototype.setSignImg=function(e){this.signImg=e,this.signImgSubject.next(this.signImg)},e.prototype.getSignImg=function(){return this.signImg},e.prototype.setInitialImg=function(e){this.initialImg=e,this.initialImgSubject.next(this.initialImg)},e.prototype.getInitialImg=function(){return this.initialImg},e.prototype.putSignatureField=function(e,t,r){var i=this;return new Promise(function(n,o){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.getPublicIp()];case 1:return i=o.sent(),this.httpClient.put(this.envUrl+"/"+e+"/fields/"+t+"/signature/"+r,{ip_address:i}).toPromise().then(function(e){return n(e)}),[2]}})})})},e.prototype.putInitialField=function(e,t,r){var i=this;return new Promise(function(n,o){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.getPublicIp()];case 1:return i=o.sent(),this.httpClient.put(this.envUrl+"/"+e+"/fields/"+t+"/initial/"+r,{ip_address:i}).toPromise().then(function(e){return n(e)}),[2]}})})})},e.prototype.updateEnvelopeField=function(e,t){if(this.workingField&&this.workingField.type){var r=this.getEnvelopeFieldValue(t);this.putEnvelopeField(e,r)}},e.prototype.getEnvelopeFieldValue=function(e){if(this.workingField&&this.workingField.type){var t={value:""};switch("boolean"==typeof e&&(t.prepared=e),this.workingField.type.toLowerCase()){case"textbox":case"checkbox":case"date":t.value=this.workingField.value}return t}return null},e.prototype.putEnvelopeField=function(e,t){var r=this;return new Promise(function(i,n){r.httpClient.put(r.envUrl+"/"+e+"/fields/"+r.workingField.fName,t).toPromise().then(function(e){return i(e)})})},e.prototype.updateGroupedField=function(e,t,r,i){var n=this;return"boolean"==typeof i&&(t.prepared=i),new Promise(function(i,o){n.httpClient.put(n.envUrl+"/"+e+"/fields/"+r,t).toPromise().then(function(e){return i(e)})})},e.prototype.prepareEnvelopeField=function(e,t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(n){switch(n.label){case 0:return this.workingField&&this.workingField.type?"textbox"===(r=this.workingField.type.toLowerCase())||"date"===r||"checkbox"===r?[3,1]:[2,!1]:[3,3];case 1:return[4,this.updateEnvelopeField(e,t)];case 2:if(i=n.sent())return[2,i.prepared];n.label=3;case 3:return[2,!1]}})})},e.prototype.getPublicIp=function(){return this.httpClient.jsonp("https://api.ipify.org?format=jsonp","callback=JSONP_CALLBACK").toPromise().then(function(e){return e.ip}).catch(function(e){return console.error("Failed to get ip",e),"ip_unavailable"})},e.prototype.updateCurrentField=function(e,t,r,i,n,o,a,s){this.workingField.fName=e,this.workingField.value=t,this.workingField.pageNum=i,this.workingField.id=n,this.workingField.vName=r,this.workingField.required=o,this.workingField.order=a,this.workingField.type=s},e.prototype.setCurrentFields=function(e){this.currentFields=e},Object.defineProperty(e.prototype,"currField",{get:function(){return this.workingField},enumerable:!0,configurable:!0}),e.prototype.errorMessages=function(e,t){return this.currentFields[e][t].error},e.prototype.setEnvId=function(e){this._envId.next(e)},e.prototype.setrName=function(e){this.rName=e,this._rName.next(e)},e.prototype.getSignatureUrl=function(e){if(e){var t=dataURLtoBlob(e);return URL.createObjectURL(t)}return null},e.prototype.setSignatureData=function(e){var t=dataURLtoBlob(e),r=URL.createObjectURL(t);this.signatureBlob=t,this.setSignImg(r)},e.prototype.setInitialData=function(e){var t=dataURLtoBlob(e),r=URL.createObjectURL(t);this.initialBlob=t,this.setInitialImg(r)},e.prototype.updateSigned=function(e,t){this.workingField.value="signed",this.signedFields[e]=t,this._signedFields.next(this.signedFields)},e.prototype.updateInitialed=function(e,t){this.workingField.value="initialed",this.signedFields[e]=t,this._signedFields.next(this.signedFields)},e.prototype.setSignatureId=function(e){this.signatureId=e,this.signatureIdSubject.next(e)},e.prototype.setRecipient=function(e){this._recipient.next(e)},e.prototype.setTotal=function(e){this._total=e},e.decorators=[{type:core.Injectable}],e.ctorParameters=function(){return[{type:http.HttpClient},{type:core.Injector},{type:sdk.DocumentsService},{type:tokens.VerdocsStateService}]},e}();var EnvelopeViewService=function(){function e(e){var t=this;this.signatureService=e,this.recipientSubject=new rxjs.ReplaySubject,this.jumpCoordinateSubject=new rxjs.ReplaySubject,this.fieldTypeSubject=new rxjs.ReplaySubject,this.pdfUrlSubject=new rxjs.ReplaySubject,this.pdfBlobSubject=new rxjs.ReplaySubject,this.toggleNextSubject=new rxjs.ReplaySubject,this.viewModeSubject=new rxjs.ReplaySubject,this.agreedSubject=new rxjs.ReplaySubject(1,500),this.attachmentsSubject=new rxjs.ReplaySubject,this.formValiditySubject=new rxjs.ReplaySubject,this.requestFormValiditySubject=new rxjs.ReplaySubject,this.signatureService._rName.subscribe(function(e){t.rName=e})}return e.prototype.setMode=function(e){this.mode=e,this.viewModeSubject.next(this.mode)},e.prototype.setSignatureService=function(e){this.signatureService=e},e.prototype.requestFormValidity=function(e){this.requestFormValiditySubject.next(e)},e.prototype.setFormValidityData=function(e){this.formValiditySubject.next(e)},e.prototype.ifBelongsToPreparer=function(e){return"textbox"===e||"date"===e||"checkbox"===e},e.prototype.ifBelongsToCurrentRecipient=function(e){return"prepareview"===this.mode?this.ifBelongsToPreparer(e.controlType):e.recipientRole===this.rName},e.decorators=[{type:core.Injectable}],e.ctorParameters=function(){return[{type:SignatureService}]},e}();var Robots={Noindex:"Noindex",Index:"Index",Follow:"Follow",Noimageindex:"Noimageindex",None:"None",Noarchive:"Noarchive",Nocache:"Nocache",Nosnippet:"Nosnippet"},PageService=function(){function e(e,t,r,i,n,o,a,s,c,l){this.titleService=e,this.injector=t,this.meta=r,this.rendererFactory=i,this.activatedRoute=n,this.router=o,this.vTokenStateService=a,this.tokenObject=s,this.platform=c,this.document=l,this.segmentIsInitialized=!1,this.lazyTitle=!1,this._config_token=this.injector.get(EssentialsConfigToken)}return e.prototype.inti=function(){var e=this;this.initializeSegment(),setTimeout(function(){e.additionalSetupForWidgets()},500),this.router.events.pipe(operators.filter(function(e){return e instanceof router.NavigationEnd}),operators.map(function(){return e.activatedRoute}),operators.map(function(e){for(var t=e;t.firstChild;)t=t.firstChild;return t}),operators.switchMap(function(e){return e.data}),operators.map(function(t){return e.lazyTitle=t.lazyTitle,t.title})).subscribe(function(t){e.lazyTitle?e.lazyTitle=!1:e.setTitleAndRecord(t)})},e.prototype.setTitleAndRecord=function(e,t){var r="Verdocs";common.isPlatformBrowser(this.platform)?this.document.cookie.includes(this._config_token.rForm_cookie_name)&&(r=e||"Verdocs",window.analytics.page(t||r)):r="Verdocs"+(e?" | "+e:""),this.titleService.setTitle(r)},e.prototype.setMetaProperty=function(e,t){t?this.getMetaTagProperty(e)?this.meta.updateTag({property:e,content:t},'property="'+e+'"'):this.meta.addTag({property:e,content:t},!0):this.getMetaTagProperty(e)&&this.meta.removeTag("property=“"+e+"”")},e.prototype.setMetaName=function(e,t){t?this.getMetaTagProperty(e)?this.meta.updateTag({property:e,content:t},'name="'+e+'"'):this.meta.addTag({property:e,content:t},!0):this.getMetaTagProperty(e)&&this.meta.removeTag("name=“"+e+"”")},e.prototype.setOpenGraphMeta=function(e,t,r,i,n){e&&this.setMetaProperty("og:type",e),t&&this.setMetaProperty("og:title",t),r&&this.setMetaProperty("og:description",r),i&&this.setMetaProperty("og:image",i),n&&this.setMetaProperty("og:url",n),this.getMetaTagProperty("og:site_name")||this.meta.addTag({property:"og:site_name",content:"Verdocs"})},e.prototype.setRobotMeta=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r="",i=0;i<e.length;i++)e[i]&&(i===e.length-1?r+=e[i]:r+=e[i]+", ");var n=r;this.setMetaName("robots",n)},e.prototype.setCanonicalUrl=function(e){e.href||(e.href=this.document.url),this.addTag(e)},e.prototype.setDescriptionMeta=function(e){this.getMetaTag("description")?e?this.meta.updateTag({name:"description",content:e},"name='description'"):this.meta.removeTag("name='description'"):e&&this.meta.addTag({name:"description",content:e},!0)},e.prototype.getMetaTag=function(e){return this.meta.getTag("name='"+e+"'")},e.prototype.getMetaTagProperty=function(e){return this.meta.getTag("property='"+e+"'")},e.prototype.initializeSegment=function(){var e=this;if(common.isPlatformBrowser(this.platform)){var t=window.analytics;if(document.cookie.includes(this._config_token.rForm_cookie_name))var r=this.vTokenStateService.decodedIdTokenSubject.subscribe(function(i){if(r.unsubscribe(),!e.segmentIsInitialized){e.segmentIsInitialized=!0,t.reset();var n=e.tokenObject.getProfile();t.identify(i.sub,{userId:i.sub,email:i.email,name:i.name,"Verdoc plan":e.planType("verdoc"),"Organization plan":e.planType("organization"),"Current Profile Id":e.tokenObject.getProfileID(),"Current Company":n.organization.name,company:{id:n.organization_id,name:n.organization.name}},{Intercom:{hideDefaultLauncher:!0}})}})}},e.prototype.robotEnum=function(){return Robots},e.prototype.planType=function(e){var t="undefined";switch(e){case"verdoc":t="env";break;case"organization":t="org"}var r=this.tokenObject.getPlans().find(function(e){return e.includes(t)}),i="None";return r&&(i="env"===t?r.includes("pro")?"Pro":"Essential":r.includes("premium")?"Premium":"Standard"),i},e.prototype.addTag=function(e,t){var r=this.rendererFactory.createRenderer(this.document,{id:"-1",encapsulation:core.ViewEncapsulation.None,styles:[],data:{}}),i=r.createElement("link"),n=this.document.head,o=this._parseSelector(e);Object.keys(e).forEach(function(t){return r.setAttribute(i,t,e[t])});try{if(null===n)throw new Error("<head> not found within DOCUMENT.");var a=r.selectRootElement(o);a?(r.removeAttribute(a,"href"),r.setAttribute(a,"href",e.href)):r.appendChild(n,i)}catch(e){r.appendChild(n,i)}},e.prototype._parseSelector=function(e){var t=e.rel?"rel":"hreflang";return"link["+t+'="'+e[t]+'"]'},e.prototype.additionalSetupForWidgets=function(){common.isPlatformBrowser(this.platform)&&(window.Intercom&&(window.Intercom("onHide",function(){window.intercomIsOpen=!1}),window.Intercom("onShow",function(){window.intercomIsOpen=!0})),window.lunchIntercom=function(){window.Intercom?window.intercomIsOpen&&!0===window.intercomIsOpen?window.Intercom("hide"):window.Intercom("show"):console.error("Intercom is not loaded!")},window.lunchElevio=function(){window._elev?window._elev.widgetIsOpen()?window._elev.close():window._elev.open():console.error("Elevio is not loaded!")})},e.ctorParameters=function(){return[{type:platformBrowser.Title},{type:core.Injector},{type:platformBrowser.Meta},{type:core.RendererFactory2},{type:router.ActivatedRoute},{type:router.Router},{type:tokens.VerdocsStateService},{type:tokens.VerdocsTokenObjectService},{type:void 0,decorators:[{type:core.Inject,args:[core.PLATFORM_ID]}]},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]},e}();var ModalService=function(){function e(){this.modals=[],this.subject=new rxjs.Subject}return e.prototype.add=function(e){this.modals.push(e)},e.prototype.open=function(e){lodash.find(this.modals,{id:e})},e.prototype.close=function(e){lodash.find(this.modals,{id:e}).close()},e.prototype.setComponentData=function(e){this.componentData=e,this.subject.next(e)},e.prototype.getComponentData=function(){return this.subject.asObservable()},e.decorators=[{type:core.Injectable}],e}();var FourOhOneDialog=function(){function e(e,t,r){this.router=e,this.injector=t,this.vTokenObjectService=r,this.error=null,this.currentProfile=null,this.error_code=null,this.error_title=null,this.error_message=null,this._config_token=this.injector.get(EssentialsConfigToken),this.rSecureUrl=this._config_token.rSecure_frontend_url,this.rFormUrl=this._config_token.rForm_frontend_url}return e.prototype.ngOnInit=function(){this.currentProfile=this.vTokenObjectService.getProfile(),this.error&&this.error.hasOwnProperty("error")&&(this.error_code=this.error.error.code||null,this.error_code&&this.prepareErroContent())},e.prototype.prepareErroContent=function(){switch(this.error_code){case"AUTH0002":this.error_title="Authorization key is missing",this.error_message="Try after "+(this.currentProfile?"signing in again.":"signing in or signing up.");break;case"T000001":this.error_title="This document is not accessible",this.error_message=(this.currentProfile?"Try using a different organization/account, ":"Try signing in, signing up, ")+"or requesting access from the owner of this document.";break;case"AUTH0003":this.error_title="Cannot complete your request",this.error_message="Try after "+(this.currentProfile?"signing in again.":"signing in or signing up.");break;default:this.error_title="Your request has been denied.",this.error_message=null}},e.prototype.goToDashboard=function(){this.router.navigate(["/dashboard"])},e.prototype.signIn=function(){window&&(window.location.href=this.rSecureUrl+"/login?redirect_url="+(this.rFormUrl+this.router.url))},e.prototype.signUp=function(){window&&(window.location.href=this.rSecureUrl+"/signup?redirect_url="+(this.rFormUrl+this.router.url))},e.decorators=[{type:core.Component,args:[{selector:"four-oh-one-dialog",template:'<div class="error__container">\n  <div class="error__title">\n    {{error_title}}\n  </div>\n  <div class="error__body" *ngIf="error_message">\n    {{error_message}}\n  </div>\n  <div class="error__action">\n    <button class="error__action-button left" mat-button *ngIf="currentProfile" (click)="goToDashboard()">go to dashboard</button>\n    <button class="error__action-button left" mat-button *ngIf="!currentProfile" (click)="signUp()">sign up</button>\n    <button class="error__action-button" mat-button (click)="signIn()">sign in</button>\n  </div>\n</div>',styles:[".error__container{padding-top:8px;padding-left:8px;padding-right:8px;max-width:640px}.error__title{padding:16px 16px 8px;font-size:20px;line-height:24px;font-weight:500;color:rgba(0,0,0,.87)}.error__body{padding:16px 16px 8px;font-size:16px;line-height:24px;color:rgba(0,0,0,.54)}.error__action{padding:8px;text-align:right}.error__action-button{color:#37474f;text-transform:uppercase}.error__action-button.left{margin-right:8px}"]}]}],e.ctorParameters=function(){return[{type:router.Router},{type:core.Injector},{type:tokens.VerdocsTokenObjectService}]},e}();var PlansDialog=function(){function e(e,t){this.router=e,this.dialog=t,this.redirectUrl=null,this.type=null,this.dialogTitle=null,this.dialogMessage=null}return e.prototype.ngOnInit=function(){switch(this.type){case"free":this.dialogTitle="Upgrade to create another document",this.dialogMessage="We are glad to see you are drawing value from Verdocs. You have reached your limit of three documents per month with your free account. Please upgrade to an Essentials or Pro subscription to create more documents.";break;case"essential":this.dialogTitle="Upgrade to access this feature",this.dialogMessage="This feature requires an essentials subscription or above. Please upgrade to access this feature.";break;case"pro":this.dialogTitle="Upgrade to access this feature",this.dialogMessage="This feature requires a pro subscription. Please upgrade to access this feature.";break;default:this.dialog.close()}},e.prototype.goToBilling=function(){window&&this.redirectUrl&&this.type?window.location.href=this.redirectUrl:this.dialog.close()},e.prototype.close=function(){this.dialog.close()},e.decorators=[{type:core.Component,args:[{selector:"plans-dialog",template:'<div class="plans-dialog__container">\n  <div class="plans-dialog__title">{{dialogTitle}}</div>\n  <div class="plans-dialog__message">\n      {{dialogMessage}}\n  </div>\n  <div class="plans-dialog__action">\n    <button class="plans-dialog__button" mat-button (click)="goToBilling()">let\'s go</button>\n    <button class="plans-dialog__button" mat-button (click)="close()">not now</button>\n  </div>\n</div>',styles:[".plans-dialog__title{padding:16px;font-size:24px;font-weight:500;color:rgba(0,0,0,.87)}.plans-dialog__message{padding:0 16px 16px;font-size:16px;line-height:24px;color:rgba(0,0,0,.54)}.plans-dialog__action{padding-top:8px;text-align:right}.plans-dialog__button{color:#37474f;text-transform:uppercase}"]}]}],e.ctorParameters=function(){return[{type:router.Router},{type:dialog.MatDialogRef}]},e}();core.Injectable();var ErrorDialogService=function(){function e(e){this.dialog=e}return e.prototype.show401ResponseError=function(e){this.dialog.open(FourOhOneDialog,{panelClass:"error_dialog",disableClose:!0}).componentInstance.error=e},e.prototype.showPlansError=function(e,t,r,i){var n=this.dialog.open(PlansDialog,{panelClass:"error_dialog",disableClose:!0});e&&(n.componentInstance.type=e),t&&(n.componentInstance.type=t),r&&(n.componentInstance.dialogTitle=r),i&&(n.componentInstance.dialogMessage=i)},e}();var GuardService=function(){function e(e,t,r,i){this.injector=e,this.stateService=t,this.dialog=r,this.platform=i,this._redirectUrl=null,this._config_token=this.injector.get(EssentialsConfigToken),this._plans=this._config_token.plans,this._rAccount_frontend_url=this._config_token.rAccount_frontend_url}return e.prototype.checkSubscription=function(e,t,r){var i=this.stateService.getIDToken(),n=this.toTokenObject(i).sub.slice(6);switch(this._redirectUrl=this._rAccount_frontend_url+"/rAccount/user/"+n+"/billing",e){case"reminders":if(t===this._plans["level-2"]||t===this._plans["level-3"])return!0;if(!0===r){var o=this.dialog.open(PlansDialog,{panelClass:"confirmation"});o.componentInstance.type="essential",o.componentInstance.redirectUrl=this._redirectUrl}return!1;case"live-link":case"attachment":case"payment":if(t===this._plans["level-3"])return!0;if(!0===r){var a=this.dialog.open(PlansDialog,{panelClass:"confirmation"});a.componentInstance.type="pro",a.componentInstance.redirectUrl=this._redirectUrl}return!1;case"open-free-envelopes":var s=this.dialog.open(PlansDialog,{panelClass:"confirmation"});return s.componentInstance.type="free",s.componentInstance.redirectUrl=this._redirectUrl,!1;default:return!1}},e.prototype.toTokenObject=function(e){if(common.isPlatformBrowser(this.platform)){var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(t))}},e.prototype.getHighestEnvelopePlan=function(e){for(var t=null,r=0;r<e.length;r++)e[r]===this._plans["level-3"]?t=e[r]:e[r]!==this._plans["level-2"]||null!==t&&"env:free"!==t?e[r]===this._plans["level-1"]&&null===t&&(t=e[r]):t=e[r];return t},e.decorators=[{type:core.Injectable}],e.ctorParameters=function(){return[{type:core.Injector},{type:tokens.VerdocsStateService},{type:dialog.MatDialog},{type:void 0,decorators:[{type:core.Inject,args:[core.PLATFORM_ID]}]}]},e}();function EssentialsConfig(){}var EssentialsConfigToken=new core.InjectionToken("EssentialsConfig"),EssentialsModule=function(){function e(){}return e.initializeEssentials=function(t){return{ngModule:e,import:[common.CommonModule,sdk.AngularApiModule.initSDK({production:t.production,domain:t.domain,origin:t.origin,loginURL:t.loginURL,rForm_backend_url:t.rForm_backend_url,rForm_frontend_url:t.rForm_frontend_url,rSecure_backend_url:t.rSecure_backend_url,rSecure_frontend_url:t.rSecure_frontend_url,rAccount_backend_url:t.rAccount_backend_url,rAccount_frontend_url:t.rAccount_frontend_url,rNotification_backend_url:t.rNotification_backend_url,plans:t.plans}),dialog.MatDialogModule],providers:[{provide:EssentialsConfigToken,useValue:t},SnackbarService,AccountService,BrowserToiTextService,BuilderDataService,BuilderService,ConversionService,SignatureService,EnvelopeViewService,PageService,ModalService,ErrorDialogService,GuardService],declarations:[FourOhOneDialog,PlansDialog],EntryComponents:[FourOhOneDialog,PlansDialog],exports:[FourOhOneDialog,PlansDialog]}},e.decorators=[{type:core.NgModule,args:[{imports:[common.CommonModule],providers:[],declarations:[FourOhOneDialog,PlansDialog]}]}],e}(),AccountService=function(){function e(e,t,r,i){this.http=e,this.router=t,this.vTokenStateService=r,this.injector=i,this.userDataSubject=new rxjs.ReplaySubject,this.userProfileSubject=new rxjs.ReplaySubject,this.profileLoadingSubject=new rxjs.ReplaySubject,this.currentProfileSubject=new rxjs.ReplaySubject,this.personalAccountSubject=new rxjs.ReplaySubject,this.profilesSubject=new rxjs.ReplaySubject,this.userFullname="",this.userInitial="",this.userEmail="",this.userPhone="",this.userData={name:this.userFullname,initial:null,email:this.userEmail,phone:this.userPhone},this.currentOrganizationId=null,this._config_token=this.injector.get(EssentialsConfigToken),this.backend_url=this._config_token.rAccount_backend_url,this.rForm_backend_url=this._config_token.rForm_backend_url,this.rSecure_backend_url=this._config_token.rSecure_backend_url}return e.prototype.getAccountData=function(){this.getProfiles()},e.prototype.getProfiles=function(){var e=this;return this.http.get(this.backend_url+"/profiles").toPromise().then(function(t){var r=t.splice(lodash.findIndex(t,function(e){return"realster"===e.organization.name}),1);e.personalAccountSubject.next(r[0]),e.profileData=t.sort(function(e,t){return e.organization.name<t.organization.name?-1:e.organization.name>t.organization.name?1:0}),e.profileData.unshift(r[0]);var i=lodash.findIndex(e.profileData,{current:!0});e.profileData[i].first_name?(e.userFullname=e.profileData[i].first_name+" "+e.profileData[i].last_name,e.userInitial=e.profileData[i].first_name.charAt(0)+e.profileData[i].last_name.charAt(0)):e.userFullname="",e.profileData[i].phone?e.userPhone=e.profileData[i].phone:e.userPhone="",e.profileData[i].email&&(e.userEmail=e.profileData[i].email),e.userData={name:e.userFullname,initial:e.userInitial,email:e.userEmail,phone:e.userPhone},e.userProfileSubject.next(e.profileData);var n=e.profileData[i];return e.currentProfileSubject.next(n),e.currentOrganizationId=n.organization_id,e.userDataSubject.next(e.userData),e.userData})},e.prototype.getProfileCollection=function(e){var t=[];return e.forEach(function(e){t.push(new profiles.ProfileModel(e))}),new profiles.ProfileCollection(t)},e.prototype.removeFromProfileData=function(e){var t=lodash.findIndex(this.profileData,{organization_id:name});t>=0&&(this.profileData.splice(t,1),this.userProfileSubject.next(this.profileData))},e.prototype.getAllProfiles=function(){return this.http.get(this.backend_url+"/profiles/").toPromise()},e.prototype.switchProfile=function(e){var t=this;return this.profileLoadingSubject.next(!0),this.http.post(this.backend_url+"/profiles/"+e+"/switch",null).toPromise().then(function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return this.vTokenStateService.setTokens(e.tokens),this.profileLoadingSubject.next(!1),[2,Promise.resolve(e)]})})})},e.prototype.updateTokens=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(r){return[2,new Promise(function(r,i){t.vTokenStateService.updateTokens(t.rSecure_backend_url).subscribe(function(i){return i&&i.length>0&&e&&t.createSnackbar("Status updated"),t.getAccountData(),r()})})]})})},e.prototype.resendEmailVerification=function(){var e=this;this.http.post(this.rSecure_backend_url+"/user/email_verification",null).toPromise().then(function(){e.createSnackbar("Verification email sent")})},e.prototype.createSnackbar=function(e){},e.prototype.putAccountData=function(e){var t=this;e.email&&(this.userData.email=e.email),e.first_name&&e.last_name&&(this.userData.name=e.first_name+" "+e.last_name,this.userData.initial=e.first_name.charAt(0)+e.last_name.charAt(0)),e.phone&&(this.userData.phone=e.phone||""),this.http.put(this.backend_url+"/profiles/"+e.id,e).toPromise().then(function(){t.userDataSubject.next(t.userData)})},e.prototype.deleteAccount=function(){return this.http.delete(this.backend_url).toPromise()},e.prototype.changePassword=function(e,t,r){return this.http.put(this.backend_url+"updatepassword",{email:e,oldPassword:t,newPassword:r}).toPromise()},e.prototype.getNameValidity=function(e){return this.http.get(this.backend_url+"/organizations/is_valid?name="+e,this.getOptions()).toPromise().then(function(e){return Promise.resolve(e)})},e.prototype.createOrganization=function(e){return this.http.post(this.backend_url+"/organizations",e,this.getOptions()).toPromise().then(function(e){return Promise.resolve(e)})},e.prototype.getOptions=function(){var e="Bearer "+this.vTokenStateService.getOtherCookieObject("rAccount_Verdocs").accessToken;return{headers:new Headers({"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"Sat, 01 Jan 2000 00:00:00 GMT","If-Modified-Since":"0","Content-Type":"application/json",Authorization:e,Accept:"application/json"})}},e.prototype.fetchToken=function(e,t,r,i){var n=this,o=this.rForm_backend_url+"/envelopes/"+e+"/recipients/"+t+"/invitation/"+r;return this.http.get(o,{observe:"response"}).subscribe(function(r){n.vTokenStateService.storeOtherCookie("signer_token",r.headers.get("signer_token")),i?n.router.navigate(["/view/sign/"+e+"/role/"+t],{queryParams:{redirectReq:i}}):n.router.navigate(["/view/sign/"+e+"/role/"+t])},function(r){n.router.navigate(["/view/sign/"+e+"/role/"+t,{error:r}])})},e.decorators=[{type:core.Injectable}],e.ctorParameters=function(){return[{type:http.HttpClient},{type:router.Router},{type:tokens.VerdocsStateService},{type:core.Injector}]},e}();exports.AccountService=AccountService,exports.BrowserToiTextService=BrowserToiTextService,exports.BuilderDataService=BuilderDataService,exports.BuilderService=BuilderService,exports.ConversionService=ConversionService,exports.DynamicField=DynamicField,exports.EnvelopeViewService=EnvelopeViewService,exports.ErrorDialogService=ErrorDialogService,exports.EssentialsConfigToken=EssentialsConfigToken,exports.EssentialsModule=EssentialsModule,exports.FourOhOneDialog=FourOhOneDialog,exports.GuardService=GuardService,exports.ModalService=ModalService,exports.PageService=PageService,exports.PlansDialog=PlansDialog,exports.SignatureService=SignatureService,exports.SnackbarService=SnackbarService,exports.blobToBase64=blobToBase64,exports.bottomOfPageIsInView=bottomOfPageIsInView,exports.buildFields=buildFields,exports.constructGroupFields=constructGroupFields,exports.constructPages=constructPages,exports.convertToUIRatio=convertToUIRatio,exports.dataURLtoBlob=dataURLtoBlob,exports.generateCheckboxLabel=generateCheckboxLabel,exports.generateGroupLabel=generateGroupLabel,exports.generateInitialStyle=generateInitialStyle,exports.generateStyle=generateStyle,exports.getDefaultHeight=getDefaultHeight,exports.getDefaultWidth=getDefaultWidth,exports.getFieldsMap=getFieldsMap,exports.getInputStyle=getInputStyle,exports.getLetterSpacing=getLetterSpacing,exports.getRLeft=getRLeft,exports.getRTop=getRTop,exports.getRValue=getRValue,exports.getRoleColor=getRoleColor,exports.getUIFieldStyling=getUIFieldStyling,exports.isInView=isInView,exports.middleOfPageIsInView=middleOfPageIsInView,exports.prepareFieldsForSigner=prepareFieldsForSigner,exports.printPdfUrl=printPdfUrl,exports.regParse=regParse,exports.rescale=rescale,exports.setRatio=setRatio,exports.timePeriod=timePeriod,exports.topOfPageIsInView=topOfPageIsInView,exports.updateElementStyles=updateElementStyles,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=verdocs-essentials.umd.min.js.map