/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Injector } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { ReplaySubject } from 'rxjs';
import { VSDKConfigToken } from '../angular-api.module';
import { findIndex } from 'lodash';
var RecipientService = /** @class */ (function () {
    function RecipientService(httpClient, injector) {
        this.httpClient = httpClient;
        this.injector = injector;
        this.recipientsSubject = new ReplaySubject();
        this.recipients = [];
        this._config_token = this.injector.get(VSDKConfigToken);
        this._rForm_backend_url = this._config_token.rForm_backend_url;
    }
    /**
     * @private
     * @param {?} recipient
     * @return {?}
     */
    RecipientService.prototype.updateRecipients = /**
     * @private
     * @param {?} recipient
     * @return {?}
     */
    function (recipient) {
        if (recipient && recipient['length'] && recipient['length'] > 0) {
            this.recipients = (/** @type {?} */ (recipient));
        }
        else if (recipient) {
            if (this.recipients && this.recipients['length'] && this.recipients['length'] > 0) {
                /** @type {?} */
                var updatedRecipientIndex = findIndex((/** @type {?} */ (this.recipients)), { role_name: recipient['role_name'] });
                if (updatedRecipientIndex !== -1) {
                    this.recipients[updatedRecipientIndex] = (/** @type {?} */ (recipient));
                }
            }
            else {
                this.recipients.push((/** @type {?} */ (recipient)));
            }
        }
        this.recipientsSubject.next(this.recipients);
    };
    /**
     * @param {?} envelopeId
     * @return {?}
     */
    RecipientService.prototype.getRecipients = /**
     * @param {?} envelopeId
     * @return {?}
     */
    function (envelopeId) {
        var _this = this;
        return this.httpClient.get(this._rForm_backend_url + ("/envelopes/" + envelopeId + "/recipients"))
            .toPromise().then((/**
         * @param {?} recipients
         * @return {?}
         */
        function (recipients) {
            _this.updateRecipients(recipients);
            return recipients;
        })).catch((/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            console.error(err);
            return [];
        }));
    };
    /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} recipientsToUpdate
     * @return {?}
     */
    RecipientService.prototype.prepareRecipients = /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} recipientsToUpdate
     * @return {?}
     */
    function (envId, roleName, recipientsToUpdate) {
        var _this = this;
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envId + "/recipients/" + roleName), { action: 'prepare', recipients: recipientsToUpdate }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        function (updatedRecipient) {
            _this.updateRecipients(updatedRecipient);
        }));
    };
    /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} newFullName
     * @return {?}
     */
    RecipientService.prototype.updateRecipientName = /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} newFullName
     * @return {?}
     */
    function (envId, roleName, newFullName) {
        var _this = this;
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envId + "/recipients/" + roleName), { action: 'update', new_full_name: newFullName }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        function (updatedRecipient) {
            _this.updateRecipients(updatedRecipient);
        }));
    };
    /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    RecipientService.prototype.setAsAgreed = /**
     * @param {?} envId
     * @param {?} roleName
     * @return {?}
     */
    function (envId, roleName) {
        var _this = this;
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envId + "/recipients/" + roleName), { action: 'update', agreed: true }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        function (updatedRecipient) {
            _this.updateRecipients(updatedRecipient);
        }));
    };
    /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} profileToClaim
     * @return {?}
     */
    RecipientService.prototype.claimProfile = /**
     * @param {?} envId
     * @param {?} roleName
     * @param {?} profileToClaim
     * @return {?}
     */
    function (envId, roleName, profileToClaim) {
        var _this = this;
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envId + "/recipients/" + roleName + "/claim"), { profile: profileToClaim }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        function (updatedRecipient) {
            _this.updateRecipients(updatedRecipient);
        }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @param {?} recipientInfo
     * @return {?}
     */
    RecipientService.prototype.updateRecipientInfoByOwner = /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @param {?} recipientInfo
     * @return {?}
     */
    function (envelopeId, roleName, recipientInfo) {
        var _this = this;
        return this.httpClient.put(this._rForm_backend_url + ("/envelopes/" + envelopeId + "/recipients/" + roleName), { action: 'owner_update', full_name: recipientInfo.full_name, email: recipientInfo.email, phone: recipientInfo.phone }).toPromise().then((/**
         * @param {?} updatedRecipient
         * @return {?}
         */
        function (updatedRecipient) {
            _this.updateRecipients(updatedRecipient);
            return updatedRecipient;
        }));
    };
    /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @return {?}
     */
    RecipientService.prototype.getInPersonLink = /**
     * @param {?} envelopeId
     * @param {?} roleName
     * @return {?}
     */
    function (envelopeId, roleName) {
        return this.httpClient.get(this._rForm_backend_url + ("/envelopes/" + envelopeId + "/recipients/" + roleName + "?in_person_link=true"))
            .toPromise().then((/**
         * @param {?} inPersonLink
         * @return {?}
         */
        function (inPersonLink) {
            return inPersonLink;
        }));
    };
    RecipientService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    RecipientService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: Injector }
    ]; };
    return RecipientService;
}());
export { RecipientService };
if (false) {
    /** @type {?} */
    RecipientService.prototype.recipientsSubject;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype._config_token;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype._rForm_backend_url;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype.recipients;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype.httpClient;
    /**
     * @type {?}
     * @private
     */
    RecipientService.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVjaXBpZW50cy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHZlcmRvY3Mvc2RrLyIsInNvdXJjZXMiOlsibGliL3JlY2lwaWVudHMvcmVjaXBpZW50cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVyQyxPQUFPLEVBQWMsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUVuQztJQVFFLDBCQUNVLFVBQXNCLEVBQ3RCLFFBQWtCO1FBRGxCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQVJyQixzQkFBaUIsR0FBRyxJQUFJLGFBQWEsRUFBZ0IsQ0FBQztRQUlyRCxlQUFVLEdBQWlCLEVBQUUsQ0FBQztRQU1wQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDO0lBQ2pFLENBQUM7Ozs7OztJQUVPLDJDQUFnQjs7Ozs7SUFBeEIsVUFBeUIsU0FBb0M7UUFDM0QsSUFBSSxTQUFTLElBQUksU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDL0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxtQkFBQSxTQUFTLEVBQWdCLENBQUM7U0FDN0M7YUFBTSxJQUFJLFNBQVMsRUFBRTtZQUNwQixJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxD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a0JBQWtCLElBQUcsZ0JBQWMsVUFBVSxvQkFBZSxRQUFRLHlCQUFzQixDQUFBLENBQUM7YUFDL0YsU0FBUyxFQUFFLENBQUMsSUFBSTs7OztRQUFDLFVBQUMsWUFBWTtZQUM3QixPQUFPLFlBQVksQ0FBQztRQUN0QixDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7O2dCQS9GRixVQUFVOzs7O2dCQVBGLFVBQVU7Z0JBREUsUUFBUTs7SUF3RzdCLHVCQUFDO0NBQUEsQUFoR0QsSUFnR0M7U0EvRlksZ0JBQWdCOzs7SUFDM0IsNkNBQTZEOzs7OztJQUU3RCx5Q0FBa0M7Ozs7O0lBQ2xDLDhDQUFtQzs7Ozs7SUFDbkMsc0NBQXNDOzs7OztJQUdwQyxzQ0FBOEI7Ozs7O0lBQzlCLG9DQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBWU0RLQ29uZmlnLCBWU0RLQ29uZmlnVG9rZW4gfSBmcm9tICcuLi9hbmd1bGFyLWFwaS5tb2R1bGUnO1xuaW1wb3J0IHsgSVJlY2lwaWVudCB9IGZyb20gJy4uL21vZGVscy9yZWNpcGllbnQubW9kZWwnO1xuaW1wb3J0IHsgZmluZEluZGV4IH0gZnJvbSAnbG9kYXNoJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJlY2lwaWVudFNlcnZpY2Uge1xuICBwdWJsaWMgcmVjaXBpZW50c1N1YmplY3QgPSBuZXcgUmVwbGF5U3ViamVjdDxJUmVjaXBpZW50W10+KCk7XG5cbiAgcHJpdmF0ZSBfY29uZmlnX3Rva2VuOiBWU0RLQ29uZmlnO1xuICBwcml2YXRlIF9yRm9ybV9iYWNrZW5kX3VybDogc3RyaW5nO1xuICBwcml2YXRlIHJlY2lwaWVudHM6IElSZWNpcGllbnRbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvclxuICApIHtcbiAgICB0aGlzLl9jb25maWdfdG9rZW4gPSB0aGlzLmluamVjdG9yLmdldChWU0RLQ29uZmlnVG9rZW4pO1xuICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsID0gdGhpcy5fY29uZmlnX3Rva2VuLnJGb3JtX2JhY2tlbmRfdXJsO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVSZWNpcGllbnRzKHJlY2lwaWVudDogSVJlY2lwaWVudCB8IElSZWNpcGllbnRbXSkge1xuICAgIGlmIChyZWNpcGllbnQgJiYgcmVjaXBpZW50WydsZW5ndGgnXSAmJiByZWNpcGllbnRbJ2xlbmd0aCddID4gMCkge1xuICAgICAgdGhpcy5yZWNpcGllbnRzID0gcmVjaXBpZW50IGFzIElSZWNpcGllbnRbXTtcbiAgICB9IGVsc2UgaWYgKHJlY2lwaWVudCkge1xuICAgICAgaWYgKHRoaXMucmVjaXBpZW50cyAmJiB0aGlzLnJlY2lwaWVudHNbJ2xlbmd0aCddICYmIHRoaXMucmVjaXBpZW50c1snbGVuZ3RoJ10gPiAwKSB7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRSZWNpcGllbnRJbmRleCA9IGZpbmRJbmRleCh0aGlzLnJlY2lwaWVudHMgYXMgYW55LCB7IHJvbGVfbmFtZTogcmVjaXBpZW50Wydyb2xlX25hbWUnXSB9KTtcbiAgICAgICAgaWYgKHVwZGF0ZWRSZWNpcGllbnRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICB0aGlzLnJlY2lwaWVudHNbdXBkYXRlZFJlY2lwaWVudEluZGV4XSA9IHJlY2lwaWVudCBhcyBJUmVjaXBpZW50O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlY2lwaWVudHMucHVzaChyZWNpcGllbnQgYXMgSVJlY2lwaWVudCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMucmVjaXBpZW50c1N1YmplY3QubmV4dCh0aGlzLnJlY2lwaWVudHMpO1xuICB9XG5cbiAgcHVibGljIGdldFJlY2lwaWVudHMoZW52ZWxvcGVJZCkge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZlbG9wZUlkfS9yZWNpcGllbnRzYClcbiAgICAgIC50b1Byb21pc2UoKS50aGVuKChyZWNpcGllbnRzOiBJUmVjaXBpZW50W10pID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVSZWNpcGllbnRzKHJlY2lwaWVudHMpO1xuICAgICAgICByZXR1cm4gcmVjaXBpZW50cztcbiAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKVxuICAgICAgICByZXR1cm4gW107XG4gICAgICB9KVxuICB9XG5cbiAgcHJlcGFyZVJlY2lwaWVudHMoZW52SWQ6IHN0cmluZywgcm9sZU5hbWU6IHN0cmluZywgcmVjaXBpZW50c1RvVXBkYXRlOiBhbnlbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucHV0KFxuICAgICAgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2VudmVsb3Blcy8ke2VudklkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9YCxcbiAgICAgIHsgYWN0aW9uOiAncHJlcGFyZScsIHJlY2lwaWVudHM6IHJlY2lwaWVudHNUb1VwZGF0ZSB9XG4gICAgKS50b1Byb21pc2UoKS50aGVuKCh1cGRhdGVkUmVjaXBpZW50OiBJUmVjaXBpZW50KSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVJlY2lwaWVudHModXBkYXRlZFJlY2lwaWVudCk7XG4gICAgfSlcbiAgfVxuXG4gIHVwZGF0ZVJlY2lwaWVudE5hbWUoZW52SWQ6IHN0cmluZywgcm9sZU5hbWU6IHN0cmluZywgbmV3RnVsbE5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucHV0KFxuICAgICAgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2VudmVsb3Blcy8ke2VudklkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9YCxcbiAgICAgIHsgYWN0aW9uOiAndXBkYXRlJywgbmV3X2Z1bGxfbmFtZTogbmV3RnVsbE5hbWUgfVxuICAgICkudG9Qcm9taXNlKCkudGhlbigodXBkYXRlZFJlY2lwaWVudDogSVJlY2lwaWVudCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVSZWNpcGllbnRzKHVwZGF0ZWRSZWNpcGllbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgc2V0QXNBZ3JlZWQoZW52SWQ6IHN0cmluZywgcm9sZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQucHV0KFxuICAgICAgdGhpcy5fckZvcm1fYmFja2VuZF91cmwgKyBgL2VudmVsb3Blcy8ke2VudklkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9YCxcbiAgICAgIHsgYWN0aW9uOiAndXBkYXRlJywgYWdyZWVkOiB0cnVlIH1cbiAgICApLnRvUHJvbWlzZSgpLnRoZW4oKHVwZGF0ZWRSZWNpcGllbnQ6IElSZWNpcGllbnQpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlUmVjaXBpZW50cyh1cGRhdGVkUmVjaXBpZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsYWltUHJvZmlsZShlbnZJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nLCBwcm9maWxlVG9DbGFpbTogYW55KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5wdXQoXG4gICAgICB0aGlzLl9yRm9ybV9iYWNrZW5kX3VybCArIGAvZW52ZWxvcGVzLyR7ZW52SWR9L3JlY2lwaWVudHMvJHtyb2xlTmFtZX0vY2xhaW1gLFxuICAgICAgeyBwcm9maWxlOiBwcm9maWxlVG9DbGFpbSB9XG4gICAgKS50b1Byb21pc2UoKS50aGVuKCh1cGRhdGVkUmVjaXBpZW50OiBJUmVjaXBpZW50KSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZVJlY2lwaWVudHModXBkYXRlZFJlY2lwaWVudCk7XG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGVSZWNpcGllbnRJbmZvQnlPd25lcihlbnZlbG9wZUlkOiBzdHJpbmcsIHJvbGVOYW1lOiBzdHJpbmcsIHJlY2lwaWVudEluZm86IHsgZnVsbF9uYW1lOiBzdHJpbmc7IGVtYWlsOiBzdHJpbmc7IHBob25lOiBzdHJpbmc7IH0pIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LnB1dChcbiAgICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZlbG9wZUlkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9YCxcbiAgICAgIHsgYWN0aW9uOiAnb3duZXJfdXBkYXRlJywgZnVsbF9uYW1lOiByZWNpcGllbnRJbmZvLmZ1bGxfbmFtZSwgZW1haWw6IHJlY2lwaWVudEluZm8uZW1haWwsIHBob25lOiByZWNpcGllbnRJbmZvLnBob25lIH1cbiAgICApLnRvUHJvbWlzZSgpLnRoZW4oKHVwZGF0ZWRSZWNpcGllbnQ6IElSZWNpcGllbnQpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlUmVjaXBpZW50cyh1cGRhdGVkUmVjaXBpZW50KTtcbiAgICAgIHJldHVybiB1cGRhdGVkUmVjaXBpZW50O1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0SW5QZXJzb25MaW5rKGVudmVsb3BlSWQsIHJvbGVOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldChcbiAgICAgIHRoaXMuX3JGb3JtX2JhY2tlbmRfdXJsICsgYC9lbnZlbG9wZXMvJHtlbnZlbG9wZUlkfS9yZWNpcGllbnRzLyR7cm9sZU5hbWV9P2luX3BlcnNvbl9saW5rPXRydWVgKVxuICAgICAgLnRvUHJvbWlzZSgpLnRoZW4oKGluUGVyc29uTGluaykgPT4ge1xuICAgICAgICByZXR1cm4gaW5QZXJzb25MaW5rO1xuICAgICAgfSk7XG4gIH1cbn1cbiJdfQ==