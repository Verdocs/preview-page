/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { VerdocsStateService } from './state.service';
import * as i0 from "@angular/core";
import * as i1 from "./state.service";
export class VerdocsTokenObjectService {
    /**
     * @param {?} stateService
     */
    constructor(stateService) {
        this.stateService = stateService;
    }
    /**
     * @return {?}
     */
    getAccessToken() {
        return this.tokenToObject(this.stateService.getAccessToken());
    }
    /**
     * @return {?}
     */
    getIDToken() {
        return this.tokenToObject(this.stateService.getIDToken());
    }
    /**
     * @return {?}
     */
    getAccountAccessToken() {
        return this.tokenToObject(this.stateService.getAccountAccessToken());
    }
    /**
     * @return {?}
     */
    getVerdocsAccessToken() {
        return this.tokenToObject(this.stateService.getVerdocsAccessToken());
    }
    /**
     * @return {?}
     */
    getProfile() {
        return this.getIDToken() ? this.getIDToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile`] : null;
    }
    /**
     * @return {?}
     */
    getPermissions() {
        return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/permissions`] : null;
    }
    /**
     * @return {?}
     */
    getAccountPermissions() {
        return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/permissions`] : null;
    }
    /**
     * @return {?}
     */
    getVerdocsPermissions() {
        return this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/permissions`] : null;
    }
    /**
     * @return {?}
     */
    getPlans() {
        return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/plans`] : this.getAccountPlans() ? this.getAccountPlans() : this.getVerdocsPlans() ? this.getVerdocsPlans() : null;
    }
    /**
     * @return {?}
     */
    getOrganizationID() {
        return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/organization_id`] : null;
    }
    /**
     * @return {?}
     */
    getAccountPlans() {
        return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/plans`] : null;
    }
    /**
     * @return {?}
     */
    getVerdocsPlans() {
        return this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/plans`] : null;
    }
    /**
     * @return {?}
     */
    getRoles() {
        return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/roles`] : this.getAccountRoles() ? this.getAccountRoles() : this.getVerdocsRoles() ? this.getVerdocsRoles() : null;
    }
    /**
     * @return {?}
     */
    getAccountRoles() {
        return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/roles`] : null;
    }
    /**
     * @return {?}
     */
    getVerdocsRoles() {
        return this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/roles`] : null;
    }
    /**
     * @return {?}
     */
    getProfileID() {
        return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile_id`] : this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile_id`] : this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile_id`] : null;
    }
    /**
     * @return {?}
     */
    getUserID() {
        /** @type {?} */
        const sub = this.getAccessToken()['sub'] || this.getAccountAccessToken()['sub'];
        /** @type {?} */
        const idStart = sub.indexOf('|') + 1;
        return this.getAccessToken()['sub'].slice(idStart);
    }
    /**
     * @param {?} token
     * @return {?}
     */
    tokenToObject(token) {
        if (token) {
            /** @type {?} */
            const base64Url = token.split('.')[1];
            /** @type {?} */
            var base64 = base64Url.replace('-', '+').replace('_', '/');
            return JSON.parse(window.atob(base64));
        }
        return null;
    }
}
VerdocsTokenObjectService.TOKEN_NAMESPACE = 'https://verdocs.com';
VerdocsTokenObjectService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root"
            },] }
];
/** @nocollapse */
VerdocsTokenObjectService.ctorParameters = () => [
    { type: VerdocsStateService }
];
/** @nocollapse */ VerdocsTokenObjectService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function VerdocsTokenObjectService_Factory() { return new VerdocsTokenObjectService(i0.ɵɵinject(i1.VerdocsStateService)); }, token: VerdocsTokenObjectService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    VerdocsTokenObjectService.TOKEN_NAMESPACE;
    /**
     * @type {?}
     * @private
     */
    VerdocsTokenObjectService.prototype.stateService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW4uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL3Rva2Vucy8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy90b2tlbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7QUFLdEQsTUFBTSxPQUFPLHlCQUF5Qjs7OztJQUVwQyxZQUNVLFlBQWlDO1FBQWpDLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtJQUN2QyxDQUFDOzs7O0lBRUwsY0FBYztRQUNaLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUM7SUFDaEUsQ0FBQzs7OztJQUNELFVBQVU7UUFDUixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQzVELENBQUM7Ozs7SUFFRCxxQkFBcUI7UUFDbkIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7Ozs7SUFFRCxxQkFBcUI7UUFDbkIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7Ozs7SUFFRCxVQUFVO1FBQ1IsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxHQUFHLHlCQUF5QixDQUFDLGVBQWUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUM5RyxDQUFDOzs7O0lBRUQsY0FBYztRQUNaLE9BQU8sSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFD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O0lBQ2QsQ0FBQzs7QUFqRmMseUNBQWUsR0FBRyxxQkFBcUIsQ0FBQzs7WUFKeEQsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7O1lBSlEsbUJBQW1COzs7Ozs7OztJQU0xQiwwQ0FBdUQ7Ozs7O0lBRXJELGlEQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgVmVyZG9jc1N0YXRlU2VydmljZSB9IGZyb20gJy4vc3RhdGUuc2VydmljZSc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogXCJyb290XCJcbn0pXG5leHBvcnQgY2xhc3MgVmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIFRPS0VOX05BTUVTUEFDRSA9ICdodHRwczovL3ZlcmRvY3MuY29tJztcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBzdGF0ZVNlcnZpY2U6IFZlcmRvY3NTdGF0ZVNlcnZpY2UsXG4gICkgeyB9XG5cbiAgZ2V0QWNjZXNzVG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMudG9rZW5Ub09iamVjdCh0aGlzLnN0YXRlU2VydmljZS5nZXRBY2Nlc3NUb2tlbigpKTtcbiAgfVxuICBnZXRJRFRva2VuKCkge1xuICAgIHJldHVybiB0aGlzLnRva2VuVG9PYmplY3QodGhpcy5zdGF0ZVNlcnZpY2UuZ2V0SURUb2tlbigpKTtcbiAgfVxuXG4gIGdldEFjY291bnRBY2Nlc3NUb2tlbigpIHtcbiAgICByZXR1cm4gdGhpcy50b2tlblRvT2JqZWN0KHRoaXMuc3RhdGVTZXJ2aWNlLmdldEFjY291bnRBY2Nlc3NUb2tlbigpKTtcbiAgfVxuXG4gIGdldFZlcmRvY3NBY2Nlc3NUb2tlbigpIHtcbiAgICByZXR1cm4gdGhpcy50b2tlblRvT2JqZWN0KHRoaXMuc3RhdGVTZXJ2aWNlLmdldFZlcmRvY3NBY2Nlc3NUb2tlbigpKTtcbiAgfVxuXG4gIGdldFByb2ZpbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0SURUb2tlbigpID8gdGhpcy5nZXRJRFRva2VuKClbYCR7VmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZS5UT0tFTl9OQU1FU1BBQ0V9L3Byb2ZpbGVgXSA6IG51bGw7XG4gIH1cblxuICBnZXRQZXJtaXNzaW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBY2Nlc3NUb2tlbigpID8gdGhpcy5nZXRBY2Nlc3NUb2tlbigpW2Ake1ZlcmRvY3NUb2tlbk9iamVjdFNlcnZpY2UuVE9LRU5fTkFNRVNQQUNFfS9wZXJtaXNzaW9uc2BdIDogbnVsbDtcbiAgfVxuXG4gIGdldEFjY291bnRQZXJtaXNzaW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBY2NvdW50QWNjZXNzVG9rZW4oKSA/IHRoaXMuZ2V0QWNjb3VudEFjY2Vzc1Rva2VuKClbYCR7VmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZS5UT0tFTl9OQU1FU1BBQ0V9L3Blcm1pc3Npb25zYF0gOiBudWxsO1xuICB9XG4gIFxuICBnZXRWZXJkb2NzUGVybWlzc2lvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VmVyZG9jc0FjY2Vzc1Rva2VuKCkgPyB0aGlzLmdldFZlcmRvY3NBY2Nlc3NUb2tlbigpW2Ake1ZlcmRvY3NUb2tlbk9iamVjdFNlcnZpY2UuVE9LRU5fTkFNRVNQQUNFfS9wZXJtaXNzaW9uc2BdIDogbnVsbDtcbiAgfVxuXG4gIGdldFBsYW5zKCkge1xuICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc1Rva2VuKCkgPyB0aGlzLmdldEFjY2Vzc1Rva2VuKClbYCR7VmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZS5UT0tFTl9OQU1FU1BBQ0V9L3BsYW5zYF0gOiB0aGlzLmdldEFjY291bnRQbGFucygpID8gdGhpcy5nZXRBY2NvdW50UGxhbnMoKSA6IHRoaXMuZ2V0VmVyZG9jc1BsYW5zKCkgPyB0aGlzLmdldFZlcmRvY3NQbGFucygpIDogbnVsbDtcbiAgfVxuXG4gIGdldE9yZ2FuaXphdGlvbklEKCkge1xuICAgIHJldHVybiB0aGlzLmdldEFjY291bnRBY2Nlc3NUb2tlbigpID8gdGhpcy5nZXRBY2NvdW50QWNjZXNzVG9rZW4oKVtgJHtWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLlRPS0VOX05BTUVTUEFDRX0vb3JnYW5pemF0aW9uX2lkYF0gOiBudWxsO1xuICB9XG5cbiAgZ2V0QWNjb3VudFBsYW5zKCkge1xuICAgIHJldHVybiB0aGlzLmdldEFjY291bnRBY2Nlc3NUb2tlbigpID8gdGhpcy5nZXRBY2NvdW50QWNjZXNzVG9rZW4oKVtgJHtWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLlRPS0VOX05BTUVTUEFDRX0vcGxhbnNgXSA6IG51bGw7XG4gIH1cblxuICBnZXRWZXJkb2NzUGxhbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VmVyZG9jc0FjY2Vzc1Rva2VuKCkgPyB0aGlzLmdldFZlcmRvY3NBY2Nlc3NUb2tlbigpW2Ake1ZlcmRvY3NUb2tlbk9iamVjdFNlcnZpY2UuVE9LRU5fTkFNRVNQQUNFfS9wbGFuc2BdIDogbnVsbDtcbiAgfVxuXG4gIGdldFJvbGVzKCkge1xuICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc1Rva2VuKCkgPyB0aGlzLmdldEFjY2Vzc1Rva2VuKClbYCR7VmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZS5UT0tFTl9OQU1FU1BBQ0V9L3JvbGVzYF0gOiB0aGlzLmdldEFjY291bnRSb2xlcygpID8gdGhpcy5nZXRBY2NvdW50Um9sZXMoKSA6IHRoaXMuZ2V0VmVyZG9jc1JvbGVzKCkgPyB0aGlzLmdldFZlcmRvY3NSb2xlcygpIDogbnVsbDtcbiAgfVxuXG4gIGdldEFjY291bnRSb2xlcygpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBY2NvdW50QWNjZXNzVG9rZW4oKSA/IHRoaXMuZ2V0QWNjb3VudEFjY2Vzc1Rva2VuKClbYCR7VmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZS5UT0tFTl9OQU1FU1BBQ0V9L3JvbGVzYF0gOiBudWxsO1xuICB9XG5cbiAgZ2V0VmVyZG9jc1JvbGVzKCkge1xuICAgIHJldHVybiB0aGlzLmdldFZlcmRvY3NBY2Nlc3NUb2tlbigpID8gdGhpcy5nZXRWZXJkb2NzQWNjZXNzVG9rZW4oKVtgJHtWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLlRPS0VOX05BTUVTUEFDRX0vcm9sZXNgXSA6IG51bGw7XG4gIH1cblxuICBnZXRQcm9maWxlSUQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0QWNjZXNzVG9rZW4oKSA/IHRoaXMuZ2V0QWNjZXNzVG9rZW4oKVtgJHtWZXJkb2NzVG9rZW5PYmplY3RTZXJ2aWNlLlRPS0VOX05BTUVTUEFDRX0vcHJvZmlsZV9pZGBdIDogdGhpcy5nZXRBY2NvdW50QWNjZXNzVG9rZW4oKSA/IHRoaXMuZ2V0QWNjb3VudEFjY2Vzc1Rva2VuKClbYCR7VmVyZG9jc1Rva2VuT2JqZWN0U2VydmljZS5UT0tFTl9OQU1FU1BBQ0V9L3Byb2ZpbGVfaWRgXSA6IHRoaXMuZ2V0VmVyZG9jc0FjY2Vzc1Rva2VuKCkgPyB0aGlzLmdldFZlcmRvY3NBY2Nlc3NUb2tlbigpW2Ake1ZlcmRvY3NUb2tlbk9iamVjdFNlcnZpY2UuVE9LRU5fTkFNRVNQQUNFfS9wcm9maWxlX2lkYF0gOiBudWxsO1xuICB9XG5cbiAgZ2V0VXNlcklEKCkge1xuICAgIGNvbnN0IHN1YiA9IHRoaXMuZ2V0QWNjZXNzVG9rZW4oKVsnc3ViJ10gfHwgdGhpcy5nZXRBY2NvdW50QWNjZXNzVG9rZW4oKVsnc3ViJ107XG4gICAgY29uc3QgaWRTdGFydCA9IHN1Yi5pbmRleE9mKCd8JykgKyAxO1xuICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc1Rva2VuKClbJ3N1YiddLnNsaWNlKGlkU3RhcnQpO1xuICB9XG5cbiAgdG9rZW5Ub09iamVjdCh0b2tlbikge1xuICAgIGlmICh0b2tlbikge1xuICAgICAgY29uc3QgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcbiAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgnLScsICcrJykucmVwbGFjZSgnXycsICcvJyk7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZSh3aW5kb3cuYXRvYihiYXNlNjQpKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxufVxuIl19