{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@verdocs/tokens/lib/services/state.service.ts","ng://@verdocs/tokens/lib/interceptors/request.interceptor.ts","ng://@verdocs/tokens/lib/services/auth.service.ts","ng://@verdocs/tokens/lib/services/authguard.service.ts","ng://@verdocs/tokens/lib/interceptors/error.interceptor.ts","ng://@verdocs/tokens/lib/interceptors/response.interceptor.ts","ng://@verdocs/tokens/lib/services/token.service.ts","ng://@verdocs/tokens/lib/dialogs/verify-email-dialog.component.ts","ng://@verdocs/tokens/lib/directives/realster-guard.directive.ts","ng://@verdocs/tokens/lib/tokens.module.ts"],"names":["__values","o","m","Symbol","iterator","i","call","next","length","value","done","helper","JwtHelperService","VerdocsStateService","cookieService","http","injector","platform","this","timerActive","cookieConfig","path","domain","secure","accessList","decodedIdTokenSubject","ReplaySubject","tokenConfig","get","VTokenConfigToken","init","prototype","loginURL","cookieName","origin","COOKIE_NAME_SUFFIX","production","getDomain","getAccessList","address","split","watchAuthentication","_this","isPlatformBrowser","authenticationWatcher","interval","subscribe","indexOf","RACCOUNT_COOKIE_NAME","removeAll","window","location","href","getLoginURL","endWatchAuthentication","unsubscribe","getAccountCookieObject","cookie_name","account_name","getOtherCookieObject","getVerdocsCookieObject","verdocs_name","getAccessToken","cookie","ACCESS_TOKEN_NAME","accessToken","getVerdocsAccessToken","getAccountAccessToken","getIDToken","ID_TOKEN_NAME","idToken","decodeToken","setTimer","state","getUserId","idTokenContent","tokenToObject","replace","getAppUserId","appName","getObject","updateCookie","key","cName","protocol","rAccountCookie","getrAccountCookieObject","otherCookie","putObject","updateTokens","rSecureBackend","getTokens","pipe","map","tokens","x","clientName","hasCookie","getAllCookies","cookies","push","getEmailVerification","hasAccessTo","storeOtherCookie","setCookie","getOtherCookie","err","console","error","getRCookie","SIGNER_TOKEN_COOKIE_NAME","removeRCookie","remove","removeRCookies","_b","tslib_1.__values","_c","removeIntercomCookie","setTokens","tokens_1","tokens_1_1","token","getAll","base64","JSON","parse","atob","cookieValue","put","getRAccountRoles","TOKEN_NAMESPACE","getPlans","Injectable","args","providedIn","CookieService","HttpClient","Injector","Inject","PLATFORM_ID","VerdocsRequestInterceptor","intercept","request","stateService","signerToken","setHeaders","Pragma","Cache-Control","Expires","If-Modified-Since","url","startsWith","handle","headers","clone","VerdocsAuthService","isAuthenticated","isTokenExpired","VerdocsAuthGuardService","authService","route","signOutRequestSubmitted","checkLogin","signOut","checkAuthentication","redirectUrl","redirectUrlParam","includes","decorators","type","forwardRef","ActivatedRoute","VerdocsErrorInterceptor","catchError","HttpErrorResponse","authGuardService","throwError","VerdocsResponseInterceptor","event","VerdocsTokenObjectService","getProfile","getPermissions","getAccountPermissions","getVerdocsPermissions","getAccountPlans","getVerdocsPlans","getOrganizationID","getRoles","getAccountRoles","getVerdocsRoles","getProfileID","getUserID","idStart","slice","VerifyEmailDialogComponent","dialogRef","vTokenAuthGuard","vTokenStateService","data","ngOnInit","setInterval","closeDialog","resendEmailVerification","close","Component","selector","template","MatDialogRef","MAT_DIALOG_DATA","VerdocsTokenGuardDirective","dialog","verdocsAuthGuard","verdocsStateService","verdocsAuthService","verifyEmailDialogIsOpen","idTokenSubscription","Subscription","resendEmailVerificationEvent","EventEmitter","decodedIdToken","emailAddress","email","enforceAuthentication","checkEmailVerification","ngOnDestroy","email_data","open","disableClose","afterClosed","reload","emit","Directive","MatDialog","Output","Input","InjectionToken","TokensModule","initInterceptor","config","ngModule","providers","provide","useValue","NgModule","imports","CookieModule","forRoot","MatButtonModule","MatDialogModule","declarations","entryComponents","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { Injectable, Injector, Inject, PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { CookieService, CookieOptions } from 'ngx-cookie';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport { VTokenConfigToken, VTokenConfig } from '../tokens.module';\nimport { ReplaySubject, Subscription, interval } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nconst helper = new JwtHelperService();\n\n@Injectable({\n  providedIn: \"root\"\n})\nexport class VerdocsStateService {\n  private static RACCOUNT_COOKIE_NAME = 'rAccount_Verdocs';\n  private static SIGNER_TOKEN_COOKIE_NAME = 'signer_token'\n  private static COOKIE_NAME_SUFFIX = '_Verdocs';\n  private static ACCESS_TOKEN_NAME = 'accessToken';\n  private static ID_TOKEN_NAME = 'idToken';\n  private static TOKEN_NAMESPACE = 'https://verdocs.com';\n\n  private loginURL: string;\n  private cookieName: string;\n  private production: boolean;\n  private accessToken: string;\n  private idToken: string;\n  private timerActive = false;\n  private domain: string;\n  private cookieConfig: CookieOptions = {\n    path: '/',\n    domain: 'localhost',\n    secure: false\n  }\n  private cookies;\n  private tokenConfig: VTokenConfig\n  private authenticationWatcher: Subscription;\n\n  public accessList: string[] = [];\n  public decodedIdTokenSubject = new ReplaySubject<any>();\n\n  constructor(\n    private cookieService: CookieService,\n    private http: HttpClient,\n    private injector: Injector,\n    @Inject(PLATFORM_ID) private platform\n  ) {\n    this.tokenConfig = this.injector.get(VTokenConfigToken);\n    this.domain = this.tokenConfig.domain;\n    this.init();\n\n  }\n\n  init() {\n    if (this.tokenConfig.loginURL) {\n      this.loginURL = this.tokenConfig.loginURL;\n    }\n    if (this.tokenConfig.cookieName) {\n      this.cookieName = this.tokenConfig.cookieName;\n    } else if (this.tokenConfig.origin) {\n      this.cookieName = this.tokenConfig.origin + VerdocsStateService.COOKIE_NAME_SUFFIX;\n    }\n    this.production = this.tokenConfig.production || false;\n    this.cookieConfig.domain = this.getDomain();\n    if (this.tokenConfig.production) {\n      this.cookieConfig.secure = true;\n    }\n    this.getAccessList();\n  }\n\n  getDomain() {\n    if (this.production || this.domain !== 'localhost') {\n      const address = this.domain.split('.');\n      return '.' + address[address.length - 2] + '.' + address[address.length - 1];\n    } else {\n      return 'localhost';\n    }\n  }\n\n  watchAuthentication() {\n    if (isPlatformBrowser(this.platform)) {\n      if (!this.timerActive) {\n        this.timerActive = true;\n        this.authenticationWatcher = interval(15000).subscribe(() => {\n          this.getAccessList();\n          if ((this.accessList.indexOf(VerdocsStateService.RACCOUNT_COOKIE_NAME) === -1 || this.accessList.indexOf(this.cookieName) === -1)) {\n            this.cookieService.removeAll();\n            window.location.href = this.getLoginURL();\n          };\n        });\n      }\n    }\n  }\n\n  endWatchAuthentication() {\n    this.authenticationWatcher.unsubscribe();\n  }\n\n  getAccountCookieObject() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie_prefix = this.tokenConfig.account_name || 'rAccount';\n      const cookie_name = cookie_prefix + VerdocsStateService.COOKIE_NAME_SUFFIX;\n      const cookie = this.getOtherCookieObject(cookie_name);\n      return cookie;\n    }\n  }\n  getVerdocsCookieObject() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie_prefix = this.tokenConfig.verdocs_name || 'rForm';\n      const cookie_name = cookie_prefix + VerdocsStateService.COOKIE_NAME_SUFFIX;\n      const cookie = this.getOtherCookieObject(cookie_name);\n      return cookie;\n    }\n  }\n\n  getAccessToken() {\n    if (isPlatformBrowser(this.platform)) {\n      if (this.cookieName) {\n        const cookie = this.getOtherCookieObject(this.cookieName);\n        if (cookie && cookie[VerdocsStateService.ACCESS_TOKEN_NAME]) {\n          this.accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME]\n          return this.accessToken;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  getVerdocsAccessToken() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie = this.getVerdocsCookieObject();\n      if (cookie && cookie[VerdocsStateService.ACCESS_TOKEN_NAME]) {\n        this.accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];\n        return this.accessToken;\n      }\n    }\n  }\n\n  getAccountAccessToken() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie = this.getAccountCookieObject();\n      if (cookie && cookie[VerdocsStateService.ACCESS_TOKEN_NAME]) {\n        this.accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];\n        return this.accessToken;\n      }\n    }\n  }\n\n  getIDToken() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie = this.getAccountCookieObject();\n      if (cookie && cookie[VerdocsStateService.ID_TOKEN_NAME]) {\n        this.idToken = cookie[VerdocsStateService.ID_TOKEN_NAME]\n        this.decodedIdTokenSubject.next(helper.decodeToken(this.idToken));\n        return this.idToken;\n      }\n    }\n    return null;\n  }\n\n  getLoginURL() {\n    return this.loginURL;\n  }\n\n  setTimer(state: boolean) {\n    this.timerActive = state;\n  }\n\n  public getUserId(): string | null {\n    const idToken = this.getIDToken();\n    if (!!idToken) {\n      const idTokenContent = this.tokenToObject(idToken);\n      if (idTokenContent['sub']) {\n        return idTokenContent['sub'].replace('auth0|', '');\n      }\n      return null;\n    }\n    return;\n  }\n\n  public getAppUserId(appName?: string): string | null {\n    if (isPlatformBrowser(this.platform)) {\n      if (!appName) {\n        appName = VerdocsStateService.RACCOUNT_COOKIE_NAME;\n      }\n      const cookie = this.cookieService.getObject(appName);\n      let idToken;\n      if (cookie && cookie[VerdocsStateService.ID_TOKEN_NAME]) {\n        idToken = cookie[VerdocsStateService.ID_TOKEN_NAME];\n        const idTokenContent = this.tokenToObject(idToken);\n        if (idTokenContent['sub']) {\n          return idTokenContent['sub'].replace('auth0|', '');\n        }\n      }\n      return null;\n    }\n    return;\n  }\n\n  updateCookie(key: string, value: string, cookieName?: string) {\n    if (isPlatformBrowser(this.platform)) {\n      const cName = cookieName ? cookieName : this.cookieName;\n      this.cookieConfig.domain = this.getDomain();\n      if (window && window.location && location.protocol === 'https:') {\n        this.cookieConfig.secure = true;\n      }\n      let rAccountCookie = this.getrAccountCookieObject();\n      let otherCookie = this.getOtherCookieObject(cName);\n      let cookie;\n      if (!!cName && !!key && !!value) {\n        if (cName === VerdocsStateService.RACCOUNT_COOKIE_NAME && !!rAccountCookie) {\n          rAccountCookie[key] = value;\n          cookie = rAccountCookie;\n        } else if (!!otherCookie) {\n          otherCookie[key] = value;\n          cookie = otherCookie;\n        }\n        this.cookieService.putObject(cName, cookie, this.cookieConfig);\n      }\n    }\n  }\n\n  updateTokens(rSecureBackend) {\n    if (isPlatformBrowser(this.platform)) {\n      return this.getTokens(rSecureBackend).pipe(\n        map((tokens: any[]) => {\n          for (let x = 0; x < tokens.length; x++) {\n            if (tokens[x].clientName === 'rAccount') {\n              this.updateCookie(VerdocsStateService.ID_TOKEN_NAME, tokens[x].idToken, tokens[x].clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);\n              this.decodedIdTokenSubject.next(helper.decodeToken(tokens[x].idToken));\n            }\n            this.updateCookie(VerdocsStateService.ACCESS_TOKEN_NAME, tokens[x].accessToken, tokens[x].clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);\n          }\n          return tokens;\n        })\n      );\n    }\n  }\n\n  hasCookie() {\n    return !!this.cookieService.get(this.cookieName);\n  }\n\n  getAccessList() {\n    if (isPlatformBrowser(this.platform)) {\n      this.getAllCookies();\n      this.accessList = [];\n      for (const cookie in this.cookies) {\n        if (cookie.indexOf(VerdocsStateService.COOKIE_NAME_SUFFIX) !== -1) {\n          this.accessList.push(cookie);\n        }\n      }\n      return this.accessList;\n    }\n  }\n\n  getEmailVerification(): boolean {\n    if (isPlatformBrowser(this.platform)) {\n      const idToken = this.getIDToken();\n      if (!!idToken) {\n        const idTokenContent = this.tokenToObject(idToken);\n        return idTokenContent['email_verified'];\n      }\n      return false;\n    }\n  }\n\n  hasAccessTo(clientName: string) {\n    return this.accessList.indexOf(clientName) !== -1;\n  }\n\n  storeOtherCookie(key, value) {\n    if (isPlatformBrowser(this.platform)) {\n      this.setCookie(key, value);\n    }\n  }\n\n  getOtherCookie(key) {\n    if (isPlatformBrowser(this.platform)) {\n      try {\n        if (key) {\n          const value = this.cookieService.getObject(key);\n          return value;\n        } else {\n          return null;\n        }\n      } catch (err) {\n        console.error('Cannot return cookie:', err);\n        return null;\n      }\n    }\n  }\n\n  getRCookie(key: string) {\n    if (isPlatformBrowser(this.platform)) {\n      return this.cookieService.get(key);\n    }\n  }\n\n  getOtherCookieObject(key) {\n    try {\n      if (!!key) {\n        if (isPlatformBrowser(this.platform)) {\n          return this.cookieService.getObject(key);\n        }\n      }\n      return null;\n    } catch (err) {\n      if (key !== VerdocsStateService.SIGNER_TOKEN_COOKIE_NAME) {\n        console.error('Cannot get cookie: ', err);\n      }\n      return null;\n    }\n  }\n\n  removeRCookie(key) {\n    if (isPlatformBrowser(this.platform)) {\n      this.cookieService.remove(key, this.cookieConfig);\n    }\n  }\n\n  removeRCookies() {\n    if (isPlatformBrowser(this.platform)) {\n      if (this.accessList.length > 0) {\n        for (const key of this.accessList) {\n          this.removeRCookie(key);\n        }\n      };\n    }\n  }\n\n  removeIntercomCookie() {\n    if (isPlatformBrowser(this.platform)) {\n      for (const cookie in this.cookies) {\n        if (cookie.indexOf('intercom') !== -1) {\n          this.removeRCookie(cookie);\n        }\n      }\n    }\n  }\n\n  setTokens(tokens) {\n    if (isPlatformBrowser(this.platform)) {\n      if (tokens && tokens.length > 0) {\n        for (const token of tokens) {\n          if (token.clientName === 'rAccount') {\n            this.updateCookie(VerdocsStateService.ID_TOKEN_NAME, token.idToken, token.clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);\n            this.decodedIdTokenSubject.next(helper.decodeToken(token.idToken));\n          }\n          this.updateCookie(VerdocsStateService.ACCESS_TOKEN_NAME, token.accessToken, token.clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);\n        }\n      }\n    }\n  }\n\n  private getrAccountCookieObject() {\n    if (isPlatformBrowser(this.platform)) {\n      try {\n        if (this.cookieName && this.cookieService.get(VerdocsStateService.RACCOUNT_COOKIE_NAME)) {\n          const cookie = this.cookieService.getObject(VerdocsStateService.RACCOUNT_COOKIE_NAME);\n          return cookie;\n        }\n        return null;\n      } catch (err) {\n        return null;\n      }\n    }\n  }\n\n  private getAllCookies() {\n    if (isPlatformBrowser(this.platform)) {\n      this.cookies = this.cookieService.getAll();\n    }\n  }\n\n  private tokenToObject(token) {\n    if (token) {\n      const base64Url = token.split('.')[1];\n      var base64 = base64Url.replace('-', '+').replace('_', '/');\n      return JSON.parse(window.atob(base64));\n    }\n    return null;\n  }\n\n  private setCookie(cookieName, cookieValue) {\n    if (isPlatformBrowser(this.platform)) {\n      this.cookieService.put(cookieName, cookieValue, this.cookieConfig);\n    }\n  }\n\n  private getTokens(rSecureBackend) {\n    return this.http.get(rSecureBackend + '/token')\n  }\n\n  public getRAccountRoles() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie = this.cookieService.getObject(VerdocsStateService.RACCOUNT_COOKIE_NAME);\n      if (!!cookie) {\n        try {\n          const accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];\n          const tokenObject = this.tokenToObject(accessToken);\n          return tokenObject[`${VerdocsStateService.TOKEN_NAMESPACE}/roles`];\n        } catch (err) {\n          console.error(err);\n        }\n      } else {\n        return null;\n      }\n    }\n  }\n\n  public getPlans() {\n    if (isPlatformBrowser(this.platform)) {\n      const cookie = this.cookieService.getObject(VerdocsStateService.RACCOUNT_COOKIE_NAME);\n      if (!!cookie) {\n        try {\n          const accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];\n          const tokenObject = this.tokenToObject(accessToken);\n          return tokenObject[`${VerdocsStateService.TOKEN_NAMESPACE}/plans`];\n        } catch (err) {\n          console.error(err);\n        }\n      } else {\n        return null;\n      }\n    }\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpEvent,\n  HttpInterceptor\n} from '@angular/common/http';\n\nimport { VerdocsStateService } from '../services/state.service';\n\n@Injectable()\nexport class VerdocsRequestInterceptor implements HttpInterceptor {\n  private stateService: VerdocsStateService;\n  constructor(\n    private injector: Injector\n  ) { }\n  intercept(request: HttpRequest<any>, next: HttpHandler) {\n    this.stateService = this.injector.get(VerdocsStateService);\n    const accessToken = this.stateService.getAccessToken();\n    const idToken = this.stateService.getIDToken();\n    const signerToken = this.stateService.getOtherCookieObject('signer_token');\n    const setHeaders = {\n      Pragma: 'no-cache',\n      'Cache-Control': 'no-cache',\n      Expires: 'Sat, 01 Jan 2000 00:00:00 GMT',\n      'If-Modified-Since': '0'\n    };\n\n    if (request.url.startsWith('assets/')) {\n      return next.handle(request);\n    }\n\n    if (!request.headers.get('Authorization') && accessToken) {\n      setHeaders['Authorization'] = `Bearer ${accessToken}`;\n    }\n    if (idToken) {\n      setHeaders['Authentication'] = `Bearer ${idToken}`;\n    }\n    if (signerToken) {\n      setHeaders['Signer'] = `Bearer ${signerToken}`;\n    }\n    request = request.clone({ setHeaders });\n\n    return next.handle(request)\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { JwtHelperService } from '@auth0/angular-jwt';\n\nimport { VerdocsStateService } from './state.service';\n\nconst helper = new JwtHelperService();\n@Injectable()\nexport class VerdocsAuthService {\n\n  constructor(\n    private stateService: VerdocsStateService\n  ) {}\n  \n  public isAuthenticated() {\n    const token = this.stateService.getIDToken();\n    if (token) {\n      const isTokenExpired = helper.isTokenExpired(token);\n      return !isTokenExpired;\n    }\n    return false;\n  }\n}\n","import { Injectable, Inject, forwardRef } from '@angular/core';\nimport { ActivatedRoute, ActivatedRouteSnapshot } from '@angular/router';\nimport { VerdocsAuthService } from './auth.service';\nimport { VerdocsStateService } from './state.service';\n\n@Injectable()\nexport class VerdocsAuthGuardService {\n  private signOutRequestSubmitted = false;\n\n  // handle redirects based on authentication state\n  constructor(\n    @Inject(forwardRef(() => VerdocsAuthService)) private authService: VerdocsAuthService,\n    @Inject(forwardRef(() => VerdocsStateService)) private stateService: VerdocsStateService,\n    private route: ActivatedRoute,\n  ) {\n    const snapshot = <ActivatedRouteSnapshot>this.route.snapshot\n  }\n\n  checkLogin() {\n    if (!this.authService.isAuthenticated) {\n      if (this.stateService.getLoginURL()) {\n        this.signOut();\n      }\n    }\n    this.stateService.watchAuthentication();\n  }\n\n  checkAuthentication() {\n    const authenticated = this.authService.isAuthenticated();\n    if (!authenticated) {\n      this.signOut();\n    }\n  }\n\n  signOut(redirectUrl?: string) {\n    if (!this.signOutRequestSubmitted) {\n      this.signOutRequestSubmitted = true;\n      if (!this.authService.isAuthenticated()) {\n        redirectUrl = window.location.href\n      }\n      this.stateService.removeRCookies();\n      this.stateService.removeIntercomCookie();\n      const redirectUrlParam = (this.stateService.getLoginURL() && this.stateService.getLoginURL().includes('?') ? '&' : '?') + 'redirect_url';\n      window.location.href = this.stateService.getLoginURL() + (redirectUrl ? `${redirectUrlParam}=${redirectUrl}` : '');\n    }\n  }\n}\n","import { Injectable, Injector, Inject, PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common'\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpInterceptor,\n  HttpErrorResponse\n} from '@angular/common/http';\nimport { catchError } from 'rxjs/operators';\n\nimport { VerdocsAuthGuardService } from '../services/authguard.service';\nimport { VerdocsStateService } from '../services/state.service';\nimport { throwError } from 'rxjs';\n\n\n@Injectable()\nexport class VerdocsErrorInterceptor implements HttpInterceptor {\n  private authGuardService: VerdocsAuthGuardService;\n  private stateService: VerdocsStateService;\n  constructor(\n    private injector: Injector,\n    @Inject(PLATFORM_ID) private platform\n  ) { }\n  intercept(request: HttpRequest<any>, next: HttpHandler) {\n    return next.handle(request).pipe(\n      catchError(err => {\n        if (err instanceof HttpErrorResponse) {\n          if (err['status'] === 403) {\n            this.stateService = this.injector.get(VerdocsStateService);\n            let redirectUrl;\n            if (isPlatformBrowser(this.platform) && err['error'] && err['error']['reason'] === 'expired') {\n              redirectUrl = window.location.href\n            }\n            this.authGuardService = this.injector.get(VerdocsAuthGuardService);\n            this.authGuardService.signOut(redirectUrl);\n          }\n          return throwError(err);\n        }\n      })\n    );\n  }\n}","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpInterceptor,\n  HttpResponse\n} from '@angular/common/http';\nimport { map } from 'rxjs/operators';\n\nimport { VerdocsStateService } from '../services/state.service';\n\n\n@Injectable()\nexport class VerdocsResponseInterceptor implements HttpInterceptor {\n  private stateService: VerdocsStateService;\n  constructor(\n    private injector: Injector\n  ) {}\n  intercept(request: HttpRequest<any>, next: HttpHandler) {\n    this.stateService = this.injector.get(VerdocsStateService);\n    return next.handle(request).pipe(\n      map((event: HttpResponse<any>) => {\n        if (!!event.headers) {\n          const accessToken = event.headers.get('x-access-token');\n          const idToken = event.headers.get('x-id-token');\n          if (accessToken) {\n            this.stateService.updateCookie('accessToken', accessToken);\n          }\n          if (idToken) {\n            this.stateService.updateCookie('idToken', idToken);\n          }\n        }\n        return event;\n      })\n    )\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { VerdocsStateService } from './state.service';\n\n@Injectable({\n  providedIn: \"root\"\n})\nexport class VerdocsTokenObjectService {\n  private static TOKEN_NAMESPACE = 'https://verdocs.com';\n  constructor(\n    private stateService: VerdocsStateService,\n  ) { }\n\n  getAccessToken() {\n    return this.tokenToObject(this.stateService.getAccessToken());\n  }\n  getIDToken() {\n    return this.tokenToObject(this.stateService.getIDToken());\n  }\n\n  getAccountAccessToken() {\n    return this.tokenToObject(this.stateService.getAccountAccessToken());\n  }\n\n  getVerdocsAccessToken() {\n    return this.tokenToObject(this.stateService.getVerdocsAccessToken());\n  }\n\n  getProfile() {\n    return this.getIDToken() ? this.getIDToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile`] : null;\n  }\n\n  getPermissions() {\n    return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/permissions`] : null;\n  }\n\n  getAccountPermissions() {\n    return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/permissions`] : null;\n  }\n  \n  getVerdocsPermissions() {\n    return this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/permissions`] : null;\n  }\n\n  getPlans() {\n    return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/plans`] : this.getAccountPlans() ? this.getAccountPlans() : this.getVerdocsPlans() ? this.getVerdocsPlans() : null;\n  }\n\n  getOrganizationID() {\n    return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/organization_id`] : null;\n  }\n\n  getAccountPlans() {\n    return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/plans`] : null;\n  }\n\n  getVerdocsPlans() {\n    return this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/plans`] : null;\n  }\n\n  getRoles() {\n    return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/roles`] : this.getAccountRoles() ? this.getAccountRoles() : this.getVerdocsRoles() ? this.getVerdocsRoles() : null;\n  }\n\n  getAccountRoles() {\n    return this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/roles`] : null;\n  }\n\n  getVerdocsRoles() {\n    return this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/roles`] : null;\n  }\n\n  getProfileID() {\n    return this.getAccessToken() ? this.getAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile_id`] : this.getAccountAccessToken() ? this.getAccountAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile_id`] : this.getVerdocsAccessToken() ? this.getVerdocsAccessToken()[`${VerdocsTokenObjectService.TOKEN_NAMESPACE}/profile_id`] : null;\n  }\n\n  getUserID() {\n    const sub = this.getAccessToken()['sub'] || this.getAccountAccessToken()['sub'];\n    const idStart = sub.indexOf('|') + 1;\n    return this.getAccessToken()['sub'].slice(idStart);\n  }\n\n  tokenToObject(token) {\n    if (token) {\n      const base64Url = token.split('.')[1];\n      var base64 = base64Url.replace('-', '+').replace('_', '/');\n      return JSON.parse(window.atob(base64));\n    }\n    return null;\n  }\n\n}\n","import { Component, Inject, OnInit, forwardRef } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material';\nimport { VerdocsAuthGuardService } from '../services/authguard.service';\nimport { VerdocsStateService } from '../services/state.service';\nimport { EmailVerificationData } from '../models/email-verification-data.model';\n\n@Component({\n  selector: 'verdocs-verify-email-dialog.component',\n  templateUrl: 'verify-email-dialog.component.html',\n  styleUrls: ['verify-email-dialog.component.scss']\n})\n\nexport class VerifyEmailDialogComponent implements OnInit {\n  constructor(\n    private dialogRef: MatDialogRef<VerifyEmailDialogComponent>,\n    @Inject(forwardRef(() => VerdocsAuthGuardService)) private vTokenAuthGuard: VerdocsAuthGuardService,\n    @Inject(forwardRef(() => VerdocsStateService)) private vTokenStateService: VerdocsStateService,\n    @Inject(MAT_DIALOG_DATA) public data: EmailVerificationData\n  ) { }\n\n  ngOnInit() {\n    setInterval(() => {\n      if (this.vTokenStateService.getEmailVerification()) {\n        this.closeDialog();\n      }\n    }, 10000);\n  }\n\n  signOut() {\n    this.vTokenAuthGuard.signOut(window.location.href);\n  }\n\n  resendEmailVerification() {\n    this.data.resendEmailVerification();\n  }\n\n  closeDialog() {\n    this.dialogRef.close();\n  }\n}\n","import { Directive, Output, Input, OnInit, EventEmitter, Inject, forwardRef, OnDestroy, PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { MatDialog } from '@angular/material';\nimport { Subscription } from 'rxjs';\nimport { VerifyEmailDialogComponent } from '../dialogs/verify-email-dialog.component';\nimport { VerdocsAuthGuardService } from '../services/authguard.service';\nimport { VerdocsStateService } from '../services/state.service';\nimport { VerdocsAuthService } from '../services/auth.service';\nimport { EmailVerificationData } from '../models/email-verification-data.model';\n\n@Directive({\n  selector: '[verdocs-guard]'\n})\nexport class VerdocsTokenGuardDirective implements OnInit, OnDestroy {\n  private verifyEmailDialogIsOpen = false;\n  private emailAddress: string;\n  private idTokenSubscription = new Subscription();\n\n  @Output() private resendEmailVerificationEvent = new EventEmitter();\n  @Input() private enforceAuthentication;\n\n  constructor(\n    private dialog: MatDialog,\n    @Inject(forwardRef(() => VerdocsAuthGuardService)) private verdocsAuthGuard: VerdocsAuthGuardService,\n    @Inject(forwardRef(() => VerdocsStateService)) private verdocsStateService: VerdocsStateService,\n    @Inject(forwardRef(() => VerdocsAuthService)) private verdocsAuthService: VerdocsAuthService,\n    @Inject(PLATFORM_ID) private platform\n  ) {\n  }\n\n  ngOnInit() {\n    this.idTokenSubscription = this.verdocsStateService.decodedIdTokenSubject.subscribe(decodedIdToken => {\n      this.emailAddress = decodedIdToken.email;\n    });\n    setInterval(() => {\n      if (this.enforceAuthentication) {\n        this.verdocsAuthGuard.checkAuthentication();\n      }\n      if (this.verdocsAuthService.isAuthenticated()) {\n        this.checkEmailVerification();\n      }\n    }, 5000);\n  }\n\n  ngOnDestroy() {\n    this.idTokenSubscription.unsubscribe();\n  }\n\n  private checkEmailVerification() {\n    const emailVerified = this.verdocsStateService.getEmailVerification()\n    if (!emailVerified && !this.verifyEmailDialogIsOpen && isPlatformBrowser(this.platform)) {\n      this.verifyEmailDialogIsOpen = true;\n      const email_data: EmailVerificationData = {\n        resendEmailVerification: () => this.resendEmailVerification(),\n        emailAddress: this.emailAddress\n      }\n      const verifyEmailDialog = this.dialog.open(VerifyEmailDialogComponent, {\n        data: email_data,\n        disableClose: true\n      });\n      verifyEmailDialog.afterClosed().subscribe(() => {\n        this.verifyEmailDialogIsOpen = false;\n        location.reload();\n      });\n    }\n  }\n\n  resendEmailVerification() {\n    this.resendEmailVerificationEvent.emit();\n  }\n}\n","import { NgModule, InjectionToken } from '@angular/core';\n\nimport { VerdocsRequestInterceptor } from './interceptors/request.interceptor';\nimport { VerdocsErrorInterceptor } from './interceptors/error.interceptor';\nimport { VerdocsResponseInterceptor } from './interceptors/response.interceptor';\n\nimport { CookieModule } from 'ngx-cookie';\nimport { VerdocsAuthService } from './services/auth.service';\nimport { VerdocsAuthGuardService } from './services/authguard.service';\nimport { VerdocsStateService } from './services/state.service';\nimport { VerdocsTokenObjectService } from './services/token.service';\n\nimport { VerdocsTokenGuardDirective } from './directives/realster-guard.directive';\nimport { VerifyEmailDialogComponent } from './dialogs/verify-email-dialog.component';\nimport { MatButtonModule, MatDialogModule } from '@angular/material';\n\nexport interface VTokenConfig {\n  production: boolean;\n  domain: string;\n  cookieName: string;\n  loginURL: string;\n  verdocs_name?: string;\n  account_name?: string;\n  origin?: 'rAccount' | 'rForm';\n}\n\nexport const VTokenConfigToken = new InjectionToken<VTokenConfig>('VTokenConfig');\n\n@NgModule({\n  imports: [\n    CookieModule.forRoot(),\n    MatButtonModule,\n    MatDialogModule,\n  ],\n  declarations: [\n    VerdocsTokenGuardDirective,\n    VerifyEmailDialogComponent\n  ],\n  providers: [\n    VerdocsResponseInterceptor,\n    VerdocsRequestInterceptor,\n    VerdocsErrorInterceptor,\n    VerdocsAuthService,\n    VerdocsAuthGuardService,\n    VerdocsStateService,\n    VerdocsTokenObjectService\n  ],\n  entryComponents: [\n    VerifyEmailDialogComponent\n  ],\n  exports: [\n    VerdocsTokenGuardDirective,\n    VerifyEmailDialogComponent\n  ]\n})\nexport class TokensModule {\n  static initInterceptor(config: VTokenConfig) {\n    return {\n      ngModule: TokensModule,\n      providers: [\n        {\n          provide: VTokenConfigToken,\n          useValue: config\n        }\n      ]\n    }\n  }\n}\n"]}