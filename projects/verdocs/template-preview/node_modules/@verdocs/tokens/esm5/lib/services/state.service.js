/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Injectable, Injector, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { HttpClient } from '@angular/common/http';
import { CookieService } from 'ngx-cookie';
import { JwtHelperService } from '@auth0/angular-jwt';
import { VTokenConfigToken } from '../tokens.module';
import { ReplaySubject, interval } from 'rxjs';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "ngx-cookie";
import * as i2 from "@angular/common/http";
/** @type {?} */
var helper = new JwtHelperService();
var VerdocsStateService = /** @class */ (function () {
    function VerdocsStateService(cookieService, http, injector, platform) {
        this.cookieService = cookieService;
        this.http = http;
        this.injector = injector;
        this.platform = platform;
        this.timerActive = false;
        this.cookieConfig = {
            path: '/',
            domain: 'localhost',
            secure: false
        };
        this.accessList = [];
        this.decodedIdTokenSubject = new ReplaySubject();
        this.tokenConfig = this.injector.get(VTokenConfigToken);
        this.domain = this.tokenConfig.domain;
        this.init();
    }
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.init = /**
     * @return {?}
     */
    function () {
        if (this.tokenConfig.loginURL) {
            this.loginURL = this.tokenConfig.loginURL;
        }
        if (this.tokenConfig.cookieName) {
            this.cookieName = this.tokenConfig.cookieName;
        }
        else if (this.tokenConfig.origin) {
            this.cookieName = this.tokenConfig.origin + VerdocsStateService.COOKIE_NAME_SUFFIX;
        }
        this.production = this.tokenConfig.production || false;
        this.cookieConfig.domain = this.getDomain();
        if (this.tokenConfig.production) {
            this.cookieConfig.secure = true;
        }
        this.getAccessList();
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getDomain = /**
     * @return {?}
     */
    function () {
        if (this.production || this.domain !== 'localhost') {
            /** @type {?} */
            var address = this.domain.split('.');
            return '.' + address[address.length - 2] + '.' + address[address.length - 1];
        }
        else {
            return 'localhost';
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.watchAuthentication = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (isPlatformBrowser(this.platform)) {
            if (!this.timerActive) {
                this.timerActive = true;
                this.authenticationWatcher = interval(15000).subscribe((/**
                 * @return {?}
                 */
                function () {
                    _this.getAccessList();
                    if ((_this.accessList.indexOf(VerdocsStateService.RACCOUNT_COOKIE_NAME) === -1 || _this.accessList.indexOf(_this.cookieName) === -1)) {
                        _this.cookieService.removeAll();
                        window.location.href = _this.getLoginURL();
                    }
                    ;
                }));
            }
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.endWatchAuthentication = /**
     * @return {?}
     */
    function () {
        this.authenticationWatcher.unsubscribe();
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getAccountCookieObject = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie_prefix = this.tokenConfig.account_name || 'rAccount';
            /** @type {?} */
            var cookie_name = cookie_prefix + VerdocsStateService.COOKIE_NAME_SUFFIX;
            /** @type {?} */
            var cookie = this.getOtherCookieObject(cookie_name);
            return cookie;
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getVerdocsCookieObject = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie_prefix = this.tokenConfig.verdocs_name || 'rForm';
            /** @type {?} */
            var cookie_name = cookie_prefix + VerdocsStateService.COOKIE_NAME_SUFFIX;
            /** @type {?} */
            var cookie = this.getOtherCookieObject(cookie_name);
            return cookie;
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getAccessToken = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            if (this.cookieName) {
                /** @type {?} */
                var cookie = this.getOtherCookieObject(this.cookieName);
                if (cookie && cookie[VerdocsStateService.ACCESS_TOKEN_NAME]) {
                    this.accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];
                    return this.accessToken;
                }
            }
        }
        return null;
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getVerdocsAccessToken = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie = this.getVerdocsCookieObject();
            if (cookie && cookie[VerdocsStateService.ACCESS_TOKEN_NAME]) {
                this.accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];
                return this.accessToken;
            }
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getAccountAccessToken = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie = this.getAccountCookieObject();
            if (cookie && cookie[VerdocsStateService.ACCESS_TOKEN_NAME]) {
                this.accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];
                return this.accessToken;
            }
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getIDToken = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie = this.getAccountCookieObject();
            if (cookie && cookie[VerdocsStateService.ID_TOKEN_NAME]) {
                this.idToken = cookie[VerdocsStateService.ID_TOKEN_NAME];
                this.decodedIdTokenSubject.next(helper.decodeToken(this.idToken));
                return this.idToken;
            }
        }
        return null;
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getLoginURL = /**
     * @return {?}
     */
    function () {
        return this.loginURL;
    };
    /**
     * @param {?} state
     * @return {?}
     */
    VerdocsStateService.prototype.setTimer = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.timerActive = state;
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getUserId = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var idToken = this.getIDToken();
        if (!!idToken) {
            /** @type {?} */
            var idTokenContent = this.tokenToObject(idToken);
            if (idTokenContent['sub']) {
                return idTokenContent['sub'].replace('auth0|', '');
            }
            return null;
        }
        return;
    };
    /**
     * @param {?=} appName
     * @return {?}
     */
    VerdocsStateService.prototype.getAppUserId = /**
     * @param {?=} appName
     * @return {?}
     */
    function (appName) {
        if (isPlatformBrowser(this.platform)) {
            if (!appName) {
                appName = VerdocsStateService.RACCOUNT_COOKIE_NAME;
            }
            /** @type {?} */
            var cookie = this.cookieService.getObject(appName);
            /** @type {?} */
            var idToken = void 0;
            if (cookie && cookie[VerdocsStateService.ID_TOKEN_NAME]) {
                idToken = cookie[VerdocsStateService.ID_TOKEN_NAME];
                /** @type {?} */
                var idTokenContent = this.tokenToObject(idToken);
                if (idTokenContent['sub']) {
                    return idTokenContent['sub'].replace('auth0|', '');
                }
            }
            return null;
        }
        return;
    };
    /**
     * @param {?} key
     * @param {?} value
     * @param {?=} cookieName
     * @return {?}
     */
    VerdocsStateService.prototype.updateCookie = /**
     * @param {?} key
     * @param {?} value
     * @param {?=} cookieName
     * @return {?}
     */
    function (key, value, cookieName) {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cName = cookieName ? cookieName : this.cookieName;
            this.cookieConfig.domain = this.getDomain();
            if (window && window.location && location.protocol === 'https:') {
                this.cookieConfig.secure = true;
            }
            /** @type {?} */
            var rAccountCookie = this.getrAccountCookieObject();
            /** @type {?} */
            var otherCookie = this.getOtherCookieObject(cName);
            /** @type {?} */
            var cookie = void 0;
            if (!!cName && !!key && !!value) {
                if (cName === VerdocsStateService.RACCOUNT_COOKIE_NAME && !!rAccountCookie) {
                    rAccountCookie[key] = value;
                    cookie = rAccountCookie;
                }
                else if (!!otherCookie) {
                    otherCookie[key] = value;
                    cookie = otherCookie;
                }
                this.cookieService.putObject(cName, cookie, this.cookieConfig);
            }
        }
    };
    /**
     * @param {?} rSecureBackend
     * @return {?}
     */
    VerdocsStateService.prototype.updateTokens = /**
     * @param {?} rSecureBackend
     * @return {?}
     */
    function (rSecureBackend) {
        var _this = this;
        if (isPlatformBrowser(this.platform)) {
            return this.getTokens(rSecureBackend).pipe(map((/**
             * @param {?} tokens
             * @return {?}
             */
            function (tokens) {
                for (var x = 0; x < tokens.length; x++) {
                    if (tokens[x].clientName === 'rAccount') {
                        _this.updateCookie(VerdocsStateService.ID_TOKEN_NAME, tokens[x].idToken, tokens[x].clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);
                        _this.decodedIdTokenSubject.next(helper.decodeToken(tokens[x].idToken));
                    }
                    _this.updateCookie(VerdocsStateService.ACCESS_TOKEN_NAME, tokens[x].accessToken, tokens[x].clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);
                }
                return tokens;
            })));
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.hasCookie = /**
     * @return {?}
     */
    function () {
        return !!this.cookieService.get(this.cookieName);
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getAccessList = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            this.getAllCookies();
            this.accessList = [];
            for (var cookie in this.cookies) {
                if (cookie.indexOf(VerdocsStateService.COOKIE_NAME_SUFFIX) !== -1) {
                    this.accessList.push(cookie);
                }
            }
            return this.accessList;
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getEmailVerification = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var idToken = this.getIDToken();
            if (!!idToken) {
                /** @type {?} */
                var idTokenContent = this.tokenToObject(idToken);
                return idTokenContent['email_verified'];
            }
            return false;
        }
    };
    /**
     * @param {?} clientName
     * @return {?}
     */
    VerdocsStateService.prototype.hasAccessTo = /**
     * @param {?} clientName
     * @return {?}
     */
    function (clientName) {
        return this.accessList.indexOf(clientName) !== -1;
    };
    /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    VerdocsStateService.prototype.storeOtherCookie = /**
     * @param {?} key
     * @param {?} value
     * @return {?}
     */
    function (key, value) {
        if (isPlatformBrowser(this.platform)) {
            this.setCookie(key, value);
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    VerdocsStateService.prototype.getOtherCookie = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (isPlatformBrowser(this.platform)) {
            try {
                if (key) {
                    /** @type {?} */
                    var value = this.cookieService.getObject(key);
                    return value;
                }
                else {
                    return null;
                }
            }
            catch (err) {
                console.error('Cannot return cookie:', err);
                return null;
            }
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    VerdocsStateService.prototype.getRCookie = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (isPlatformBrowser(this.platform)) {
            return this.cookieService.get(key);
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    VerdocsStateService.prototype.getOtherCookieObject = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        try {
            if (!!key) {
                if (isPlatformBrowser(this.platform)) {
                    return this.cookieService.getObject(key);
                }
            }
            return null;
        }
        catch (err) {
            if (key !== VerdocsStateService.SIGNER_TOKEN_COOKIE_NAME) {
                console.error('Cannot get cookie: ', err);
            }
            return null;
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    VerdocsStateService.prototype.removeRCookie = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (isPlatformBrowser(this.platform)) {
            this.cookieService.remove(key, this.cookieConfig);
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.removeRCookies = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (isPlatformBrowser(this.platform)) {
            if (this.accessList.length > 0) {
                try {
                    for (var _b = tslib_1.__values(this.accessList), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var key = _c.value;
                        this.removeRCookie(key);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
            ;
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.removeIntercomCookie = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            for (var cookie in this.cookies) {
                if (cookie.indexOf('intercom') !== -1) {
                    this.removeRCookie(cookie);
                }
            }
        }
    };
    /**
     * @param {?} tokens
     * @return {?}
     */
    VerdocsStateService.prototype.setTokens = /**
     * @param {?} tokens
     * @return {?}
     */
    function (tokens) {
        var e_2, _a;
        if (isPlatformBrowser(this.platform)) {
            if (tokens && tokens.length > 0) {
                try {
                    for (var tokens_1 = tslib_1.__values(tokens), tokens_1_1 = tokens_1.next(); !tokens_1_1.done; tokens_1_1 = tokens_1.next()) {
                        var token = tokens_1_1.value;
                        if (token.clientName === 'rAccount') {
                            this.updateCookie(VerdocsStateService.ID_TOKEN_NAME, token.idToken, token.clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);
                            this.decodedIdTokenSubject.next(helper.decodeToken(token.idToken));
                        }
                        this.updateCookie(VerdocsStateService.ACCESS_TOKEN_NAME, token.accessToken, token.clientName + VerdocsStateService.COOKIE_NAME_SUFFIX);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (tokens_1_1 && !tokens_1_1.done && (_a = tokens_1.return)) _a.call(tokens_1);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    VerdocsStateService.prototype.getrAccountCookieObject = /**
     * @private
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            try {
                if (this.cookieName && this.cookieService.get(VerdocsStateService.RACCOUNT_COOKIE_NAME)) {
                    /** @type {?} */
                    var cookie = this.cookieService.getObject(VerdocsStateService.RACCOUNT_COOKIE_NAME);
                    return cookie;
                }
                return null;
            }
            catch (err) {
                return null;
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    VerdocsStateService.prototype.getAllCookies = /**
     * @private
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            this.cookies = this.cookieService.getAll();
        }
    };
    /**
     * @private
     * @param {?} token
     * @return {?}
     */
    VerdocsStateService.prototype.tokenToObject = /**
     * @private
     * @param {?} token
     * @return {?}
     */
    function (token) {
        if (token) {
            /** @type {?} */
            var base64Url = token.split('.')[1];
            /** @type {?} */
            var base64 = base64Url.replace('-', '+').replace('_', '/');
            return JSON.parse(window.atob(base64));
        }
        return null;
    };
    /**
     * @private
     * @param {?} cookieName
     * @param {?} cookieValue
     * @return {?}
     */
    VerdocsStateService.prototype.setCookie = /**
     * @private
     * @param {?} cookieName
     * @param {?} cookieValue
     * @return {?}
     */
    function (cookieName, cookieValue) {
        if (isPlatformBrowser(this.platform)) {
            this.cookieService.put(cookieName, cookieValue, this.cookieConfig);
        }
    };
    /**
     * @private
     * @param {?} rSecureBackend
     * @return {?}
     */
    VerdocsStateService.prototype.getTokens = /**
     * @private
     * @param {?} rSecureBackend
     * @return {?}
     */
    function (rSecureBackend) {
        return this.http.get(rSecureBackend + '/token');
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getRAccountRoles = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie = this.cookieService.getObject(VerdocsStateService.RACCOUNT_COOKIE_NAME);
            if (!!cookie) {
                try {
                    /** @type {?} */
                    var accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];
                    /** @type {?} */
                    var tokenObject = this.tokenToObject(accessToken);
                    return tokenObject[VerdocsStateService.TOKEN_NAMESPACE + "/roles"];
                }
                catch (err) {
                    console.error(err);
                }
            }
            else {
                return null;
            }
        }
    };
    /**
     * @return {?}
     */
    VerdocsStateService.prototype.getPlans = /**
     * @return {?}
     */
    function () {
        if (isPlatformBrowser(this.platform)) {
            /** @type {?} */
            var cookie = this.cookieService.getObject(VerdocsStateService.RACCOUNT_COOKIE_NAME);
            if (!!cookie) {
                try {
                    /** @type {?} */
                    var accessToken = cookie[VerdocsStateService.ACCESS_TOKEN_NAME];
                    /** @type {?} */
                    var tokenObject = this.tokenToObject(accessToken);
                    return tokenObject[VerdocsStateService.TOKEN_NAMESPACE + "/plans"];
                }
                catch (err) {
                    console.error(err);
                }
            }
            else {
                return null;
            }
        }
    };
    VerdocsStateService.RACCOUNT_COOKIE_NAME = 'rAccount_Verdocs';
    VerdocsStateService.SIGNER_TOKEN_COOKIE_NAME = 'signer_token';
    VerdocsStateService.COOKIE_NAME_SUFFIX = '_Verdocs';
    VerdocsStateService.ACCESS_TOKEN_NAME = 'accessToken';
    VerdocsStateService.ID_TOKEN_NAME = 'idToken';
    VerdocsStateService.TOKEN_NAMESPACE = 'https://verdocs.com';
    VerdocsStateService.decorators = [
        { type: Injectable, args: [{
                    providedIn: "root"
                },] }
    ];
    /** @nocollapse */
    VerdocsStateService.ctorParameters = function () { return [
        { type: CookieService },
        { type: HttpClient },
        { type: Injector },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    /** @nocollapse */ VerdocsStateService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function VerdocsStateService_Factory() { return new VerdocsStateService(i0.ɵɵinject(i1.CookieService), i0.ɵɵinject(i2.HttpClient), i0.ɵɵinject(i0.INJECTOR), i0.ɵɵinject(i0.PLATFORM_ID)); }, token: VerdocsStateService, providedIn: "root" });
    return VerdocsStateService;
}());
export { VerdocsStateService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.RACCOUNT_COOKIE_NAME;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.SIGNER_TOKEN_COOKIE_NAME;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.COOKIE_NAME_SUFFIX;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.ACCESS_TOKEN_NAME;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.ID_TOKEN_NAME;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.TOKEN_NAMESPACE;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.loginURL;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.cookieName;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.production;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.accessToken;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.idToken;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.timerActive;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.domain;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.cookieConfig;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.cookies;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.tokenConfig;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.authenticationWatcher;
    /** @type {?} */
    VerdocsStateService.prototype.accessList;
    /** @type {?} */
    VerdocsStateService.prototype.decodedIdTokenSubject;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.cookieService;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    VerdocsStateService.prototype.platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0B2ZXJkb2NzL3Rva2Vucy8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9zdGF0ZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBaUIsTUFBTSxZQUFZLENBQUM7QUFDMUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDdEQsT0FBTyxFQUFFLGlCQUFpQixFQUFnQixNQUFNLGtCQUFrQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxhQUFhLEVBQWdCLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3RCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7O0lBRS9CLE1BQU0sR0FBRyxJQUFJLGdCQUFnQixFQUFFO0FBRXJDO0lBOEJFLDZCQUNVLGFBQTRCLEVBQzVCLElBQWdCLEVBQ2hCLFFBQWtCLEVBQ0csUUFBUTtRQUg3QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDRyxhQUFRLEdBQVIsUUFBUSxDQUFBO1FBbEIvQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUVwQixpQkFBWSxHQUFrQjtZQUNwQyxJQUFJLEVBQUUsR0FBRztZQUNULE1BQU0sRUFBRSxXQUFXO1lBQ25CLE1BQU0sRUFBRSxLQUFLO1NBQ2QsQ0FBQTtRQUtNLGVBQVUsR0FBYSxFQUFFLENBQUM7UUFDMUIsMEJBQXFCLEdBQUcsSUFBSSxhQUFhLEVBQU8sQ0FBQztRQVF0RCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQztRQUN0QyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFZCxDQUFDOzs7O0lBRUQsa0NBQUk7OztJQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRTtZQUM3QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDO1NBQzNDO1FBQ0QsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRTtZQUMvQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDO1NBQy9DO2FBQU0sSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtZQUNsQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDO1NBQ3BGO1FBQ0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsSUFBSSxLQUFLLENBQUM7UUFDdkQsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzVDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUU7WUFDL0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2pDO1FBQ0QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7Ozs7SUFFRCx1Q0FBUzs7O0lBQVQ7UUFDRSxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxXQUFXLEVBQUU7O2dCQUM1QyxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO1lBQ3RDLE9BQU8sR0FBRyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztTQUM5RTthQUFNO1lBQ0wsT0FBTyxXQUFXLENBQUM7U0FDcEI7SUFDSCxDQUFDOzs7O0lBRUQsaURBQW1COzs7SUFBbkI7UUFBQSxpQkFhQztRQVpDLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNyQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztnQkFDeEIsSUFBSSxDQUFDLHFCQUFxQixHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTOzs7Z0JBQUM7b0JBQ3JELEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztvQkFDckIsSUFBSSxDQUFDLEtBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksS0FBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUU7d0JBQ2pJLEtBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQUM7d0JBQy9CLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztxQkFDM0M7b0JBQUEsQ0FBQztnQkFDSixDQUFDLEVBQUMsQ0FBQzthQUNKO1NBQ0Y7SUFDSCxDQUFDOzs7O0lBRUQsb0RBQXNCOzs7SUFBdEI7UUFDRSxJQUFJLENBQUMscUJBQXFCLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDM0MsQ0FBQzs7OztJQUVELG9EQUFzQjs7O0lBQXRCO1FBQ0UsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7O2dCQUM5QixhQUFhLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLElBQUksVUFBVTs7Z0JBQzNELFdBQVcsR0FBRyxhQUFhLEdBQUcsbUJBQW1CLENBQUMsa0JBQWtCOztnQkFDcEUsTUFBTSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLENBQUM7WUFDckQsT0FBTyxNQUFNLENBQUM7U0FDZjtJQUNILENBQUM7Ozs7SUFDRCxvREFBc0I7OztJQUF0QjtRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFOztnQkFDOUIsYUFBYSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxJQUFJLE9BQU87O2dCQUN4RCxXQUFXLEdBQUcsYUFBYSxHQUFHLG1CQUFtQixDQUFDLGtCQUFrQjs7Z0JBQ3BFLE1BQU0sR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsV0FBVyxDQUFDO1lBQ3JELE9BQU8sTUFBTSxDQUFDO1NBQ2Y7SUFDSCxDQUFDOzs7O0lBRUQsNENBQWM7OztJQUFkO1FBQ0UsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDcEMsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFOztvQkFDYixNQUFNLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7Z0JBQ3pELElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO29CQUMzRCxJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO29CQUNoRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7aUJBQ3pCO2FBQ0Y7U0FDRjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7OztJQUVELG1EQUFxQjs7O0lBQXJCO1FBQ0UsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7O2dCQUM5QixNQUFNLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixFQUFFO1lBQzVDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO2dCQUMzRCxJQUFJLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO2dCQUNqRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7YUFDekI7U0FDRjtJQUNILENBQUM7Ozs7SUFFRCxtREFBcUI7OztJQUFyQjtRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFOztnQkFDOUIsTUFBTSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtZQUM1QyxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsRUFBRTtnQkFDM0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsQ0FBQztnQkFDakUsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQ3pCO1NBQ0Y7SUFDSCxDQUFDOzs7O0lBRUQsd0NBQVU7OztJQUFWO1FBQ0UsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7O2dCQUM5QixNQUFNLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixFQUFFO1lBQzVDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDdkQsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsbUJBQW1CLENBQUMsYUFBYSxDQUFDLENBQUE7Z0JBQ3hELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDbEUsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO2FBQ3JCO1NBQ0Y7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Ozs7SUFFRCx5Q0FBVzs7O0lBQVg7UUFDRSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdkIsQ0FBQzs7Ozs7SUFFRCxzQ0FBUTs7OztJQUFSLFVBQVMsS0FBYztRQUNyQixJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztJQUMzQixDQUFDOzs7O0lBRU0sdUNBQVM7OztJQUFoQjs7WUFDUSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRTtRQUNqQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUU7O2dCQUNQLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQztZQUNsRCxJQUFJLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDekIsT0FBTyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQzthQUNwRDtZQUNELE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFDRCxPQUFPO0lBQ1QsQ0FBQzs7Ozs7SUFFTSwwQ0FBWTs7OztJQUFuQixVQUFvQixPQUFnQjtRQUNsQyxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNwQyxJQUFJLENBQUMsT0FBTyxFQUFFO2dCQUNaLE9BQU8sR0FBRyxtQkFBbUIsQ0FBQyxvQkFBb0IsQ0FBQzthQUNwRDs7Z0JBQ0ssTUFBTSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQzs7Z0JBQ2hELE9BQU8sU0FBQTtZQUNYLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDdkQsT0FBTyxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxhQUFhLENBQUMsQ0FBQzs7b0JBQzlDLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQztnQkFDbEQsSUFBSSxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUU7b0JBQ3pCLE9BQU8sY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ3BEO2FBQ0Y7WUFDRCxPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsT0FBTztJQUNULENBQUM7Ozs7Ozs7SUFFRCwwQ0FBWTs7Ozs7O0lBQVosVUFBYSxHQUFXLEVBQUUsS0FBYSxFQUFFLFVBQW1CO1FBQzFELElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFOztnQkFDOUIsS0FBSyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVTtZQUN2RCxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDNUMsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxLQUFLLFFBQVEsRUFBRTtnQkFDL0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO2FBQ2pDOztnQkFDRyxjQUFjLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixFQUFFOztnQkFDL0MsV0FBVyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUM7O2dCQUM5QyxNQUFNLFNBQUE7WUFDVixJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFO2dCQUMvQixJQUFJLEtBQUssS0FBSyxtQkFBbUIsQ0FBQyxvQkFBb0IsSUFBSSxDQUFDLENBQUMsY0FBYyxFQUFFO29CQUMxRSxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUM1QixNQUFNLEdBQUcsY0FBYyxDQUFDO2lCQUN6QjtxQkFBTSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUU7b0JBQ3hCLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7b0JBQ3pCLE1BQU0sR0FBRyxXQUFXLENBQUM7aUJBQ3RCO2dCQUNELElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ2hFO1NBQ0Y7SUFDSCxDQUFDOzs7OztJQUVELDBDQUFZOzs7O0lBQVosVUFBYSxjQUFjO1FBQTNCLGlCQWVDO1FBZEMsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDcEMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FDeEMsR0FBRzs7OztZQUFDLFVBQUMsTUFBYTtnQkFDaEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQ3RDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsS0FBSyxVQUFVLEVBQUU7d0JBQ3ZDLEtBQUksQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO3dCQUN2SSxLQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7cUJBQ3hFO29CQUNELEtBQUksQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxHQUFHLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDLENBQUM7aUJBQ2hKO2dCQUNELE9BQU8sTUFBTSxDQUFDO1lBQ2hCLENBQUMsRUFBQyxDQUNILENBQUM7U0FDSDtJQUNILENBQUM7Ozs7SUFFRCx1Q0FBUzs7O0lBQVQ7UUFDRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkQsQ0FBQzs7OztJQUVELDJDQUFhOzs7SUFBYjtRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNyQixJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQztZQUNyQixLQUFLLElBQU0sTUFBTSxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBQ2pDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO29CQUNqRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDOUI7YUFDRjtZQUNELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztTQUN4QjtJQUNILENBQUM7Ozs7SUFFRCxrREFBb0I7OztJQUFwQjtRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFOztnQkFDOUIsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDakMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFOztvQkFDUCxjQUFjLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUM7Z0JBQ2xELE9BQU8sY0FBYyxDQUFDLGdCQUFnQixDQUFDLENBQUM7YUFDekM7WUFDRCxPQUFPLEtBQUssQ0FBQztTQUNkO0lBQ0gsQ0FBQzs7Ozs7SUFFRCx5Q0FBVzs7OztJQUFYLFVBQVksVUFBa0I7UUFDNUIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNwRCxDQUFDOzs7Ozs7SUFFRCw4Q0FBZ0I7Ozs7O0lBQWhCLFVBQWlCLEdBQUcsRUFBRSxLQUFLO1FBQ3pCLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzVCO0lBQ0gsQ0FBQzs7Ozs7SUFFRCw0Q0FBYzs7OztJQUFkLFVBQWUsR0FBRztRQUNoQixJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNwQyxJQUFJO2dCQUNGLElBQUksR0FBRyxFQUFFOzt3QkFDRCxLQUFLLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDO29CQUMvQyxPQUFPLEtBQUssQ0FBQztpQkFDZDtxQkFBTTtvQkFDTCxPQUFPLElBQUksQ0FBQztpQkFDYjthQUNGO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDNUMsT0FBTyxJQUFJLENBQUM7YUFDYjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7SUFFRCx3Q0FBVTs7OztJQUFWLFVBQVcsR0FBVztRQUNwQixJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNwQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3BDO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxrREFBb0I7Ozs7SUFBcEIsVUFBcUIsR0FBRztRQUN0QixJQUFJO1lBQ0YsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFO2dCQUNULElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO29CQUNwQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUMxQzthQUNGO1lBQ0QsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUFDLE9BQU8sR0FBRyxFQUFFO1lBQ1osSUFBSSxHQUFHLEtBQUssbUJBQW1CLENBQUMsd0JBQXdCLEVBQUU7Z0JBQ3hELE9BQU8sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsR0FBRyxDQUFDLENBQUM7YUFDM0M7WUFDRCxPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQzs7Ozs7SUFFRCwyQ0FBYTs7OztJQUFiLFVBQWMsR0FBRztRQUNmLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDbkQ7SUFDSCxDQUFDOzs7O0lBRUQsNENBQWM7OztJQUFkOztRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztvQkFDOUIsS0FBa0IsSUFBQSxLQUFBLGlCQUFBLElBQUksQ0FBQyxVQUFVLENBQUEsZ0JBQUEsNEJBQUU7d0JBQTlCLElBQU0sR0FBRyxXQUFBO3dCQUNaLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQ3pCOzs7Ozs7Ozs7YUFDRjtZQUFBLENBQUM7U0FDSDtJQUNILENBQUM7Ozs7SUFFRCxrREFBb0I7OztJQUFwQjtRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLEtBQUssSUFBTSxNQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDakMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO29CQUNyQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lCQUM1QjthQUNGO1NBQ0Y7SUFDSCxDQUFDOzs7OztJQUVELHVDQUFTOzs7O0lBQVQsVUFBVSxNQUFNOztRQUNkLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOztvQkFDL0IsS0FBb0IsSUFBQSxXQUFBLGlCQUFBLE1BQU0sQ0FBQSw4QkFBQSxrREFBRTt3QkFBdkIsSUFBTSxLQUFLLG1CQUFBO3dCQUNkLElBQUksS0FBSyxDQUFDLFVBQVUsS0FBSyxVQUFVLEVBQUU7NEJBQ25DLElBQUksQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDOzRCQUMvSCxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7eUJBQ3BFO3dCQUNELElBQUksQ0FBQyxZQUFZLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsVUFBVSxHQUFHLG1CQUFtQixDQUFDLGtCQUFrQixDQUFDLENBQUM7cUJBQ3hJOzs7Ozs7Ozs7YUFDRjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7SUFFTyxxREFBdUI7Ozs7SUFBL0I7UUFDRSxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNwQyxJQUFJO2dCQUNGLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFOzt3QkFDakYsTUFBTSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLG9CQUFvQixDQUFDO29CQUNyRixPQUFPLE1BQU0sQ0FBQztpQkFDZjtnQkFDRCxPQUFPLElBQUksQ0FBQzthQUNiO1lBQUMsT0FBTyxHQUFHLEVBQUU7Z0JBQ1osT0FBTyxJQUFJLENBQUM7YUFDYjtTQUNGO0lBQ0gsQ0FBQzs7Ozs7SUFFTywyQ0FBYTs7OztJQUFyQjtRQUNFLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ3BDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUM1QztJQUNILENBQUM7Ozs7OztJQUVPLDJDQUFhOzs7OztJQUFyQixVQUFzQixLQUFLO1FBQ3pCLElBQUksS0FBSyxFQUFFOztnQkFDSCxTQUFTLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7O2dCQUNqQyxNQUFNLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7WUFDMUQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztTQUN4QztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7Ozs7OztJQUVPLHVDQUFTOzs7Ozs7SUFBakIsVUFBa0IsVUFBVSxFQUFFLFdBQVc7UUFDdkMsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDcEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDcEU7SUFDSCxDQUFDOzs7Ozs7SUFFTyx1Q0FBUzs7Ozs7SUFBakIsVUFBa0IsY0FBYztRQUM5QixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsQ0FBQTtJQUNqRCxDQUFDOzs7O0lBRU0sOENBQWdCOzs7SUFBdkI7UUFDRSxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTs7Z0JBQzlCLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxvQkFBb0IsQ0FBQztZQUNyRixJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUU7Z0JBQ1osSUFBSTs7d0JBQ0ksV0FBVyxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsQ0FBQzs7d0JBQzNELFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQztvQkFDbkQsT0FBTyxXQUFXLENBQUksbUJBQW1CLENBQUMsZUFBZSxXQUFRLENBQUMsQ0FBQztpQkFDcEU7Z0JBQUMsT0FBTyxHQUFHLEVBQUU7b0JBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDcEI7YUFDRjtpQkFBTTtnQkFDTCxPQUFPLElBQUksQ0FBQzthQUNiO1NBQ0Y7SUFDSCxDQUFDOzs7O0lBRU0sc0NBQVE7OztJQUFmO1FBQ0UsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7O2dCQUM5QixNQUFNLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsb0JBQW9CLENBQUM7WUFDckYsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFO2dCQUNaLElBQUk7O3dCQUNJLFdBQVcsR0FBRyxNQUFNLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUM7O3dCQUMzRCxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUM7b0JBQ25ELE9BQU8sV0FBVyxDQUFJLG1CQUFtQixDQUFDLGVBQWUsV0FBUSxDQUFDLENBQUM7aUJBQ3BFO2dCQUFDLE9BQU8sR0FBRyxFQUFFO29CQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQ3BCO2FBQ0Y7aUJBQU07Z0JBQ0wsT0FBTyxJQUFJLENBQUM7YUFDYjtTQUNGO0lBQ0gsQ0FBQztJQTVaYyx3Q0FBb0IsR0FBRyxrQkFBa0IsQ0FBQztJQUMxQyw0Q0FBd0IsR0FBRyxjQUFjLENBQUE7SUFDekMsc0NBQWtCLEdBQUcsVUFBVSxDQUFDO0lBQ2hDLHFDQUFpQixHQUFHLGFBQWEsQ0FBQztJQUNsQyxpQ0FBYSxHQUFHLFNBQVMsQ0FBQztJQUMxQixtQ0FBZSxHQUFHLHFCQUFxQixDQUFDOztnQkFUeEQsVUFBVSxTQUFDO29CQUNWLFVBQVUsRUFBRSxNQUFNO2lCQUNuQjs7OztnQkFWUSxhQUFhO2dCQURiLFVBQVU7Z0JBRkUsUUFBUTtnREE2Q3hCLE1BQU0sU0FBQyxXQUFXOzs7OEJBN0N2QjtDQTRhQyxBQWphRCxJQWlhQztTQTlaWSxtQkFBbUI7Ozs7OztJQUM5Qix5Q0FBeUQ7Ozs7O0lBQ3pELDZDQUF3RDs7Ozs7SUFDeEQsdUNBQStDOzs7OztJQUMvQyxzQ0FBaUQ7Ozs7O0lBQ2pELGtDQUF5Qzs7Ozs7SUFDekMsb0NBQXVEOzs7OztJQUV2RCx1Q0FBeUI7Ozs7O0lBQ3pCLHlDQUEyQjs7Ozs7SUFDM0IseUNBQTRCOzs7OztJQUM1QiwwQ0FBNEI7Ozs7O0lBQzVCLHNDQUF3Qjs7Ozs7SUFDeEIsMENBQTRCOzs7OztJQUM1QixxQ0FBdUI7Ozs7O0lBQ3ZCLDJDQUlDOzs7OztJQUNELHNDQUFnQjs7Ozs7SUFDaEIsMENBQWlDOzs7OztJQUNqQyxvREFBNEM7O0lBRTVDLHlDQUFpQzs7SUFDakMsb0RBQXdEOzs7OztJQUd0RCw0Q0FBb0M7Ozs7O0lBQ3BDLG1DQUF3Qjs7Ozs7SUFDeEIsdUNBQTBCOzs7OztJQUMxQix1Q0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3RvciwgSW5qZWN0LCBQTEFURk9STV9JRCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgaXNQbGF0Zm9ybUJyb3dzZXIgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IENvb2tpZVNlcnZpY2UsIENvb2tpZU9wdGlvbnMgfSBmcm9tICduZ3gtY29va2llJztcbmltcG9ydCB7IEp3dEhlbHBlclNlcnZpY2UgfSBmcm9tICdAYXV0aDAvYW5ndWxhci1qd3QnO1xuaW1wb3J0IHsgVlRva2VuQ29uZmlnVG9rZW4sIFZUb2tlbkNvbmZpZyB9IGZyb20gJy4uL3Rva2Vucy5tb2R1bGUnO1xuaW1wb3J0IHsgUmVwbGF5U3ViamVjdCwgU3Vic2NyaXB0aW9uLCBpbnRlcnZhbCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5jb25zdCBoZWxwZXIgPSBuZXcgSnd0SGVscGVyU2VydmljZSgpO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46IFwicm9vdFwiXG59KVxuZXhwb3J0IGNsYXNzIFZlcmRvY3NTdGF0ZVNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBSQUNDT1VOVF9DT09LSUVfTkFNRSA9ICdyQWNjb3VudF9WZXJkb2NzJztcbiAgcHJpdmF0ZSBzdGF0aWMgU0lHTkVSX1RPS0VOX0NPT0tJRV9OQU1FID0gJ3NpZ25lcl90b2tlbidcbiAgcHJpdmF0ZSBzdGF0aWMgQ09PS0lFX05BTUVfU1VGRklYID0gJ19WZXJkb2NzJztcbiAgcHJpdmF0ZSBzdGF0aWMgQUNDRVNTX1RPS0VOX05BTUUgPSAnYWNjZXNzVG9rZW4nO1xuICBwcml2YXRlIHN0YXRpYyBJRF9UT0tFTl9OQU1FID0gJ2lkVG9rZW4nO1xuICBwcml2YXRlIHN0YXRpYyBUT0tFTl9OQU1FU1BBQ0UgPSAnaHR0cHM6Ly92ZXJkb2NzLmNvbSc7XG5cbiAgcHJpdmF0ZSBsb2dpblVSTDogc3RyaW5nO1xuICBwcml2YXRlIGNvb2tpZU5hbWU6IHN0cmluZztcbiAgcHJpdmF0ZSBwcm9kdWN0aW9uOiBib29sZWFuO1xuICBwcml2YXRlIGFjY2Vzc1Rva2VuOiBzdHJpbmc7XG4gIHByaXZhdGUgaWRUb2tlbjogc3RyaW5nO1xuICBwcml2YXRlIHRpbWVyQWN0aXZlID0gZmFsc2U7XG4gIHByaXZhdGUgZG9tYWluOiBzdHJpbmc7XG4gIHByaXZhdGUgY29va2llQ29uZmlnOiBDb29raWVPcHRpb25zID0ge1xuICAgIHBhdGg6ICcvJyxcbiAgICBkb21haW46ICdsb2NhbGhvc3QnLFxuICAgIHNlY3VyZTogZmFsc2VcbiAgfVxuICBwcml2YXRlIGNvb2tpZXM7XG4gIHByaXZhdGUgdG9rZW5Db25maWc6IFZUb2tlbkNvbmZpZ1xuICBwcml2YXRlIGF1dGhlbnRpY2F0aW9uV2F0Y2hlcjogU3Vic2NyaXB0aW9uO1xuXG4gIHB1YmxpYyBhY2Nlc3NMaXN0OiBzdHJpbmdbXSA9IFtdO1xuICBwdWJsaWMgZGVjb2RlZElkVG9rZW5TdWJqZWN0ID0gbmV3IFJlcGxheVN1YmplY3Q8YW55PigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY29va2llU2VydmljZTogQ29va2llU2VydmljZSxcbiAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybVxuICApIHtcbiAgICB0aGlzLnRva2VuQ29uZmlnID0gdGhpcy5pbmplY3Rvci5nZXQoVlRva2VuQ29uZmlnVG9rZW4pO1xuICAgIHRoaXMuZG9tYWluID0gdGhpcy50b2tlbkNvbmZpZy5kb21haW47XG4gICAgdGhpcy5pbml0KCk7XG5cbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgaWYgKHRoaXMudG9rZW5Db25maWcubG9naW5VUkwpIHtcbiAgICAgIHRoaXMubG9naW5VUkwgPSB0aGlzLnRva2VuQ29uZmlnLmxvZ2luVVJMO1xuICAgIH1cbiAgICBpZiAodGhpcy50b2tlbkNvbmZpZy5jb29raWVOYW1lKSB7XG4gICAgICB0aGlzLmNvb2tpZU5hbWUgPSB0aGlzLnRva2VuQ29uZmlnLmNvb2tpZU5hbWU7XG4gICAgfSBlbHNlIGlmICh0aGlzLnRva2VuQ29uZmlnLm9yaWdpbikge1xuICAgICAgdGhpcy5jb29raWVOYW1lID0gdGhpcy50b2tlbkNvbmZpZy5vcmlnaW4gKyBWZXJkb2NzU3RhdGVTZXJ2aWNlLkNPT0tJRV9OQU1FX1NVRkZJWDtcbiAgICB9XG4gICAgdGhpcy5wcm9kdWN0aW9uID0gdGhpcy50b2tlbkNvbmZpZy5wcm9kdWN0aW9uIHx8IGZhbHNlO1xuICAgIHRoaXMuY29va2llQ29uZmlnLmRvbWFpbiA9IHRoaXMuZ2V0RG9tYWluKCk7XG4gICAgaWYgKHRoaXMudG9rZW5Db25maWcucHJvZHVjdGlvbikge1xuICAgICAgdGhpcy5jb29raWVDb25maWcuc2VjdXJlID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5nZXRBY2Nlc3NMaXN0KCk7XG4gIH1cblxuICBnZXREb21haW4oKSB7XG4gICAgaWYgKHRoaXMucHJvZHVjdGlvbiB8fCB0aGlzLmRvbWFpbiAhPT0gJ2xvY2FsaG9zdCcpIHtcbiAgICAgIGNvbnN0IGFkZHJlc3MgPSB0aGlzLmRvbWFpbi5zcGxpdCgnLicpO1xuICAgICAgcmV0dXJuICcuJyArIGFkZHJlc3NbYWRkcmVzcy5sZW5ndGggLSAyXSArICcuJyArIGFkZHJlc3NbYWRkcmVzcy5sZW5ndGggLSAxXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICdsb2NhbGhvc3QnO1xuICAgIH1cbiAgfVxuXG4gIHdhdGNoQXV0aGVudGljYXRpb24oKSB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICBpZiAoIXRoaXMudGltZXJBY3RpdmUpIHtcbiAgICAgICAgdGhpcy50aW1lckFjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25XYXRjaGVyID0gaW50ZXJ2YWwoMTUwMDApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5nZXRBY2Nlc3NMaXN0KCk7XG4gICAgICAgICAgaWYgKCh0aGlzLmFjY2Vzc0xpc3QuaW5kZXhPZihWZXJkb2NzU3RhdGVTZXJ2aWNlLlJBQ0NPVU5UX0NPT0tJRV9OQU1FKSA9PT0gLTEgfHwgdGhpcy5hY2Nlc3NMaXN0LmluZGV4T2YodGhpcy5jb29raWVOYW1lKSA9PT0gLTEpKSB7XG4gICAgICAgICAgICB0aGlzLmNvb2tpZVNlcnZpY2UucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHRoaXMuZ2V0TG9naW5VUkwoKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBlbmRXYXRjaEF1dGhlbnRpY2F0aW9uKCkge1xuICAgIHRoaXMuYXV0aGVudGljYXRpb25XYXRjaGVyLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBnZXRBY2NvdW50Q29va2llT2JqZWN0KCkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgY29uc3QgY29va2llX3ByZWZpeCA9IHRoaXMudG9rZW5Db25maWcuYWNjb3VudF9uYW1lIHx8ICdyQWNjb3VudCc7XG4gICAgICBjb25zdCBjb29raWVfbmFtZSA9IGNvb2tpZV9wcmVmaXggKyBWZXJkb2NzU3RhdGVTZXJ2aWNlLkNPT0tJRV9OQU1FX1NVRkZJWDtcbiAgICAgIGNvbnN0IGNvb2tpZSA9IHRoaXMuZ2V0T3RoZXJDb29raWVPYmplY3QoY29va2llX25hbWUpO1xuICAgICAgcmV0dXJuIGNvb2tpZTtcbiAgICB9XG4gIH1cbiAgZ2V0VmVyZG9jc0Nvb2tpZU9iamVjdCgpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGNvbnN0IGNvb2tpZV9wcmVmaXggPSB0aGlzLnRva2VuQ29uZmlnLnZlcmRvY3NfbmFtZSB8fCAnckZvcm0nO1xuICAgICAgY29uc3QgY29va2llX25hbWUgPSBjb29raWVfcHJlZml4ICsgVmVyZG9jc1N0YXRlU2VydmljZS5DT09LSUVfTkFNRV9TVUZGSVg7XG4gICAgICBjb25zdCBjb29raWUgPSB0aGlzLmdldE90aGVyQ29va2llT2JqZWN0KGNvb2tpZV9uYW1lKTtcbiAgICAgIHJldHVybiBjb29raWU7XG4gICAgfVxuICB9XG5cbiAgZ2V0QWNjZXNzVG9rZW4oKSB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICBpZiAodGhpcy5jb29raWVOYW1lKSB7XG4gICAgICAgIGNvbnN0IGNvb2tpZSA9IHRoaXMuZ2V0T3RoZXJDb29raWVPYmplY3QodGhpcy5jb29raWVOYW1lKTtcbiAgICAgICAgaWYgKGNvb2tpZSAmJiBjb29raWVbVmVyZG9jc1N0YXRlU2VydmljZS5BQ0NFU1NfVE9LRU5fTkFNRV0pIHtcbiAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gY29va2llW1ZlcmRvY3NTdGF0ZVNlcnZpY2UuQUNDRVNTX1RPS0VOX05BTUVdXG4gICAgICAgICAgcmV0dXJuIHRoaXMuYWNjZXNzVG9rZW47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGdldFZlcmRvY3NBY2Nlc3NUb2tlbigpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGNvbnN0IGNvb2tpZSA9IHRoaXMuZ2V0VmVyZG9jc0Nvb2tpZU9iamVjdCgpO1xuICAgICAgaWYgKGNvb2tpZSAmJiBjb29raWVbVmVyZG9jc1N0YXRlU2VydmljZS5BQ0NFU1NfVE9LRU5fTkFNRV0pIHtcbiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLkFDQ0VTU19UT0tFTl9OQU1FXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWNjZXNzVG9rZW47XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0QWNjb3VudEFjY2Vzc1Rva2VuKCkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgY29uc3QgY29va2llID0gdGhpcy5nZXRBY2NvdW50Q29va2llT2JqZWN0KCk7XG4gICAgICBpZiAoY29va2llICYmIGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLkFDQ0VTU19UT0tFTl9OQU1FXSkge1xuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gY29va2llW1ZlcmRvY3NTdGF0ZVNlcnZpY2UuQUNDRVNTX1RPS0VOX05BTUVdO1xuICAgICAgICByZXR1cm4gdGhpcy5hY2Nlc3NUb2tlbjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRJRFRva2VuKCkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgY29uc3QgY29va2llID0gdGhpcy5nZXRBY2NvdW50Q29va2llT2JqZWN0KCk7XG4gICAgICBpZiAoY29va2llICYmIGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLklEX1RPS0VOX05BTUVdKSB7XG4gICAgICAgIHRoaXMuaWRUb2tlbiA9IGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLklEX1RPS0VOX05BTUVdXG4gICAgICAgIHRoaXMuZGVjb2RlZElkVG9rZW5TdWJqZWN0Lm5leHQoaGVscGVyLmRlY29kZVRva2VuKHRoaXMuaWRUb2tlbikpO1xuICAgICAgICByZXR1cm4gdGhpcy5pZFRva2VuO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGdldExvZ2luVVJMKCkge1xuICAgIHJldHVybiB0aGlzLmxvZ2luVVJMO1xuICB9XG5cbiAgc2V0VGltZXIoc3RhdGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnRpbWVyQWN0aXZlID0gc3RhdGU7XG4gIH1cblxuICBwdWJsaWMgZ2V0VXNlcklkKCk6IHN0cmluZyB8IG51bGwge1xuICAgIGNvbnN0IGlkVG9rZW4gPSB0aGlzLmdldElEVG9rZW4oKTtcbiAgICBpZiAoISFpZFRva2VuKSB7XG4gICAgICBjb25zdCBpZFRva2VuQ29udGVudCA9IHRoaXMudG9rZW5Ub09iamVjdChpZFRva2VuKTtcbiAgICAgIGlmIChpZFRva2VuQ29udGVudFsnc3ViJ10pIHtcbiAgICAgICAgcmV0dXJuIGlkVG9rZW5Db250ZW50WydzdWInXS5yZXBsYWNlKCdhdXRoMHwnLCAnJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcHVibGljIGdldEFwcFVzZXJJZChhcHBOYW1lPzogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICBpZiAoIWFwcE5hbWUpIHtcbiAgICAgICAgYXBwTmFtZSA9IFZlcmRvY3NTdGF0ZVNlcnZpY2UuUkFDQ09VTlRfQ09PS0lFX05BTUU7XG4gICAgICB9XG4gICAgICBjb25zdCBjb29raWUgPSB0aGlzLmNvb2tpZVNlcnZpY2UuZ2V0T2JqZWN0KGFwcE5hbWUpO1xuICAgICAgbGV0IGlkVG9rZW47XG4gICAgICBpZiAoY29va2llICYmIGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLklEX1RPS0VOX05BTUVdKSB7XG4gICAgICAgIGlkVG9rZW4gPSBjb29raWVbVmVyZG9jc1N0YXRlU2VydmljZS5JRF9UT0tFTl9OQU1FXTtcbiAgICAgICAgY29uc3QgaWRUb2tlbkNvbnRlbnQgPSB0aGlzLnRva2VuVG9PYmplY3QoaWRUb2tlbik7XG4gICAgICAgIGlmIChpZFRva2VuQ29udGVudFsnc3ViJ10pIHtcbiAgICAgICAgICByZXR1cm4gaWRUb2tlbkNvbnRlbnRbJ3N1YiddLnJlcGxhY2UoJ2F1dGgwfCcsICcnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIHVwZGF0ZUNvb2tpZShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZywgY29va2llTmFtZT86IHN0cmluZykge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgY29uc3QgY05hbWUgPSBjb29raWVOYW1lID8gY29va2llTmFtZSA6IHRoaXMuY29va2llTmFtZTtcbiAgICAgIHRoaXMuY29va2llQ29uZmlnLmRvbWFpbiA9IHRoaXMuZ2V0RG9tYWluKCk7XG4gICAgICBpZiAod2luZG93ICYmIHdpbmRvdy5sb2NhdGlvbiAmJiBsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHBzOicpIHtcbiAgICAgICAgdGhpcy5jb29raWVDb25maWcuc2VjdXJlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGxldCByQWNjb3VudENvb2tpZSA9IHRoaXMuZ2V0ckFjY291bnRDb29raWVPYmplY3QoKTtcbiAgICAgIGxldCBvdGhlckNvb2tpZSA9IHRoaXMuZ2V0T3RoZXJDb29raWVPYmplY3QoY05hbWUpO1xuICAgICAgbGV0IGNvb2tpZTtcbiAgICAgIGlmICghIWNOYW1lICYmICEha2V5ICYmICEhdmFsdWUpIHtcbiAgICAgICAgaWYgKGNOYW1lID09PSBWZXJkb2NzU3RhdGVTZXJ2aWNlLlJBQ0NPVU5UX0NPT0tJRV9OQU1FICYmICEhckFjY291bnRDb29raWUpIHtcbiAgICAgICAgICByQWNjb3VudENvb2tpZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgY29va2llID0gckFjY291bnRDb29raWU7XG4gICAgICAgIH0gZWxzZSBpZiAoISFvdGhlckNvb2tpZSkge1xuICAgICAgICAgIG90aGVyQ29va2llW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICBjb29raWUgPSBvdGhlckNvb2tpZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvb2tpZVNlcnZpY2UucHV0T2JqZWN0KGNOYW1lLCBjb29raWUsIHRoaXMuY29va2llQ29uZmlnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1cGRhdGVUb2tlbnMoclNlY3VyZUJhY2tlbmQpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFRva2VucyhyU2VjdXJlQmFja2VuZCkucGlwZShcbiAgICAgICAgbWFwKCh0b2tlbnM6IGFueVtdKSA9PiB7XG4gICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0b2tlbnMubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIGlmICh0b2tlbnNbeF0uY2xpZW50TmFtZSA9PT0gJ3JBY2NvdW50Jykge1xuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvb2tpZShWZXJkb2NzU3RhdGVTZXJ2aWNlLklEX1RPS0VOX05BTUUsIHRva2Vuc1t4XS5pZFRva2VuLCB0b2tlbnNbeF0uY2xpZW50TmFtZSArIFZlcmRvY3NTdGF0ZVNlcnZpY2UuQ09PS0lFX05BTUVfU1VGRklYKTtcbiAgICAgICAgICAgICAgdGhpcy5kZWNvZGVkSWRUb2tlblN1YmplY3QubmV4dChoZWxwZXIuZGVjb2RlVG9rZW4odG9rZW5zW3hdLmlkVG9rZW4pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ29va2llKFZlcmRvY3NTdGF0ZVNlcnZpY2UuQUNDRVNTX1RPS0VOX05BTUUsIHRva2Vuc1t4XS5hY2Nlc3NUb2tlbiwgdG9rZW5zW3hdLmNsaWVudE5hbWUgKyBWZXJkb2NzU3RhdGVTZXJ2aWNlLkNPT0tJRV9OQU1FX1NVRkZJWCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0b2tlbnM7XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGhhc0Nvb2tpZSgpIHtcbiAgICByZXR1cm4gISF0aGlzLmNvb2tpZVNlcnZpY2UuZ2V0KHRoaXMuY29va2llTmFtZSk7XG4gIH1cblxuICBnZXRBY2Nlc3NMaXN0KCkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgdGhpcy5nZXRBbGxDb29raWVzKCk7XG4gICAgICB0aGlzLmFjY2Vzc0xpc3QgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgY29va2llIGluIHRoaXMuY29va2llcykge1xuICAgICAgICBpZiAoY29va2llLmluZGV4T2YoVmVyZG9jc1N0YXRlU2VydmljZS5DT09LSUVfTkFNRV9TVUZGSVgpICE9PSAtMSkge1xuICAgICAgICAgIHRoaXMuYWNjZXNzTGlzdC5wdXNoKGNvb2tpZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmFjY2Vzc0xpc3Q7XG4gICAgfVxuICB9XG5cbiAgZ2V0RW1haWxWZXJpZmljYXRpb24oKTogYm9vbGVhbiB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICBjb25zdCBpZFRva2VuID0gdGhpcy5nZXRJRFRva2VuKCk7XG4gICAgICBpZiAoISFpZFRva2VuKSB7XG4gICAgICAgIGNvbnN0IGlkVG9rZW5Db250ZW50ID0gdGhpcy50b2tlblRvT2JqZWN0KGlkVG9rZW4pO1xuICAgICAgICByZXR1cm4gaWRUb2tlbkNvbnRlbnRbJ2VtYWlsX3ZlcmlmaWVkJ107XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgaGFzQWNjZXNzVG8oY2xpZW50TmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuYWNjZXNzTGlzdC5pbmRleE9mKGNsaWVudE5hbWUpICE9PSAtMTtcbiAgfVxuXG4gIHN0b3JlT3RoZXJDb29raWUoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgdGhpcy5zZXRDb29raWUoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0T3RoZXJDb29raWUoa2V5KSB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmNvb2tpZVNlcnZpY2UuZ2V0T2JqZWN0KGtleSk7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignQ2Fubm90IHJldHVybiBjb29raWU6JywgZXJyKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0UkNvb2tpZShrZXk6IHN0cmluZykge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgcmV0dXJuIHRoaXMuY29va2llU2VydmljZS5nZXQoa2V5KTtcbiAgICB9XG4gIH1cblxuICBnZXRPdGhlckNvb2tpZU9iamVjdChrZXkpIHtcbiAgICB0cnkge1xuICAgICAgaWYgKCEha2V5KSB7XG4gICAgICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvb2tpZVNlcnZpY2UuZ2V0T2JqZWN0KGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGtleSAhPT0gVmVyZG9jc1N0YXRlU2VydmljZS5TSUdORVJfVE9LRU5fQ09PS0lFX05BTUUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignQ2Fubm90IGdldCBjb29raWU6ICcsIGVycik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICByZW1vdmVSQ29va2llKGtleSkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgdGhpcy5jb29raWVTZXJ2aWNlLnJlbW92ZShrZXksIHRoaXMuY29va2llQ29uZmlnKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVSQ29va2llcygpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGlmICh0aGlzLmFjY2Vzc0xpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiB0aGlzLmFjY2Vzc0xpc3QpIHtcbiAgICAgICAgICB0aGlzLnJlbW92ZVJDb29raWUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVJbnRlcmNvbUNvb2tpZSgpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGZvciAoY29uc3QgY29va2llIGluIHRoaXMuY29va2llcykge1xuICAgICAgICBpZiAoY29va2llLmluZGV4T2YoJ2ludGVyY29tJykgIT09IC0xKSB7XG4gICAgICAgICAgdGhpcy5yZW1vdmVSQ29va2llKGNvb2tpZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXRUb2tlbnModG9rZW5zKSB7XG4gICAgaWYgKGlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XG4gICAgICBpZiAodG9rZW5zICYmIHRva2Vucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgdG9rZW4gb2YgdG9rZW5zKSB7XG4gICAgICAgICAgaWYgKHRva2VuLmNsaWVudE5hbWUgPT09ICdyQWNjb3VudCcpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ29va2llKFZlcmRvY3NTdGF0ZVNlcnZpY2UuSURfVE9LRU5fTkFNRSwgdG9rZW4uaWRUb2tlbiwgdG9rZW4uY2xpZW50TmFtZSArIFZlcmRvY3NTdGF0ZVNlcnZpY2UuQ09PS0lFX05BTUVfU1VGRklYKTtcbiAgICAgICAgICAgIHRoaXMuZGVjb2RlZElkVG9rZW5TdWJqZWN0Lm5leHQoaGVscGVyLmRlY29kZVRva2VuKHRva2VuLmlkVG9rZW4pKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy51cGRhdGVDb29raWUoVmVyZG9jc1N0YXRlU2VydmljZS5BQ0NFU1NfVE9LRU5fTkFNRSwgdG9rZW4uYWNjZXNzVG9rZW4sIHRva2VuLmNsaWVudE5hbWUgKyBWZXJkb2NzU3RhdGVTZXJ2aWNlLkNPT0tJRV9OQU1FX1NVRkZJWCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldHJBY2NvdW50Q29va2llT2JqZWN0KCkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHRoaXMuY29va2llTmFtZSAmJiB0aGlzLmNvb2tpZVNlcnZpY2UuZ2V0KFZlcmRvY3NTdGF0ZVNlcnZpY2UuUkFDQ09VTlRfQ09PS0lFX05BTUUpKSB7XG4gICAgICAgICAgY29uc3QgY29va2llID0gdGhpcy5jb29raWVTZXJ2aWNlLmdldE9iamVjdChWZXJkb2NzU3RhdGVTZXJ2aWNlLlJBQ0NPVU5UX0NPT0tJRV9OQU1FKTtcbiAgICAgICAgICByZXR1cm4gY29va2llO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0QWxsQ29va2llcygpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIHRoaXMuY29va2llcyA9IHRoaXMuY29va2llU2VydmljZS5nZXRBbGwoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRva2VuVG9PYmplY3QodG9rZW4pIHtcbiAgICBpZiAodG9rZW4pIHtcbiAgICAgIGNvbnN0IGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2Uod2luZG93LmF0b2IoYmFzZTY0KSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb29raWUoY29va2llTmFtZSwgY29va2llVmFsdWUpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIHRoaXMuY29va2llU2VydmljZS5wdXQoY29va2llTmFtZSwgY29va2llVmFsdWUsIHRoaXMuY29va2llQ29uZmlnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFRva2VucyhyU2VjdXJlQmFja2VuZCkge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHJTZWN1cmVCYWNrZW5kICsgJy90b2tlbicpXG4gIH1cblxuICBwdWJsaWMgZ2V0UkFjY291bnRSb2xlcygpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGNvbnN0IGNvb2tpZSA9IHRoaXMuY29va2llU2VydmljZS5nZXRPYmplY3QoVmVyZG9jc1N0YXRlU2VydmljZS5SQUNDT1VOVF9DT09LSUVfTkFNRSk7XG4gICAgICBpZiAoISFjb29raWUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLkFDQ0VTU19UT0tFTl9OQU1FXTtcbiAgICAgICAgICBjb25zdCB0b2tlbk9iamVjdCA9IHRoaXMudG9rZW5Ub09iamVjdChhY2Nlc3NUb2tlbik7XG4gICAgICAgICAgcmV0dXJuIHRva2VuT2JqZWN0W2Ake1ZlcmRvY3NTdGF0ZVNlcnZpY2UuVE9LRU5fTkFNRVNQQUNFfS9yb2xlc2BdO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRQbGFucygpIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcbiAgICAgIGNvbnN0IGNvb2tpZSA9IHRoaXMuY29va2llU2VydmljZS5nZXRPYmplY3QoVmVyZG9jc1N0YXRlU2VydmljZS5SQUNDT1VOVF9DT09LSUVfTkFNRSk7XG4gICAgICBpZiAoISFjb29raWUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGNvb2tpZVtWZXJkb2NzU3RhdGVTZXJ2aWNlLkFDQ0VTU19UT0tFTl9OQU1FXTtcbiAgICAgICAgICBjb25zdCB0b2tlbk9iamVjdCA9IHRoaXMudG9rZW5Ub09iamVjdChhY2Nlc3NUb2tlbik7XG4gICAgICAgICAgcmV0dXJuIHRva2VuT2JqZWN0W2Ake1ZlcmRvY3NTdGF0ZVNlcnZpY2UuVE9LRU5fTkFNRVNQQUNFfS9wbGFuc2BdO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19