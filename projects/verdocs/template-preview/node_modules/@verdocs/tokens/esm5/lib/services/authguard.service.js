/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Inject, forwardRef } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { VerdocsAuthService } from './auth.service';
import { VerdocsStateService } from './state.service';
var VerdocsAuthGuardService = /** @class */ (function () {
    // handle redirects based on authentication state
    function VerdocsAuthGuardService(authService, stateService, route) {
        this.authService = authService;
        this.stateService = stateService;
        this.route = route;
        this.signOutRequestSubmitted = false;
        /** @type {?} */
        var snapshot = (/** @type {?} */ (this.route.snapshot));
    }
    /**
     * @return {?}
     */
    VerdocsAuthGuardService.prototype.checkLogin = /**
     * @return {?}
     */
    function () {
        if (!this.authService.isAuthenticated) {
            if (this.stateService.getLoginURL()) {
                this.signOut();
            }
        }
        this.stateService.watchAuthentication();
    };
    /**
     * @return {?}
     */
    VerdocsAuthGuardService.prototype.checkAuthentication = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var authenticated = this.authService.isAuthenticated();
        if (!authenticated) {
            this.signOut();
        }
    };
    /**
     * @param {?=} redirectUrl
     * @return {?}
     */
    VerdocsAuthGuardService.prototype.signOut = /**
     * @param {?=} redirectUrl
     * @return {?}
     */
    function (redirectUrl) {
        if (!this.signOutRequestSubmitted) {
            this.signOutRequestSubmitted = true;
            if (!this.authService.isAuthenticated()) {
                redirectUrl = window.location.href;
            }
            this.stateService.removeRCookies();
            this.stateService.removeIntercomCookie();
            /** @type {?} */
            var redirectUrlParam = (this.stateService.getLoginURL() && this.stateService.getLoginURL().includes('?') ? '&' : '?') + 'redirect_url';
            window.location.href = this.stateService.getLoginURL() + (redirectUrl ? redirectUrlParam + "=" + redirectUrl : '');
        }
    };
    VerdocsAuthGuardService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    VerdocsAuthGuardService.ctorParameters = function () { return [
        { type: VerdocsAuthService, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return VerdocsAuthService; })),] }] },
        { type: VerdocsStateService, decorators: [{ type: Inject, args: [forwardRef((/**
                         * @return {?}
                         */
                        function () { return VerdocsStateService; })),] }] },
        { type: ActivatedRoute }
    ]; };
    return VerdocsAuthGuardService;
}());
export { VerdocsAuthGuardService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    VerdocsAuthGuardService.prototype.signOutRequestSubmitted;
    /**
     * @type {?}
     * @private
     */
    VerdocsAuthGuardService.prototype.authService;
    /**
     * @type {?}
     * @private
     */
    VerdocsAuthGuardService.prototype.stateService;
    /**
     * @type {?}
     * @private
     */
    VerdocsAuthGuardService.prototype.route;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGd1YXJkLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AdmVyZG9jcy90b2tlbnMvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvYXV0aGd1YXJkLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRCxPQUFPLEVBQUUsY0FBYyxFQUEwQixNQUFNLGlCQUFpQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXREO0lBSUUsaURBQWlEO0lBQ2pELGlDQUN3RCxXQUErQixFQUM5QixZQUFpQyxFQUNoRixLQUFxQjtRQUZ5QixnQkFBVyxHQUFYLFdBQVcsQ0FBb0I7UUFDOUIsaUJBQVksR0FBWixZQUFZLENBQXFCO1FBQ2hGLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBTnZCLDRCQUF1QixHQUFHLEtBQUssQ0FBQzs7WUFRaEMsUUFBUSxHQUFHLG1CQUF3QixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBQTtJQUM5RCxDQUFDOzs7O0lBRUQsNENBQVU7OztJQUFWO1FBQ0UsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxFQUFFO1lBQ3JDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsRUFBRTtnQkFDbkMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2FBQ2hCO1NBQ0Y7UUFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLG1CQUFtQixFQUFFLENBQUM7SUFDMUMsQ0FBQzs7OztJQUVELHFEQUFtQjs7O0lBQW5COztZQUNRLGFBQWEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsRUFBRTtRQUN4RCxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNoQjtJQUNILENBQUM7Ozs7O0lBRUQseUNBQU87Ozs7SUFBUCxVQUFRLFdBQW9CO1FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUU7WUFDakMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLElBQUksQ0FBQztZQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEVBQUUsRUFBRTtnQkFDdkMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFBO2FBQ25DO1lBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUNuQyxJQUFJLENBQUMsWUFBWSxDQUFDLG9CQUFvQixFQUFFLENBQUM7O2dCQUNuQyxnQkFBZ0IsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsY0FBYztZQUN4SSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBSSxnQkFBZ0IsU0FBSSxXQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3BIO0lBQ0gsQ0FBQzs7Z0JBeENGLFVBQVU7Ozs7Z0JBSEYsa0JBQWtCLHVCQVN0QixNQUFNLFNBQUMsVUFBVTs7O3dCQUFDLGNBQU0sT0FBQSxrQkFBa0IsRUFBbEIsQ0FBa0IsRUFBQztnQkFSdkMsbUJBQW1CLHVCQVN2QixNQUFNLFNBQUMsVUFBVTs7O3dCQUFDLGNBQU0sT0FBQSxtQkFBbUIsRUFBbkIsQ0FBbUIsRUFBQztnQkFYeEMsY0FBYzs7SUE2Q3ZCLDhCQUFDO0NBQUEsQUF6Q0QsSUF5Q0M7U0F4Q1ksdUJBQXVCOzs7Ozs7SUFDbEMsMERBQXdDOzs7OztJQUl0Qyw4Q0FBcUY7Ozs7O0lBQ3JGLCtDQUF3Rjs7Ozs7SUFDeEYsd0NBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBmb3J3YXJkUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgQWN0aXZhdGVkUm91dGVTbmFwc2hvdCB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBWZXJkb2NzQXV0aFNlcnZpY2UgfSBmcm9tICcuL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBWZXJkb2NzU3RhdGVTZXJ2aWNlIH0gZnJvbSAnLi9zdGF0ZS5zZXJ2aWNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFZlcmRvY3NBdXRoR3VhcmRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzaWduT3V0UmVxdWVzdFN1Ym1pdHRlZCA9IGZhbHNlO1xuXG4gIC8vIGhhbmRsZSByZWRpcmVjdHMgYmFzZWQgb24gYXV0aGVudGljYXRpb24gc3RhdGVcbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IFZlcmRvY3NBdXRoU2VydmljZSkpIHByaXZhdGUgYXV0aFNlcnZpY2U6IFZlcmRvY3NBdXRoU2VydmljZSxcbiAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gVmVyZG9jc1N0YXRlU2VydmljZSkpIHByaXZhdGUgc3RhdGVTZXJ2aWNlOiBWZXJkb2NzU3RhdGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGU6IEFjdGl2YXRlZFJvdXRlLFxuICApIHtcbiAgICBjb25zdCBzbmFwc2hvdCA9IDxBY3RpdmF0ZWRSb3V0ZVNuYXBzaG90PnRoaXMucm91dGUuc25hcHNob3RcbiAgfVxuXG4gIGNoZWNrTG9naW4oKSB7XG4gICAgaWYgKCF0aGlzLmF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCkge1xuICAgICAgaWYgKHRoaXMuc3RhdGVTZXJ2aWNlLmdldExvZ2luVVJMKCkpIHtcbiAgICAgICAgdGhpcy5zaWduT3V0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc3RhdGVTZXJ2aWNlLndhdGNoQXV0aGVudGljYXRpb24oKTtcbiAgfVxuXG4gIGNoZWNrQXV0aGVudGljYXRpb24oKSB7XG4gICAgY29uc3QgYXV0aGVudGljYXRlZCA9IHRoaXMuYXV0aFNlcnZpY2UuaXNBdXRoZW50aWNhdGVkKCk7XG4gICAgaWYgKCFhdXRoZW50aWNhdGVkKSB7XG4gICAgICB0aGlzLnNpZ25PdXQoKTtcbiAgICB9XG4gIH1cblxuICBzaWduT3V0KHJlZGlyZWN0VXJsPzogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLnNpZ25PdXRSZXF1ZXN0U3VibWl0dGVkKSB7XG4gICAgICB0aGlzLnNpZ25PdXRSZXF1ZXN0U3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgIGlmICghdGhpcy5hdXRoU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkge1xuICAgICAgICByZWRpcmVjdFVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmXG4gICAgICB9XG4gICAgICB0aGlzLnN0YXRlU2VydmljZS5yZW1vdmVSQ29va2llcygpO1xuICAgICAgdGhpcy5zdGF0ZVNlcnZpY2UucmVtb3ZlSW50ZXJjb21Db29raWUoKTtcbiAgICAgIGNvbnN0IHJlZGlyZWN0VXJsUGFyYW0gPSAodGhpcy5zdGF0ZVNlcnZpY2UuZ2V0TG9naW5VUkwoKSAmJiB0aGlzLnN0YXRlU2VydmljZS5nZXRMb2dpblVSTCgpLmluY2x1ZGVzKCc/JykgPyAnJicgOiAnPycpICsgJ3JlZGlyZWN0X3VybCc7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHRoaXMuc3RhdGVTZXJ2aWNlLmdldExvZ2luVVJMKCkgKyAocmVkaXJlY3RVcmwgPyBgJHtyZWRpcmVjdFVybFBhcmFtfT0ke3JlZGlyZWN0VXJsfWAgOiAnJyk7XG4gICAgfVxuICB9XG59XG4iXX0=